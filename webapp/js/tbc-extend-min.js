/** 
 * -------------------------------------------------------------
 * Copyright (c) 2013 时代光华, All rights reserved. 
 * http://www.21tb.com/ 
 *  
 * @version: 0.0.1 
 * @author: Colin <mail@luozhihua.com> 
 * @description: TBC Javascript Project 
 * @build time: Thu Apr 24 2014 14:17:12 GMT+0800 (中国标准时间) 
 * ------------------------------------------------------------- 
 */ 

function t(a){$("#tips").append("<div>"+a+"; </div>")}!function(a,b){"use strict";function c(a,b){var c;if("string"==typeof a){for(c=0;c<b.length;c+=1)if(a===b[c])return!1;return!0}}function d(a){a=a.toLowerCase();var b=j.exec(a)||k.exec(a)||l.exec(a)||a.indexOf("compatible")<0&&m.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}}function e(){var a,b,c,d,e=[this];for(this.parentClass=this.parentClass||[],a=0;a<arguments.length;a+=1){for(d=null,b=0,c=this.parentClass.length;c>b;b+=1)if(this.parentClass[b]===arguments[a]){d=!0;break}d||(this.parentClass.push(arguments[a]),e.push(arguments[a]))}return f.extend.apply(this,e),e=null,this}var f,g,h,e,i=a.navigator.userAgent,j=/(webkit)[ \/]([\w.]+)/,k=/(opera)(?:.*version)?[ \/]([\w.]+)/,l=/(msie) ([\w.]+)/,m=/(mozilla)(?:.*? rv:([\w.]+))?/;!function(){return}(),a.console=a.console||{log:function(){}},a.tbc=f=a.tbc||{nspath:"tbc"},f.namespace=f.ns=function(a,b){a=a.split(/[.\/\\>]/);var c,d,e=b||f,g=e.nspath||"window";for(c=0,d=a.length;d>c;c+=1)(0!==c||"tbc"!==a[c])&&(g+="."+a[c],e[a[c]]=e[a[c]]||{superClass:e},e[a[c]].nspath=e[a[c]].nspath||g,e=e[a[c]]);try{return e}finally{e=g=null}},f.version="1.0",f.self=function(a,b){var c=b||[],d=c[c.length-1],g=d&&"object"==typeof d&&d.subclass?d.subclass:a;g&&(g.extend=e,g.extend(f.ClassManager,f.Event));try{return g}finally{c=d=g=null}},f.extend=function(){var a,b,d,e=arguments,f=e.length,g="nspath,superClass,extend,iid,guid,packageName";if(g=g.split(","),f>1)for(b=1;f>b;b+=1){switch(typeof e[b]){case"object":a=e[b]&&e[b].constructor===Array&&"function"==typeof e[b][0]?new e[b][0](e[b][1],{subclass:e[0]}):e[b];break;case"function":a=new e[b]({subclass:e[0]});break;default:a={}}for(d in a)a.hasOwnProperty(d)&&c(d,g)!==!1&&"undefined"!=typeof a[d]&&(arguments[0][d]=a[d])}try{return arguments[0]}finally{e=a=null}},h=d(i),h.browser&&(f[h.browser]=!0,f.browserVersion=h.version),f.touchable="ontouchstart"in document.documentElement,g={getCoordinate:function(a,c){a=b("string"==typeof a?document.getElementById(a):a);var d=a.size()?a.offset():{left:0,top:0},e={left:d.left,top:d.top,bottom:0,right:0,width:a.outerWidth(),height:a.outerHeight()};e.right=e.left+e.width,e.bottom=e.top+e.height;try{return e}finally{e=a=c=d=null}},getScroll:function(a,b){var c={top:0,left:0},d=a.parentNode;if(d||d&&"body"===d.nodeName)return c;for(;d&&d!==(b||document.body);)c.left+=d.scrollLeft||0,c.top+=d.scrollTop||0,d=d.parentNode;try{return c}finally{a=d=b=c=null}},cookie:function(a,b){return"undefined"==typeof b?this.getCookie(a):(b=""+b,void this.setCookie.apply(this,arguments))},setCookie:function(a,b,c,d,e){var f,g="";c&&(f=new Date,f.setDate(f.getDate()+c),g=";expires="+f.toGMTString()),d=";domain="+(d||document.location.host),e=";path="+(e||"/"),document.cookie=[a,"=",escape(b),g,e,d].join("")},getCookie:function(a){var b,c,d=document.cookie;return d&&d.length>0&&(b=d.lastIndexOf(a+"="),-1!==b)?(b=b+a.length+1,c=d.indexOf(";",b),-1===c&&(c=d.length),unescape(d.substring(b,c))):""},lock:function(a,c){a=b(a||document.body);var d="number"==typeof c?{zIndex:c}:c,e=a.css("position"),f=b.isNumeric(c)?c:this.getMaxZIndex(a),g=a.innerWidth(),h=a.innerHeight(),i=b('<div class="elem_mask"></div>').appendTo(a);d=b.extend({position:"absolute",top:0,left:0,width:g,cursor:"wait",height:h,backgroundColor:"#000",opacity:.2,zIndex:f+1},d),i.css(d),e&&"static"!==e&&""!==e||a.css({position:"relative"});try{return i}finally{a=e=i=f=d=null}},unlock:function(a){a=b(a||document.body),a.children(".elem_mask").fadeOut(200,function(){b(this).remove(),a=null})},percentToInt:function(b,c){return"string"==typeof b&&b.match(/%$/)?a.parseInt(b)/100*c:b},percentToFloat:function(b,c){return"string"==typeof b&&b.match(/%$/)?a.parseFloat(b)/100*c:b},substr:function(a,b){if(!a||!b)return a||"";var c=0,d=0,e="";for(d=0;d<a.length;d+=1){if(c+=a.charCodeAt(d)>255?2:1,c>b)return e;e+=a.charAt(d)}return a},formatString:function(a){if(0===arguments.length)return"";var b,c;for(b=1;b<arguments.length;b+=1)c=new RegExp("\\{"+(b-1)+"\\}","gm"),a=a.replace(c,arguments[b]);return a},stringTemplate:function(a,b,c){if(b&&"object"!=typeof b)return a;c=c||{};var d,e;for(d in b)b.hasOwnProperty(d)&&(e=new RegExp("\\{"+d+"\\}","gm"),a=a.replace(e,c[b[d]]||b[d]||""));return a=a.replace(/\{\w+\}/g,"")},getMaxZIndex:function(a){var c,d=0;a=b(a||"body"),c=a.children(),c.each(function(){var a=b(this).css("zIndex");a=a&&!isNaN(a)?a:0,d=Math.max(d,a)});try{return d}finally{c=a=null}},getElementByMaxZIndex:function(a,c){a=b(a),c=b(c);for(var d,e,f,g,h=a[0],i=c[0];h&&h!==document.body;){for(d=h.offsetParent;d&&i&&i!==document.body;){if(e=i.offsetParent,e&&d===e){f=b(h).css("zIndex"),g=b(i).css("zIndex"),f="auto"===f?0:f,g="auto"===g?0:g;var j=-1===b(d).nextAll().index(e);return h=i=d=e=null,f>g?a:f===g&&j?a:c}i=e}i=c[0],h=d}},getCursorPosition:function(a){var b={text:"",start:0,end:0};if(a.focus(),a.setSelectionRange)b.start=a.selectionStart,b.end=a.selectionEnd,b.text=b.start!==b.end?a.value.substring(b.start,b.end):"";else if(document.selection){var c,d=document.selection.createRange(),e=document.body.createTextRange();for(e.moveToElementText(a),b.text=d.text,b.bookmark=d.getBookmark(),c=0;e.compareEndPoints("StartToStart",d)<0&&0!==d.moveStart("character",-1);c++)"\n"===a.value.charAt(c)&&c++;b.start=c,b.end=b.text.length+b.start}return b},setCursorPosition:function(a,b){if(b||alert("You must get cursor position first."),a.setSelectionRange)a.focus(),a.setSelectionRange(b.start,b.end);else if(a.createTextRange){var c=a.createTextRange();a.value.length===b.start?(c.collapse(!1),c.select()):(c.moveToBookmark(b.bookmark),c.select())}},setCursors:function(a,b,c){a.setSelectionRange?(a.focus(),a.setSelectionRange(b,c)):a.createTextRange&&(range=a.createTextRange(),range.collapse(!0),range.moveEnd("character",c),range.moveStart("character",b),range.select())},setCursor:function(a){var b=this.getCursorPosition(a);this.setCursorPosition(a,b)},batch:function(c,d,e,g,h,i){if(!b.isArray(c))return!1;e=e||0,d=d||1e3,g=g||20;var j=e*d,k=c.length,l=Math.min((e+1)*d,k),m=c.slice(j,l);b.isFunction(h)?h(m,l===k,e):a.console&&console.log("Error: tbc.batch(...). arguments[4] must be a function;"),setTimeout(function(){e+=1,k>d*e&&f.batch(c,d,e,g,h,i)},g),l===k&&b.isFunction(i)&&i.call(this)},seriesForm:function(a){var c,d=b("input,textarea,select",a),e=[],f={},g=[],h={};d.each(function(){var a=this.tagName.toLowerCase();if(this.disabled)return!0;switch(a){case"input":switch(this.type){case"checkbox":f[this.name]=f[this.name]||[],this.checked&&f[this.name].push(this.value);break;case"radio":h[this.name]=h[this.name]||[],this.checked&&h[this.name].push(this.value);break;case"button":case"reset":break;case"submit":if(!b(this).hasClass("trigger_aspnet_event"))break;default:e.push([this.name||this.id,encodeURIComponent(this.value)].join("="))}break;case"textarea":e.push([this.name||this.id,encodeURIComponent(this.value)].join("="));break;case"select":b("option",this).each(function(){this.selected&&g.push(encodeURIComponent(this.value))}),e.push([this.name||this.id,g.join(",")].join("="));break;case"button":e.push([this.name||this.id,encodeURIComponent(this.value)].join("="))}}),d=null;for(c in f)e.push([c,f[c].join(",")].join("="));for(c in h)e.push([c,h[c].join(",")].join("="));try{return e.join("&")}finally{e=h=f=g=null}},replaceUrlParam:function(a,c,d){var e=this.isObject(a)?a:function(){var b={};return b[a]=c,b}(),f=d||document.location.search;f=f.substring(f.indexOf("?")+1).split("&");var g={};return b.each(f,function(){var a=this.split("=");g[a[0]]=a[1]||""}),b.extend(g,e),g},mergerPath:function(a,b){var a=a||document.location.href;if(b.match(/^https?:\/\//)){return b}var c=a.split("?")[0].split("/");if(c.length--,!b.match(/^\/{1}/)){for(;0===b.indexOf("../");)b=b.slice(3),c.length--;b=unescape(c.join("/")+"/"+b)}return b},randomString:function(a){a=a?a-1:15;var b="0123456789abcdefghijklmnoprstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+|=-`";return function(a,b,c){return(c?arguments.callee(a,b,c-1):"")+b[a.floor(a.random()*b.length)]}(Math,b,a)},i18nData:{},i18n:function(a){var b,c,d,e="<i class=I18N data-key={0}>{1}<i></i></i>",g=f.cookie("translationMode"),h=/^\!/;return c=!!a.match(h),a=a.replace(h,""),b=a?f.i18nData[a]||a:"",b=b.replace(/\'/g,"\\'"),arguments.length>1&&(d=Array.prototype.slice.call(arguments,1),d=[b].concat(d),b=f.formatString.apply(f,d)),"true"!==g||c||(b=c?a+"="+b:f.formatString(e,a,b)),b},getLocal:function(){return f.cookie("local_")},randColor:function(a){return function(a,b,c){return(c>0?arguments.callee(a,b,c-1):"#")+b[a.floor(16*a.random())]}(Math,a||["1","2","3","4","5","6","7","8","9","0","a","b","c","d","e","f"],5)},random:function(a,b){switch(arguments.length){case 1:return Math.floor(Math.random()*a+1);case 2:return Math.floor(Math.random()*(b-a+1)+a);default:return 0}},isSight:function(a){var c=b(a)[0]?b(a)[0].parentNode:a,d=this.getCoordinate(b(a)[0]),e=this.getCoordinate(b(a)[0]);if(d.top<e.top||d.top>e.bottom||d.left<e.left)return!1;try{return!0}finally{c=a=d=e=null}},inArea:function(a,b){var c=this.getCoordinate(a),d=this.getCoordinate(b);if(d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.left>c.left&&d.right<c.right&&d.top>c.top&&d.bottom<c.bottom)return!0;try{return!1}finally{a=b=c=d=null}},isIncline:function(a,b){var c=this.getCoordinate(a),d=this.getCoordinate(b);if(d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.centerX>c.left&&d.centerX<c.right&&d.centerY>c.top&&d.centerY<c.bottom)return!0;try{return!1}finally{a=b=c=d=null}},isOverlap:function(a,c){var d=b.isPlainObject(a)?a:this.getCoordinate(a),e=b.isPlainObject(c)?c:this.getCoordinate(c),f=Math.max(d.left,e.left),g=Math.max(d.top,e.top),h=Math.min(d.right,e.right),i=Math.min(d.bottom,e.bottom);try{return h>f&&i>g}finally{a=c=d=e=null}},center:function(a,c,d){a=b(a),c=b(c);var e,f,g,h,i=a.width(),j=a.height(),k=a.css("left"),l=a.css("top");c.size()?(e=c.innerWidth(),f=c.innerHeight(),g=c.scrollTop(),h=c.scrollLeft()):(e=document.documentElement.clientWidth||document.documentElement.offsetWidth,f=document.documentElement.clientHeight||document.documentElement.offsetHeight,g=Math.max(document.documentElement.scrollTop,document.body.scrollTop),h=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)),k=i>e?h:e/2+h-i/2,l=j>f?g:f/2+g-j/2,a.css({top:l,left:k,width:i,height:j}),d=d||c,b.isFunction(d)&&d.call(a)},array:{unique:function(a){var b,c,d,e,f=[];for(c=0,d=a.length;d>c;c+=1){for(b=!1,e=0;e<f.length;e+=1)a[c]===f[e]&&(b=!0);b!==!0&&f.push(a[c])}try{return f}finally{f=null}},merge:function(){var a,b=arguments,c=b.length,d=[];for(a=0;c>a;a+=1)"object"==typeof b[a]&&b[a].constructor===Array&&(d=d.concat(b[a]));try{return this.unique(d)}finally{b=d=null}},clear:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b+=1)"undefined"!=typeof a[b]&&d.push(a[b]);try{return d}finally{d=null}},remove:function(a){var c=[],d=arguments;return d=f.isArray(d[1])?[1].concat(d[1]):d,b.each(a,function(a,b){var e,f,g=!1;for(e=1,f=d.length;f>e;e+=1)if(!g&&d[e]===b){g=!0;break}g||c.push(b)}),c},indexOf:function(a,b){var c,d;for(b=b&&"object"==typeof b&&b.constructor===Array?b:[],c=0,d=b.length;d>c;c+=1)if(a===b[c])return c;return-1},sort:function(a,b){var c;c=a.sort("string"==typeof b&&"desc"===b.toLowerCase()?this.sortASC:"function"==typeof b?b:this.sortDESC);try{return c}finally{c=null}},sortASC:function(a,b){return a-b},sortDESC:function(a,b){return b-a}},isNumber:function(a){return"number"==typeof a},isString:function(a){return"string"==typeof a},isFunction:function(a){return"function"==typeof a},isNull:function(a){return null===a},isBool:function(a){return"boolean"==typeof a},isArray:function(a){return!!a&&a.constructor===Array},isObject:function(a){return!!a&&a.constructor===Object},debug:{printObj:function(a,b){var c,d=["{\n"];for(c in a)a.hasOwnProperty(c)&&d.push(b?"    "+c+":"+a[c]+",\n":"    "+c+"; ");return d.push("}"),d.join("")}},log:function(b){a.console&&a.console.log(b)},st:function(){return this.st.time=(new Date).getTime(),this.st.time},et:function(){var a=(new Date).getTime(),b="tbc.et: "+(a-this.st.time);return f.log(b),a-this.st.time}},f.extend(f,g),a.i18n||(a.i18n=function(){return f.i18n.apply(f,arguments)})}(window,jQuery),function(){Function.prototype.bind=Function.prototype.bind||function(){var a=this,b=arguments[0],c=Array.prototype.slice.call(arguments,1);return function(){var d=Array.prototype.concat.apply(c,arguments);return a.apply(b,d)}}}(),function(a,b){"use strict";a.Event=function(){a.self(this,arguments).extend({init:function(){return this.packageName="tbc.Event",this},eventStorage:{},REMOVE:function(a,b){if("function"==typeof b){var c,d,e=this.eventStorage[a],f=[];if("object"==typeof e&&e.constructor===Array){for(c=0,d=e.length;d>c;c+=1)e[c].toString()!==b.toString()&&f.push(e[c]);this.eventStorage[a]=f}}else this.eventStorage[a]=[]},TRIGGER:function(a,b){var c,d,e,f=this.eventStorage[a];if("object"==typeof f&&f.constructor===Array)for(e=f.length-1;e>-1;e-=1)if("function"==typeof f[e])try{if(d=f[e].apply(this,b),c=d===!1?!1:c,d===!0)return!0}catch(g){}return c===!1?!1:c},addEvent:function(a,c){var d,e,f,g,h,i=this.eventStorage;if("object"==typeof a){for(d in a)a.hasOwnProperty(d)&&this.addEvent(d,a[d]);return this}if("function"==typeof c){for(e=b.isArray(i[a])?i[a]:i[a]=[],f=!1,g=0,h=e.length;h>g;g+=1)e[g].toString()===c.toString()&&(f=!0);f||i[a].push(c)}return this},removeEvent:function(a,b){var c,d=this.eventStorage,e=new RegExp("(^|\\.)"+a.substring(a.indexOf(".")+1,a.length)+"($|\\.)");for(c in d)d.hasOwnProperty(c)&&(c===a||c.match(e))&&this.REMOVE(c,b);return d=null,this},triggerEvent:function(a){var b,c,d,e,f,g=[],h=this.eventStorage,i=new RegExp("(^|\\.)"+a.substring(a.indexOf(".")+1,a.length)+"($|\\.)");for(d=1,e=arguments.length;e>d;d+=1)g.push(arguments[d]);for(f in h)if(h.hasOwnProperty(f)&&(f===a||f.match(i))&&(c=this.TRIGGER(f,g),b=c===!1?!1:b,c===!0))return!1;return h=null,b===!1?!1:this}})}}(tbc,jQuery),function(a,b){"use strict";a.TASK_DEPOT=a.TASK_DEPOT||{},a.TASK_DEPOT_COUNT=a.TASK_DEPOT_COUNT||0,a.guid=a.guid||0,a.TASKS=function(b,c){return b?!c||a.TASK_DEPOT[b]?a.TASK_DEPOT[b]||null:(a.TASK_DEPOT[b]=c,void(a.TASK_DEPOT_COUNT+=1)):null},a.TASKS.set=function(a,b){this(a,b)},a.TASKS.get=function(a){return this(a)},a.TASKS.del=function(b){var c,d,e=a.TASK_DEPOT[b];if(b&&e){try{e.container&&a.TASK_DEPOT[b].container.empty().remove(),e.ui&&a.TASK_DEPOT[b].ui.empty().remove()}catch(f){}c=e.DEPENDS||[],a.TASKS.killAll(c);for(d in e)e.hasOwnProperty(d)&&delete a.TASK_DEPOT[b][d];e=null,delete a.TASK_DEPOT[b]}},a.TASKS.killAll=function(b){if("array"==typeof b&&b.length>0){var c,d,e;for(c in a.TASK_DEPOT)if(a.TASK_DEPOT.hasOwnProperty(c)&&a.TASK_DEPOT[c].DEPENDS)for(d=0,e=b.length;e>d;d++)b[d]===c&&a.TASK_DEPOT[c].DESTROY()}},a.getTaskByElement=function(c){var d=b(c).attr("tbc");return d=d||b(c).parents("[tbc]:first").attr("tbc"),a.TASKS(d)},a.ClassManager=function(){a.self(this,arguments).extend({DEPENDS:[],depend:function(b){return a.isArray(b.DEPENDS)&&b.DEPENDS.push(this.guid),this},dependSelf:function(a){var b="object"==typeof a?a.guid:a;return this.DEPENDS.push(b),this},undepend:function(b){return b&&a.isArray(b.DEPENDS)&&(b.DEPENDS=a.array.remove(b.DEPENDS,this.guid)),this},undependSelf:function(b){var c="object"==typeof b?b.guid:b;return this.DEPENDS=a.array.remove(this.DEPENDS,c),this},INIT:function(){var b=this.constructor;return this.packageName="tbc.ClassManager",b.maxid=b.maxid||0,b.maxid=b.maxid+1,this.iid=b.maxid,b.count=b.count&&!isNaN(b.count)?b.count+1:1,a.guid+=1,this.guid=a.guid,b.instance=b.instance||{},this.CREATE_TIME=(new Date).getTime(),this.INIT_INSTANCE(),this.INSTANCE(this.iid,this),a.TASKS(this.guid,this),this},DESTROY:function(){var b=this.guid,c=this.iid;this.INSTANCE(c,"del"),this.triggerEvent("destroy"),a.TASKS.del(b,!1),b=c=null},INSTANCE:function(a,b){if(!a)return null;if("del"===b&&this.constructor.instance[a])delete this.constructor.instance[a],this.constructor.count=this.constructor.count-1;else{if(!b||this.constructor.instance[a])return this.constructor.instance[a]||null;this.constructor.instance[a]=b}return this},INIT_INSTANCE:function(){this.INSTANCE.get=function(a){return this(a)},this.INSTANCE.set=function(a,b){this(a,b)},this.INSTANCE.del=function(a){this(a,"del")}}}).INIT()}}(tbc,jQuery),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b+c:d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b+c:-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return 0==b?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){return 0==b?c:b==e?c+d:(b/=e/2)<1?d/2*Math.pow(2,10*(b-1))+c:d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){return(b/=e/2)<1?-d/2*(Math.sqrt(1-b*b)-1)+c:d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(0==b)return c;if(1==(b/=e))return c+d;if(g||(g=.3*e),h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin(2*(b*e-f)*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(0==b)return c;if(1==(b/=e))return c+d;if(g||(g=.3*e),h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin(2*(b*e-f)*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(0==b)return c;if(2==(b/=e/2))return c+d;if(g||(g=.3*e*1.5),h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return 1>b?-.5*h*Math.pow(2,10*(b-=1))*Math.sin(2*(b*e-f)*Math.PI/g)+c:h*Math.pow(2,-10*(b-=1))*Math.sin(2*(b*e-f)*Math.PI/g)*.5+d+c},easeInBack:function(a,b,c,d,e,f){return void 0==f&&(f=1.70158),d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){return void 0==f&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){return void 0==f&&(f=1.70158),(b/=e/2)<1?d/2*b*b*(((f*=1.525)+1)*b-f)+c:d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(a,b,c,d,e){return d-jQuery.easing.easeOutBounce(a,e-b,0,d,e)+c},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?7.5625*d*b*b+c:2/2.75>b?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:2.5/2.75>b?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(a,b,c,d,e){return e/2>b?.5*jQuery.easing.easeInBounce(a,2*b,0,d,e)+c:.5*jQuery.easing.easeOutBounce(a,2*b-e,0,d,e)+.5*d+c}}),function(a){a.extend(a.fn,{center:function(a){var b,c,d,e,f=this.width(),g=this.height(),h=options.left,i=options.top;return a?(b=this[0].scrollLeft,c=this[0].scrollTop,d=this[0].offsetWidth,e=this[0].offsetHeight):(b=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),c=Math.max(document.documentElement.scrollTop,document.body.scrollTop),d=Math.max(document.documentElement.clientWidth,document.documentElement.offsetWidth,document.documentElement.scrollWidth),e=Math.max(document.documentElement.clientHeight,document.documentElement.offsetHeight,document.documentElement.scrollHeight)),h=f>d?b:d/2+b-f/2,i=g>e?c:e/2+c-g/2,this.css({top:i,left:h})},disableSelect:function(){a(this).css({"-moz-user-select":"none","-webkit-user-select":"none","-o-user-select":"none","-ms-user-select":"none",userSelect:"none"}).bind("selectstart",function(){return!1})},enableSelect:function(){a(this).css({"-moz-user-select":"","-webkit-user-select":"","-o-user-select":"","-ms-user-select":"",userSelect:""}).unbind("selectstart")},flash:function(){_this.animate({opacity:.5},40).animate({opacity:1},40).animate({opacity:.5},40).animate({opacity:1},40).animate({opacity:.5},40).animate({opacity:1},40,function(){})},shake:function(b){return this.each(function(){var c=a(this),d=c.css("marginLeft");"auto"==d&&c.css("marginLeft",c.parent().width()/2-c.width()/2),c.animate({marginLeft:"-=5px"},40).animate({marginLeft:"+=10px"},40).animate({marginLeft:"-=5px"},40).animate({marginLeft:"+=4px"},40).animate({marginLeft:"-=4px"},40).animate({marginLeft:"+=2px"},40).animate({marginLeft:"-=2px"},40,function(){a.isFunction(b)&&b.call(c),"auto"==d&&a(c).css({marginLeft:"auto"})})})},scaleTo:function(b,c){return this.each(function(){var d=a(this),e=d.width(),f=d.height(),g=d.css("left"),h=d.css("top"),i=a.isPlainObject(b)?b:a.extend({},a(b).offset(),{width:a(b).width(),height:a(b).height(),opacity:0});d.animate(i,1200,"easeOutBounce",function(){d.css({display:"none",width:e,height:f,left:g,top:h,opacity:1}),a.isFunction(c)&&c.call(d)})})},evert:function(){return this.css({"-moz-transform":"translateZ(-300px) rotateY(90deg) rotateX(0deg)","-webkit-transform":"translateZ(-800px) rotateY(90deg) rotateX(0deg)","-o-transform":"translateZ(-300px) rotateY(90deg) rotateX(0deg)","-ms-transform":"translateZ(-300px) rotateY(90deg) rotateX(0deg)",transform:"translateZ(-300px) rotateY(90deg) rotateX(0deg)"})},facade:function(){return this.css({"-moz-transform":"translateZ(0px) rotateY(0deg) rotateX(0deg)","-webkit-transform":"translateZ(0px) rotateY(0deg) rotateX(0deg)","-o-transform":"translateZ(0px) rotateY(0deg) rotateX(0deg) ","-ms-transform":"translateZ(0px) rotateY(0deg) rotateX(0deg)",transform:"translateZ(0px) rotateY(0deg) rotateX(0deg)"})},enable3D:function(){return this.parent().css({"-moz-transform-style":"preserve-3d","-webkit-transform-style":"preserve-3d","-ms-transform-style":"preserve-3d","-o-transform-style":"preserve-3d","transform-style":"preserve-3d","-webkit-transform-style":"perspective"}),this},disable3D:function(){return this.parent().css({"-moz-transform-style":"","-webkit-transform-style":"","-ms-transform-style":"","-o-transform-style":"","transform-style":""}),this},enableAnimate:function(a,b,c){var d=a||".4s",e=c||"ease",f=b||"0s",g=[d,e,f].join(" ");return this.css({"-moz-transition":"-moz-transform "+g,"-webkit-transition":"-web-transform "+g,"-o-transition":"-o-transform "+g,"-ms-transition":"-ms-transform "+g,transition:"transform "+g}),this},disableAnimate:function(){return this.css({"-moz-transition":"","-webkit-transition":"","-o-transition":"","-ms-transition":"",transition:""})}})}(jQuery),function(a){a.fn.drag=function(b){a.fn.drag.count=a.fn.drag.count?a.fn.drag.count++:1;var c=a.fn.drag.count,d={window:window,document:document,handle:null,timeout:0,area:null,areaMargin:0,targetChild:null,focus:!1,animate:!1,cursor:"move",target:null,staff:"x",disableInsert:null,insertToTarget:!0,onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},onItemMouseover:function(){},onItemMouseout:function(){},ghostClass:null,enabled:function(){return!0},event:{dragStart:function(){},drag:function(){},drop:function(){},dragEnd:function(){},itemMouseover:function(){},itemMouseout:function(){},targetMouseover:function(){},targetMouseout:function(){}}},e=a.extend({},d,b);e.document=e.document||document,e.targetChild=a(e.targetChild||this.selector||this);var f,g=function(){var b=e.area,c=e.areaMargin,d=tbc.percentToInt;if(b===!0)b=e.area=e.document.body,f=tbc.getCoordinate(a(b)[0]),f.bottom=Math.max(e.document.body.offsetHeight,e.document.body.scrollHeight,e.document.body.clientHeight,e.document.documentElement.clientHeight,e.document.documentElement.offsetHeight,e.document.documentElement.scrollHeight),f.right=Math.max(e.document.body.offsetWidth,e.document.body.scrollWidth,e.document.body.clientWidth,e.document.documentElement.clientWidth,e.document.documentElement.offsetWidth,e.document.documentElement.scrollWidth),f.height=f.bottom-f.top,f.width=f.right-f.left;else if(a.isPlainObject(b)){var g=i.offsetParent().height(),h=i.offsetParent().width();f={left:d(b.left,h),top:d(b.top,g),right:d(b.right,h),bottom:d(b.bottom,g)}}else f=tbc.getCoordinate(a(b)[0]),a(b).each(function(a,b){var c=tbc.getCoordinate(b);f.left=Math.min(f.left,c.left),f.right=Math.max(f.right,c.right),f.top=Math.min(f.top,c.top),f.bottom=Math.max(f.bottom,c.bottom)});c&&c.left&&c.top&&(f.left+=d(c.left,i.width()),f.right+=d(c.right,i.width()),f.top+=d(c.top,i.height()),f.bottom+=d(c.bottom,i.height())),b=c=d=null};if(e.disableInsert){var h=a(e.disableInsert).data("onDragDisableInsert");h=h||[],-1==tbc.array.indexOf(h,c)&&h.push(c),a(e.disableInsert).data("onDragDisableInsert",h)}var i=this;return this.each(function(b,d){function h(b,c){var d=a("#drag_wrap");return d.size()?d:a('<div id="drag_wrap"></div>').css({width:b,height:c})}function j(){a("#drag_wrap").remove(),q=null}function k(b,c){var f=(i[0].tagName||i[0].nodeName).toLowerCase(),g=a("#drag_ghost");return g=g.size()?g.show():a("<"+f+' id="drag_ghost"></'+f+">").insertAfter(d),e.ghostClass?g.addClass(e.ghostClass):g.css({border:"#000 1px dotted",width:b,height:c}),g}function l(b){a.isFunction(e.onDragStart)&&e.onDragStart.call(d[0],b),a.isFunction(e.event.dragStart)&&e.event.dragStart.call(d[0],b),m(),s=tbc.getCoordinate(d[0]),t=b.clientY-s.top+(e.document.documentElement.scrollLeft||e.document.body.scrollTop),u=b.clientX-s.left+(e.document.documentElement.scrollLeft||e.document.body.scrollLeft),a("body").css({"-moz-user-select":"none",webkitUserSelect:"none",oUserSelect:"none",userSelect:"none"}).bind("selectstart",function(){return!1});var c=d.width(),f=d.height();if(q=h().css({position:"absolute",visible:"visible",display:"none",width:d.outerWidth(),height:d.outerHeight(),zIndex:tbc.getMaxZIndex()}).appendTo("body").show(),e.target){r=k().show(),r.css({width:c,height:f}).insertAfter(d);var g=d.clone().remove().removeClass("ue-app").addClass("ue-app-clone");q.append(g)}var i=n(b);q.css({position:"absolute",top:i.top,left:i.left,width:i.width})}function m(){return x=e.document.documentElement.scrollTop||e.document.body.scrollTop,y=e.document.documentElement.scrollLeft||e.document.body.scrollLeft,{top:x,left:y}}function n(b){m(),g();var c,h=q?tbc.getCoordinate(q[0].offsetParent):{left:0,top:0},i=(q?tbc.getCoordinate(q[0].offsetParent):{left:0,top:0},0),j=0;try{c=e.window.frameElement}catch(k){}if(null!==c){var l=a(c).offset();l&&(i=l.top,j=l.left)}var n=b.pageY-h.top-d.offsetParent().offset().top-t+x+i,o=b.pageX-h.left-d.offsetParent().offset().left-u+y+j,p=d.width(),r=d.height(),s=n+r,v=o+p,w={top:n,left:o,right:v,bottom:s,width:p,height:r};return e.area&&(w.top=w.bottom>=f.bottom?f.bottom-w.height:Math.max(f.top,w.top),w.left=w.right>=f.right?f.right-w.width:Math.max(f.left,w.left)),w}function o(b,g){function h(b,c){var d=0;return b.each(function(b,e){-1!=a("*",c).index(e)&&d++}),0!==d}if(!e.area||!(g.mouseX<f.left||g.mouseX>f.right||g.mouseY<f.top||g.mouseY>f.bottom)){var i;if(null!==e.target&&(e.targetChild=a(e.targetChild.selector),a(e.target).each(function(){i=a(this);var f=function(){var a=i.data("onDragDisableInsert");return-1==tbc.array.indexOf(c,a)}(),j=tbc.getCoordinate(this),k=tbc.getCoordinate(this.parentNode);if(g&&g.mouseX>j.left&&g.mouseX<j.right&&g.mouseY>j.top&&g.mouseY<j.bottom){if("true"!=i.attr("_dragHover")){var l=a.extend({},b,{target:i});a.isFunction(e.onTargetMouseover)&&e.onTargetMouseover.call(d[0],l),a.isFunction(e.event.targetMouseover)&&e.event.targetMouseover.call(d[0],l),i.attr("_dragHover","true")}if(!h(e.targetChild,i))return e.insertToTarget&&f&&r.appendTo(i),!1;var m=[];a(e.targetChild,i).each(function(){m.push(a(".ue-apptitle",this).text())}),e.insertToTarget&&f&&i[0]==r.parent()[0]&&r.appendTo(i),a(e.targetChild,i).each(function(c,h){var i=tbc.getCoordinate(h),j=h;if(q.children()[0]==h)return!0;if(j==d[0])return!0;if(g.mouseX>i.left&&g.mouseX<i.right&&g.mouseY>i.top&&g.mouseY<i.bottom){var k=a(j).height()/2,l=a(j).width()/2;if("y"==e.staff&&g.mouseY-i.top<k||"x"==e.staff&&g.mouseX-i.left<l?e.insertToTarget&&f&&r.insertBefore(j):"y"==e.staff&&g.mouseY+k>i.top||"x"==e.staff&&g.mouseX+l>i.right?e.insertToTarget&&f&&r.insertAfter(j):e.insertToTarget&&f&&r.insertAfter(j),"true"!=a(j).attr("_dragHover")){var m=a.extend({},b,{target:j});a.isFunction(e.onItemMouseover)&&e.onItemMouseover.call(d[0],m),a.isFunction(e.event.itemMouseover)&&e.event.itemMouseover.call(d[0],m),a(j).attr("_dragHover","true")}return!0}if("true"==a(j).attr("_dragHover")){var m=a.extend({},b,{target:j});e.onItemMouseout.call(d[0],m),a.isFunction(e.event.itemMouseout)&&e.event.itemMouseout.call(d[0],m),a(j).removeAttr("_dragHover")}})}else if(g&&g.mouseX>j.left&&g.mouseX<j.right&&g.mouseY>k.top&&g.mouseY<k.bottom&&e.insertToTarget&&f&&r.appendTo(i),"true"==i.attr("_dragHover")){var l=a.extend({},b,{target:i});a.isFunction(e.onTargetMouseout)&&e.onTargetMouseout.call(d[0],l),a.isFunction(e.event.targetMouseout)&&e.event.targetMouseout.call(d[0],l),i.removeAttr("_dragHover")}})),a.fn.scrollTo){var j=document.documentElement.scrollTop,k=j+Math.max(document.body.clientHeight,document.documentElement.clientHeight,document.body.offsetHeight,document.documentElement.offsetHeight);b.pageY<j+20?a(e.area).scrollTo("-=20px",0):b.pageY>k-20&&a(e.area).scrollTo("+=20px",0)}a.extend(b,{target:i}),a.isFunction(e.onDrag)&&e.onDrag.call(d[0],b,g),a.isFunction(e.event.drag)&&e.event.drag.call(d[0],b,g)}}d=a(d);var p,q,r,s,t,u,v=!1,w=({parent:d.parent(),prev:d.prev()},a(e.handle,d)),x=e.document.documentElement.scrollTop||e.document.body.scrollTop,y=e.document.documentElement.scrollLeft||e.document.body.scrollLeft;w=w.size()?w:d,w.bind({touchstart:function(b){b=b.originalEvent,b.stopContextmenu=!0;var c={x:b.changedTouches[0].pageX-parseInt(d.css("left")),y:b.changedTouches[0].pageY-parseInt(d.css("top"))};t=c.y,u=c.x,a(this).bind({"touchmove.touchDrag":function(a){a=a.originalEvent;var b=n(a),c=b.left,e=b.top;return d.css({left:c,top:e}),!1},"touchend.touchDrag":function(){a(this).unbind(".touchDrag")}})},mouseleave:function(){clearTimeout(p)},mouseup:function(){clearTimeout(p)},mousedown:function(b){function c(){a(e.document).unbind(".drag").bind({"mousemove.drag":f,"mouseup.drag":g,"contextmenu.drag":function(){return!1}})}function f(b){v===!1&&(l(b),v=!0),clearTimeout(h);var c=n(b);i=c,e.target?q.css({position:"absolute",top:c.top,left:c.left,width:c.width}):d.css({top:c.top,left:c.left}),a.extend(c,{mouseX:b.clientX+y,mouseY:b.clientY+x}),h=setTimeout(function(){o(b,c)},30)}function g(b){var c,f,g,h,k=r?r[0]:null;b.dropon=k,v=!1,h=a.isFunction(e.event.drop)?e.event.drop.call(d[0],b,i)!==!1:!0,a(e.document).unbind(".drag"),a("body").css({"-moz-user-select":"normal",webkitUserSelect:"normal",oUserSelect:"normal",userSelect:"normal"}).unbind("selectstart"),e.target?(c=r.parent(),a.extend(b,{target:c}),f=tbc.getCoordinate(r[0]),g=function(){try{h&&d.removeClass("dragging").insertAfter(r),j(),z(),a.isFunction(e.event.dragEnd)&&e.event.dragEnd.call(d[0],b,i)}catch(c){}e.focus&&d.css("zIndex",d.data("_zIndex")).data("_zIndex",null)},e.animate?q.animate({width:f.width,height:f.height,left:f.left,top:f.top},400,g):(q.css({left:f.left,top:f.top}),g())):(e.focus&&d.css("zIndex",d.data("_zIndex")).data("_zIndex",null),a.isFunction(e.event.dragEnd)&&e.event.dragEnd.call(d[0],b,i),j()),c=f=g=h=k=null
}if(b.disableSelectArea=!0,!(!e.enabled()||tbc.msie&&tbc.browserVersion<9&&1!=b.button||(tbc.msie&&tbc.browserVersion>8||!tbc.msie)&&0!=b.button)){e.timeout?p=setTimeout(c,e.timeout):c();var h,i}}});var z=function(){a("#drag_ghost").remove(),r=null}})}}(jQuery),function(a){a.fn.resizableForTbc=function(b){var c={minWidth:10,minHeight:10,maxWidth:document.documentElement.offsetWidth,maxHeight:document.documentElement.scrollHeight,handle:null,vector:"normal",document:document,margin:{left:0,top:0,right:0,bottom:0},enabled:function(){return!0},onResizeStart:function(){},onResize:function(){},onResizeEnd:function(){}};return this.each(function(){var d=a(this),e=a.extend({},c,b);e.handle=a(e.handle,this),e.handle.size()||("static"===d.css("position")&&d.css({position:"relative"}),e.handle=a('<div role="south-east">◢</div>').css({width:"6px",height:"6px",position:"absolute",right:"0px",bottom:"0px",lineHeight:"0",overflow:"hidden",border:"3px solid #f90",borderWidth:"0 3px 3px 0",cursor:"se-resize"}).hover(function(){a(this).css({borderColor:"#09f"})},function(){a(this).css({borderColor:"#f90"})}).append('<div style="overflow: hidden; border: solid #fff 0px; border-width:3px 0pt 0pt 3px; width: 1px; height: 1px;"></div>').appendTo(this).fadeOut(),d.hover(function(){e.handle.fadeIn()},function(){e.handle.fadeOut()}));e.handle.each(function(){}).bind("mousedown",function(){if(!e.enabled())return null;a("body").css({"-moz-user-select":"none","-webkit-user-select":"none","-o-user-select":"none","-ms-user-select":"none",userSelect:"none"}).bind("selectstart",function(){return!1}),e.onResizeStart.call(d);var b=tbc.getCoordinate(d[0]);b.left+=e.margin.left,b.right-=e.margin.right,b.top+=e.margin.top,b.bottom-=e.margin.bottom,b.width-=e.margin.left+e.margin.right,b.height-=e.margin.top+e.margin.bottom;var c,f=a.extend({},b),g=tbc.getMaxZIndex(e.document.body),h=a("<div />").css({position:"absolute",zIndex:g+1,left:b.left,top:b.top,width:b.width,height:b.height,border:"1px dotted blue",background:"#fff",opacity:.7}).appendTo(a("body",e.document)),i=a(this).attr("role");switch(i){case"west":c={x:-1,y:0};break;case"east":c={x:1,y:0};break;case"north":c={x:0,y:-1};break;case"south":c={x:0,y:1};break;case"north-west":c={x:-1,y:-1};break;case"south-west":c={x:-1,y:1};break;case"north-east":c={x:1,y:-1};break;case"south-east":c={x:1,y:1};break;default:return!1}return a(e.document).bind("mousemove.resizable",function(g){{var i=e.maxWidth||document.documentElement.offsetWidth;e.maxHeight||document.documentElement.offsetHeight}x=Math.max(Math.min(g.pageX,b.right),b.left),y=Math.max(Math.min(g.pageY,b.bottom),b.top),-1===c.x&&(f.left=Math.max(0,b.right-i,Math.min(g.pageX,b.right-e.minWidth)),f.width=Math.min(i,Math.max(b.left-g.pageX+b.width,e.minWidth))),1===c.x&&(f.width=Math.min(i,Math.max(g.pageX-b.left,e.minWidth)),f.right=Math.min(b.left+i,Math.max(g.pageX,b.left+e.minWidth))),-1===c.y&&(f.top=Math.max(0,b.bottom-e.maxHeight,Math.min(g.pageY,b.bottom-e.minHeight)),f.height=Math.min(e.maxHeight,Math.max(b.top-g.pageY+b.height,e.minHeight))),1===c.y&&(f.height=Math.min(e.maxHeight,Math.max(g.pageY-b.top,e.minHeight)),f.bottom=Math.min(b.top+e.maxHeight,Math.max(g.pageY,b.top+e.minHeight))),h.css({left:f.left,top:f.top,width:f.width,height:f.height});var j=a.extend({},f);j.left-=e.margin.left,j.right+=e.margin.right,j.top-=e.margin.top,j.bottom+=e.margin.bottom,j.width+=e.margin.left+e.margin.right,j.height+=e.margin.top+e.margin.bottom,"absolute"!=d.css("position")&&(delete j.top,delete j.left,delete j.right,delete j.bottom),e.onResize.call(d,j)}).bind("mouseup.resizable",function(){var b=d.offsetParent().offset();a("body").css({"-moz-user-select":"","-webkit-user-select":"","-o-user-select":"","-ms-user-select":"",userSelect:""}).unbind("selectstart"),a(e.document).unbind(".resizable"),f.left-=e.margin.left+b.left,f.right+=e.margin.right-b.left,f.top-=e.margin.top+b.top,f.bottom+=e.margin.bottom-b.top,f.width+=e.margin.left+e.margin.right,f.height+=e.margin.top+e.margin.bottom,"absolute"!=d.css("position")&&(delete f.top,delete f.left,delete f.right,delete f.bottom),d.css(f),e.onResizeEnd.call(d,f),h.remove()}),!1})})}}(jQuery),function(a){"use strict";a(document).ready(function(){a("head").append('<style type="text/css" id="contextmenuStyle">    /* insert by jQuery.Contextmenu.js */    .ue-contextmenu{position:absolute; z-index:1000; left:100px; top:100px; font-size:12px;}    .ue-contextmenu *{-moz-transition:.3s;-webkit-transition:.3s;-o-transition:.3s;-ms-transition:.3s;transition:.3s;}    .ue-contextmenu ul{+width:180px; min-width:180px; background-color:#fff; box-shadow:3px 3px 4px rgba(0,0,0,0.8); border:1px solid #888;}    .ue-contextmenu ul,.ue-contextmenu li{ list-style:none; margin:0; padding:0;}    .ue-contextmenu li{height:28px; line-height:28px; +width:100%; position:relative; +float:left;}    .ue-contextmenu .ue-item,.ue-contextmenu .ue-item:visited{display:block; width:100%; height:100%; white-space:nowrap; word-break:keep-all; text-decoration:none; color:#333;}    .ue-contextmenu .ue-item:hover{ color:#fff;}    .ue-contextmenu li.hover{ background-color:#219CCB;}    .ue-contextmenu li.hover .ue-item{color:#fff;}    .ue-contextmenu li.hover li .ue-item{color:#333;}    .ue-contextmenu .ue-item span{ display:block; height:100%; cursor:default;}    .ue-contextmenu .ue-item span.ue-icon{ width:28px; float:left; overflow:hidden;        background-color:#eee; background-color:rgba(27,138,228,0.15); background-position:50% 50%; background-repeat:no-repeat;        position:absolute; left:0; top:0;}    .ue-contextmenu .ue-item span.ue-icon span{ height:16px; margin:6px 0 0 6px;}    .ue-contextmenu li.hover span.ue-icon span{ -moz-transform:rotate(360deg); -webkit-transform:rotate(360deg); -o-transform:rotate(360deg); -ms-transform:rotate(360deg); transform:rotate(360deg);}    .ue-contextmenu li.disabled .ue-item span.ue-icon span{ -moz-transform:rotate(0deg); -webkit-transform:rotate(0deg); -o-transform:rotate(0deg); -ms-transform:rotate(0deg); transform:rotate(0deg);}    .ue-contextmenu .ue-item span.ue-text{ margin-left:29px; padding:0 40px 0 4px; _zoom:1;}    .ue-contextmenu li.disabled{background-color:#fff !important;}    .ue-contextmenu li.hover .ue-item span.ue-icon{filter:alpha(opacity=80);}    .ue-contextmenu li.disabled .ue-item span.ue-icon span{filter:alpha(opacity=30); opacity:0.3;}    .ue-contextmenu li.disabled .ue-item span.ue-text{color:#000; filter:alpha(opacity=30); opacity:0.3;}    .ue-contextmenu li.ue-line{height:0px; overflow:hidden; line-height:0px; +float:left;        border-top:1px solid #e0e0e0;}    .ue-contextmenu ul ul{ clear:both; position:absolute; left:100%; top:-1px; display:none;}    .ue-contextmenu ul ul.ue-submenu ul{ display:none;}    .ue-contextmenu li:hover>ul, .ue-contextmenu li.hover>ul{display:block !important;}    .ue-submenu-more{ position:absolute; right:1px; text-align:center; top:0; height:100%; width:10px;        font-size:20px; overflow:hidden; text-indent:-12px;}</style>')}),a.fn.contextmenu=function(b){return this.each(function(){var c,d,e,f=a(this).data("contextMenuItems")||[];f.inited=f.inited||!0,b.items.length>0&&(f=b.before?b.items.concat(f):f.concat(b.items)),a(this).data("contextMenuItems",f),b.items=f,f.inited||(a(this).unbind("contextmenu").bind("contextmenu",function(c,d){var e,f;return a(c.target).hasClass("ue-contextmenu")||a(c.target).parents(".ue-contextmenu").size()?(c.stopPropagation(),!1):c.ctrlKey?!0:(e=d?a.extend({},b,d):b,c.stopPropagation(),f=new a.contextmenu(e,this),f.show(c),!1)}),this.addEventListener&&(d=function(d){clearTimeout(c),document.body.style.webkitTouchCallout="none",d.stopContextmenu||(d.stopContextmenu=!0,c=setTimeout(function(){var c=d.targetTouches[0].pageX,e=d.targetTouches[0].pageY,f=a.extend({},b,{left:c,top:e}),g=new a.contextmenu(f,this);g.show(d)},800))},e=function(){clearTimeout(c)},this.removeEventListener("touchstart",d),this.addEventListener("touchstart",d),this.removeEventListener("touchend",e),this.addEventListener("touchend",e)))})},a.contextmenu=function(b,c){var d,e,f;a.contextmenu.id=a.contextmenu.id||0,a.contextmenu.id+=1,d=a.contextmenu.id,a.contextmenu.actions=a.contextmenu.actions||{},a.contextmenu.actions[d]={},e={items:{length:0},left:0,top:0,event:{show:function(){},hide:function(){}}},f=a.extend({},e,b),a.contextmenu.style={animate:a.contextmenu.animate||!0,shadow:a.contextmenu.shadow||!0,textColor:a.contextmenu.textColor||"#666",highlightTextColor:a.contextmenu.highlightTextColor||"#000",backgroundColor:a.contextmenu.backgroundColor||"#fff",highlightBackgroundColor:a.contextmenu.highlightBackgroundColor||"#ccf"},a.contextmenu.action=function(b,c){try{var e=a.contextmenu.actions[d][b];a.isFunction(e)&&e.call(c)}catch(f){}},a.contextmenu.hoverIn=function(b){if(b=a(b).addClass("hover").children("ul").show(),0!==b.size()){var c=document.documentElement.scrollTop+document.body.offsetHeight,d=document.documentElement.scrollLeft+document.body.offsetWidth,e=b.offset(),f=e.left,g=e.top,h=g+b.height(),i=f+b.width();h>c&&b.css({top:c-h}),i>d&&b.css({left:"auto",right:"100%"})}},a.contextmenu.hoverOut=function(b){a(b).removeClass("hover").children("ul").hide()},this.items=f.items||[],this.addItem=this.append=this.push=function(a){return this.items[this.items.length]=a,this},this.removeItem=function(a){return delete this.items[a],this},this.disableItem=function(a){return this.items[a].enabled=!1,this},this.show=function(b){function e(b,c){var f='<ul class="'+(c||"")+'">';return b=a.isFunction(b)?b():b,a.each(b,function(b,c){var h,i,j,k,l,m,n,o,p="";switch(g+=1,c){case"line":case"-":case"--":case"---":p='<li class="ue-line"></li>';break;default:if(h=a.isFunction(c)?c():c,j=a.isFunction(h.text)?h.text():h.text,!j||""===j)break;i=a.isFunction(h.icon)?h.icon():h.icon||"",k=a.isFunction(h.disabled)?h.disabled():h.disabled,l=a.isFunction(h.visible)?h.visible():h.visible,m=a.isFunction(h.submenu)?h.submenu():h.submenu,n=k?"null":"$.contextmenu.action("+g+")",o=k?"":'onmouseover="$.contextmenu.hoverIn(this);" onmouseout="$.contextmenu.hoverOut(this);"',a.contextmenu.actions[d][g]=h.click,p=l!==!0?'<li class="'+(k?"disabled":"")+'" '+o+'><span class="ue-item" href="javascript:void(null);" onclick="'+n+';">'+(i.match(/\.(jpg|jpeg|gif|png|img|ico|bmp)$/)||-1!==i.indexOf("sf-server/file/getFile/")?'<span class="ue-icon"><span class="tbc-icon"><img src="'+i+'" style="border:0px; width:16px;" /></span></span>':'<span class="ue-icon"><span class="tbc-icon '+i+'"></span></span>')+'<span class="ue-text">'+j+"</span></span>"+(m?'<span class="ue-submenu-more">&diams;</span>'+e(m,"ue-submenu"):"")+"</li>":""}f+=p}),f+="</ul>"}var g,h,i,j,k,l,m,n,o,p,q;return q=function(b){setTimeout(function(){var c;for(b.remove(),c=0;d>c;c+=1)delete a.contextmenu.actions[c];b=null},1),a(document).unbind("click.hideContextmenu blur.hideContextmenu"),a.isFunction(f.event.hide)&&f.event.hide.call(a(c))},a(b.target).hasClass("ue-contextmenu")||a(b.target).parents(".ue-contextmenu").size()?(b.stopPropagation(),!1):(a.isFunction(f.event.show)&&f.event.show.call(a(c)),a(document).trigger("click.hideContextmenu"),g=0,h=f.left||b.pageX||b.targetTouches[0],i=f.top||b.pageY||b.targetTouches[0],j=a('<div class="ue-contextmenu"></div>').append(e(this.inherit(b))).css({left:h,top:i,zIndex:window.tbc?window.tbc.getMaxZIndex():"auto"}).appendTo("body"),k=document.documentElement.scrollTop+document.body.offsetHeight,l=document.documentElement.scrollLeft+document.body.offsetWidth,m=i+j.height(),n=h+j.width(),o=m>k?k-j.height():i,p=n>l?l-j.width():h,m>k&&j.css({top:"auto",bottom:"0px"}),n>l&&j.css({left:"auto",right:"0px"}),a(document).bind("click.hideContextmenu blur.hideContextmenu",function(){return a(b.target).hasClass("ue-contextmenu")&&0!==a(b.target).parents(".ue-contextmenu").size()?(b.stopPropagation(),!1):void q(j)}),this)},this.inherit=function(b){function d(){var b=a(this).data("contextMenuItems"),d=this;b&&b.length>0&&c!==d&&f.push("line"),b&&a.each(b,function(a,b){b.inheritable===!0&&c!==d&&f.push(b)})}var e,f=[];a.each(this.items,function(a,b){f.push(b)}),a(b.target).parents().each(d);try{for(e=window;e&&(a(window.frameElement).parents().each(d),e.parent!==e);)e=e.parent}catch(g){}return f}}}(jQuery),function(a){a.fn.selectArea=function(b){var c={item:this.children(),exclude:null,classSelected:"selected",event:{select:function(){},unselect:function(){}}},d=a.extend({},c,b);return this.each(function(){a(this).bind({"mousedown.selector":function(b){if(!(tbc.msie&&tbc.browserVersion<9&&1!=b.button||(tbc.msie&&tbc.browserVersion>8||!tbc.msie)&&0!=b.button||b.disableSelectArea||b.target!=this)){b.stopPropagation();var c,e=a(this),f=b.pageX,g=b.pageY,h=!1;a(document).bind({"mousemove.selector.a":function(b){a("body").disableSelect(),c=c||a.fn.selectArea.area().appendTo("body"),h=!0;var i=a.fn.selectArea.getOffset(b,f,g);c.css(i),(!tbc.msie||tbc.browserVersion>7)&&a.fn.selectArea.selectElement.call(e,d,b,f,g)},"mouseup.selector.a":function(b){h&&(a.fn.selectArea.selectElement.call(e,d,b,f,g),h=!1),a("body").enableSelect(),c&&c.remove(),a(this).unbind(".selector.a")}})}}})})},a.fn.selectArea.selectElement=function(b,c,d,e){var f=a.fn.selectArea.getOffset(c,d,e);a(this).children(b.item).not(b.exclude).each(function(){tbc.isOverlap(f,this)?(a(this).addClass(b.classSelected),b.event.select.call(this,c)):(a(this).removeClass(b.classSelected),b.event.unselect.call(this,c))})},a.fn.selectArea.getOffset=function(a,b,c){var d=a.pageX,e=a.pageY,f=Math.min(d,b),g=Math.max(d,b),h=Math.min(e,c),i=Math.max(e,c),j=Math.abs(f-g),k=Math.abs(h-i);return{left:f,top:h,right:g,bottom:i,width:j,height:k}},a.fn.selectArea.area=function(){var b=a("<div><div></div></div>"),c=tbc.getMaxZIndex()+1;b.css({backgroung:"transparent",border:"1px dotted #09f",position:"absolute",left:0,top:0,width:0,height:0,zIndex:c}),b.find("div").css({width:"100%",height:"100%",background:"#0af",opacity:.1});try{return b}finally{b=c=null}}}(jQuery),function(a){a.extend(a.fn,{validate:function(b){if(!this.length)return void(b&&b.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));var c=a.data(this[0],"validator");if(c)return c;try{this.attr("novalidate","novalidate")}catch(d){}return c=new a.validator(b,this[0]),a.data(this[0],"validator",c),c.settings.onsubmit&&(this.validateDelegate(":submit","click",function(b){c.settings.submitHandler&&(c.submitButton=b.target),a(b.target).hasClass("cancel")&&(c.cancelSubmit=!0)}),this.submit(function(b){function d(){var d;return c.settings.submitHandler?(c.submitButton&&(d=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(c.submitButton.value).appendTo(c.currentForm)),c.settings.submitHandler.call(c,c.currentForm,b),c.submitButton&&d.remove(),!1):!0}return c.settings.debug&&b.preventDefault(),c.cancelSubmit?(c.cancelSubmit=!1,d()):c.form()?c.pendingRequest?(c.formSubmitted=!0,!1):d():(c.focusInvalid(),!1)})),c},valid:function(){if(a(this[0]).is("form"))return this.validate().form();var b=!0,c=a(this[0].form).validate();return this.each(function(){b&=c.element(this)}),b},removeAttrs:function(b){var c={},d=this;return a.each(b.split(/\s/),function(a,b){c[b]=d.attr(b),d.removeAttr(b)}),c},rules:function(b,c){var d=this[0];if(b){var e=a.data(d.form,"validator").settings,f=e.rules,g=a.validator.staticRules(d);switch(b){case"add":a.extend(g,a.validator.normalizeRule(c)),f[d.name]=g,c.messages&&(e.messages[d.name]=a.extend(e.messages[d.name],c.messages));break;case"remove":if(!c)return delete f[d.name],g;var h={};return a.each(c.split(/\s/),function(a,b){h[b]=g[b],delete g[b]}),h}}var i=a.validator.normalizeRules(a.extend({},a.validator.classRules(d),a.validator.attributeRules(d),a.validator.dataRules(d),a.validator.staticRules(d)),d);if(i.required){var j=i.required;delete i.required,i=a.extend({required:j},i)}return i}}),a.extend(a.expr[":"],{blank:function(b){return!a.trim(""+b.value)},filled:function(b){return!!a.trim(""+b.value)},unchecked:function(a){return!a.checked}}),a.validator=function(b,c){this.settings=a.extend(!0,{},a.validator.defaults,b),this.currentForm=c,this.init()},a.validator.format=function(b,c){return 1===arguments.length?function(){var c=a.makeArray(arguments);return c.unshift(b),a.validator.format.apply(this,c)}:(arguments.length>2&&c.constructor!==Array&&(c=a.makeArray(arguments).slice(1)),c.constructor!==Array&&(c=[c]),a.each(c,function(a,c){b=b.replace(new RegExp("\\{"+a+"\\}","g"),function(){return c})}),b)},a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(a){this.lastActive=a,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(a)).hide())},onfocusout:function(a){this.checkable(a)||!(a.name in this.submitted)&&this.optional(a)||this.element(a)},onkeyup:function(a,b){(9!==b.which||""!==this.elementValue(a))&&(a.name in this.submitted||a===this.lastElement)&&this.element(a)},onclick:function(a){a.name in this.submitted?this.element(a):a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).addClass(c).removeClass(d):a(b).addClass(c).removeClass(d)},unhighlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).removeClass(c).addClass(d)}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function b(b){var c=a.data(this[0].form,"validator"),d="on"+b.type.replace(/^validate/,"");c.settings[d]&&c.settings[d].call(c,this[0],b)}this.labelContainer=a(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm),this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var c=this.groups={};a.each(this.settings.groups,function(b,d){"string"==typeof d&&(d=d.split(/\s/)),a.each(d,function(a,d){c[d]=b})});var d=this.settings.rules;a.each(d,function(b,c){d[b]=a.validator.normalizeRule(c)}),a(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",b).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",b),this.settings.invalidHandler&&a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),a.extend(this.submitted,this.errorMap),this.invalid=a.extend({},this.errorMap),this.valid()||a(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(b){b=this.validationTargetFor(this.clean(b)),this.lastElement=b,this.prepareElement(b),this.currentElements=a(b);var c=this.check(b)!==!1;return c?delete this.invalid[b.name]:this.invalid[b.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),c},showErrors:function(b){if(b){a.extend(this.errorMap,b),this.errorList=[];for(var c in b)this.errorList.push({message:b[c],element:this.findByName(c)[0]});this.successList=a.grep(this.successList,function(a){return!(a.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){a.fn.resetForm&&a(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b=0;for(var c in a)b++;return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}},findLastActive:function(){var b=this.lastActive;return b&&1===a.grep(this.errorList,function(a){return a.element.name===b.name}).length&&b},elements:function(){var b=this,c={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&b.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in c||!b.objectLength(a(this).rules())?!1:(c[this.name]=!0,!0)})},clean:function(b){return a(b)[0]},errors:function(){var b=this.settings.errorClass.replace(" ",".");return a(this.settings.errorElement+"."+b,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=a([]),this.toHide=a([]),this.currentElements=a([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(a){this.reset(),this.toHide=this.errorsFor(a)},elementValue:function(b){var c=a(b).attr("type"),d=a(b).val();return"radio"===c||"checkbox"===c?a("input[name='"+a(b).attr("name")+"']:checked").val():"string"==typeof d?d.replace(/\r/g,""):d},check:function(b){b=this.validationTargetFor(this.clean(b));var c,d=a(b).rules(),e=!1,f=this.elementValue(b);for(var g in d){var h={method:g,parameters:d[g]};try{if(c=a.validator.methods[g].call(this,f,b,h.parameters),"dependency-mismatch"===c){e=!0;continue}if(e=!1,"pending"===c)return void(this.toHide=this.toHide.not(this.errorsFor(b)));if(!c)return this.formatAndAdd(b,h),!1}catch(i){throw this.settings.debug&&window.console&&console.log("Exception occured when checking element "+b.id+", check the '"+h.method+"' method.",i),i}}return e?void 0:(this.objectLength(d)&&this.successList.push(b),!0)},customDataMessage:function(b,c){return a(b).data("msg-"+c.toLowerCase())||b.attributes&&a(b).attr("data-msg-"+c.toLowerCase())},customMessage:function(a,b){var c=this.settings.messages[a];return c&&(c.constructor===String?c:c[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a];return void 0},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customDataMessage(b,c),!this.settings.ignoreTitle&&b.title||void 0,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(b,c){var d=this.defaultMessage(b,c.method),e=/\$?\{(\d+)\}/g;"function"==typeof d?d=d.call(this,c.parameters,b):e.test(d)&&(d=a.validator.format(d.replace(e,"{$1}"),c.parameters)),this.errorList.push({message:d,element:b}),this.errorMap[b.name]=d,this.submitted[b.name]=d},addWrapper:function(a){return this.settings.wrapper&&(a=a.add(a.parent(this.settings.wrapper))),a},defaultShowErrors:function(){var a,b;for(a=0;this.errorList[a];a++){var c=this.errorList[a];this.settings.highlight&&this.settings.highlight.call(this,c.element,this.settings.errorClass,this.settings.validClass),this.showLabel(c.element,c.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);if(this.settings.unhighlight)for(a=0,b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(b,c){var d=this.errorsFor(b);d.length?(d.removeClass(this.settings.validClass).addClass(this.settings.errorClass),d.html(c)):(d=a("<"+this.settings.errorElement+">").attr("for",this.idOrName(b)).addClass(this.settings.errorClass).html(c||""),this.settings.wrapper&&(d=d.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(d).length||(this.settings.errorPlacement?this.settings.errorPlacement(d,a(b)):d.insertAfter(b))),!c&&this.settings.success&&(d.text(""),"string"==typeof this.settings.success?d.addClass(this.settings.success):this.settings.success(d,b)),this.toShow=this.toShow.add(d)},errorsFor:function(b){var c=this.idOrName(b);return this.errors().filter(function(){return a(this).attr("for")===c})},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},validationTargetFor:function(a){return this.checkable(a)&&(a=this.findByName(a.name).not(this.settings.ignore)[0]),a},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(b){return a(this.currentForm).find("[name='"+b+"']")},getLength:function(b,c){switch(c.nodeName.toLowerCase()){case"select":return a("option:selected",c).length;case"input":if(this.checkable(c))return this.findByName(c.name).filter(":checked").length}return b.length},depend:function(a,b){return this.dependTypes[typeof a]?this.dependTypes[typeof a](a,b):!0},dependTypes:{"boolean":function(a){return a},string:function(b,c){return!!a(b,c.form).length},"function":function(a,b){return a(b)}},optional:function(b){var c=this.elementValue(b);return!a.validator.methods.required.call(this,c,b)&&"dependency-mismatch"},startRequest:function(a){this.pending[a.name]||(this.pendingRequest++,this.pending[a.name]=!0)},stopRequest:function(b,c){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[b.name],c&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(a(this.currentForm).submit(),this.formSubmitted=!1):!c&&0===this.pendingRequest&&this.formSubmitted&&(a(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:!0,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(b,c){b.constructor===String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(b){var c={},d=a(b).attr("class");return d&&a.each(d.split(" "),function(){this in a.validator.classRuleSettings&&a.extend(c,a.validator.classRuleSettings[this])}),c},attributeRules:function(b){var c={},d=a(b);for(var e in a.validator.methods){var f;"required"===e?(f=d.get(0).getAttribute(e),""===f&&(f=!0),f=!!f):f=d.attr(e),f?c[e]=f:d[0].getAttribute("type")===e&&(c[e]=!0)}return c.maxlength&&/-1|2147483647|524288/.test(c.maxlength)&&delete c.maxlength,c},dataRules:function(b){var c,d,e={},f=a(b);for(c in a.validator.methods)d=f.data("rule-"+c.toLowerCase()),void 0!==d&&(e[c]=d);return e},staticRules:function(b){var c={},d=a.data(b.form,"validator");return d.settings.rules&&(c=a.validator.normalizeRule(d.settings.rules[b.name])||{}),c},normalizeRules:function(b,c){return a.each(b,function(d,e){if(e===!1)return void delete b[d];if(e.param||e.depends){var f=!0;switch(typeof e.depends){case"string":f=!!a(e.depends,c.form).length;break;case"function":f=e.depends.call(c,c)}f?b[d]=void 0!==e.param?e.param:!0:delete b[d]}}),a.each(b,function(d,e){b[d]=a.isFunction(e)?e(c):e}),a.each(["minlength","maxlength"],function(){b[this]&&(b[this]=Number(b[this]))}),a.each(["rangelength"],function(){var c;b[this]&&(a.isArray(b[this])?b[this]=[Number(b[this][0]),Number(b[this][1])]:"string"==typeof b[this]&&(c=b[this].split(/[\s,]+/),b[this]=[Number(c[0]),Number(c[1])]))}),a.validator.autoCreateRanges&&(b.min&&b.max&&(b.range=[b.min,b.max],delete b.min,delete b.max),b.minlength&&b.maxlength&&(b.rangelength=[b.minlength,b.maxlength],delete b.minlength,delete b.maxlength)),b},normalizeRule:function(b){if("string"==typeof b){var c={};a.each(b.split(/\s/),function(){c[this]=!0}),b=c}return b},addMethod:function(b,c,d){a.validator.methods[b]=c,a.validator.messages[b]=void 0!==d?d:a.validator.messages[b],c.length<3&&a.validator.addClassRules(b,a.validator.normalizeRule(b))},methods:{required:function(b,c,d){if(!this.depend(d,c))return"dependency-mismatch";if("select"===c.nodeName.toLowerCase()){var e=a(c).val();return e&&e.length>0}return this.checkable(c)?this.getLength(b,c)>0:a.trim(b).length>0},remote:function(b,c,d){if(this.optional(c))return"dependency-mismatch";var e=this.previousValue(c);if(this.settings.messages[c.name]||(this.settings.messages[c.name]={}),e.originalMessage=this.settings.messages[c.name].remote,this.settings.messages[c.name].remote=e.message,d="string"==typeof d&&{url:d}||d,e.old===b)return e.valid;e.old=b;var f=this;this.startRequest(c);var g={};return g[c.name]=b,a.ajax(a.extend(!0,{url:d,mode:"abort",port:"validate"+c.name,dataType:"json",data:g,success:function(d){f.settings.messages[c.name].remote=e.originalMessage;var g=d===!0||"true"===d;if(g){var h=f.formSubmitted;f.prepareElement(c),f.formSubmitted=h,f.successList.push(c),delete f.invalid[c.name],f.showErrors()}else{var i={},j=d||f.defaultMessage(c,"remote");i[c.name]=e.message=a.isFunction(j)?j(b):j,f.invalid[c.name]=!0,f.showErrors(i)}e.valid=g,f.stopRequest(c,g)}},d)),"pending"},minlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||e>=d},maxlength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||d>=e},rangelength:function(b,c,d){var e=a.isArray(b)?b.length:this.getLength(a.trim(b),c);return this.optional(c)||e>=d[0]&&e<=d[1]},min:function(a,b,c){return this.optional(b)||a>=c},max:function(a,b,c){return this.optional(b)||c>=a},range:function(a,b,c){return this.optional(b)||a>=c[0]&&a<=c[1]},email:function(a,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)
},url:function(a,b){return this.optional(b)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a).toString())},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a)},number:function(a,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},creditcard:function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9 \-]+/.test(a))return!1;var c=0,d=0,e=!1;a=a.replace(/\D/g,"");for(var f=a.length-1;f>=0;f--){var g=a.charAt(f);d=parseInt(g,10),e&&(d*=2)>9&&(d-=9),c+=d,e=!e}return c%10===0},equalTo:function(b,c,d){var e=a(d);return this.settings.onfocusout&&e.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(c).valid()}),b===e.val()}}}),a.format=a.validator.format}(jQuery),function(a){var b={};if(a.ajaxPrefilter)a.ajaxPrefilter(function(a,c,d){var e=a.port;"abort"===a.mode&&(b[e]&&b[e].abort(),b[e]=d)});else{var c=a.ajax;a.ajax=function(d){var e=("mode"in d?d:a.ajaxSettings).mode,f=("port"in d?d:a.ajaxSettings).port;return"abort"===e?(b[f]&&b[f].abort(),b[f]=c.apply(this,arguments)):c.apply(this,arguments)}}}(jQuery),function(a){a.extend(a.fn,{validateDelegate:function(b,c,d){return this.bind(c,function(c){var e=a(c.target);return e.is(b)?d.apply(e,arguments):void 0})}})}(jQuery),function(a,b){"use strict";a.Accordion=function(c){var d={height:320,header:".tbc-accordion-header",container:null,itemHeader:".tbc-accordion-itemHeader",itemContainer:".tbc-accordion-itemContainer",currentCss:"current",active:0,event:{titleClick:function(){},active:function(){},retire:function(){}}},e=a.extend({},d,c);e.height=e.height&&"auto"!==e.height?e.height:356,a.self(this,arguments).extend({init:function(){var a=this;this.addEvent(e.event),this.packageName="tbc.Accordion",e.container?(this.ui=b(e.container),this.container=this.ui):(this.ui=b('<div class="tbc-accordion"></div>'),this.container=this.ui),this.ui.height(e.height),this.crimpleAll(),setTimeout(function(){a.setCurrent(e.active,!0)},100),this.ui.delegate(e.itemHeader,"click touchend dblclick",function(){var c=b(this).prevAll(e.itemHeader).size();a.setCurrent(c)})},getSize:function(){return this.container.children(e.header).size()},appendTo:function(a){var c=b(a);return c.size()&&c.append(this.ui),this},append:function(a){return a.header&&a.container?this.appendItem.apply(this,arguments):this.container.append(a),this},appendItem:function(a){return a.header&&a.container&&(a.container.hide(),this.container.append(a.header.addClass("tbc-accordion-itemHeader")).append(a.container.addClass("tbc-accordion-itemContainer"))),this},prepend:function(a){return a.header&&a.container?this.prependItem.apply(this,arguments):this.container.prepend(a),this},prependItem:function(a){return a.header&&a.container&&(a.container.hide(),this.container.prepend(a.container.addClass("tbc-accordion-itemContainer")).prepend(a.header.addClass("tbc-accordion-itemHeader"))),this},removeItem:function(a){var c,d;return a&&!isNaN(a)?(c=this.container.children(e.itemHeader).eq(a),d=c.next(e.itemContainer),c.remove(),d.remove()):"string"==typeof a&&(this.container.children(e.itemHeader).each(function(){return-1!==this.innerHTML.indexOf(a)?(c=b(this),!1):void 0}),d=c.next(e.itemContainer),c.remove(),d.remove()),c=d=null,this},getAll:function(){var a,c,d=[],f=this.container.children(e.itemHeader);for(a=0,c=f.length;c>a;a+=1)d.push({header:b(f[a]),container:b(f[a]).next(e.itemContainer)});try{return d}finally{d=f=null}},crimpleAll:function(){var a=this.container,b=a.children(e.itemHeader),c=a.children(e.itemContainer);return b.removeClass(e.currentCss),c.slideUp(),this},getCurrent:function(){var a=this.container.children(e.itemHeader).filter("."+e.currentCss),b=a.next(e.itemContainer);try{return a.size()?{header:a,container:b}:null}finally{a=b=null}},setCurrent:function(a,b){if(a=0!==a&&a?a:0,b||!this.isCurrent(a)){var c=this,d=this.getCurrent(),f=this.findItem(a);d&&f&&(d.header.removeClass(e.currentCss),d.container.stop().animate({height:0},300,function(){d.container.hide(),c.triggerEvent("retire",d),d=null})),f&&(f.header.addClass(e.currentCss),f.container.show().stop().animate({height:this.getAvailableHeight()},300,function(){f.container.css({overflow:"auto",position:"relative"}),c.triggerEvent("active",f),f=null}))}return this},isCurrent:function(a){var b=this.findItem(a);return b&&b.header.hasClass(e.currentCss)},findItem:function(a){var b,c,d,e=this.getAll();if(0===a||a&&!isNaN(a))b=e[a];else for(c=0,d=e.length;d>c;c+=1)if(-1!==e[c].header.innerHTML.indexOf(a)){b=e[c];break}try{return b}finally{e=b=null}},getHeight:function(){return this.container.innerHeight()},setHeight:function(a){var b=this.getHeadersHeight();return this.getCurrent().container.css({height:a-b}),this.ui.css({height:a}),this.triggerEvent("resize",a-b),this},getAvailableHeight:function(){var a=this.getHeight(),b=this.getHeadersHeight();return a-b},setAvailableHeight:function(a){var b=this.getHeadersHeight();return this.ui.css({height:a+b}),this.getCurrent().container.css({height:a}),this.trigerEvent("resize",a),this},getHeadersHeight:function(){var a,c,d=0,f=this.container.children(e.itemHeader);for(a=0,c=f.length;c>a;a+=1)d+=b(f[a]).outerHeight();try{return d}finally{d=f=a=c=null}}}).init()}}(tbc,jQuery),function(a,b){"use strict";a.accordionSelector=function(c){function d(a){var b;return a.includeChild!==b?a.includeChild:i.includeChild&&"ORGANIZATION"===a.nodeType||b}var e,f,g=a.self(this,arguments),h={autoSelect:!0,container:null,multiple:!0,height:356,treeOptions:{},accordionOptions:{},items:[{title:i18n("v4.js.organization"),type:"ajax",nodeType:"ORGANIZATION",content:"",active:!0,options:{}},{title:i18n("v4.js.post"),type:"ajax",nodeType:"POSITION_CATEGORY",content:"",options:{}},{title:i18n("v4.js.group"),type:"ajax",nodeType:"GROUP_CATEGORY",content:"",options:{}}],event:{}},i=a.extend({},h,c),j=0;g.packageName="tbc.orgSelector",g.addEvent(i.event),i.container?(g.container=b(i.container),g.ui=i.ui?b(i.ui):g.container):(g.container=b('<div class="tbc-orgSelector"></div>'),g.ui=i.ui?b(i.ui):g.container),f=g.container.css("position"),"position"!==f&&"fixed"!==f&&g.container.css("position","relative"),i.accordionOptions=b.extend({height:i.height},i.accordionOptions),e=new a.Accordion(i.accordionOptions),g.accordion=e,e.depend(g),e.appendTo(g.container),e.addEvent({retire:function(a){a.header.find(".tbc-accordion-includeChild").hide()},active:function(c){var e,f,h,j,k=c.container.data("options");"undefined"!=typeof d(k)&&c.header.find(".tbc-accordion-includeChild").show();try{g.includeChild=c.header.find("[name^='includeChild']")[0].checked}catch(l){}if(c&&c.container)if(c.container.data("rendered")||c.container.data("rendering")){if(i.autoSelect!==!1){if(e=c.container.data("treeId"),f=a.TASKS(e),!f)return;f.setCurrent()}}else"ajax"===k.type&&"string"==typeof k.content?(j=b("<div/>").html("loading...").css({margin:"1em",textAlign:"center"}).appendTo(c.container),h=b.extend({},k.treeOptions,{nodeType:k.nodeType,url:k.content,container:c.container,param:{nodeType:k.nodeType}}),f=new a.Tree(h),f.depend(g),f.addEvent({afterRender:function(){var b=this;i.autoSelect!==!1&&setTimeout(function(){b.setCurrent()},100),j.remove(),a.unlock(c.container),c.container.data("rendering",!1),g.triggerEvent("afterLoad",c),j=c=null},select:function(a,b,c,d){console.log(arguments),g._selected=a,g.triggerEvent("select",a,a.tp||a.nodeType,d),g.triggerEvent("selected",a,a.tp||a.nodeType,d)},deselect:function(a){return g.triggerEvent("deselect",a)},beforeLoad:function(){a.lock(c.container,10)},afterLoad:function(){a.unlock(c.container,10)}}),c.container.data("treeId",f.guid),setTimeout(function(){f.load(),f=null},1)):"object"==typeof k.content&&c.container.append(k.content),c.container.data("rendered",!0);g.triggerEvent("active",c)}}),g.extend({setHeight:function(b){this.container.height(b);{var c=this.container.innerHeight(),d=this.getCurrent(),e=d.container.data("treeId");a.TASKS(e)}this.triggerEvent("resize",c)},appendTo:function(a){b(a).size()&&this.ui.appendTo(a)},prependTo:function(a){b(a).size()&&this.ui.prependTo(a)},getCurrent:function(){return this.accordion.getCurrent()},getSelected:function(){return this._selected}}).addEvent({resize:function(a){e.setHeight(a)}}),b.each(i.items,function(a){var c,f,h=b('<h3 class="tbc-accordion-itemHeader"/>').html(this.title).appendTo(g.container),i=b('<div class="tbc-accordion-itemContainer"/>').appendTo(g.container).hide(),k=this.icon?this.icon.match(/(jpg|jpeg|png|gif|bmp)/)?'<i class="tbc-icon"><img src="'+this.icon+'"/></i>':'<i class="tbc-icon '+this.icon+'"></i>':null;k&&h.prepend(k),c=d(this),f=b('<div class="tbc-accordion-includeChild"></div>').html('<input type="checkbox" name="includeChild_'+a+'" '+(c?' checked="checked" ':"")+' /><label for="includeChild_'+a+'">'+i18n("v4.js.includeSubCls")+"</label>"),f.show().css({display:"none"}),f.find("[name='includeChild_"+a+"']").click(function(){g.includeChild=this.checked,g.triggerEvent("includechild",this.checked)}),h.append(f),i.data("options",this),e.appendItem({header:h,container:i}),h=i=k=null,this.active&&(j=a)}),e.setCurrent(j)}}(tbc,jQuery),function(a,b){"use strict";a.dialog=function(c,d){if(c&&c instanceof Object&&!c.size&&(d=c,c=d.html),d=d||{},!(this instanceof a.dialog))return new a.dialog(c,d);var e=d.parentClass||(d.url?a.Window:a.Panel),f=a.extend({name:i18n("v4.js.systemPrompt"),width:320,height:190,target:"body",modal:!0,icon:"icon-application_windows",autoLoad:!1,scrolling:!1,buttonsAlign:"right"},d);f.homepage=d.url;var g=a.self(this,arguments).extend([e,f],{initDialog:function(){var a,d,e,h,i=this,j=b('<div style="overflow:auto;"></div>'),k=[];if(j.append(c||f.html),this.append(j),f.buttons){if("object"!=typeof f.buttons||f.buttons instanceof Array){if(f.buttons instanceof Array)for(d=0;d<f.buttons.length;d++)h=f.buttons[d],e=i.renderButtons(h,d),k.push(e)}else for(d in f.buttons)f.buttons.hasOwnProperty(d)&&(h=f.buttons[d],e=i.renderButtons(h,d),k.push(e));k.length>0&&(a=b('<div class="tbc-dialog-buttons" style="text-align:'+f.buttonsAlign+'; padding:10px; background-color:#f6f6f6;"></div>'),a.html(k.join(""))),a.on("click","button",function(){var a=this.getAttribute("data-action"),c=a&&/^\d+$/.test(a)?f.buttons[parseInt(a)].action:f.buttons[a];b.isFunction(c)&&c.call(g)}),this.container.css({overflow:"hidden"}),this.append(a)}return this.container=j,this.show(),this.initModal(),this.addEvent({close:function(){var a=this.mask;a&&b.isFunction(a.fadeOut)&&a.fadeOut(function(){a.remove()})},resize:function(c){var d,e=this.part.header.height(),f=this.part.footer.height();d=a&&b.isFunction(a.height)?c.height-e-f-a.outerHeight():"100%",j.height(d)}}),this},renderButtons:function(a,b){var c,d;return"function"==typeof a?(c=b,d=""):(c=a.text||"",d=a.cssClass||""),'<button class="tbc-button '+d+'" data-action="'+b+'" type="button">'+c+"</button>"},initModal:function(){var a=this;f.modal&&(this.mask=b('<div class="tbc-mask"/>').css({position:"absolute",zIndex:(this.ui.css("zIndex")||1)-1,backgroundColor:"#000",opacity:.2,left:0,top:0,width:"100%",height:"100%"}).insertBefore(this.ui).bind("click",function(){b.isFunction(a.flash)&&a.flash()}))}}).initDialog();return g.triggerEvent("resize",{width:f.width,height:g.ui.height()}),b.isFunction(g.load)&&g.load(),g},a.confirm=function(c,d,e){var f={};return e=e||(b.isPlainObject(d)?d:{}),f[e.verifyText||i18n("v4.js.confirm")]=function(){b.isFunction(d)&&d.call(this),this.close()},f[e.cancelText||i18n("v4.js.cancel")]=function(){this.close()},e.buttons=f,e.icon=e.icon||"icon-warning_triangle",e.name=e.name||e.title||i18n("v4.js.confirm"),c=b('<div style="padding:24px;"></div>').empty().append(c),a.dialog(c,e)},a.alert=function(c,d,e){var f={};return e=e||(b.isPlainObject(d)?d:{}),f[e.verifyText||i18n("v4.js.confirm")]=function(){b.isFunction(d)&&d.call(this),this.close()},e.buttons=f,e.icon=e.icon||"icon-information",e.name=e.name||e.title||i18n("v4.js.systemPrompt"),c=b('<div style="padding:24px;"></div>').append(c),a.dialog(c,e)}}(window.tbc,window.jQuery,window.URLS),tbc.Button=function(a){var b=tbc.self(this,arguments);b.extend(tbc.Event),b.extend(tbc.ClassManager),b.packageName="tbc.Button";var c={border:!0,icon:null,text:"&nbsp;",click:null,target:null},d=tbc.extend({},c,a);b.ui=$('<button class="">        <span class="tbc-icon icon-application_windows_add"><img src="" onerror="this.style.display=\'none\'" style="width:16px; height:16px;"/></span>        <span class="tbc-button-text"></span>    </button>').addClass(d.border?"tbc-button":"tbc-button-link");var e=b.ui.find("img"),f=b.ui.find(".tbc-button-text");b.icon=function(a){return a&&"string"==typeof a?(a.match(/\.(jpg|jpeg|gif|png|img|bmp|ico)$/)||-1!==a.indexOf("sf-server/file/getFile/")?e.show().attr("src",a).parent().removeAttr("class").addClass("tbc-icon"):e.hide().parent().removeAttr("class").addClass("tbc-icon").addClass(a),b):d.icon},b.text=function(a){return a&&"string"==typeof a?(f.html(a),d.text=a,b):d.text},b.disable=function(){return b.disabled=!0,b.ui.addClass("tbc-button-disabled"),b.triggerEvent("disable"),b},b.enable=function(){return b.disabled=!1,b.ui.removeClass("tbc-button-disabled"),b.triggerEvent("enable"),b},b.click=function(){return b.disabled||($.isFunction(d.click)&&d.click.call(b),b.triggerEvent("click")),b},b.appendTo=function(a){return a=a&&a.container?a.container:a,b.ui.appendTo(a),b.triggerEvent("append",a),b},b.remove=function(){b.ui.remove(),b.triggerEvent("remove")},b.icon(d.icon),b.text(d.text),b.appendTo(d.target),b.ui.click(function(){b.click()})},function(a,b){"use strict";a.blendSelector=function(c){function d(a,b){var c=h.ui.find(".searchKeywords");b&&0!==b.length&&b!==c[0].title?"0"===a?(h._ajaxDataAvailable.keyword=b,h._ajaxDataSelected.keyword=""):"1"===a&&g.itemSelectorOptions.autoSave!==!1&&g.itemSelectorOptions.lazy!==!0&&(h._ajaxDataAvailable.keyword="",h._ajaxDataSelected.keyword=b):(h._ajaxDataAvailable.keyword="",h._ajaxDataSelected.keyword=""),h.pageSelected(1),h.pageAvailable(1)}a.blendSelector.bodyOverflowHidden||(a.blendSelector.bodyOverflowHidden=!0,b("html,body").css({overflow:"hidden",background:"transparent"}));var e=a.self(this,arguments),f={max:0,title:i18n("v4.js.selectUsers"),verifyButton:!0,cancelButton:!0,verifyText:i18n("v4.js.confirm"),cancelText:i18n("v4.js.cancel")},g=a.extend({},f,c);e.addEvent(g.event),e.packageName="tbc.blendSelector",e.ui=b('<div class="tbc-blendSelector"></div>').html('<div role="header" class="tbc-blendSelector-header"><h3>'+i18n("v4.js.pleaseSelect")+'</h3><span role="tips"><i class="tbc-icon icon-info"></i>'+i18n("v4.js.usltAutoSaveTips")+'</span> </div><div role="org" class="tbc-blendSelector-organize"></div><div role="items" class="tbc-blendSelector-items"></div><div style="clear:both;"></div><div role="footer" class="tbc-blendSelector-footer">    <a role="verify" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(g.verifyText||i18n("v4.js.confirm"))+'</span></a>    <a role="cancel" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(g.cancelText||i18n("v4.js.cancel"))+"</span></a></div>"),e.container=e.ui,e.part={},e.ui.find("[role]").each(function(){var a=this.getAttribute("role");e.part[a]=b(this)}),g.itemSelectorOptions=b.extend({},g.itemSelectorOptions,{vauleSetFormater:function(a){var b,c={};for(b in a)if(a.hasOwnProperty(b))switch(b){case"nm":case"text":c.nm=a.nm||a.text,c.text=a.nm||a.text;break;case"selected":c[b]=a[b]||this._cache.selected.names[a.id]?" checked":"";break;case"rnm":c[b]=a[b]?" ("+a[b]+")":"";break;case"icn":c[b]=a[b]?" ("+a[b]+")":"";break;default:c[b]=a[b]}c.selected=a.selected||this._cache.selected.names[a.id]?" checked":"";try{return c}finally{c=null}}}),g.orgSelectorOptions=b.extend(g.orgSelectorOptions||{},{height:365});var h=new a.itemSelector(g.itemSelectorOptions),i=new a.accordionSelector(g.orgSelectorOptions);h.prepend('<div class="tbc-itemSelector-header">    <div class="padding">        <select name="accountStatus">            <option value="ALL" selected="selected">'+i18n("v4.js.all")+'</option>            <option value="ENABLE">'+i18n("v4.js.activationStaff")+'</option>            <option value="FORBIDDEN">'+i18n("v4.js.freezeStaff")+'</option>        </select>        <div class="abs_right">            <input type="text" value="'+i18n("v4.js.usltInputTips")+'" title="'+i18n("v4.js.usltInputTips")+'" class="tbc-inputer searchKeywords">            <select name="which">                <option value="0">'+i18n("v4.js.available")+'</option>                <option value="1">'+i18n("v4.js.selected")+'</option>            </select>            <a class="tbc-button searchButton" type="button">'+i18n("v4.js.filter")+"</a>        </div>     </div></div>"),(g.itemSelectorOptions.autoSave===!1||g.itemSelectorOptions.lazy===!0)&&e.part.tips.hide(),h.addEvent({beforeSave:function(){return a.lock(e.ui),!1},afterSave:function(){return a.unlock(e.ui),!1}}),h.ui.find("select[name='accountStatus']").val(g.accountStatus).change(function(){h._ajaxDataAvailable.accountStatus=this.value,h._ajaxDataSelected.accountStatus=this.value,h.pageAvailable()}),g.accountStatus&&(h._ajaxDataAvailable.accountStatus=g.accountStatus,h._ajaxDataSelected.accountStatus=g.accountStatus),(g.accountStatus||g.accountStatus&&"all"!==g.accountStatus.toLowerCase())&&h.ui.find("select[name='accountStatus']").hide(),h.ui.find(".searchKeywords").keyup(function(a){var c=b.trim(this.value);c!==this.title&&(h._ajaxDataAvailable.keyword=c,h._ajaxDataSelected.keyword=c),13===a.keyCode&&h.ui.find(".searchButton").trigger("click")}).focus(function(){var a=b.trim(this.value);a===this.title&&(this.value="")}).blur(function(){var a=b.trim(this.value);""===a&&(this.value=this.title)}),h.ui.find("select[name='which']").change(function(){var a=this.value,b=h.ui.find(".searchKeywords").val();d(a,b)}),h.ui.find(".searchButton").click(function(a){a.preventDefault();var b=h.ui.find("select[name='which']").val(),c=h.ui.find(".searchKeywords").val();d(b,c)}),g.itemSelectorOptions.deletable===!1&&(b(h.part.removeAll).hide(),b(h.part.operaRemoveSelected).attr("disabled","disabled").addClass("tbc-button-disabled"),b(h.part.operaRemoveCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled")),h.depend(e),i.depend(e),h.appendTo(e.part.items),i.appendTo(e.part.org),i.addEvent({select:function(a,b){h._ajaxDataAvailable.nodeType=b,h._ajaxDataAvailable.nodeId=a.id,h.pageAvailable(1)},includechild:function(a){h._ajaxDataAvailable.includeChild=a}}),e.extend({append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},close:function(){e.triggerEvent("close"),this.DESTROY()},getSelected:function(){var a,b=h._cache.selected.names,c=[];for(a in b)b.hasOwnProperty(a)&&c.push(b[a]);return c}}),g.verifyButton||e.part.verify.hide(),g.cancelButton||e.part.cancel.hide(),e.part.verify.click(function(){var c=e.getSelected(),d=g.itemSelectorOptions.autoSave,f=g.itemSelectorOptions.lazy,h=[];if("undefined"!=typeof d&&d!==!0||f!==!0||!g.lazyUrl)e.triggerEvent("verify",c)!==!1&&(e.ui.remove(),e.close());else{b.each(c,function(){h.push(this.userId)});var i=g.itemSelectorOptions.post||{};i[g.itemSelectorOptions.postKey||"userIds"]=h.join(","),b.ajax({url:g.lazyUrl,data:i,type:"post",dataType:"json",beforeSend:function(){a.lock(e.ui)},complete:function(){a.unlock(e.ui)},success:function(){e.triggerEvent("verify",c)!==!1&&(e.ui.remove(),e.close())}}),i=null}}),e.part.cancel.click(function(){var a=e.getSelected();e.triggerEvent("cancel",a)!==!1&&(e.ui.remove(),e.close())})}}(tbc,jQuery),function(a,b){"use strict";b.CourseSelector=function(c){b.CourseSelector.bodyOverflowHidden||(b.CourseSelector.bodyOverflowHidden=!0,a("html,body").css({overflow:"hidden",background:"transparent"}));var d,e,f,g={selectButtons:function(){}},h=b.extend({},g,c),i=b.self(this,arguments);i.addEvent(h.event),i.packageName="tbc.CourseSelector",i.ui=a('<div class="tbc-blendSelector tbc-courseSelector"></div>').html('<div role="header" class="tbc-blendSelector-header"><h3>'+i18n("v4.js.pleaseSelect")+'</h3><span role="tips"><i class="tbc-icon icon-info"></i>'+i18n("v4.js.usltAutoSaveTips")+'</span> </div><div role="org" class="tbc-blendSelector-organize"></div><div role="items" class="tbc-blendSelector-items"></div><div style="clear:both;"></div><div role="footer" class="tbc-blendSelector-footer">    <a role="verify" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(h.verifyText||i18n("v4.js.confirm"))+'</span></a>    <a role="cancel" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(h.cancelText||i18n("v4.js.cancel"))+"</span></a></div>"),i.container=i.ui,i.part={},i.ui.find("[role]").each(function(){var b=this.getAttribute("role");i.part[b]=a(this)}),(h.itemSelectorOptions.autoSave===!1||h.itemSelectorOptions.lazy===!0)&&i.part.tips.hide(),h.itemSelectorOptions=a.extend({},h.itemSelectorOptions,{isOrganize:!0,textTransform:{COURSE:i18n("v4.js.courseMin"),SUBJECT:i18n("v4.js.subject")},post:h.post,itemTemplate:'<li data-id="{id}" title="{title}" class="{selected} {checked}"><i>{title}</i></li>',dataTemplate:{id:"id",text:"title",title:"title"},itemTemplateSelected:'<li data-id="{id}" title="{title}"><i>{type}{title}</i></li>',vauleSetFormater:function(a){var b,c=(e.getCurrent().container.data("options").nodeType,{});for(b in a)if(a.hasOwnProperty(b))switch(b){case"type":c.type=a.type||"COURSE";break;case"nm":case"text":case"title":c.nm=a.nm||a.text||a.title,c.text=a.nm||a.text||a.title,c.title=a.nm||a.text||a.title;break;case"selected":c[b]=a[b]||this._cache.selected.names[a.id]?" checked":"";break;default:c[b]=a[b]}try{return c}finally{c=null}},postFormater:function(a){var b,c,d,e=[];for(c=0,d=a.length;d>c;c+=1)b=a[c].tp||"COURSE",e.push([b,a[c].id].join(":"));return e.join(",")},itemDataFormater:function(a){{var b,c,d=e.getCurrent().container.data("options").nodeType;e.getSelected()||{}}for(b=0,c=a.length;c>b;b+=1)switch(a[b].tp||d){case"SUBJECT":a[b].tp=a[b].type||"SUBJECT",a[b].nm=a[b].title,delete a[b].rid,delete a[b].rnm;break;default:a[b].tp=a[b].type||"COURSE",a[b].nm=a[b].title}return a}}),h.orgSelectorOptions=a.extend({},h.orgSelectorOptions,{autoSelect:!1}),f=h.itemSelectorOptions.dataTemplate,h.orgSelectorOptions=a.extend(h.orgSelectorOptions||{},{height:365}),d=new b.itemSelector(h.itemSelectorOptions),e=new b.accordionSelector(h.orgSelectorOptions),d.prepend('<div class="tbc-itemSelector-header"><div class="padding">   <div class="abs_right">        <input type="text" value="'+i18n("v4.js.enterCourseCodeOrTitle")+'" title="'+i18n("v4.js.enterCourseCodeOrTitle")+'" class="tbc-inputer searchKeywords">        <select name="device" style="display:'+(h.itemSelectorOptions.device!==!1?"":"none")+';">            <option value="">'+i18n("v4.js.allDevice")+'</option>            <option value="COMPUTER">PC</option>            <option value="IPHONE">iPhone</option>            <option value="IPAD">iPad</option>            <option value="ANDROIDPHONE">Android</option>            <option value="ANDROIDPAD">Android Pad</option>        </select>        <a class="tbc-button searchButton" type="button">'+i18n("v4.js.filter")+"</a>    </div></div></div>"),d.addEvent({beforeSave:function(){return b.lock(i.ui),!1},afterSave:function(){return b.unlock(i.ui),!1}}),d.ui.on("click",".searchButton",function(){var b=d.ui.find("input.searchKeywords"),c=b.val(),e=d.ui.find("select[name='device']").val();a.trim(c)!==b.attr("title")?d._ajaxDataAvailable.keyword=c:delete d._ajaxDataAvailable.keyword,h.itemSelectorOptions.device!==!1?d._ajaxDataAvailable.device=e:delete d._ajaxDataAvailable.device,d.pageAvailable(1)}),d.ui.find("input.searchKeywords").bind({focus:function(){a.trim(this.value)===this.title&&(this.value="")},blur:function(){""===a.trim(this.value)&&(this.value=this.title)}}),i.extend({appendTo:function(){}}),d.depend(i),e.depend(i),a(d.part.addAll).hide(),h.itemSelectorOptions.deletable===!1&&(a(d.part.removeAll).hide(),a(d.part.operaRemoveSelected).attr("disabled","disabled").addClass("tbc-button-disabled"),a(d.part.operaRemoveCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled")),d.appendTo(i.part.items),d.loadAvailableByPage(1),e.appendTo(i.part.org),e.addEvent({afterLoad:function(a){var c=(a.container.data("options"),a.container.data("treeId")),d=b.TASKS(c);d&&"function"==typeof d.setCurrent&&d.setCurrent()},active:function(a){var c=(a.container.data("options"),a.container.data("treeId")),d=b.TASKS(c);d&&"function"==typeof d.setCurrent&&d.setCurrent()},check:function(a){{var b,c,f,g,h;this.getCurrent().container.data("options").nodeType}for(b=0,c=a.length;c>b;b+=1)f=e.includeChild?i18n("v4.js.includeSubCls"):"",g=a[b].property,h=[{id:g.id,tp:g.tp,nm:g.nm||g.text,ic:e.includeChild,icn:f,rnm:""}],g.id&&!d._cache.available.names[g.id]&&d.addAvailableItem(h)},deselect:function(a){var b,c;for(b=0,c=a.length;c>b;b+=1)d.removeAvailableItem(a[b].property.id)},select:function(a,b){d._ajaxDataAvailable.nodeType=b,d._ajaxDataAvailable.nodeId=a.id,d.loadAvailableByPage(1)},includechild:function(a){d._ajaxDataAvailable.includeChild=a}}),d.addEvent({select:function(){{var a=e.getCurrent();a.container.data("options")}},beforeAvailableLoad:function(){{var a=e.getCurrent();a.container.data("options")}}}),i.extend({append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},close:function(){i.triggerEvent("close"),this.DESTROY()},getSelected:function(){var b;if(a.isFunction(d.getSelected))b=d.getSelected();else{var c,e=d._cache.selected.names,b=[];for(c in e)e.hasOwnProperty(c)&&e[c]&&b.push(e[c])}return b}}),h.verifyButton||i.part.verify.hide(),h.cancelButton||i.part.cancel.hide(),i.part.verify.click(function(){var c,d=i.getSelected(),e=h.itemSelectorOptions.autoSave,f=h.itemSelectorOptions.lazy;e!==!1&&f===!0&&h.lazyUrl?(c=h.itemSelectorOptions.post||{},c[h.itemSelectorOptions.postKey||"courseIds"]=h.itemSelectorOptions.postFormater(d),a.ajax({url:h.lazyUrl,data:c,type:"post",dataType:"json",beforeSend:function(){b.lock(i.ui)},complete:function(){b.unlock(i.ui)},success:function(){i.triggerEvent("verify",d)!==!1&&(i.ui.remove(),i.close())}}),c=null):i.triggerEvent("verify",d)!==!1&&(i.ui.remove(),i.close())}),i.part.cancel.click(function(){var a=i.getSelected();i.triggerEvent("cancel",a)!==!1&&(i.ui.remove(),i.close())})}}(jQuery,tbc),function(){"use strict";tbc.organizationSelector=function(a){function b(a,b){var c=g.ui.find(".searchKeywords"),d=c.attr("placeholder")||c.attr("title");b&&0!==b.length&&b!==d?"0"===a?(g._ajaxDataAvailable.keyword=b,g._ajaxDataSelected.keyword=""):"1"===a&&e.itemSelectorOptions.autoSave!==!1&&e.itemSelectorOptions.lazy!==!0&&(g._ajaxDataAvailable.keyword="",g._ajaxDataSelected.keyword=b):(g._ajaxDataAvailable.keyword="",g._ajaxDataSelected.keyword=""),g.pageSelected(1),g.pageAvailable(1)}tbc.organizationSelector.bodyOverflowHidden||(tbc.organizationSelector.bodyOverflowHidden=!0,$("html,body").css({overflow:"hidden",background:"transparent"}));var c=tbc.self(this,arguments),d={},e=tbc.extend({},d,a);c.addEvent(e.event),c.packageName="tbc.organizationSelector",c.ui=$('<div class="tbc-blendSelector tbc-organizationSelector"></div>').html('<div role="header" class="tbc-blendSelector-header">   <h3>'+i18n("v4.js.pleaseSelect")+'</h3><span role="tips"><i class="tbc-icon icon-info"></i>'+i18n("v4.js.usltAutoSaveTips")+'</span></div><div role="org" class="tbc-blendSelector-organize"></div><div role="items" class="tbc-blendSelector-items"></div><div style="clear:both;"></div><div role="footer" class="tbc-blendSelector-footer">   <a role="verify" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(e.verifyText||i18n("v4.js.confirm"))+'</span></a>   <a role="cancel" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(e.cancelText||i18n("v4.js.cancel"))+"</span></a></div>"),c.container=c.ui,c.part={},c.ui.find("[role]").each(function(){var a=this.getAttribute("role");c.part[a]=$(this)}),(e.itemSelectorOptions.autoSave===!1||e.itemSelectorOptions.lazy===!0)&&c.part.tips.hide(),e.itemSelectorOptions=$.extend({},e.itemSelectorOptions,{isOrganize:!0,textTransform:{ORGANIZATION:"["+i18n("v4.js.minDep")+"] ",POSITION:"["+i18n("v4.js.minJob")+"] ",POSITION_CATEGORY:" ",GROUP:"["+i18n("v4.js.minGroup")+"] ",GROUP_CATEGORY:" "},post:e.post,itemTemplate:'<li data-id="{id}" title="{np}" title="{nm}"><i>{nm}</i></li>',itemTemplateSelected:'<li data-id="{id}" title="{np}"><i>{tp}{nm}{parentheses1}{rnm}{icn}{parentheses2}</i></li>',dataTemplate:{id:"id",text:"nm",title:"np"},vauleSetFormater:function(a){var b,c=(h.getCurrent().container.data("options").nodeType,{});for(b in a)switch(b){case"nm":case"text":c.nm=a.nm||a.text,c.text=a.nm||a.text;break;case"selected":c[b]=a[b]||this._cache.selected.names[a.id]?" checked":"";break;case"rnm":c[b]=a[b]?a[b]:"";break;case"icn":c[b]=a[b]?a[b]:"";break;default:c[b]=a[b]}try{return c}finally{c=null}},postFormater:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b++)d.push([a[b].ic,a[b][f.id],a[b].tp||"ORGANIZATION",a[b].rid].join(":"));return d.join(",")},itemDataFormater:function(a){var b,c,d=h.getCurrent().container.data("options").nodeType,e=h.getSelected()||{};for(b=0,c=a.length;c>b;b++)switch(a[b].tp||d){case"POSITION":a[b].rnm=a[b].rnm||e.nm||e.text,a[b].rid=a[b].rid||e.id,a[b].tp=a[b].tp||"POSITION",a[b].rnm&&(a[b].parentheses1=" (",a[b].parentheses2=")"),a[b].ic=h.includeChild,a[b].ic&&(a[b].parentheses1=" (",a[b].parentheses2=")");break;case"ORGANIZATION":a[b].tp=a[b].tp||"ORGANIZATION",delete a[b].rid,delete a[b].rnm,a[b].ic&&(a[b].parentheses1=" (",a[b].parentheses2=")");break;case"GROUP":}return a}}),e.orgSelectorOptions=$.extend({},e.orgSelectorOptions,{autoSelect:!1,height:365});var f=e.itemSelectorOptions.dataTemplate,g=new tbc.itemSelector(e.itemSelectorOptions),h=new tbc.accordionSelector(e.orgSelectorOptions);g.prepend('<div class="tbc-itemSelector-header">    <div class="padding">        <div class="abs_right">            <input type="text" placeholder="'+i18n("v4.js.enterKeywords")+'" class="tbc-inputer searchKeywords">            <select name="which" style="display:none;">                <option value="0">'+i18n("v4.js.available")+'</option>                <option value="1">'+i18n("v4.js.selected")+'</option>            </select>            <a class="tbc-button searchButton" type="button">'+i18n("v4.js.filter")+"</a>        </div>     </div></div>"),g.ui.find(".searchKeywords").keyup(function(a){var b=$.trim(this.value),c=this.getAttribute("placeholder");
b!==c&&(g._ajaxDataAvailable.keyword=b,g._ajaxDataSelected.keyword=b),13===a.keyCode&&g.ui.find(".searchButton").trigger("click")}).focus(function(){var a=$.trim(this.value);a===this.getAttribute("placeholder")&&(this.value="")}).blur(function(){var a=$.trim(this.value);""===a&&(this.value=this.getAttribute("placeholder"))}),g.ui.find("select[name='which']").change(function(){var a=this.value,c=g.ui.find(".searchKeywords").val();b(a,c)}),g.ui.find(".searchButton").click(function(a){a.preventDefault();var c=g.ui.find("select[name='which']").val(),d=g.ui.find(".searchKeywords").val();b(c,d)}),g.addEvent({beforeSave:function(){return tbc.lock(c.ui),!1},afterSave:function(){return tbc.unlock(c.ui),!1}}),c.extend({appendTo:function(){}}),g.depend(c),h.depend(c),$(g.part.operaAddCurrPage).hide(),$(g.part.operaRemoveCurrPage).hide(),$(g.part.addAll).hide(),$(g.part.availContainer).parent().hide(),$(g.part.selectedContainer).parent().css({width:410}),e.itemSelectorOptions.deletable===!1&&($(g.part.removeAll).hide(),$(g.part.operaRemoveSelected).attr("disabled","disabled").addClass("tbc-button-disabled"),$(g.part.operaRemoveCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled")),g.appendTo(c.part.items),g.loadAvailableByPage(1),h.appendTo(c.part.org),h.addEvent({afterLoad:function(a){var b=a.container.data("options");if("POSITION"===b.nodeType){var c=a.container.data("treeId"),d=tbc.TASKS(c);d&&d.setCurrent()}},active:function(a){var b=a.container.data("options");if("POSITION"===b.nodeType){{var c=$(g.part.selectedContainer).parent();c.outerWidth()}$(g.part.selectedContainer).parent().css({width:203}),c.css({width:203}).show(),$(g.part.availContainer).parent().show()}else{var d=$(g.part.availContainer).parent();d.hide(),d.find("li.selected").removeClass("selected"),$(g.part.selectedContainer).parent().css({width:418})}if("POSITION"===b.nodeType){var e=a.container.data("treeId"),f=tbc.TASKS(e);f&&f.setCurrent()}g.clearAvailable()},check:function(a){for(var b=(this.getCurrent().container.data("options").nodeType,0),c=a.length;c>b;b++){var d=h.includeChild?i18n("v4.js.includeSubCls"):"",e=a[b].property,f=[{id:e.id,tp:e.tp,nm:e.nm||e.text,ic:h.includeChild,icn:d,rnm:""}];e.id&&!g._cache.available.names[e.id]&&g.addAvailableItem(f)}},deselect:function(a){for(var b=0,c=a.length;c>b;b++)g.removeAvailableItem(a[b].property.id)},select:function(a,b){g._ajaxDataAvailable.nodeType=b,g._ajaxDataAvailable.nodeId=a.id;var c=this.getCurrent().container.data("options").nodeType;if(a.tp===c||!a.tp&&"POSITION"!==c||"ORGANIZATION"===c||"GROUP"===c&&"GROUP"===a.tp)if("POSITION"===a.tp);else{var d,e;a.tp&&"ORGANIZATION"!==a.tp?e=[{id:a.id,tp:a.tp,nm:a.nm||a.text,ic:h.includeChild,rnm:""}]:(d=h.includeChild?i18n("v4.js.includeSubCls"):"",e=[{id:a.id,tp:a.tp,nm:a.nm||a.text,ic:h.includeChild,icn:d,rnm:""}]),g.addAvailableItem(e)}else"POSITION"===c&&g.loadAvailableByPage(1)},includechild:function(a){g._ajaxDataAvailable.includeChild=a}}),g.addEvent({select:function(){var a=h.getCurrent(),b=a.container.data("options");"POSITION"!==b.nodeType&&this.clearAvailable()},beforeAvailableLoad:function(){var a=h.getCurrent(),b=a.container.data("options");return"POSITION"!==b.nodeType?!1:void 0}}),c.extend({append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},close:function(){c.triggerEvent("close"),this.DESTROY()},getSelected:function(){var a=g._cache.selected.names,b=[];for(var c in a)c&&a[c]&&b.push(a[c]);return b}}),e.verifyButton||c.part.verify.hide(),e.cancelButton||c.part.cancel.hide(),c.part.verify.click(function(){var a=c.getSelected(),b=e.itemSelectorOptions.autoSave,d=e.itemSelectorOptions.lazy;if(b!==!1&&d===!0&&e.lazyUrl){var f=e.itemSelectorOptions.post||{};f[e.itemSelectorOptions.postKey||"orgIds"]=e.itemSelectorOptions.postFormater(a),$.ajax({url:e.lazyUrl,data:f,dataType:"json",type:"post",beforeSend:function(){tbc.lock(c.ui)},complete:function(){tbc.unlock(c.ui)},success:function(){c.triggerEvent("verify",a)!==!1&&(c.ui.remove(),c.close())}}),f=null}else c.triggerEvent("verify",a)!==!1&&(c.ui.remove(),c.close())}),c.part.cancel.click(function(){var a=c.getSelected();c.triggerEvent("cancel",a)!==!1&&(c.ui.remove(),c.close())})},tbc.organizationSelector.prototype={init:function(){}}}(),function(a,b){"use strict";a.Drag=function(c){var d=a.self(this,arguments),e={node:null,selected:null,window:window,document:document,handle:null,cursor:"move",circles:null,circlesRound:{},targets:null,rangeMode:"y",disableItem:null,disableInsertTargets:null,timeout:0,pauseTimeout:40},f=a.extend({},e,c),g=!!document.documentElement.ontouchstart,h=b(f.node).find(f.handle),i={left:0,top:0},j={left:0,top:0},k=f.targets||b(f.node).parent(),l=[],m=null,n=null;d.packageName="tbc.Drag",d.pointer=b("<div></div>").addClass("tbc-drag-pointer").css({position:"absolute",zIndex:100,background:"#fff",height:"1px",border:"1px solid #888",borderRadius:"10px",overflow:"hidden",lineHeight:"0",opacity:.5}),h.size()&&h.css({cursor:f.cursor||"move"}),b(f.disableInsertTargets).data("tbc_drag_"+d.guid,!0),d.node=null,d.replica=[],d.a=function(){alert(f.targets.size())},d.addContainer=function(c){b(c).each(function(){l.push(this)}),f.targets=b(l),b(c).delegate(f.handle,"mousedown",{},function(c){var e=b(this);return d.node=e.parents(f.node),0===d.node.size()||c.originalEvent.draggable===!1||f.disableItem&&d.node.filter(f.disableItem).size()>0||a.msie&&a.browserVersion<9&&1!==c.button||(a.msie&&a.browserVersion>8||!a.msie)&&0!==c.button?!1:(b("body").disableSelect(),i.left=c.pageX,i.top=c.pageY,d.init(c),c.disableSelectArea=!0,!1)})},d.addContainer(k),d.removeContainer=function(a){var c=[];f.targets.each(function(d,e){b(a).each(function(){e!==this&&c.push(e)})}),f.targets=b(c)},d.init=function(a){return b(document).bind({"mouseup.tbc_drag":function(a){d.stop(a,d.getPositionByEvent(a))}}),f.timeout?m=setTimeout(function(){d.start(a)},f.timeout):d.start(a),d},d.getPositionByEvent=function(a){return{left:a.pageX-j.left,top:a.pageY-j.top}},d.start=function(a){{var c=d.node.offset();document.documentElement.scrollTop||document.body.scrollTop,document.documentElement.scrollLeft||document.body.scrollLeft}d.triggerEvent("start",a),d.createReplica(),"y"===f.rangeMode?d.pointer.css({width:d.node.width(),height:2}).appendTo("body"):d.pointer.css({width:2,height:d.node.height()}).appendTo("body"),j={left:a.pageX-c.left,top:a.pageY-c.top},b(document).bind("mousemove.tbc_drag",function(a){d.move(a)}),d.starting=!0},d.move=function(a){clearTimeout(n),n=setTimeout(function(){d.pause(a)},f.pauseTimeout);var b=d.getPositionByEvent(a);return b.right=b.left+1,b.bottom=b.top+1,d.replica&&d.moveReplica(b),d.triggerEvent("move",b),d},d.pause=function(c,e){if(f.targets&&b(f.targets).size()>0&&(!a.msie||a.msie&&a.browserVersion>7)&&d.starting===!0){var g=d.locateInsertPosition(c),h=g.offset;g.marks.size()?d.pointer.show().css({width:"y"===f.rangeMode?h.width:2,height:"y"===f.rangeMode?2:h.height,left:h.left,top:g.replica.top<h.halfY?h.top:h.bottom}):d.pointer.hide()}return d.triggerEvent("pause",c,e),d},d.stop=function(a){if(clearTimeout(m),clearTimeout(n),b(document).unbind(".tbc_drag"),b("body").enableSelect(),d.starting!==!0)return d;var c=d.locateInsertPosition(a),e=d.node,g=f.selected?e.siblings(f.selected):b(),h=c.replica.top<c.offset.halfY?"before":"after",i={node:e,selected:g,marks:c.marks,from:e.parent(),to:c.transfer||c.dropBox,offset:c.offset};return i.offset.relative=h,d.insertTo(c,i),d.starting=!1,d.triggerEvent("stop",i),d},d.createReplica=function(){var c,e=d.node.offset(),g=[],h={node:d.node,clone:d.node.clone().appendTo("body").css({position:"absolute",zIndex:"100",left:e.left,top:e.top,opacity:.5})};return g.push(h),f.selected&&(c=d.node.siblings(f.selected),c.each(function(c,d){var e=b(this),f=e.offset(),i="rotate("+a.random(-15,15)+"deg)",j={node:e,clone:e.clone().appendTo("body").css({position:"absolute",zIndex:"99",left:f.left,top:f.top,opacity:.5,MozTransform:i,WebkitTransform:i,OTransform:i,msTransform:i,transform:i})};g.push(j),j.clone.animate(h.clone.offset(),800),d=null})),d.replica=g,e=g=h=null,d.replica},d.moveReplica=function(a){return b.each(d.replica,function(b,c){c.clone.stop().css({left:a.left,top:a.top})}),d},d.deleteReplica=function(){return b.each(d.replica,function(a,c){var d=c.transfer?b(c.transfer).offset():b(c.node).offset(),e=d.left,f=d.top;c.clone.animate({top:f,left:e,opacity:0},400,function(){c.clone.remove(),delete c.clone})}),delete d.replica,d},d.isOpenFor=function(a){var c=!0;return b(f.disableInsertTargets).each(function(){return b(a)[0]===this?(c=!1,!1):void 0}),c},d.insertTo=function(a,c){if(!a)return d;{var e,f,g,h=c.node,i=c.selected,j=c.to;window.desktop}b(a.dropBox).removeClass("tbc-dragin").parent().removeClass("tbc-dragin-parent"),d.isOpenFor(j)&&(a.marks.size()?(e=a.marks,f=a.offset,g=d.triggerEvent("beforeInsert",c),g===!1?(b.each(d.replica,function(a){d.replica[a].transfer=c.transfer}),a.marks[0]!==h[0]&&d.triggerEvent("afterInsert",c)):a.marks[0]!==h[0]&&("before"===c.offset.relative?h.insertBefore(e):h.insertAfter(e),i.insertAfter(h),d.triggerEvent("afterInsert",c)),e=f=null):j.size()&&d.triggerEvent("beforeInsert",c)!==!1&&(h.appendTo(j),i.insertAfter(h),d.triggerEvent("afterInsert",c))),d.pointer.remove(),d.deleteReplica(),h=i=c=null},d.locateTarget=function(c,d){var e,g,h,i,j,k,l=[],m={},n=b(f.targets);for(k=0;k<n.size();k+=1)j=n[k],i=b(j).offset().left,e=b(j).offset().top,g=i+j.offsetWidth,h=e+j.offsetHeight,b(j).filter(":visible").size()>0&&a.isOverlap({left:i,top:e,bottom:h,right:g},d)&&l.push(j);return b.each(l,function(c,d){m.self=m.self||d,m.self=-1!==b(m.self).find("*").index(d)?d:a.getElementByMaxZIndex(m.self,d)[0]}),n.not(m.self).removeClass("tbc-dragin").trigger("dragout").parent().removeClass("tbc-dragin-parent"),m.self&&b(m.self).addClass("tbc-dragin").trigger("dragin",m).parent().addClass("tbc-dragin-parent"),m},d.locateInsertPosition=function(c){var e={left:c.pageX,top:c.pageY,right:c.pageX+1,bottom:c.pageY+1},g=d.locateTarget(c,e),h=null,i={};return b(g.self).children(f.node).each(function(c,d){var f=b(d).offset().left,g=b(d).offset().top,j=d.offsetWidth,k=d.offsetHeight,l=f+j,m=g+k,n=f+j/2,o=g+k/2,p={left:f,top:g,right:l,bottom:m+10,width:j,height:k,halfX:n,halfY:o};return a.isOverlap(p,e)?(h=d,i=p,!1):void 0}),{dropBox:b(g.self),transfer:g.transfer,offset:i,marks:b(h),replica:e}},d.disable=function(){b(f.node).unbind(".tbc_drag").css({cursor:"default"}),d.triggerEvent("disable")},d.enable=function(){var a=b(f.node);return a.each(function(a,c){var e=f.handle?b(f.handle,c):b(this);g?e.bind("touchstart.tbc_drag",function(a){d.start(a,c)}):e.css({cursor:f.cursor||"move"}).bind("mousedown.tbc_drag",function(a){d.start(a,c)})}),d},d.maskDoc=function(){var a=b(f.document.body).children(".tbc-drag-mask");a=0!==a.size()?a:b('<div class="tbc-drag-mask" />').appendTo(f.document.body),a.show()},d.unmaskDoc=function(){var a=b(f.document.body).children(".tbc-drag-mask");a.hide()},d.addEvent({start:function(){this.maskDoc()},stop:function(){this.unmaskDoc()}})}}(window.tbc,jQuery),function(a,b){a.itemSelector=function(c){var d={"group owner can not quit group":"群主不能退出群","group admin can not quit group":"群管理员不能退出群","only group validateIdentity in OPEN or VALIDATE can exist by yourself":"仅“开放”或“验证”群可自助退出"},e=a.self(this,arguments),f={availableUrl:null,selectedUrl:null,selectUrl:null,deselectUrl:null,selectAllUrl:null,deselectAllUrl:null,itemTemplate:null,selectedData:null,propertiesUrl:null,itemTemplateSelected:null,dataTemplate:{id:"userId",text:"employeeCode",depict:"userName",title:""},htmlFormater:null,resultFormater:null,max:0,lazy:!1,postKey:"userIds",autoSave:!0,multiple:!0,dataType:"json",cleanable:!0,resettable:!0,event:{selected:function(){},unselected:function(){},complete:function(){}}},g=a.extend({},f,c);g.autoSave="undefined"==typeof g.autoSave?!0:g.autoSave,e.packageName="tbc.itemSelector";var h=b('<div class="tbc-itemSelector '+(g.multiple?"":"tbc-itemSelector-single")+'"></div>').html('<div class="tbc-itemSelector-panel availableBox">        <div class="tbc-itemSelector-title">            <span role="availTitle">待选</span> [<i class="" role="availNum">0</i>]            <a role="addAll" class="tbc-button tbc-itemSelector-btnAddAll" type="button">添加全部</a>        </div>        <div role="availContainer" class="tbc-itemSelector-list"></div>        <div role="availPagination" class="tbc-itemSelector-pagination">            <div class="border">                <select role="availPageSize" id="fromPageSize" name="fromPageSize" class="inputxt">                    <option value="10">10</option>                    <option value="20">20</option>                    <option value="50">50</option>                    <option value="100">100</option>                    <option value="500">500</option>                </select>                <div class="abs_right">                    <a  role="availPrevPage" href="javascript:void(0);" id="fromPrev" class="tbc-buttons prev"><i class="tbc-icon icon-arrow-left"></i></a>                    <input role="availPageTyper" type="text" value="1" id="fromPageNO" name="fromPageNo" class="inputxt tbc-inputer" norender="true">                    <i>/</i>                    <span role="availPageTotal">1</span>                    <a role="availNextPage" href="javascript:void(0);" class="tbc-buttons next"><i class="tbc-icon icon-arrow-right"></i></a>                </div>            </div>        </div>    </div>    <div role="operaList" class="tbc-itemSelector-panel tbc-itemSelector-operation">        <button role="operaAddSelected" class="tbc-button normalBtn addSelected" type="button"><i class="tbc-icon icon-arrow-right"></i></button>        <button role="operaRemoveSelected" class="tbc-button normalBtn removeSelected" type="button"><i class="tbc-icon icon-arrow-left"></i></button>        <button role="operaAddCurrPage" class="tbc-button bigBtn addCurrPage" type="button"><i class="tbc-icon icon-arrow-dblright"></i></button>        <button role="operaRemoveCurrPage" class="tbc-button bigBtn removeCurrPage" type="button"><i class="tbc-icon icon-arrow-dblleft"></i></button>    </div>    <div class="tbc-itemSelector-panel selectedBox">        <div class="tbc-itemSelector-title">            <span role="selectedTitle">已选</span> <span> [ <i class="" role="selectedNum">0</i><b role="maxSelected"></b> ]</span>            <a role="removeAll" class="tbc-button tbc-itemSelector-btnRemoveAll">移除全部</a>        </div>        <div role="selectedContainer" class="tbc-itemSelector-list"><ul></ul></div>        <div role="selectedPagination" class="tbc-itemSelector-pagination">            <div class="border">                <select role="selectedPageSize" name="toPageSize" class="inputxt">                    <option value="10">10</option>                    <option value="20">20</option>                    <option value="50">50</option>                    <option value="100">100</option>                    <option value="500">500</option>                </select>                <div class="abs_right">                    <a role="selectedPrevPage" href="javascript:void(0);" class="tbc-buttons prev"><i class="tbc-icon icon-arrow-left"></i></a>                    <input role="selectedPageTyper" type="text" value="1" name="toPageNo" class="inputxt tbc-inputer" norender="true">                    <i>/</i>                    <span role="selectedPageTotal">1</span>                    <a role="selectedNextPage" href="javascript:void(0);" class="tbc-buttons next"><i class="tbc-icon icon-arrow-right"></i></a>                </div>            </div>        </div>    </div></div>').css({position:"relative",zIndex:1});e.extend({ui:h,container:h,init:function(){var c=this.part={},d=this.getMax();if(h.find("[role]").each(function(){var a=this.getAttribute("role");c[a]=this,a=null}),this._cache={selected:{total:0,list:[],names:{},page:{"page.pageSize":10,"page.pageNo":1,totalPages:1,total:0},selected:{}},available:{total:0,list:[],names:{},page:{"page.pageSize":10,"page.pageNo":1,totalPages:1,total:0}}},this._ajaxDataAvailable=a.extend({},this._cache.selected.page,{includeChild:!0,keyword:""}),this._ajaxDataSelected=a.extend({},this._cache.available.page,{keyword:""}),d&&!isNaN(d)&&(1===d&&b(c.operaAddCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled"),b(c.maxSelected).append('/<b title="最多只能选择'+d+'项" style="font-weight:bold; color:red; cursor:default; text-decoration:underline;">'+d+"</b>")),g.pagination===!1?(b(c.selectedPagination).hide(),b(c.availPagination).hide(),b(c.selectedContainer).css({height:283}),b(c.availContainer).css({height:283})):(b(c.selectedPagination).show(),b(c.availPagination).show(),b(c.selectedContainer).css({height:" "}),b(c.availContainer).css({height:" "})),g.autoSave||"string"!=typeof g.selectedData)!g.autoSave&&b.isArray(g.selectedData)?setTimeout(function(){this.setSelected(g.selectedData)}.bind(this),100):this.loadSelectedByPage(1);else{var e=g.selectedData.split(",");e.length>0&&this.getPropertiesById(e)}(g.autoSave===!1||g.lazy===!0)&&b(c.addAll).hide()},append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},getMax:function(){var a=g.max,b="function"==typeof a?a():isNaN(a)?0:a;return b},formatPage:function(a){var c={};b("input[type='hidden']",a).each(function(){switch(this.name){case"totalPages":c.totalPages=this.value||0;break;case"totalRecords":c.totalRecords=this.value||0;break;case"pageNo":c["page.pageNo"]=this.value||0;break;case"pageSize":c["page.pageSize"]=this.value||0}}),c.prev=Math.max(c["page.pageNo"]-=1,1),c.next=Math.min(c["page.pageNo"]+=1,c.totalPages);try{return c}finally{c=null}},getPages:function(a){var b={},c=this.part,d=this._cache.available.page||{},e=this._cache.selected||{};switch(a){case"available":b["page.pageSize"]=d["page.pageSize"]||c.availPageSize.value||10,b["page.pageNo"]=d["page.pageNo"]||c.availPageTyper.value||1,b.totalPages=d.totalPages||c.availPageTotal.value||1,b.total=d.total||c.availNum.value||0;break;case"selected":b["page.pageSize"]=e["page.pageSize"]||c.selectedPageSize.value||10,b["page.pageNo"]=e["page.pageNo"]||c.selectedPageTyper.value||1,b.totalPages=e.totalPages||c.selectedPageTotal.value||1,b.total=e.total||c.selectedNum.value||0}try{return b}finally{b=null}},formatList:function(a){var c=[];a&&"object"==typeof a&&b.isFunction(a.size)?b("li",a).each(function(){{var a={},d=g.dataTemplate;b("input",this).val()||this.getAttribute("data-id")}a[d.id]=b("input",this).val()||this.getAttribute("data-id"),a[d.text]=b("i",this).text()||b("span:first",this).text(),a[d.depict]=b("span:last",this).text(),a[d.title]=this.getAttribute("title"),c.push(a),a=null}):a&&(c=a);try{return c}finally{c=null}},setPagination:function(c,d){var e=d.total?d.total:"0";switch(c){case"available":this.part.availPageTyper.value=d["page.pageNo"],this.part.availPageTotal.innerHTML=d.totalPages,b(this.part.availPageSize).val(d["page.pageSize"]),b(this.part.availNum).html(e),a.extend(this._cache.available.page,d);break;case"selected":this.part.selectedPageTyper.value=d["page.pageNo"],this.part.selectedPageTotal.innerHTML=d.totalPages,b(this.part.selectedPageSize).val(d["page.pageSize"]),b(this.part.selectedNum).html(e),a.extend(this._cache.selected.page,d)}},loadAvailableByPage:function(a){var c=this;if(g.availableUrl&&this.triggerEvent("beforeAvailableLoad")!==!1){var d=(g.autoSave!==!1&&g.lazy===!0?!0:!1)+"";a=a||this.getPages("available")["page.PageNo"]||1;{this._ajaxDataAvailable,this._cache.available.page}a=Math.max(0,Math.min(this._cache.available.page.totalPages,a)),b.ajax({url:g.availableUrl,dataType:g.dataType,data:b.extend({},g.post,this._ajaxDataAvailable,this._cache.available.page,{"page.pageNo":a,lazy:d}),type:"post",beforeSend:function(){c.triggerEvent("beforeAvailableLoad")},complete:function(){},error:function(){},success:function(d){d&&d.rows&&(g.itemDataFormater&&(d.rows=g.itemDataFormater(d.rows)),b.each(d.rows,function(){!this.id&&(this.id=this.userId),!this.text&&(this.text=this.userName||this.nm),!this.nm&&(this.nm=this.text),e._cache.available.names[this[g.dataTemplate.id]]=this}));var f=c.formatResult(d,g.itemTemplate);c.updateAvailablePage(f),c.triggerEvent("afterAvailableLoad"),c=f=a=null}})}},loadSelectedByPage:function(a){var c=this;if(g.selectedUrl&&g.autoSave&&this.triggerEvent("beforeSelectedLoad")!==!1){var d=(g.autoSave!==!1&&g.lazy===!0?!0:!1)+"";a=a||this.getPages("selected")["page.PageNo"]||1,b.ajax({url:g.selectedUrl,dataType:g.dataType,type:"post",data:b.extend({},g.post,e._ajaxDataSelected,this._cache.selected.page,{"page.pageNo":a,lazy:d}),beforeSend:function(){},complete:function(){},error:function(){var a=b(c.part.selectedContainer);0===a.find("ul").size()&&a.html("<ul></ul>")},success:function(a){if(a&&a.rows){g.itemDataFormater&&(a.rows=g.itemDataFormater(a.rows));for(var d in e._cache.selected.names)delete e._cache.selected.names[d];b.each(a.rows,function(){!this.id&&(this.id=this.userId),!this.text&&(this.text=this.userName),!this.nm&&(this.nm=this.text),e._cache.selected.names[this[g.dataTemplate.id]]=this})}var f=c.formatResult(a,g.itemTemplateSelected);c.updateSelectedPage(f),c._cache.selected.list=f.list,f.list=null,c=f=null}})}else{var f=b(c.part.selectedContainer);0===f.find("ul").size()&&f.html("<ul></ul>")}},updateAvailablePage:function(a){var c=b(this.part.availContainer);return c.empty().append(a.html),this.setPagination("available",a.page),g.pagination===!1?(b(this.part.availPagination).hide(),c.css({height:283}),this):(b(this.part.availPagination).show(),c.css({height:" "}),this._cache.available.page=a.page,this._cache.available.list=[].concat(a.list),a.page["page.pageNo"]<=1?b(this.part.availPrevPage).addClass("tbc-button-disabled"):b(this.part.availPrevPage).removeClass("tbc-button-disabled"),void(a.page["page.pageNo"]>=a.page.totalPages?b(this.part.availNextPage).addClass("tbc-button-disabled"):b(this.part.availNextPage).removeClass("tbc-button-disabled")))},updateSelectedPage:function(a){var c=b(this.part.selectedContainer);return c.empty().append(a.html),this.setPagination("selected",a.page),g.pagination===!1?(b(this.part.selectedPagination).hide(),c.css({height:283}),this):(b(this.part.selectedPagination).show(),c.css({height:" "}),this._cache.selected.page=a.page,g.autoSave!==!1,a.page["page.pageNo"]<=1?b(this.part.selectedPrevPage).addClass("tbc-button-disabled"):b(this.part.selectedPrevPage).removeClass("tbc-button-disabled"),void(a.page["page.pageNo"]>=a.page.totalPages?b(this.part.selectedNextPage).addClass("tbc-button-disabled"):b(this.part.selectedNextPage).removeClass("tbc-button-disabled")))},pageAvailable:function(){this.loadAvailableByPage.apply(this,arguments)},pageSelected:function(a){var a=a||e._cache.selected.page["page.pageNo"],b=e._cache.selected.page.totalPages;a=Math.max(1,Math.min(b,a)),g.autoSave===!1||g.lazy===!0?this.sliceSelectedByPage.apply(this,arguments):this.loadSelectedByPage(a)},sliceSelectedByPage:function(a){var b=a||this._cache.selected.page["page.pageNo"],c=this._cache.selected.page.totalPages,d=this._cache.selected.page["page.pageSize"],e=this.sliceListByPage(this._cache.selected.list,Math.max(1,Math.min(c,b)),d||10),f=this.formatResult(e,g.itemTemplateSelected);this.updateSelectedPage(f)},sliceListByPage:function(a,b,c){c=g.pagination!==!1?c||10:a.length;var d=a.length,e=Math.floor(d/c)+(d%c>0?1:0),f=Math.max(0,(b-1)*c),h=Math.min(d,b*c),i=a.slice(f,h);return{totalRecords:d,totalPages:e,total:a.length,rows:i,pageSize:c,pageNo:b}},formatResult:function(a,c){var d={html:"<ul></ul>",page:{"page.pageSize":10,"page.pageNo":1,totalPages:0,total:0},list:[]};if(a){g.dataType="string"==typeof g.dataType?g.dataType.toLowerCase():g.dataType;var e="html"!==g.dataType&&"text"!==g.dataType||"string"!=typeof a&&!a.jQuery?"json"===g.dataType||"object"==typeof a?"json":"xml"===g.dataType?"xml":g.dataType:"html";switch(e){case"html":var f=b("<div/>").html(a);d.html=b(a),d.page=this.formatPage(f),d.list=this.formatList(f),f.remove(),f=null;break;case"json":var h=a.rows?a.rows.length>a.pageSize&&g.pagination!==!1?this.sliceListByPage(a.rows,a.pageNo,a.pageSize).rows:a.rows:null;d.html=h?this.createHtmlByJSON(h,c):"",d.page={"page.pageSize":g.pagination!==!1?a.pageSize:a.total,"page.pageNo":a.pageNo||0,totalPages:a.totalPages||0,total:a.total||0},d.list=a.rows||this.formatList(d.html)}}try{return d}finally{d=null}},createHtmlByJSON:function(c,d){if(!c)return"";for(var e,f=b("<ul/>"),h=a.isArray(c)?c:c.list||[],i=h.length,j=d||g.itemTemplate||'<li data-id="{userId}" class="{selected} {checked}" title="{userName}"><i>{employeeCode}</i><span>{userName}</span></li>',k=[],l=0;i>l;l++)e=g.vauleSetFormater?g.vauleSetFormater.call(this,h[l]):h[l],k.push(a.stringTemplate(j,e,g.textTransform));f.html(k.join(""));try{return f}finally{f=h=i=j=k=null}},createHtmlByXML:function(){},getAvailablePage:function(){return this._cahce.available.page},selectItems:function(a){b(a);a=b(a).filter(function(){var a=this.getAttribute("data-id"),c=b(e.part.selectedContainer).find("li[data-id='"+a+"']").size()>0;return!c}).addClass("checked"),e.setNextSelected(a),a.clone().prependTo(b("ul",e.part.selectedContainer))},saveSelected:function(c,f){if(g.autoSave!==!1&&g.lazy!==!0&&c.length>0){var h,i=g.post||{};if(g.postFormater)h=g.postFormater(c),i[g.postKey]=h;else{for(var j=[],k=0,l=c.length;l>k;k++)j.push(c[k][g.dataTemplate.id]);i[g.postKey]=j.join(",")}b.ajax({url:g.addUrl||g.selectUrl,type:"post",data:i,dataType:"json",beforeSend:function(){e.triggerEvent("beforeSave")!==!1&&a.lock(e.ui)},complete:function(){a.unlock(e.ui),b.isFunction(f)&&f.call(e),e.triggerEvent("afterSave")},success:function(a){if(a.success!==!0&&a.message){var b=d[a.message]||a.message;alert(b)}}}),i=null}else e.pageAvailable(),e.pageSelected()},deselectItems:function(a){a=b(a),e.setNextSelected(a),a.remove()},saveDeselected:function(c,f){if(g.autoSave&&!g.lazy&&c.length>0){var h,i=g.post||{};if(g.postFormater)h=g.postFormater(c),i[g.postKey]=h;else{for(var j=[],k=0,l=c.length;l>k;k++)j.push(c[k][g.dataTemplate.id]);i[g.postKey]=j.join(",")}b.ajax({url:g.removeUrl||g.deselectUrl,type:"post",data:i,dataType:"json",beforeSend:function(){e.triggerEvent("beforeSave")!==!1&&a.lock(e.ui)},complete:function(){a.unlock(e.ui),b.isFunction(f)&&f.call(e),e.triggerEvent("afterSave")},success:function(a){if(a.success!==!0&&a.message){var b=d[a.message]||a.message;alert(b)}}}),i=null}else e.pageSelected(),e.pageAvailable()},setNextSelected:function(a){if(1===a.size()){var b=a.next();b.size()?b.addClass("selected"):a.prev().addClass("selected"),b=null}},checkSelect:function(a,b){if(0===a.length)return!1;var c=this.getMax();if(c&&!isNaN(c)){if(this._cache.selected.page.total>=c)return alert("您最多只能选择"+c+"条."),!1;var d=a.length,e=0;this._cache.selected.page.total+d>c&&(e=c-this._cache.selected.page.total,a=a.slice(0,e),alert("数量已经超过限制, 仅前面的"+e+"个被添加到了已选栏."))}var f=this.getAvailableItems(a),h=this;g.itemDataFormater&&(f=g.itemDataFormater(f));var i=this._cache.available.page["page.pageNo"];i+=b?1:0,this.selectItems(a),this.selectToCache(f),this.saveSelected(f,function(){this.pageAvailable(i),this.pageSelected(i)}),f.length=0,f=a=h=null},checkDeselect:function(a){if(0===a.length)return!1;var b=this.getSelectedItems(a),c=this;this.deselectToCache(b),this.deselectItems(a),this.saveDeselected(b,function(){this.pageAvailable(),this.pageSelected()}),b.length=0,b=a=c=null},selectAll:function(){g.autoSave!==!1&&g.lazy!==!0?b.ajax({url:g.selectAllUrl,type:"post",dataType:"json",data:b.extend({},g.post,this._ajaxDataAvailable,this._cache.available.page),beforeSend:function(){e.triggerEvent("beforeSave")!==!1&&a.lock(e.ui)},complete:function(){a.unlock(e.ui),e.pageSelected(),e.pageAvailable(),e.triggerEvent("afterSave")},success:function(a){if(a.success!==!0&&a.message){var b=d[a.message]||a.message;alert(b)}}}):(this.pageSelected(),this.pageAvailable())},removeAll:function(){this._cache.selected.list.length=0,this._cache.selected.names={},g.autoSave!==!1&&g.lazy!==!0?b.ajax({url:g.deselectAllUrl,type:"post",dataType:"json",data:b.extend({},g.post,this._ajaxDataAvailable,this._cache.available.page),beforeSend:function(){e.triggerEvent("beforeSave")!==!1&&a.lock(e.ui)},complete:function(){a.unlock(e.ui),e.pageSelected(1),e.pageAvailable(1),e.triggerEvent("afterSave")},success:function(a){if(a.success!==!0&&a.message){var b=d[a.message]||a.message;alert(b)}}}):(this.pageSelected(1),this.pageAvailable(1))},selectCurrentPage:function(){var a=b("li",this.part.availContainer).not(".checked");this.checkSelect(a,"goNextPage"),a=null},deselectCurrentPage:function(a){var c=b("li",this.part.selectedContainer);this.checkDeselect(c,a),c=null},getSelectedItems:function(a){var c=[];b(a).each(function(){var a=this.getAttribute("data-id"),b=e._cache.selected.names[a];b&&c.push(b)});try{return c}finally{c=null}},getAvailableItems:function(a){var c=[];b(a).each(function(){var a=this.getAttribute("data-id"),b=e._cache.available.names[a];b&&c.push(b)});try{return c}finally{c=null}},selectChecked:function(){var a=b("li.selected",this.part.availContainer).not(".checked");this.checkSelect(a),a=null},addAvailableItem:function(a,c){var d=this.createHtmlByJSON(a).find("li").addClass("selected"),e=b(this.part.availContainer).children("ul");c&&e.empty(),e=0!==e.size()?e:b("<ul/>").appendTo(this.part.availContainer),e.append(d),this.deselectToCache(a)},removeAvailableItem:function(a){b(this.part.availContainer).find("li[data-id='"+a+"']").remove(),delete this._cache.available.names[a]},clearAvailable:function(){b(this.part.availContainer).children("ul").empty();var a=this._cache.selected.names[id];for(var c in a)delete a[c];a=null,this._cache.selected.list.length=0},deselectChecked:function(){var a=b("li.selected",this.part.selectedContainer);this.checkDeselect(a),a=null},selectToCache:function(a){var c=this,d=[];b.each(a,function(a,b){if(b){var e=this[g.dataTemplate.id];c._cache.selected.names[e]||(c._cache.selected.names[e]=this,c._cache.selected.list.push(this),d.push(this)),delete c._cache.available.names[e]}}),this.triggerEvent("select",d),d=c=null},deselectToCache:function(c){var d,f=this;b.each(c,function(){var a=this[g.dataTemplate.id];f._cache.available.names[a]||(f._cache.available.names[a]=this,f._cache.available.list.push(this)),delete f._cache.selected.names[a],b(f.part.availContainer).find("li[data-id='"+a+"']").removeClass("checked")}),f._cache.selected.list.length=0;for(var h in f._cache.selected.names)d++,f._cache.selected.list.push(f._cache.selected.names[h]),d>5e3&&a.lock(e.ui);a.unlock(e.ui),this.triggerEvent("deselect",c),f=null},getPropertiesById:function(a){var c=this,d=g.post||{};d[g.postKey]=a.join(","),b.ajax({url:g.propertiesUrl,type:"post",dataType:"json",data:d,success:function(a){a&&c.setSelected(a)}})},setSelected:function(c){var d=this;c&&b.isArray(c)&&c.length>0&&(a.lock(d.ui),d._cache.selected.list=d._cache.selected.list||[],a.batch(c,1e4,0,0,function(a){for(var b,c,e=0,f=a.length;f>e;e++)b=a[e][g.dataTemplate.id],c=d._cache.selected.names[b],c||(d._cache.selected.names[b]=a[e],d._cache.selected.list.push(a[e])),d._cache.selected.names[b].selected=!0},function(){a.unlock(d.ui);var c=d.sliceListByPage(d._cache.selected.list,1,10),e=d.formatResult(c,g.itemTemplateSelected);b(d.part.selectedContainer).empty().append(e.html),d.setPagination("selected",e.page)}))},getSelected:function(){var a,b=this._cache.selected.names,c=[];for(a in b)b.hasOwnProperty(a)&&b[a]&&c.push(b[a]);return c},initEvent:function(){var a=this,c=this.part;b(c.availContainer).add(c.selectedContainer).delegate("li","click",function(c){var d=b(this);if(c.shiftKey){var e;d.siblings().add(d).each(function(){e?b(this).addClass("selected"):b(this).removeClass("selected"),(this===d[0]||b(this).hasClass("lastClicked"))&&(e=!e,b(this).addClass("selected"))
})}else d.addClass("lastClicked").siblings().removeClass("lastClicked"),c.ctrlKey&&g.multiple&&1!==a.getMax()?d.hasClass("selected")?d.removeClass("selected"):d.addClass("selected"):d.addClass("selected").siblings().removeClass("selected")}).delegate("li","dblclick",function(c){if(!c.shiftKey&&!c.ctrlKey){var d=b(this);d.addClass("selected").siblings("li").removeClass("selected"),a.selectChecked()}}),b(c.availContainer).add(c.selectedContainer).delegate("li","dblclick",function(){}),b(c.operaAddCurrPage).click(function(){a.selectCurrentPage()}),b(c.operaRemoveCurrPage).click(function(){a.deselectCurrentPage()}),b(c.operaAddSelected).click(function(){a.selectChecked()}),b(c.operaRemoveSelected).click(function(){a.deselectChecked()}),b(c.availPageTyper).keyup(function(b){if(!this.value.match(/^\d+$/),13===b.keyCode){var c=parseInt(this.value);a.pageAvailable(c)}}),b(c.selectedPageTyper).keyup(function(b){if(!this.value.match(/^\d+$/),13===b.keyCode){var c=parseInt(this.value);a.pageSelected(c)}}),b(c.availPageSize).change(function(){a._cache.available.page["page.pageSize"]=this.value,a.pageAvailable()}),b(c.selectedPageSize).change(function(){a._cache.selected.page["page.pageSize"]=this.value,a.pageSelected()}),b(c.availPrevPage).click(function(){var b=a._cache.available.page["page.pageNo"]-1;a.pageAvailable(b)}),b(c.availNextPage).click(function(){var b=a._cache.available.page["page.pageNo"]+1;a.pageAvailable(b)}),b(c.selectedPrevPage).click(function(){var b=a._cache.selected.page["page.pageNo"]-1;return a.pageSelected(b)}),b(c.selectedNextPage).click(function(){var b=a._cache.selected.page["page.pageNo"]+1;return a.pageSelected(b)}),b(c.addAll).click(function(){a.selectAll()}),b(c.removeAll).click(function(){a.removeAll()})}}),e.init(),e.loadAvailableByPage(1),e.initEvent()}}(tbc,jQuery),tbc.jdc=new function(){var a=tbc.self(this);a.extend(tbc.Event),a.extend(tbc.ClassManager),a.packageName="tbc",a.db={store:{},key:function(a){return isNaN(parseInt(a))?null:this.store[a]},getItem:function(a){return this.store[a]},setItem:function(a,b){return b&&(this.store[a]=b),b.KEY=a,b},removeItem:function(a){this.store[a]=null,delete this.store[a]}};var b={};a.db.setItem("tables",b),a.getTable=function(a){return b[a]},a.createTable=function(a){return a&&!b[a]?(b[a]=new tbc.jdc.Table(a),b[a]):void 0},a.dropTable=function(a){b[a]&&(b[a].del("all"),b[a].DESTROY(),delete b[a])},a.select=function(a,c){var d="string"==typeof a?b[a]:a;if(d){var e=d.get(c);return d=null,e||null}return null},a.set=function(c,d,e){var f=b[c];if(f||(f=a.createTable(c)),f)if("object"==typeof d)for(var g in d)f.set(g,d[g]);else f.set(d,e);f=null},a.del=function(a,c){var d=b[a];d&&d.del(c),d=null}},tbc.jdc.Table=function(){var a=tbc.self(this);a.extend(tbc.Event),a.extend(tbc.ClassManager),a.packageName="tbc.jdc.Table",a.count=0,a.store={},a.get=function(b){var c=[];if("all"===b.toLowerCase()||"*"===b){for(var d in a.store)c.push(a.store[d]);return c}return a.store[b]||null},a.set=function(b,c){a.store[b]&&a.count++,a.store[b]=c},a.del=function(b){if("string"==typeof b&&"all"===b.toLowerCase())for(var c in a.store)delete a.store[c];else b&&delete a.store[b]}},function(a,b){"use strict";a.Panel=function(c){var d={window:window,opener:null,title:null,name:null,icon:"",html:"",area:"body",width:400,height:300,top:"auto",left:"auto",target:null,modal:!0,enable3D:!0,sizeType:"restore",minWidth:180,autoShow:!0,minHeight:100,autoClose:!1,draggable:!0,resizable:!0,minimizable:!1,maximizable:!1,translatable:!1,headless:!1,flatten:!1,defaultSate:"restore",autoCloseTimeout:5,className:null,event:{}},e=b.extend({},d,c);e.window=e.window||window,a.self(this,arguments).extend({packageName:"tbc.Panel",part:{},ui:null,container:null,lastSize:{width:0,height:0,left:0,top:0,right:"auto",bottom:"auto"},initUi:function(){var c=a.getMaxZIndex(b(".tbc-slide-scene.current")[0]),d=a.msie&&a.browserVersion<9?"div":"div",f=[];return this.ui=b("<"+d+' class="tbc-panel shadow" style="filter:alpha(opacity=0); opacity:0; z-index:'+(c+1)+';"></'+d+">").attr("tbc",this.guid).html('<div role="header" class="tbc-panel-header" unselectable="on" onselectstart="return false;">    <div class="tbc-panel-top-left resize-handle" role="north-west"></div>    <div class="tbc-panel-top-right resize-handle" role="north-east"></div>    <div role="controls" class="tbc-panel-controls">        <div class="tbc-switch-role" role="roleBox">            <span class="tbc-switch-role-roleName" role="roleName"></span>            <span class="tbc-switch-role-handle tbc-icon icon-arrow_state_blue_expanded" role="roleHandle"></span>            <ul class="tbc-switch-role-list" role="roleList"><li>1111</li><li>2222</li></ul>        </div>        <span class="tbc-panel-controls-box">            <a role="close" class="tbc-panel-btn-close" hidefocus="true" title="'+i18n("v4.js.close")+'">×</a>            <a role="restore" class="tbc-panel-btn-max" hidefocus="true" title="'+i18n("v4.js.maximize")+"/"+i18n("v4.js.restore")+'">■</a>            <a role="min" class="tbc-panel-btn-min" hidefocus="true" title="'+i18n("v4.js.minimize")+'">▁</a>            <a role="refresh" class="tbc-panel-btn-refresh" hidefocus="true" title="'+i18n("v4.js.refresh")+'">&hArr;</a>            <a role="reset" class="tbc-panel-btn-reset" hidefocus="true" title="'+i18n("v4.js.reopen")+'">&otimes;</a>            <a role="help" class="tbc-panel-btn-help" hidefocus="true" title="">?</a>            <a role="translate" class="tbc-panel-btn-translate" hidefocus="true" title="">?</a>        </span>    </div>    <div class="tbc-panel-top-center">        <div class="tbc-panel-top-center-handle resize-handle" role="north"></div>        <span class="tbc-panel-icon"><img role="icon" height="16" onerror="this.style.display=\'none\';" /></span>        <div role="title" class="tbc-panel-title">            <!--标题区域-->窗体基类        </div>    </div></div><div class="tbc-panel-body">    <div class="tbc-panel-middle-left resize-handle" role="west"></div>    <div class="tbc-panel-middle-right resize-handle" role="east"></div>    <div class="tbc-panel-middle-center tbc-panel-main">        <div role="container" class="tbc-panel-container">            <!--内容区域-->        </div>        <div role="mask" class="tbc-panel-locked-layer" style="display:none;">            <div role="maskTips" class="tbc-panel-locked-layertips"></div>        </div>    </div></div><div role="footer" class="tbc-panel-footer">    <div class="tbc-panel-footer-left resize-handle" role="south-west"></div>    <div class="tbc-panel-footer-right resize-handle" role="south-east"></div>    <div class="tbc-panel-footer-center resize-handle" role="south"></div></div>'),e.className&&f.push(e.className),e.headless&&f.push("no-title"),e.flatten&&f.push("layerMode"),this.ui.addClass(f.join(" ")),this.ui.bind("click",function(c){var d=c.target,e=d.tagName.toLowerCase(),f=a.getTaskByElement(this);f&&b.isFunction(f.focus)&&f.focus(),("input"===e||"textarea"===e||"button"===e||"a"===e||d.contenteditable)&&setTimeout(function(){d.focus(),d=null},0),f=null}),a.Panel.cacheid++,this.cacheid=a.Panel.cacheid,this.ui.attr("iid",this.iid),this.ui.attr("cacheid",this.cacheid),a.Panel.cache[this.cacheid]=this,a.Panel.cache_length+=1,e.closable!==!1&&this.ui.addClass("closable"),e.minimizable&&this.ui.addClass("minimizable"),e.maximizable&&this.ui.addClass("maximizable"),e.refreshable&&this.ui.addClass("refreshable"),e.resettable&&this.ui.addClass("resettable"),e.helpable&&this.ui.addClass("helpable"),e.translatable===!0&&"true"===a.cookie("translationMode")&&this.ui.addClass("translatable"),this},initPart:function(){var c=this;if(this.ui.find("[role]").each(function(a,c){var d=c.getAttribute("role");this.part[d]=b(c)}.bind(this)),this.container=this.part.container,this.part.form&&this.part.form.submit(function(a){a.preventDefault(),this.triggerEvent("submit")}.bind(this)),this.part.controls.bind("mousedown",function(a){a.disableSelectArea=!0,a.stopPropagation()}).delegate("a","click",null,function(b){b.preventDefault();var d=b.currentTarget,f=d.getAttribute("role");switch(f){case"close":b.stopPropagation(),this.close();break;case"min":e.minimizable&&setTimeout(function(){c.min()},10);break;case"max":e.maximizable&&this.max();break;case"restore":e.maximizable&&("max"===this.sizeType?this.restore():this.max());break;case"refresh":e.refreshable&&this.refresh&&this.refresh();break;case"reset":e.resettable&&this.reset&&this.reset();break;case"help":e.helpable&&this.help();break;case"translate":(e.translatable||"true"===a.cookie("translationMode"))&&this.openTranslateWin()}}.bind(this)),this.part.title.dblclick(function(){"max"!==c.sizeType&&e.maximizable?c.max():c.restore()}),a.msie&&a.browserVersion<8){var d=24*c.part.controls.children(".tbc-panel-controls-box").children().size()+2;c.part.controls.width(d)}return this},init:function(){return this.packageName="tbc.Panel",this.initUi(),this.initPart(),this.initDrag(),this.initResize(),this.initContextmenu(),this},initForOpen:function(){var b,c,d,f,g,h,i;return"FULL"===e.windowInitialType||"MAX"===e.windowInitialType?(b="100%",c="100%",d=f=g=h=0):(i=window.taskbar?taskbar.ui.height():0,b=a.system?Math.min(a.system.getDesktopWidth(),e.width||e.minWidth):e.width||e.minWidth,c=a.system?Math.min(a.system.getDesktopHeight()-24-i,e.height||e.minHeight):e.height||e.minHeight,d=e.left,f=e.right,h=e.bottom,g=e.top),this.appendTo(e.target||a.Panel.parent||"body").name(e.name||"窗口").icon(e.icon||a.Panel.defaultIcon||(window.DEFAULT_ICONS?DEFAULT_ICONS.window_icon:null)||"").resize(b,c,g,f,h,d,!1),"FULL"===e.windowInitialType||"MAX"===e.windowInitialType?this.resize("max").rememberSize(e.width,e.height,e.top,e.left):this.rememberSize(),this.opened=!0,this.triggerEvent("open"),this},initDrag:function(){var c=this;try{if(e.draggable)c.addEvent("drop",function(){c.rememberSize()}),b.fn.drag&&c.ui.addClass("draggable").drag({document:document,area:"body",areaMargin:{top:-6,left:"-80%",bottom:"80%",right:"80%"},handle:c.part.title,enabled:function(){return c.ui.hasClass("draggable")},timeout:1,event:{dragStart:function(){var d=c.ui.css("zIndex")||2;a.lock("body",{zIndex:9999999,opacity:.001,cursor:"move"}),c.dragSaveOnIframe=b("<div />").insertAfter(c.ui).css({position:"absolute",z:d-1,background:"#fff",opacity:.01,width:"100%",height:"100%",left:0,top:0}),c.triggerEvent("dragStart")},drag:function(a,b){c.triggerEvent("drag",b)},drop:function(b,d){c.dragSaveOnIframe&&c.dragSaveOnIframe.remove(),a.unlock("body"),c.triggerEvent("drop",d)}}}),c.part.title.mousedown(function(){c.focus()});else if(e.draggable&&!b.fn.drag)throw"jQuery plugins 'jQuery.fn.drag' was not found! jQuery.fn.dialog Dependent on the plugin."}catch(d){a.log(d)}return this},initResize:function(){var c=this;try{if(e.resizable&&b.fn.resizableForTbc)c.ui.addClass("resizable").resizableForTbc({handle:".resize-handle",vector:"normal",document:document,margin:{top:7,left:7,right:9,bottom:9},minWidth:e.minWidth,minHeight:e.minHeight,enabled:function(){return c.ui.hasClass("resizable")},onResizeStart:function(){c.focus().lock()},onResize:function(){},onResizeEnd:function(a){c.resize(a),c.unlock()}});else if(e.resizable&&!b.fn.resizableForTbc)throw"jQuery plugins 'jQuery.fn.resizableForTbc' was not found! jQuery.fn.dialog Dependent on the plugin."}catch(d){a.log(d)}return this},initContextmenu:function(){var a=this;return b.isFunction(b.fn.contextmenu)&&this.ui.contextmenu({items:[{text:i18n("v4.js.minimize"),icon:"",click:function(){a.min()},disabled:!e.minimizable,inheritable:!0},{text:function(){return i18n("max"===a.sizeType?"v4.js.restore":"v4.js.maximize")},icon:"",click:function(){"max"===a.sizeType?a.restore():a.max()},disabled:!e.maximizable,inheritable:!0},{text:i18n("v4.js.close"),icon:"",click:function(){a.close()},inheritable:!0}]}),this},panelLayout:function(){var a=this;try{var c=a.ui,d=c.innerHeight()-a.part.header.height()-a.part.footer.height(),e=c.width()-b(".tbc-panel-middle-left",c).width()-b(".tbc-panel-middle-right",c).width();b(".tbc-panel-body",c).height(d),a.part.container.height(d).width(e)}catch(f){}return a=null,this},show:function(){var a=this;return this.opened||this.initForOpen(),this.minimize=!1,this.ui.css({opacity:0,display:"block"}).animate({opacity:1},200),this.facade(),setTimeout(function(){a.focus(),a=null},0),this.triggerEvent("show"),this},hide:function(){var b=this;return a.msie&&a.browserVersion<8?this.ui.css({opacity:0,display:"none"}):this.ui.animate({opacity:0,display:"none"},200,function(){b.ui.hide(),b=null}),this.evert(),this.triggerEvent("hide"),this},html:function(a){return this.triggerEvent("beforeChange"),a?(this.container.html(a),this.triggerEvent("afterChange"),this):this.container.html()},append:function(a){return this.triggerEvent("beforeChange"),this.container.append(a),this.triggerEvent("afterChange"),this},appendTo:function(a){return this.ui.appendTo(a),this},prepend:function(a){return this.triggerEvent("beforeChange"),this.container.prepend(a.ui?a.ui:a),this.triggerEvent("afterChange"),this},prependTo:function(a){return this.ui.prependTo(a.container?a.container:a),this},titleModel:"{0}<span style='filter:alpha(opacity=70); opacity:0.7; font-weight:lighter;' title='{0} {1}'>{1}</span>",title:function(b){if(b){e.title=b;var c,d=e.name,f=e.title,g=f&&f!==d?a.formatString(this.titleModel||"",f?d+" > ":d,f):e.name;return c=f?d+" > "+f:d||"",this.part.title.html(g).attr("title",c),this.triggerEvent("changeTitle",b,d),this}return e.title},name:function(b){if(b){e.name=b;var c,d=b,f=e.title,g=f&&f!==d?a.formatString(SELF.titleModel,f?d+" > ":d,f):e.name;return c=f?d+" > "+f:d||"",this.part.title.html(g).attr("title",c),this.triggerEvent("changeTitle",f,b),this}return e.name},icon:function(b){var c=a.system.isImg(b);return c||!b||"null"===b?(b=c?b:window.DEFAULT_ICONS?DEFAULT_ICONS.window_icon:"",this.part.icon.show().parent().css({backgroundPosition:"center center"}),this.part.icon.attr("src",b),this.triggerEvent("changeIcon",b),this):(this.part.icon.parent().addClass("tbc-icon "+b).css({backgroundImage:""}),this.part.icon.hide(),this)},close:function(b){function c(){if(f){var a;f.ui.empty().remove();for(a in f.part)f.part.hasOwnProperty(a)&&delete f.part[a];f.triggerEvent("afterClose",f.returnValue),f.DESTROY()}e=d=f=null}var f=this;if(this.modalWindow)try{if(!b)return this.modalWindow.show().focus().flash(),this;this.modalWindow.close(b)}catch(g){}return this.triggerEvent("beforeClose")===!1?this:(this.triggerEvent("close",this.returnValue),a.Panel.cache_length-=1,delete a.Panel.cache[this.cacheid],a.Panel.removeSequence(this.cacheid),this.opener&&this.opener.modalWindow&&delete this.opener.modalWindow,b||setTimeout(function(){var b,c,d,e,f=window.desktop?window.desktop.current().container[0]:null;for(d=a.Panel.sequence,e=d.length;e>=0;e-=1)if(c=a.Panel.cache[d[e]],c&&(b=a.Panel.cache[d[e]].ui.parent()[0],f===b||b===document.body)){a.Panel.cache[d[e]].focus();break}f=b=c=null},0),void(a.msie&&a.browserVersion<8?c():(this.evert(),this.ui.animate({opacity:0,marginTop:"-=20px"},300,c))))},closeOther:function(){},min:function(){return this.blur(),this.ui.hide(),this.minimize=!0,this.maximize=!1,this.triggerEvent("min"),this},max:function(){return this.minimize&&this.show(),this.disableResize().disableDrag(),this.resize("100%","100%",null,null,null,null,!1),this.sizeType="max",this.maximize=!0,this.minimize=!1,this.ui.addClass("maximize"),this.triggerEvent("max"),this},restore:function(){this.minimize&&this.show();var a=this.lastSize||{},b=a.left||0,c=a.top||0,d=a.width||this.ui.width(),e=a.height||this.ui.height();return this.enableResize().enableDrag(),this.resize(d,e,c,null,null,b,!1),this.sizeType="restore",this.minimize=!1,this.maximize=!1,this.ui.removeClass("maximize"),this.triggerEvent("restore"),this},sizeType:e.sizeType||"restore",rememberSize:function(a,b,c,d){return this.lastSize={top:c||this.ui.css("top"),left:d||this.ui.css("left"),width:a||this.ui.width(),height:b||this.ui.height()},this},openModalDialog:function(b,c){var d=this,e=c||d.constructor||a.Panel;return this.modalWindow=new e(b),this.modalWindow.opener=this,this.modalWindow.addEvent({afterClose:function(){d.modalWindow=null,d.show().focus()}}),e=null,this.modalWindow},openModalessDialog:function(b,c){var d=this,e=c||d.constructor||a.Panel;return this.modalWindow=new e(b),this.modalWindow.opener=this,this.modalWindow.modaless=!0,this.modalWindow.addEvent({afterClose:function(){d.modalWindow=null,d.show().focus()}}),e=null,this.modalWindow},focused:!1,focus:function(){var b,c,d,e,f,g,h,i=this.ui.parent(),j=this.modalWindow;if(i.hasClass("current")||(c=a.system?a.system.getTaskByElement(i):null,c&&(d=c.index,desktop.show(d)),i=c=null),j){if(b=a.getMaxZIndex(this.ui.parent()[0]),this.ui.css({zIndex:b}),j&&!j.modaless)return j.focused?j.focus().flash():j.focus(),this;j.ui.css({zIndex:b+1})}if(this.focused===!0)return this;this.focused=!0,a.Panel.removeSequence(this.cacheid),a.Panel.sequence.push(this.cacheid),this.unlock("blur"),f=Math.max(window.parseInt(this.ui.css("top")),-6),j?this.ui.addClass("shadow"):(e=a.getMaxZIndex(this.ui.parent()[0]),this.ui.addClass("shadow").css({zIndex:e+1,top:f})),this.triggerEvent("focus"),g=a.Panel.cache;for(h in g)g.hasOwnProperty(h)&&g[h]!==this&&g[h].blur&&g[h].focused&&g[h].blur(!0);return g=null,this},blur:function(b){var c,d,e;if(b!==!0){for(d=a.Panel.sequence,c=d.length-2;c>-1;c--)if(e=a.Panel.cache[d[c]],this.ui&&e.ui&&this.ui.parent()[0]===e.ui.parent()[0]&&e&&!e.minimize&&!e.focused){e.focus();break}e=d=null}return this.focused=!1,this.ui.removeClass("shadow"),this.modalWindow&&this.modalWindow.modaless||this.lock("blur","",.1),this.triggerEvent("blur"),this},resize:function(a){var c,d;switch(a){case"min":this.min();break;case"max":this.max();break;case"restore":this.restore();break;default:if(a){var f=b(e.area).size()?b(e.area):this.ui.parent(),g=!0;"object"!=typeof a?(d=arguments,c={width:d[0],height:d[1],top:d[2],right:d[3],bottom:d[4],left:d[5]}):(c=a,d=[c.width,c.height,c.top,c.right,c.bottom,c.left]),g=arguments[arguments.length-1]===!1?!1:g,c.width="auto"===c.width?f.innerWidth()-((isNaN(c.left)?20:c.left)+(isNaN(c.right)?20:c.right)):"100%"===c.width?f.innerWidth()+12:c.width,c.height="auto"===c.height?f.innerHeight()-((isNaN(c.top)?20:c.top)+(isNaN(c.bottom)?20:c.bottom)):"100%"===c.height?f.innerHeight()+12:c.height;var h=Math.max(c.width,e.minWidth),i=Math.max(c.height,e.minHeight),j="100%"===d[0]?-6:"auto"===c.left?Math.max(0,(f.width()-h)/2):c.left,k="auto"===c.right?Math.max(0,(f.width()-h)/2):c.right,l="100%"===d[1]?-6:"auto"===c.top?Math.max(0,(f.height()-i)/2):c.top,m="auto"===c.bottom?Math.max(0,(f.height()-i)/2):c.bottom;g!==!1&&b.extend(this.lastSize,{left:parseInt(this.ui.css("left")),top:parseInt(this.ui.css("top")),width:this.ui.width(),height:this.ui.height()}),this.ui.css({width:h,height:i,left:j,right:k,top:l,bottom:m}),this.panelLayout(),this.triggerEvent("resize",{width:h,height:i})}}return this},resizeWidth:function(a,b){return a=isNaN(a)?{width:a,left:b,right:b}:a,this.resize(a),this},resizeHeight:function(a,b){return a=isNaN(a)?{height:a,top:b,bottom:b}:a,this.resize(a),this},locateTransWin:function(a){var b=a.ui.width()+10,c=this.offset(),d=c.left+c.width-b,e=c.top+32;a.ui.css({left:d,top:e})},openTranslateWin:function(c){var d,e=((new Date).getTime(),this),f=e.offset(),g=320,h=200,i=f.left+f.width-g-10,j=f.top+32;desktop.transWin=desktop.transWin||this.openModalessDialog({name:i18n("v4.js.translate"),icon:"icon-i18n",width:g,height:h,maxWidth:480,left:i,top:j,className:"layerMode",resizable:!0},a.Panel).addEvent({open:function(){this.container.load(URLS.translateForm),e.locateTransWin(d)},resize:function(a){var b=this.ui.find(".trans-inputer").outerHeight(),c=this.ui.find(".trans-tips, .trans-list");c.height(a.containerHeight-b)}}),d=desktop.transWin,d.i18nKey=c,d.removeEvent("close").addEvent({close:function(){desktop.transWin=null,e.removeEvent("drop.translate")}}),b.isFunction(d.search)&&d.search(c),d.opener!==this&&(d.opener.modalWindow=null,d.opener.removeEvent("drop.translate").removeEvent("resize.translate"),d.opener=this,this.modalWindow=d),this.addEvent({"drop.translate":function(){this.locateTransWin(d)},"resize.translate":function(){this.locateTransWin(d)}}),d.show().focus()},disableResize:function(){return this.ui.removeClass("resizable"),this},enableResize:function(){return this.ui.addClass("resizable"),this},disableDrag:function(){return this.ui.removeClass("draggable"),this},enableDrag:function(){return this.ui.addClass("draggable"),this},center:function(a,c,d){var f=c&&!isNaN(c)?c:this.ui.width(),g=d&&!isNaN(d)?d:this.ui.height(),h=e.left,i=e.top,j=document.documentElement,k=document.body,l=j.clientWidth||j.offsetWidth,m=j.clientHeight||j.offsetHeight;return h=f>l?Math.max(j.scrollLeft,k.scrollLeft):l/2+Math.max(j.scrollLeft,k.scrollLeft)-f/2,i=g>m?Math.max(j.scrollTop,k.scrollTop):m/2+Math.max(j.scrollTop,k.scrollTop)-g/2,this.ui.css({top:i,left:h,width:f,height:g}),b.isFunction(a)&&a.call(this),this.triggerEvent("center"),j=k=null,this},lock:function(a,c,d){var e=b(".tbc-panel-locked-layer",this.ui);return e.css({display:"block"}),d&&e.css({opacity:d}),a&&e.addClass(a),this.part.maskTips.html(c),this.triggerEvent("lock"),this},unlock:function(a){var c=b(".tbc-panel-locked-layer",this.ui);return a&&c.removeClass(a),"tbc-panel-locked-layer"===b.trim(c.attr("class"))&&(c.css({display:"none"}),c.css({opacity:""})),this.part.maskTips.html(""),this.triggerEvent("unlock"),this},fling:function(){return this.shake()},shake:function(a){var c=this,d=this.ui;return d.animate({left:"-=5px"},40),d.animate({left:"+=10px"},40),d.animate({left:"-=5px"},40),d.animate({left:"+=4px"},40),d.animate({left:"-=4px"},40),d.animate({left:"+=2px"},40),d.animate({left:"-=2px"},40,function(){b.isFunction(a)&&a.call(c)}),d=null,this.triggerEvent("shake"),this.triggerEvent("fling"),this},scaleTo:function(a,c){var d=this,e=d.ui,f=e.width(),g=e.height(),h=e.css("left"),i=e.css("top"),j=b.isPlainObject(a)?a:b.extend({},b(a).offset(),{width:b(a).width(),height:b(a).height(),opacity:0});return e.animate(j,1200,"easeOutBounce",function(){d.ui.css({display:"none",width:f,height:g,left:h,top:i,opacity:1}),b.isFunction(c)&&c.call(d),d=null}),e=null,this},evert:function(){try{this.ui.css({"-moz-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)","-webkit-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)","-o-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)","-ms-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)",transform:"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)"})}catch(a){}return this.triggerEvent("evert"),this},facade:function(){try{this.ui.css({"-moz-transform":"none","-webkit-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none"})}catch(a){}return this.triggerEvent("facade"),this},enable3D:function(){return this.ui.parent().css({"-moz-transform-style":"preserve-3d","-webkit-transform-styles":"preserve-3d","-ms-transform-style":"preserve-3d","-o-transform-style":"preserve-3d","transform-style":"preserve-3d","-webkit-transform-style":"perspective"}),this.triggerEvent("enable3D"),this},disable3D:function(){return this.ui.parent().css({"-moz-transform-style":"none","-webkit-transform-style":"none","-ms-transform-style":"none","-o-transform-style":"none","transform-style":"none"}),this.triggerEvent("disable3D"),this},enableAnimate:function(a,b,c){var d=a||".4s",e=c||"ease",f=b||"0s",g=[d,e,f].join(" ");return this.ui.css({"-moz-transition":"-moz-transform "+g,"-webkit-transition":"-web-transform "+g,"-o-transition":"-o-transform "+g,"-ms-transition":"-ms-transform "+g,transition:"transform "+g}),this.triggerEvent("enableAnimate"),this},disableAnimate:function(){return this.ui.css({"-moz-transition":"","-webkit-transition":"","-o-transition":"","-ms-transition":"",transition:""}),this.triggerEvent("disableAnimate"),this},active:function(a){return a?this.ui.addClass("active"):this.ui.removeClass("active"),this.triggerEvent("active"),this},flash:function(a){var c=this.ui,d=function(){c.dequeue("flash")},e=40;return this.ui.queue("flash",[function(){c.css({opacity:.5}).removeClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:1}).addClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:.5}).removeClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:1}).addClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:.5}).removeClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:1}).addClass("shadow"),setTimeout(function(){d(),c.verifyButton?c.verifyButton.focus():c.cancelButton&&c.cancelButton.focus(),b.isFunction(a)&&a.call(c)},e)}]).dequeue("flash"),this.triggerEvent("flash"),this},offset:function(){var a=this.ui,c=a.offset(),d=this.part.container;return b.extend(c,{offsetWidth:a.outerWidth(),offsetHeight:a.outerHeight(),containerWidth:d.innerWidth(),containerHeight:d.innerHeight(),width:a.width(),height:a.height(),scrollWidth:d[0].scrollWidth,scrollHeight:d[0].scrollHeight}),c}}).addEvent({afterClose:function(){var c,d,e=!1;for(d in a.Panel.cache)a.Panel.cache.hasOwnProperty(d)&&(c=a.Panel.cache[d],e=e||c.maximize);e||(window.taskbar&&taskbar.show(),desktop.setDockZindex(),b(".tbc-desktop-nav").css({zIndex:5})),c=null},max:function(){window.taskbar&&taskbar.hide(),b(".tbc-desktop-dock").css({zIndex:3})},min:function(){var c,d;for(d in a.Panel.cache)if(a.Panel.cache.hasOwnProperty(d)&&(c=a.Panel.cache[d],"max"===c.sizeType&&!c.minimize))return;c=null,window.taskbar&&taskbar.show(),desktop.setDockZindex(),b(".tbc-desktop-nav").css({zIndex:5})},restore:function(){var c,d;for(d in a.Panel.cache)if(c=a.Panel.cache[d],"max"===c.sizeType&&!c.minimize)return;c=null,window.taskbar&&taskbar.show(),desktop.setDockZindex(),b(".tbc-desktop-nav").css({zIndex:5})},destroy:function(){try{e=c=null}catch(a){}}}).init()},a.Panel.cache=a.Panel.cache||{},a.Panel.cacheid=isNaN(a.Panel.cacheid)||!a.Panel.cacheid?0:a.Panel.cacheid,a.Panel.cache_length=isNaN(a.Panel.cache_length)?0:a.Panel.cache_length,a.Panel.sequence=a.Panel.sequence||[],a.Panel.parent=".tbc-slide-scene.current",a.Panel.removeSequence=a.Panel.removeSequence||function(b){a.Panel.sequence=a.array.remove(a.Panel.sequence,b)}}(tbc,jQuery),tbc.namespace("tbc.historyStore"),tbc.extend(tbc.historyStore,{cache:{},get:function(a){return this.cache[a]},set:function(a,b){return this.cache[a]=new tbc.history(b),his},add:function(a,b){return this.cache[a]=this.cache[a]||b,this.cache[a]},remove:function(a){delete this.cache[a]}}),tbc.History=function(a){(function(a,b){var c=tbc.self(a,b);c.packageName="tbc.History",c.cache=[],c.currentIndex=0;try{return c}finally{c=null}})(this,arguments).extend({current:function(){return this.cache[this.currentIndex]},add:function(a,b,c){var d,e;return this.prohibited===!0?this:(delete this.prohibited,e=this.cache[this.currentIndex],d="string"==typeof a?{url:a,method:b,data:c}:a,e&&(console.log(e.url),console.log(d.url),console.log(e.url!==d.url)),e&&e.url===d.url||(this.clear(),this.cache.push(d),this.currentIndex=this.cache.length-1,this.triggerEvent("add")),this)},redirect:function(b,c,d){var e=c||a;if("function"==typeof e){this.triggerEvent("beforeRedirect");try{(!c||$.isFunction(c)&&c(b,d)!==!1)&&a(b,d)}catch(f){}this.triggerEvent("afterRedirect")}return this},clear:function(){return this.cache=this.cache.slice(0,this.currentIndex+1),this},go:function(a,b){var c=a>=0?a:this.currentIndex+a;c=this.limitIndex(c);var d=this.cache[c];return this.currentIndex=c,d&&(this.redirect(d,b,!0),this.triggerEvent("go")),this},forward:function(a){if(!this.isLast()){var b=this.currentIndex+1,c=this.cache[b];this.currentIndex=b,this.redirect(c,a,!0),this.triggerEvent("forward")}return this},back:function(a){if(!this.isFirst()){var b=this.currentIndex-1,c=this.cache[b];this.currentIndex=b,this.redirect(c,a,!0),this.triggerEvent("back")}return this},reload:function(){if(!this.isFirst()){var a=this.current();this.redirect(a,null,!0),this.triggerEvent("reload")}return this},limitIndex:function(a){return a=Math.max(a,0),Math.min(a,this.cache.length-1)},isLast:function(){return this.currentIndex===this.cache.length-1||0===this.cache.length},isFirst:function(){return 0===this.currentIndex}})},function(a,b){"use strict";a.Window=function(c){function d(){var a,b=12,c=1e3,d=0,e=0,f=this,g=f.contentWindow;a=setInterval(function(){b--;try{var c=g.document;c.body.addEventListener("touchstart",function(a){e=a.targetTouches[0].pageX,d=a.targetTouches[0].pageY}),c.body.addEventListener("touchmove",function(a){f.parentNode.scrollHeight>20+f.parentNode.offsetHeight&&a.preventDefault();var b=e-a.targetTouches[0].pageX,g=d-a.targetTouches[0].pageY;f.parentNode.scrollLeft+=b,f.parentNode.scrollTop+=g,this.scrollLeft+=b,this.scrollTop+=g,c.documentElement.scrollLeft+=b,c.documentElement.scrollTop+=g}),c.body.addEventListener("touchend",function(){}),clearInterval(a)}catch(h){}1>b&&clearInterval(a)},c)}function e(){h.ui.removeClass("loading")}var f=window.desktop,g=window.URLS,h=a.self(this,arguments);h.extend([a.Panel,c]);var i={loadType:"iframe",homepage:null,autoLoad:!0,scrolling:!0},j=b.extend({},i,c);j.homepage=j.homepage||j.url,"iframe"==j.loadType&&(j.scrolling=!1);var k=b('<div class="tbc-window-toolbar"></div>'),l=b('<div class="tbc-window-body" style="'+(j.scrolling?"overflow:auto;":"")+'"></div>'),m=b('<div class="tbc-window-statebar"></div>');if(h.html(k.add(l).add(m)),h.addEvent({resize:function(){var a=this.part.container.innerHeight(),b="none"!==k.css("display")?k.outerHeight():0,c="none"!==m.css("display")?m.outerHeight():0;l.height(a-b-c)},load:function(a,b){this.history&&this.history.add(a,b)}}),h.container=l,h._html=h.html,a.extend(h,{init:function(){this.packageName="tbc.Window",this.initEvent(),this.initHistory(),this.initRoleSwitch()},initEvent:function(){this.addEvent({open:function(){this.task&&(this.task.remove(),delete this.task),this.addTaskbar(),this.task.setCurrent()}})},initHistory:function(){var b=this;this.history=new a.History(function(a,c){b.load(a.url,a.method,a.data,c)}),this.history.depend(this)},initRoleSwitch:function(){var a=this;j.appRoles&&j.appRoles.length>1?(this.part.roleList.empty(),this.part.roleBox.css({display:"block"}).bind({mouseleave:function(){a.part.roleList.hide()}}),this.part.roleHandle.click(function(){a.part.roleList.show()}),this.part.roleName.click(function(){a.part.roleList.show()}),b.each(j.appRoles,function(c,d){d.currentRole&&a.part.roleName.html(d.roleName),b("<li/>").html(d.roleName).appendTo(a.part.roleList).click(function(){a.part.roleName.html(d.roleName),a.switchRole(d.roleId,d.roleCode),a.part.roleList.hide();j.originateSettings;j.originateSettings.appRoles[c].currentRole=!0,b.each(j.appRoles,function(a){c!==a&&(j.originateSettings.appRoles[a].currentRole=!1)})})})):this.part.roleBox.hide()},addTaskbar:function(){var b=this;a.Task&&(this.task=new a.Task({title:j.name||j.userDeskItemName,icon:j.icon}),this.task.depend(this),this.task.handle.contextmenu({items:[{text:"最小化",icon:"",click:function(){b.min()},disabled:function(){return!j.minimizable||b.minimize},inheritable:!0},{text:function(){return"max"===b.sizeType?"还原":"最大化"},icon:"",click:function(){"max"===b.sizeType?b.restore():b.max()},disabled:function(){return!j.maximizable},inheritable:!0},{text:"关闭",icon:"icon-application_windows_remove",click:function(){b.close()},inheritable:!0},{text:"关闭全部",icon:"icon-remove_outline",click:function(){var b,c,d;for(c=a.Panel.sequence,d=c.length;d>=0;d-=1)b=a.Panel.cache[c[d]],b&&b.close&&b.close(!0);b=null},inheritable:!0}]}),this.task.handle.bind({click:function(){var c,d,e=b.ui.parent(),g=e.hasClass("current"),h=a.system.getTaskByElement(e);!g&&h&&(c=h.index,f.show(c)),b.minimize?(d=b.sizeType,b.resize(d)):b.focused?g?b.min():b.flash():(b.focus(),b.focused&&b.task.setCurrent()),e=g=h=null
}}),this.addEvent({focus:function(){b.minimize||b.task.setCurrent()},show:function(){b.task.show()},hide:function(){b.task.hide()},blur:function(){b.task.removeCurrent()},afterClose:function(){b.task.remove(),delete b.task.handle,b=null},changeTitle:function(a,c){b.task.title(c&&a?c+": "+a:c||a)},changeIcon:function(a){b.task.icon(a)}}))},html:function(a){return(this.container||l).html(a),this},tools:{store:{},length:0,container:k,add:function(a,b){if(!a)return this;k[0].style.display="block";var c,d,e;"string"==typeof a&&b?(c={},c[a]=b):c=a;for(d in c)c.hasOwnProperty(d)&&(e=c[d],this.store[d]=e,e=e&&e.ui?e.ui:e,k.append(e),h.triggerEvent("tools.add",e),this.length+=1);return h.triggerEvent("resize"),c=null,this},get:function(a){return this[a]},remove:function(a){return this.store[a].remove(),delete this.store[a],h.triggerEvent("tools.remove"),this.length-=1,this.length<1&&k.hide(),this},clear:function(){var a;for(a in this.store)this.store.hasOwnProperty(a)&&this.remove(a);return this}},reload:function(){this.history.prohibited=!0;var a=this.history.current();return a?this.load(a.url,a.method,a.data):this.load(null,j.data?"post":"get",j.data),a=null,this},refresh:function(){return this.load(j.homepage,j.data?"post":"get",j.data),this},reset:function(){return"MAX"!==j.windowInitialType&&"FULL"!==j.windowInitialType&&this.maximize&&this.restore(),this.initForOpen(),this.load(j.homepage,j.data?"post":"get",j.data),this},help:function(){if(g.help){var d=function(c){var d=window.applicationMap[c],e=d?d.appCode||null:null;b.ajax({url:g.help,type:"post",data:{applicationId:c,appCode:e,corpCode:window.corpCode},dataType:"html",complete:function(){a.system.helpwin.unlock("loading")},error:function(){a.system.helpwin.load('<div style="padding:180px 2em; text-align:center;">没有找到与 <strong>'+(j.applicationName||j.userDeskItemName)+"</strong> 相关的帮助内容.</div>")},beforeSend:function(){a.system.helpwin.lock("loading","loading...")},success:function(c){a.system.helpwin.html("");var d,e=b('<div class="apphelp-frame"></div>'),f=b(c).find("div.apphelp-tab-frame"),g=b('<div class="infotitle_a"><ul></ul></div>'),h=b('<div class="apphelp-frame-container" style=""></div>');0===f.size()?a.system.helpwin.load(c):(d=new a.Tabset({container:h,header:g.children("ul"),effects:"fade"}),f.each(function(){var c=this.getAttribute("title"),e=b(this).children(),f=b('<li class="">'+c+"</li>"),g=new a.Tabpage({title:c,handleNode:f,titleNode:f,iconNode:null,container:b('<div class="apphelp-tab-frame"></div>').append(e),content:this,autoShow:!1,currentClass:"cur"});d.append(g),d.dependSelf(g)}),d.show(0),d.depend(a.system.helpwin),a.system.helpwin.addEvent("beforeunload",function(){b.each(d.tabs,function(){this.DESTROY()}),d.DESTROY(),e=f=g=h=d=null}),e.append(g),e.append(h),a.system.helpwin.append(e))}})};a.system.helpwin?(a.system.helpwin.focus().flash().name("帮助 "+(c.userDeskItemName||c.applicationName)),d(j.applicationId||j.userDeskItemId)):(a.system.helpwin=new a.Window({name:"帮助 "+(c.userDeskItemName||c.applicationName),icon:"icon-comment_question",loadType:"html",width:580,height:450,minWidth:580,minHeight:450,scrolling:!1,resizable:!0,minimizable:!0,maximizable:!1,refreshable:!0}).addEvent("close",function(){delete a.system.helpwin}).show(),a.system.helpwin.refresh=function(){d(j.applicationId||j.userDeskItemId)},d(j.applicationId||j.userDeskItemId))}},load:function(a,c,d,e){function f(){switch(j.loadType){case"iframe":h.loadByIframe(a,c,d,e);break;case"ajax":h.loadByAjax(a,c,d,e);break;case"html":h.html(d||a)}}var g=h.triggerEvent("beforeunload");return h.loadTime=(new Date).getTime(),a=a||j.homepage,(g!==!1||window.confirm("您确定离开该页面吗?"))&&f(),d=b.extend({},j.data,d),c=c||(j.data&&d?"post":"get"),h},loadByAjax:function(a,c,d,e){return b.ajax({url:a,method:c||(d?"post":"get"),data:d||null,error:function(){},beforeSend:function(){this.ui.addClass("loading")}.bind(this),complete:function(){e!==!0&&this.addHistory(a,c,d),this.ui.removeClass("loading")}.bind(this),success:function(a){a=b.isFunction(j.ajaxResultProcessor)?j.ajaxResultProcessor(a):a,a!==!1&&this.html(a)}.bind(this)}),this},switchRole:function(c,d){if(c){var e=j.applicationId;b.ajax({url:a.formatString(g.switchAppRole,"elos",e,c),dataType:"json",type:"get",error:function(){},success:function(){h.load(j.homepage,"post",{current_role_code:d,current_role_id:c,current_app_id:j.userDeskItemId})}})}},matchIframeSrc:function(a){var b,c,d;a.match(/http:\/\/hao.qq.com/)?d="http://hao.qq.com":(b=a?a.match(/<iframe[^>]+>/):null,c=b&&b[0]?b[0].match(/src\s*=\s*["']?\s*\S+\s*["']?/):null,d=c&&c[0]?c[0].replace(/(src\s*=\s*["']?\s*|\s*["']*\s*>?$)/g,""):null,d=!d||d.match(/^("|'|,|\+|\()/)?null:d);try{return d}finally{a=b=c=d=null}},isHistoryEnable:function(){var a,b=!1;try{a=this.iframe.contentWindow,b=a?a.enableAppHistory:!1}catch(c){}return a=null,b},addHistory:function(a,b,c){var d;return this.noHistory?(delete this.noHistory,this):(d="string"==typeof a?{url:a,method:b,data:c}:a,void(d&&d.url&&this.history.add(d)))},loadByIframe:function(c,d,e,f){var g,i=this.loadTime;return this.ui.addClass("loading"),a.Window.iframeUrls=a.Window.iframeUrls||{},g=a.Window.iframeUrls[j.applicationId],b.ajax({url:c,beforeSend:function(){this.lock("loading",i18n("v4.js.waitServer"))}.bind(this),success:function(b){if(i===h.loadTime){var k=h.matchIframeSrc(b);c=k||c,h.doLoadByIframe(c,d,e,f),g||(a.Window.iframeUrls[j.applicationId]=c),k=null}},error:function(){h.doLoadByIframe(c,d,e,f)}}),h},doLoadByIframe:function(a,c,d,e,f){f="boolean"==typeof e?e:f,f!==!0&&this.lock("loading",i18n("v4.js.loadingApp"));var g,i,j=[],k=h.iframe,l="tbc_window_iframe_"+h.guid;if(a=a.replace(/#$/,""),"post"===c&&d){g=b('<form action="'+a+'" target="'+l+'" method="post" enctype="application/x-www-form-urlencoded" style="display:none;"></form>').appendTo(h.container);for(i in d)d.hasOwnProperty(i)&&b('<input class="default_data" type="hidden" name="'+i+'" id="'+i+'" value="'+d[i]+'" />').appendTo(g);b('<input class="default_data" type="submit" name="submit_default_data" id="submit_default_data" value="submit" />').appendTo(g),setTimeout(function(){g[0].submit(),g.find(".default_data").remove(),g.remove(),g=null},1)}else if("get"===c&&d){if("object"==typeof d)if(d.constructor===Array)j=j.concat(d);else for(i in d)d.hasOwnProperty(i)&&j.push([i,d[i]].join("="));else j.push(d);j=j.join("&"),a=""===j?a:-1!==a.indexOf("?")?a+"&"+j:a+"?"+j,this.loadIframe(a)}else this.loadIframe(a);return f!==!0?this.addHistory(a,c,d):this.noHistory=f,setTimeout(function(){h&&"function"==typeof h.unlock&&h.unlock("loading")},1e3),j=l=k=null,h},loadIframe:function(a){var c,d,e,f,g,h=this.iframe;try{g=h.contentWindow,g=g.document,f=g.location,c=f.search,e=f.pathname,-1!==a.indexOf("#")&&(d=a.substring(a.indexOf("#")+1),d="!"+d.replace(/^\!/,""))}catch(i){}if(d&&"!"!==d&&-1!==a.indexOf(c)&&-1!==a.indexOf(e)){f.hash=d;var j=(navigator.appName,navigator.appVersion),k=j.match(/MSIE/)?j.split(";")[1].replace(/[MSIE ]/g,""):0;if(!b.support.hashchange||k&&8>k)try{h.contentWindow.$(h.contentWindow).trigger("hashchange")}catch(i){}return this}h.src=a,h=f=c=g=d=null}}).init(),"iframe"===j.loadType){var n;h.html('<iframe class="tbc-window-iframe" scrolling="auto" frameborder="no" hidefocus="" allowtransparency="true" id="tbc_window_iframe_'+h.guid+'" name="tbc_window_iframe_'+h.guid+'"></iframe'),n=h.iframe=h.container.children(".tbc-window-iframe")[0],h.addEvent({beforeClose:function(){h.returnValue=n.contentWindow.returnValue}}),a.msie&&a.browserVersion<8&&(n.attachEvent("onload",function(){var a,c=10;a=setInterval(function(){c--,0>c&&clearInterval(a),b(".tbc-slide-scene.current,.tbc-desktop-slide,.tbc-desktop,body").each(function(){})},500)}),n.attachEvent("onfocus",function(a){return a.preventDefault&&a.preventDefault(),!1})),a.touchable&&(n.onload=function(){d.call(this)}),h.unlock("loading");var n=n;n.attachEvent?n.attachEvent("onload",e):n.onload=e,h.addEvent("beforeClose.clearIframe",function(){var a=b(h.iframe).hide();try{a[0].contentWindow.document.write(""),a[0].contentWindow.document.clear()}catch(c){}h.iframe.src="about:blank",delete h.iframe.execute,delete h.iframe.trigger,a.remove(),h.iframe=a=null}),h.iframe.execute=function(a){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);"function"==typeof a?a.apply(h,b):h[a].apply(h,b),b=null},h.iframe.property=function(a){var b=h[a];return"function"!=typeof b?b:void 0},h.iframe.trigger=function(a){for(var b=[a],c=1;c<arguments.length;c++)b.push(arguments[c]);h.triggerEvent.apply(h,b),b=null}}return j.homepage&&j.autoLoad&&(j.loadType=j.loadType||(j.data?"post":"get"),h.load(null,j.loadType,j.data)),h.ui.contextmenu({items:["-",{text:function(){return h.isHistoryEnable()?i18n("v4.js.forward"):null},icon:"",click:function(){h.history.forward()},disabled:function(){return h.history.isLast()}},{text:function(){return h.isHistoryEnable()?i18n("v4.js.back"):null},icon:"",click:function(){h.history.back()},disabled:function(){return h.history.isFirst()}},{text:i18n("v4.js.refresh"),icon:"",disabled:!!h.reload,click:function(){h.reload&&h.reload()}}]}),h.addEvent({afterClose:function(){h.tools.clear()},destroy:function(){try{j=c=i=k=m=l=h=null}catch(a){}}}),h}}(tbc,jQuery),tbc.Pop=function(a){var b=tbc.self(this,arguments);b.extend(tbc.Event,tbc.ClassManager),b.packageName="tbc.Pop";var c={width:320,height:180,icon:null,autoClose:!1,timeout:3,locate:null,parent:null,counter:".tbc-pop-close i"},d=tbc.extend({},c,a),e=null,f=d.timeout||5,g=tbc.getMaxZIndex()+1,h='<div class="tbc-pop" style="opacity:0.001; filter:alpha(opacity=0.01); z-index:'+g+';">    <div class="tbc-pop-arrow">&diams;</div>    <div class="tbc-pop-close"><i></i><a>&times;</a></div>    <div class="tbc-pop-inner">        <div class="tbc-pop-icon"></div>        <div class="tbc-pop-container"></div>    </div></div>';b.ui=$(h).css({width:d.width,height:d.height}).attr("tbc",b.guid).appendTo(d.parent||"body").bind(function(){b.focus()}),b.container=b.ui.find(".tbc-pop-container"),b.arrow=b.ui.find(".tbc-pop-arrow"),b.counter=$(d.counter,b.ui),b.extend({html:function(a){return b.container.html(a),b},focus:function(){var a=tbc.getMaxZIndex();return b.ui.css({zIndex:a+1}),b},show:function(){return b.ui.show(),b},hide:function(){return b.hide(),b},addCounter:function(a){return b.counter.add(a),b},countDown:function(a){return b.triggerEvent("beforeCountdown"),b.ui.find(".tbc-pop-close i").html(a),b.triggerEvent("countdown"),b},stop:function(){return b.triggerEvent("beforeStop"),clearInterval(e),f=0,b.triggerEvent("stop"),b},start:function(){return e=setInterval(function(){return 0>=f?void b.close():(f--,void b.countDown(f))},1e3),b.triggerEvent("start"),b},pause:function(){return clearInterval(e),b},resume:function(){return this.start(),b},close:function(){return b.triggerEvent("beforeClose")!==!1&&(clearInterval(e),b.ui.empty().remove(),b.triggerEvent("close"),b.DESTROY(),b=null),b},append:function(a){return b.triggerEvent("beforeAppend")!==!1&&(b.container.append(a.ui||a),b.triggerEvent("append")),b},prepend:function(a){return b.triggerEvent("beforeAppend")!==!1&&(b.container.prepend(a.ui||a),b.triggerEvent("append")),b},appendTo:function(a){return b.ui.appendTo(a.container||a),b},prependTo:function(a){return b.ui.prependTo(a.container||a),b},setArrowX:function(a,c){var d=b.ui.offset(),e=c||$(a).offset(),f=a.width()/2-14,g=e.left+f-d.left;return 0>g&&b.ui.css({left:"-="+Math.abs(g)+"px"}),b.arrow.css({top:"",left:Math.max(1,g)+"px"}),b},setArrowY:function(a,c){var d=b.ui.offset(),e=c||$(a).offset(),f=a.height()/2-14,g=e.top+f-d.top;return 0>g&&b.ui.css({top:"-="+Math.abs(g)+"px"}),b.arrow.css({left:"",top:Math.max(g,1)+"px"}),b},locate:function(a,c){if(a=a||d.locate?$(a||d.locate):b.lastLocate,b.lastLocate=a,!(a.size<0)){var e=b.getPosition(a,c),f=b.ui.data("lastClass")||"tbc-pop-left",g="",h="y";return"auto"===e.left?e.parent.height<e.locate.bottom?(g="tbc-pop-bottom",e.right-=e.locate.width,e.bottom+=e.parent.height+e.parent.scrollTop-e.locate.bottom+e.locate.height+20,h="x"):e.locate.top<0?(g="tbc-pop-top",e.right-=e.locate.width,e.top+=e.locate.height+4,h="x"):(g="tbc-pop-right",e.right+=4):e.parent.height<e.locate.bottom?(g="tbc-pop-bottom",e.left-=e.locate.width,e.bottom+=e.parent.height+e.parent.scrollTop-e.locate.bottom+e.locate.height+20,h="x"):e.locate.top<0?(g="tbc-pop-top",e.left-=e.locate.width,e.top+=e.locate.height+4,h="x"):(g="tbc-pop-left",e.left+=4),e.left="auto"===e.left?e.left:e.left+"px",e.bottom="auto"===e.bottom?e.bottom:e.bottom+"px",e.top="auto"===e.top?e.top:e.top+"px",e.right="auto"===e.right?e.right:e.right+"px",b.arrow.removeClass(f).addClass(g).data("lastClass",g),b.ui.css({left:e.left,right:e.right,top:e.top,bottom:e.bottom,opacity:1}),"x"===h?b.setArrowX(a,c):b.setArrowY(a,c),b}},getPosition:function(a,c){var e,f,g=$(a||d.locate),h=c?c.left:0,i=c?c.top:0,j=g.offset(),k=g.width(),l=g.height(),m=h||j.left,n=i||j.top,o=m+k,p=n+l,q=b.ui.width(),r=b.ui.height(),s=b.ui.offsetParent()[0].offsetHeight,t=b.ui.offsetParent()[0].offsetWidth,u="0",v="auto";return o+q>t&&m>q?(e=t-j.left,f="auto"):(e="auto",f=o),n+r>s?(u="auto",v=0):(u=n,v="auto"),{top:u,bottom:v,left:f,right:e,width:q,height:r,locate:{left:m,top:n,right:o,bottom:p,width:k,height:l},parent:{height:s,width:t,scrollTop:b.ui.offsetParent()[0].scrollTop,scrollLeft:b.ui.offsetParent()[0].scrollLeft}}}}),b.ui.find(".tbc-pop-close a").bind({click:function(){b.close()}}),d.autoClose===!0&&b.start(),b.addEvent({destroy:function(){b=c=d=e=f=g=h=null}})},function(a,b){"use strict";a.Tabpage=function(c){var d={title:null,icon:null,closable:!1,closeNode:null,handleNode:"",titleNode:null,iconNode:null,container:null,content:null,duration:300,easing:null,autoShow:!0},e=a.extend({},d,c),f=b(e.handleNode),g=b(e.iconNode,f),h=b(e.titleNode,f),i=b(e.container);a.self(this,arguments).extend({init:function(){this.packageName="tbc.Tabpage",e.group&&(this.group=e.group,this.appendTo(this.group)),e.autoShow&&this.show()},handle:f,container:i,ui:i,title:function(a){var c;a?(h.html(a),c=this):c=b.trim(h.html());try{return c}finally{c=null}},icon:function(a){var b;a?(g.attr("src",a),b=this):b=g.attr("src");try{return b}finally{b=null}},outToBottom:function(a){this.triggerEvent("beforeHide");var c=this,d=i.parent(),f=d.height();i.animate({top:f},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},outToTop:function(a){this.triggerEvent("beforeHide");var c=this,d=i.height();i.animate({top:-d},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},outToRight:function(a){this.triggerEvent("beforeHide");var c=this,d=i.parent(),f=d.width();i.animate({left:f},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},outToLeft:function(a){this.triggerEvent("beforeHide");var c=this,d=i.width();i.animate({left:-d},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},inFromTop:function(a){this.triggerEvent("beforeShow");var c=this,d=i.height();i.css({top:-d}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},inFromBottom:function(a){this.triggerEvent("beforeShow");var c=this,d=i.parent(),f=d.height();i.css({top:f}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},inFromLeft:function(a){var c=this,d=i.width();this.triggerEvent("beforeShow"),i.css({left:-d}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},inFromRight:function(a){var c=this,d=i.parent(),f=d.width();this.triggerEvent("beforeShow"),i.css({left:f}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},fadeOut:function(a){var c=this;this.triggerEvent("beforeHide"),i.css({top:0,left:0}).animate({opacity:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},fadeIn:function(a){var c=this;this.triggerEvent("beforeShow"),i.css({top:0,left:0}).show().animate({opacity:1},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},show:function(a){this.triggerEvent("beforeShow"),i.css({top:0,left:0,opacity:1}).show(),b.isFunction(a)&&a(),this.triggerEvent("show")},hide:function(a){this.triggerEvent("beforeHide"),i.css({top:0,left:0}).hide(),b.isFunction(a)&&a(),this.triggerEvent("hide")},close:function(){e.closable&&this.triggerEvent("beforeClose")!==!1&&(b(e.handleNode).empty().remove(),i.empty().remove(),this.triggerEvent("close"),delete this.group,this.DESTROY(),d=e=f=g=h=i=null)},appendTo:function(a){return this.group&&this.group.remove(this.index),a.append(this),this.group=a,this},prependTo:function(a){return this.group&&this.group.remove(this.index),a.prepend(this),this.group=a,this}}).addEvent({beforeShow:function(){this.handle.addClass(e.currentClass||"current"),this.container.addClass(e.currentClass||"current")},beforeHide:function(){this.handle.removeClass(e.currentClass||"current"),this.container.removeClass(e.currentClass||"current")},hide:function(){i.hide()},destroy:function(){d=e=c=f=g=h=i=null}}).init()}}(tbc,jQuery),function(a,b){"use strict";a.Tabset=function(c){var d={container:".tbc-tabset",header:".tbc-desktop-nav",prevHandle:".tbc-tabset-prev",nextHandle:".tbc-tabset-next",effects:"slide-x",easing:"swing",loop:!0,auto:!0,timeout:5e3,speed:800},e=b.extend({},d,c);a.self(this,arguments).extend({init:function(){var c=this;if(this.packageName="tbc.Tabset",this.header=b(e.header),this.container=b(e.container),this.tabs=[],this.currIndex=0,a.touchable){var d,f=0,g=0;this.container[0].addEventListener("touchstart",function(a){f=a.touches[0].pageX,g=a.touches[0].pageY,d=(new Date).getTime()}),this.container[0].addEventListener("touchmove",function(a){var b=a.touches[0].pageX,d=a.touches[0].pageY;c.current().ui.css({left:b-f}),b=d=null}),this.container[0].addEventListener("touchend",function(a){var b=a.changedTouches[0].pageX,e=a.changedTouches[0].pageY,g=(new Date).getTime(),h=Math.abs(b-f),i=c.container.width();h>i/2||h>i/2/(1e3/(g-d))?f>b&&!c.isLast()?c.next():b>f&&!c.isFirst()?c.prev():c.current().ui.animate({left:0}):c.current().ui.animate({left:0}),b=e=i=null})}},isFirst:function(){return 0===this.currIndex},isLast:function(){return this.currIndex===this.tabs.length-1},current:function(){return this.tabs[this.currIndex]},next:function(a){var b=this.tabs[this.currIndex],c=isNaN(a)?this.getNextIndex():a;switch(this.effect()){case"slide-x":b&&b.outToLeft(),this.tabs[c].inFromRight();break;case"slide-y":b&&b.outToTop(),this.tabs[c].inFromBottom();break;case"fade":b&&b.fadeOut(),this.tabs[c].fadeIn();break;default:b&&b.hide(),this.tabs[c].show()}return this.currIndex=c,this},prev:function(a){var b,c,d=this.tabs[this.currIndex],e=isNaN(a)?this.getPrevIndex():a,f=this.tabs[e];switch(this.effect()){case"slide-x":b="inFromLeft",c="outToRight";break;case"slide-y":b="inFromTop",c="outToBottom";break;case"fade":b="fadeIn",c="fadeOut";break;default:b="show",c="hide"}return d&&"function"==typeof d[c]&&d[c](),f&&"function"==typeof f[b]&&f[b](),this.currIndex=e,this},getNextIndex:function(){var a,b,c,d=this.tabs;for(b=this.currIndex+1,c=d.length;c>b;b++)if(d[b].visible!==!1){a=b;break}return a||(a=0),a},getPrevIndex:function(){var a,b,c=this.tabs;for(b=this.currIndex-1;b>=0;b--)if(c[b].visible!==!1){a=b;break}return a||0===a||(a=c.length),a},show:function(a){var b,c=this.currIndex;return a=a||0,c>a?this.prev(a):a>c?this.next(a):(b=this.tabs[this.currIndex],b&&b.fadeIn()),this},hide:function(a){if(!isNaN(a)){var b=this.tabs[a];return a===this.currIndex&&this.show(a+1),b.handle.hide(),b.container.hide(),b.visible=!1,this.arrayTab(),this}},arrayTab:function(a){function c(a,c){var d=c.options;if(b.isFunction(a))return a.call(c);if("string"==typeof a)switch(a=a.toLowerCase()){case"hidden":return c.visible;case"visible":return!c.visible;case"admin":return"ADMIN"===d.type;case"!admin":return"ADMIN"!==d.type;case"link":return"LINK"===d.type;case"user":return"USER"===d.type;case"other":return"OTHER"===d.type}}var d,e,f=1,g=this.tabs;for(d=0,e=g.length;e>d;d++)c(a,g[d])?g[d].handle.find("i").html(""):(g[d].handle.find("i").html(f),f+=1);g=null},onAddTab:function(a){var c=this;a.handle.bind("click",function(){c.show(a.index)}),a.group=this,a.addEvent({close:function(){c.remove(a.index)},beforeShow:function(){var a=this.index;b.each(c.tabs,function(b,d){b!==c.currIndex&&b!==a&&d.hide()})}}),a.autoShow&&this.show(a.index)},append:function(a){return this.header.append(a.handle),this.container.append(a.container),this.tabs.push(a),a.index=this.tabs.length-1,this.onAddTab(a),this},prepend:function(a){return this.header.prepend(a.handle),this.container.prepend(a.container),this.tabs=[a].concat(this.tabs),a.index=0,this.onAddTab(a),this},insert:function(a,b){if(isNaN(b)||(b=this.tabs[b]),!b)return this.prepend(a);var c,d,e,f,g=this.tabs;for(a.handle.insertAfter(b.handle),a.container.insertAfter(b.container),c=g.slice(0,b.index+1),d=g.slice(b.index+1,g.length),this.tabs=c.concat([a]).concat(d),a.index=b.index+1,b.index<this.currIndex&&(this.currIndex+=1),e=0,f=d.length;f>e;e++)d[e].index+=1;this.onAddTab(a)},effect:function(a){return"string"!=typeof a?e.effects:(e.effects=a,this)},easing:function(a){return"string"!=typeof a?e.easing:(e.easing=a,this)},remove:function(a){return a===this.currIndex?a<this.tabs.length-1?(this.excludeTab(a),this.next()):a>0&&(this.excludeTab(a),this.prev()):a<this.currIndex?(this.excludeTab(a),this.currIndex-=1,this.show(this.currIndex)):this.excludeTab(a),this},excludeTab:function(a){var b,c,d,e=[];for(c=0,d=this.tabs.length;d>c;c++)b=this.tabs[c],b&&b.index!==a&&(b.index=e.length,e.push(b));return b=null,this.tabs=e,this}}).addEvent({destroy:function(){d=e=c=null}}).init()}}(tbc,jQuery),tbc.namespace("tbc.tree"),tbc.tree.Editor=tbc.tree.Editor||function(a){var b=tbc.self(this,arguments),c={hideDisabledTools:!1,addible:!0,editable:!0,deletable:!0,editUrl:null,addUrl:null,deleteUrl:null,moveUrl:null,level:0},d=$.extend({},c,a);b.extend([tbc.Tree,a],{packageName:"tbc.tree.Editor",isDeletable:function(a){return d.deletable&&this.hasChildren(a)},hoverTools:function(a){var b=[],c="string"==typeof a?this.cache(a):a,e=this.isRoot(a);(!d.level||c.level<d.level)&&d.addible?b.push('<a href="javascript:void(0);" class="stree-add">新增</a>'):d.hideDisabledTools?"":b.push('<span style="color:#888; text-decoration:line-through;">新增</span>'),e||(b.push('<a href="javascript:void(0);" class="stree-edit">编辑</a>'),this.isFirst(a)?d.hideDisabledTools?"":b.push('<span style="color:#888; text-decoration:line-through;">上移</span>'):b.push('<a href="javascript:void(0);" class="stree-moveup">上移</a>'),this.isLast(a)?d.hideDisabledTools?"":b.push('<span style="color:#888; text-decoration:line-through;">下移</span>'):b.push('<a href="javascript:void(0);" class="stree-movedown">下移</a>'),this.isDeletable(a)?d.hideDisabledTools?"":b.push('<span style="color:#888; text-decoration:line-through;">删除</span>'):b.push('<a href="javascript:void(0);" class="stree-delete">删除</a>'));try{return b.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}finally{c=b=""}},nodeAddHandle:function(a){var c="string"==typeof a?this.cache(a):a;c&&this.triggerEvent("beforeAdd",c)!==!1&&(this.addbox?(this.addbox.show(),this.addbox.locate($(".stree-text",c.html)),this.addbox.container.find("._cont").empty().load(d.addUrl)):(this.addbox=new tbc.Pop({name:"新增",width:400,height:340}),this.addbox.appendTo("body"),this.addbox.show(),this.addbox.locate($(".stree-text",c.html)),this.addbox.addEvent({close:function(){b.addbox=null}}),this.addbox.append('<div class="tbc-titleBar"><b>新增</b> &nbsp;<i style="color:#aaa;">(双击标题关闭)</i></div><div class="_cont"><div style="text-align:center;">Loading...</div></div>'),this.addbox.container.delegate(".tbc-titleBar","dblclick",function(){b.addbox.close()}).find("._cont").load(d.addUrl,{id:c.property.id})),this.addbox.__nodeid=c.property.id)},nodeEditHandle:function(a){var c="string"==typeof a?this.cache(a):a;c&&this.triggerEvent("beforeEdit",c)!==!1&&(this.editbox?(this.editbox.show(),this.editbox.locate($(".stree-text",c.html)),this.editbox.container.find("._cont").empty().load(d.editUrl)):(this.editbox=new tbc.Pop({width:400,height:340}),this.editbox.appendTo("body"),this.editbox.show(),this.editbox.locate($(".stree-text",c.html)),this.editbox.addEvent({close:function(){b.editbox=null}}),this.editbox.append('<div class="tbc-titleBar"><b>编辑:</b><i>'+(c.property.nm||c.property.text||"")+'</i> &nbsp;<i style="color:#aaa;">(双击标题关闭)</i></div><div class="_cont"></div>'),this.editbox.container.delegate(".tbc-titleBar","dblclick",function(){b.editbox.close()}).find("._cont").load(d.editUrl,{id:c.property.id})),this.editbox.__nodeid=c.property.id)},nodeDeleteCheck:function(){},nodeDelete:function(a){a="string"==typeof a?this.cache(a):a;var c=$(a.html).css({background:"yellow"});if(c.hasClass("disabled"))return c=null,!1;c.addClass("disabled");var d=b,e=c.find(".stree-delete"),f=e.offset(),g=$('<div class="tbc-tips">确定删除吗?&nbsp;&nbsp;<a class="_dle" href="javascript:void(0);">删除</a>&nbsp;<a class="_cancel" href="javascript:void(0);">取消</a></div>').css({left:f.left,top:f.top-12,opacity:0,background:"#fff",border:"1px solid #ccc",padding:"6px",position:"absolute",zIndex:"10000"}).appendTo("body").animate({left:"+=24px",opacity:1},200),h=function(){g&&g.stop().animate({left:"-=64px",opacity:0},200,function(){c&&c.css({background:""}).removeClass("disabled"),g&&g.remove(),a=d=c=e=f=g=h=null})};g.delegate("a._dle","click",function(){d.nodeDeleteAjax(a),h()}),g.delegate("a._cancel","click",function(){h()}),g.animate({opacity:0},1e4,h)},removeNode:function(a){for(var b,c="string"==typeof a?this.cache(a):a,d=c.parents[c.parents.length-1],e=this.cache(d).property.sn,f=c.html,g=0,h=e.length;h>g;g++)if(e[g].id===a){b=g;break}this.cache(d).property.sn=e.slice(0,b).concat(e.slice(b+1,h)),f.parentNode.removeChild(f),c=d=e=b=f=h=null},nodeDeleteAjax:function(a){a="string"==typeof a?a:a.property?a.property.id:null;var c=b;d.deleteUrl&&a&&$.ajax({url:d.deleteUrl,type:"post",dataType:"json",data:{id:a,action:"delete"},beforeSend:function(){},complete:function(){},error:function(){},success:function(b){b.success?(c.deleteNode(a),c.triggerEvent("delete",a),c=null):alert(b.message||"删除失败")}})},nodeMoveup:function(a){if(a&&!this.isFirst(a)){for(var b,c,d=this.cache(a),e=d.parents[d.parents.length-1],f=this.cache(e).property.sn,g=0,h=f.length;h>g;g++)if(f[g].id===a){b=f[g-1],f[g-1]=f[g],f[g]=b;break}c=$(d.html).parent(),c.insertBefore(c.prev()),this.nodeMoveAjax(a,"up"),d=c=paren=f=next=null}},nodeMovedown:function(a){if(a&&!this.isLast(a)){for(var b,c=this.cache(a),d=c.parents[c.parents.length-1],e=this.cache(d).property.sn,f=0,g=e.length;g>f;f++)if(e[f].id===a){b=e[f+1],e[f+1]=e[f],e[f]=b;break}var h=$(c.html).parent();h.insertAfter(h.next()),this.nodeMoveAjax(a,"down"),c=h=paren=e=b=null}},nodeMoveAjax:function(a,c){a="string"==typeof a?a:a.property?a.property.id:null;var e=b;d.moveUrl&&a&&c&&$.ajax({url:d.moveUrl,type:"post",data:{id:a,type:c},dataType:"html",beforeSend:function(){},complete:function(){},error:function(){},success:function(){e.triggerEvent("move",a,c),e=null}})}}),b.ui.delegate(".stree-node","mouseenter",function(){var a=this.getAttribute("data-id"),c=b.hoverTools(a);$(this).addClass("stree-node-hover").find(".stree-node-tools").css({display:"inline"}).html(c)}).delegate(".stree-node","mouseleave",function(){$(this).removeClass("stree-node-hover").find(".stree-node-tools").hide().html("")}).delegate(".stree-add","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeAddHandle(c)}).delegate(".stree-moveup","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeMoveup(c)}).delegate(".stree-movedown","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeMovedown(c)}).delegate(".stree-edit","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeEditHandle(c)}).delegate(".stree-delete","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeDelete(c)})},function(a){"use strict";window.tbc=tbc||{},tbc.Tree=function(b){var c=tbc.self(this,arguments),d={width:"auto",height:"auto",cssClass:"tbc-tree",dataType:"ajax",container:"",url:null,data:null,lazyLevel:4,selected:"",checkbox:!1,cascadeCheck:!0,singleCheck:!0,cascadeSelect:!0,multipleSelect:!1,filterVisible:!0,filterEmptyText:"没有找到<b>{keyword}</b>相关的内容",formatExtool:function(){},isRetracted:!0},e=a.extend({},d,b);e.container=e.ui?a(e.ui).find(e.container):a(e.container),e.ui=e.ui?a(e.ui):e.container,e.ui[0].onselectstart=function(){return!1},c.addEvent(e.event),c.addEvent({afterRender:function(){a.isFunction(e.onLoad)&&e.onLoad.apply(this,arguments),e.selected&&this.setCurrent(e.selected,!1)},select:function(){a.isFunction(e.onSelect)&&e.onSelect.apply(this,arguments)},deleteNode:function(){a.isFunction(e.onDelete)&&e.onDelete.apply(this,arguments)},check:function(){a.isFunction(e.onCheck)&&e.onCheck.apply(this,arguments)},move:function(){a.isFunction(e.onMove)&&e.onMove.apply(this,arguments)},addNode:function(){a.isFunction(e.onAdd)&&e.onAdd.apply(this,arguments)}}),c.packageName="tbc.Tree",c.extend({ui:e.ui,container:e.container,appendTo:function(b){a(b).size()&&this.container.appendTo(b)},data:null,init:function(){switch(e.dataType){case"json":this.render(e.data);break;case"ajax":this.load();break;default:this.load()}},appendFilter:function(){var b,c=this,d=a('<div class="tbc-tree-filter">   <div class="s-wrapper">       <input class="tbc-tree-keyword" type="search" title="输入关键字，按回车键筛选." />       <input class="tbc-tree-search" type="button" value="筛选" title="筛选." />       <input class="tbc-tree-clear" type="button" value="X" title="退出筛选模式" />   </div></div><div class="tbc-tree-filter-place"><div class="tbc-tree-empty"></div></div>');this.filterBar=d,d.prependTo(this.container.children(".tbc-tree")).on("click",".tbc-tree-search",function(){var b=a(this).siblings(".tbc-tree-keyword"),d=a.trim(b.val()),e=a.trim(b.attr("title"));""!==d&&d!==e&&c.filter(d)}).on("click",".tbc-tree-clear",function(){a(this).hide().siblings(".tbc-tree-keyword").val("").trigger("blur"),c.cancelFilter()}).find("input").on("focus",null,function(){var b=a.trim(this.title),c=a.trim(this.value);b===c&&(this.value="")}).on("blur",null,function(){var b=a.trim(this.title),c=a.trim(this.value);""===c&&(this.value=b)}).on("keyup",null,function(d){var e=a(this),f=e.siblings(".tbc-tree-clear"),g=a.trim(this.title),h=a.trim(this.value),i=this.getAttribute("data-last");""!==h?f.show():f.hide(),clearTimeout(b),""!==h&&h!==g&&(i&&i!==h&&(b=setTimeout(function(){c.filter(h)},400)),13===d.keyCode&&c.filter(h)),""===h&&i&&""!==i&&c.cancelFilter(),this.setAttribute("data-last",h)}).trigger("focus"),e.filterVisible||d.hide()},load:function(){var b=e.url.replace(/\=$/,"");b=b+(-1===b.indexOf("?")?"?_=":"&_=")+ +new Date;var d=a.ajax({url:b,type:e.param?"post":"get",data:a.extend({},e.param,{noDepPath:e.noDepPath}),dataType:"json",cache:!1,beforeSend:function(){c.triggerEvent("beforeLoad")},complete:function(){c.triggerEvent("afterLoad")},error:function(){c.triggerEvent("error","loading failed!")},success:function(a){c.render(a)}});this.addEvent({destroy:function(){d.abort&&d.abort(),d=null}})},treeContainer:null,render:function(b){this.triggerEvent("beforeRender");var c=((new Date).getTime(),a('<div class="tbc-tree"><div class="tbc-tree-container"></div></div>')),d=c.children(".tbc-tree-container"),f=this.container.height()-42;this.treeContainer=d,c.addClass(e.cssClass),e.filterVisible&&c.addClass("tbc-tree-hasfilter"),this.container.append(c),d.html(this.createChild(b)),f>42&&d.height(f),this.addHtmlCache(),this.appendFilter(),this.triggerEvent("afterRender")},resize:function(a){a&&!isNaN(a)&&this.ui.height(a),this.trigger("resize",a)
},renderNode:function(b){var c,d,e,f,g=this.cache(b),h=g.property,i=h.sn||h.children;h&&i&&!g.rendered&&(c=parseInt(g.level,10)+1,d=this.createChild(i,c,g.parents.concat([b])),g.rendered=!0,this.cache(b,"rendered",!0),e=a(g.html.parentNode).append(d),f=e.find("dt.stree-node"),this.addHtmlCache(f),this.triggerEvent("itemRender",i)),g=h=i=f=c=d=null},filter:function(a){var b=this,c={},d=this._cacheIndex,e=this._cacheData;this.cancelFilter(),tbc.lock(this.container),tbc.batch(d,1e3,0,10,function(d,f){var g,h,i,j,k,l,m,n,o,p=d.length;for(g=0;p>g;g++)if(h=e[d[g]],k=h.property,l=k.text||k.nm,m=k.id,i=h.parents,"string"==typeof l&&-1!==l.indexOf(a))for(c[m]=!0,h.matched=!0,n=0,o=i.length;o>n;n++)j=i[n],c[j]=c[j]||!1;f&&(b.filterResult=c,b.mode="filter",b.keyword=a,b.highLightKeyWord(c,a),tbc.unlock(b.container))})},highLightKeyWord:function(b,c){var d,e,f,g,h=0,i=this._cacheData;for(g in b)b.hasOwnProperty(g)&&(h+=1,d=a(i[g].html),b[g]===!0&&(e=d.children(".stree-text"),f=e.text().replace(c,'<strong class="keyword">'+c+"</strong>"),e.html(f),d.addClass("matched-keyword")),d.addClass("matched"),d.parents("ul:first").addClass("matched-parent"));0===h&&this.container.find(".tbc-tree-filter-empty"),this.container.children(".tbc-tree").addClass("tbc-tree-filter-mode")},cancelFilter:function(){var b,c,d,e=this.filterResult,f=this._cacheData;for(d in e)e.hasOwnProperty(d)&&(delete f[d].match,b=a(f[d].html),c=b.children(".stree-text"),c.html(c.text()),b.removeClass("matched matched-keyword"),b.parents("ul.matched-parent").removeClass("matched-parent"));this.filterResult=[],this.container.children(".tbc-tree").removeClass("tbc-tree-filter-mode"),this.mode="normal",this.keyword=""},addHtmlCache:function(b){b=b?a(b):this.container.find("dt.stree-node");var c=this;a(b).each(function(){var a=this.getAttribute("data-id");c.cache(a,"html",this)}),c=b=null},cache:function(a,b,c){if("index"===a)return this._cacheIndex;if(!a)return this._cacheData;var d=this._cacheData[a];if(d||(d=this._cacheData[a]={}),b)void 0!==c&&(d[b]=c);else try{return d}finally{d=null}try{return d[b]}finally{d=null}},_cacheData:{},_cacheIndex:[],createChild:function(a,b,c,d){b=b||0,c=c||[];var e,f,g,h,i,j=(this.keyword,a.length);for(i=0;j>i;i+=1)if(h=a[i],g=h.id,h.children&&!h.sn&&(h.sn=h.children),this.cache(g,"property",h),this.cache(g,"level",b),this.cache(g,"parents",c),this.cache(g,"checked",!!h.checked),this.cache(g,"current",!!h.selected||!!h.current),this._cacheIndex.push(g),d===!0){if(!this._delayCreateNode)break;this._delayCreateNode(h,b,c.concat([g]),f,d)}else 0===i&&(f="first"),i===j-1&&(f="last"),e||(e="filter"===this.mode&&""!==this.keyword?['<ul class="matched-parent">']:["<ul>"]),e.push(this.createNode(h,b,c.concat([g]),f,d)),"last"===f&&e.push("</ul>");try{return e?e.join(""):""}finally{e=null}},_delayCreateNode:function(a,b,c,d,e){var f=this;setTimeout(function(){f.createNode&&f.createNode(a,b,c,d,e),f=null},40)},createNode:function(a,b,c,d,f){var g,h,i,j,k,l,m,n,o,p,q,r,s=a.id,t=a.sn||a.children,u=this.keyword;if(f===!0&&t&&t.length>0)return this.createChild(t,b+1,c,f),t=null,"";g=e.lazyLevel||2,h=this.cache(s),i=a.nm||a.text,j=a.tips||i,m="",n="first"===d?" stree-node-first":"last"===d?" stree-node-last":"",o=["stree-node","stree-level-{3}",n,t&&0!==t.length?"":" stree-leaf",h&&h.current?"stree-node-selected":""],p='<div class="stree-node-tools" style="display:none; float:none;"></div>',q=e.checkbox?'<span class="tbc-checkbox stree-checkbox" data-id="{0}" data-text="{1}">    <input type="checkbox" name="'+e.checkboxName+'" value="{0}" title="{1}" '+(h&&h.checked?' checked="checked" ':"")+"/></span>":"",r='<li>    <dt data-id="{0}" data-text="{1}" title="{1}" class="{2}">        <span class="stree-space" style="width:'+16*b+'px;"></span>        <span class="stree-handle" level="{3}"></span>'+q+'        <span class="stree-icon stree-icon-{3}"></span>        <span class="stree-text">{4}</span>       {5}    </dt>    {6}</li>',"filter"===this.mode?(l=this.filterResult[s],"undefined"!=typeof l&&o.push("matched"),l===!0?(o.push("matched-keyword"),k=i.replace(u,'<b class="keyword">'+u+"</b>")):k=i):k=i,t&&t.length>0&&(g>b?(m=this.createChild(t,b+1,c),this.cache(s,"rendered",!0)):t&&(this.createChild(t,b+1,c,!0),o.push("stree-node-retracted"))),r=tbc.formatString(r,s,j,o.join(" "),b,k,p,m);try{return r}finally{o=t=r=s=i=null}},addNode:function(b,c,d,e){var f,g="string"==typeof b?{id:b,pr:d,nm:c,sg:e}:b,h=this.cache(d),i=a(h.html).removeClass("stree-leaf");switch(e){case"prepend":this.prependNode.apply(this,arguments);break;case"append":this.appendNode.apply(this,arguments);break;default:this.insertNode.apply(this,arguments)}g=h=i=f=null},appendNode:function(b,c,d){var e,f,g="string"==typeof b?{id:b,pr:d,nm:c}:b,h=this.cache(d),i=a(h.html).removeClass("stree-leaf");g&&(f=h.parents.concat([g.pr]),e=a(this.createChild([g],h.level+1,f)),i.next("ul").size()?i.next("ul").append(e.html()):i.after(e),this.addHtmlCache(i.next("ul").find(".stree-node")),h.rendered=!0),h.property.sn=h.property.sn||[],h.property.sn.push(g),this.triggerEvent("addNode",g),g=h=i=e=f=null},prependNode:function(b,c,d){var e,f,g="string"==typeof b?{id:b,pr:d,nm:c}:b,h=this.cache(d),i=a(h.html).removeClass("stree-leaf");g&&(f=h.parents.concat([g.pr]),e=a(this.createChild([g],h.level+1,f)),i.next("ul").size()?i.next("ul").prepend(e.html()):i.after(e),this.addHtmlCache(i.next("ul").find(".stree-node")),h.rendered=!0),h.property.sn=[g].concat(h.property.sn||[]),this.triggerEvent("addNode",g),g=h=i=e=f=null},adjustNode:function(){},insertNode:function(b,c,d,e){var f,g,h,i,j="string"==typeof b?{id:b,pr:d,nm:c,sg:e}:b,k=this.cache(d),l=a(k.html).removeClass("stree-leaf"),m=k.property.sn||[];if(e="string"==typeof e?this.cache(e):e){for(g=k.parents.concat([j.pr]),f=a(this.createChild([j],k.level+1,g)),h=0,i=m.length;i>h;h+=1)if(m[h].id===e.property.id){k.property.sn=m.slice(0,h).concat([j]).concat(m.slice(h,i)),l.next("ul").size()?a(this.cache(m[h].id,"html")).after(f.html()):l.after(f);break}this.addHtmlCache(l.next("ul").find(".stree-node[data-id='"+j.id+"']")),k.rendered=!0}else this.appendNode(b,c,d);this.triggerEvent("addNode",j),j=k=l=m=f=g=null},renameNode:function(b,c){if(b="string"==typeof b?this.cache(b):b,b&&c){var d=a(b.html).find(".stree-text"),e=d.text();b.property&&(b.property.nm=c),d.html(c),this.triggerEvent("rename",b,c,e),d=e=null}},deleteNode:function(b){if(b="string"==typeof b?this.cache(b):b,!this.hasChildren(b)){var c,d,e,f,g,h=b.parents;if(h&&h.length>0){for(c=this.cache(h[h.length-1]),d=c.property.sn||[],e=[],f=0,g=d.length;g>f;f+=1)d[f].id!==b.property.id&&e.push(d[f]);c.property.sn=e}a(b.html).remove(),this.triggerEvent("deleteNode",b,h),d=e=null}},toggleNode:function(b){var c="string"==typeof b?this.container.find("div[data-id='"+b+"']"):a(b);0!==c.size()&&(c.hasClass("stree-node-retracted")?this.unfoldNode(c):this.foldNode(c))},unfoldNode:function(b){var c="string"==typeof b?this.container.find("div[data-id='"+b+"']"):a(b);0!==c.size()&&(c.removeClass("stree-node-retracted"),c.next("ul").removeClass("hide")),this.triggerEvent("unfold",c)},foldNode:function(b){var c="string"==typeof b?this.container.find("div[data-id='"+b+"']"):a(b);0!==c.size()&&(c.addClass("stree-node-retracted"),c.next("ul").addClass("hide")),this.triggerEvent("fold",c)},getTreeNode:function(b){var d=[],e=b?this.getChildNodes(b):[this.getFirstNode()];return b=b||this.getFirstNode().property.id,a.each(e,function(){var b=this.property,e=c.getTreeNode(b.id),f=a.extend({},this.property,{sn:e,children:e,checked:this.checked,selected:this.current,parents:this.parents});d.push(f)}),d},getChecked:function(){var a,b,c,d=[],e=this._cacheIndex;for(b=0,c=e.length;c>b;b+=1)a=this.cache(e[b]),a.checked&&d.push(a);try{return d}finally{d=a=e=null}},getChildNodes:function(a,b){var c,d,e,f,g="string"==typeof a?this.cache(a):a,h=g&&g.property?g.property.sn||g.property.children||[]:[],i=[];for(e=0,f=h.length;f>e;e+=1)c=h[e],d=this.cache(c.id),d&&i.push(d),b&&(c.sn||c.children)&&(i=i.concat(this.getChildNodes(c.id,b)));try{return i}finally{g=h=i=c=d=a=null}},isRoot:function(a){var b="string"==typeof a?this.cache(a):a;try{return b&&0===b.level}finally{b=null}},getIndex:function(a,b){var c,d,e,f,g="string"==typeof a?this.cache(a):a,h=g.property.id;for(b&&0!==b.length||(c=g.parents?g.parents[g.parents.length-1]:null,d=this._cacheData[c],b=d&&d.property?d.property.sn||d.property.children||[]:[]),e=0,f=b.length;f>e;e++)if(b[e].id===h)return e;return-1},getSiblings:function(a,b,c){var d,e,f,g,h,i,j="string"==typeof a?this.cache(a):a,k=j.parents?j.parents[j.parents.length-1]:null,l=this._cacheData[k],m=l&&l.property?l.property.sn||l.property.children||[]:[],n=j.property.id,o=[];for(h=this.getIndex(n,m),"prev"===b?(f=0,g=h):"next"===b?(f=h+1,g=m.length):"string"==typeof b||b&&b.property?(f=this.getIndex(a,m),g=this.getIndex(b,m),h=Math.min(f,g),g=Math.max(f,g)+1,f=h):(f=0,g=m.length),i=f;g>i;i++)d=m[i],e=this.cache(d.id),o.push(e),c&&(o=o.concat(this.getChildNodes(e,!0)));try{return o}finally{j=l=m=o=d=e=a=null}},checkNode:function(b,c){var d=this,f=[];return tbc.isArray(b)?void(!1!==this.triggerEvent("beforeCheck",b)&&b.length>0&&tbc.batch(b,1e3,0,10,function(g,h,i){var j,k,l;for(k=0,l=g.length;l>k;k+=1)j=g[k],("filter"!==d.mode||j.matched)&&("string"==typeof j&&(j=d.cache(j)),j.checked=!0,a(j.html).addClass(e.checkedCss||"stree-node-checked").find("input[type='checkbox']").attr("checked",!0),f.push(j));!h||tbc.isFunction(c)&&c.call(d,b)===!1||d.triggerEvent("check",f),4===i&&tbc.lock(d.ui)},function(){tbc.unlock(d.ui)})):tbc.log("Error at tbc.Tree().checkNode(list): arguments[0]:list must be an array;")},uncheckNode:function(b,d){return tbc.isArray(b)?void(!1!==this.triggerEvent("beforeUncheck",b)&&b.length>0&&tbc.batch(b,1e3,0,10,function(f,g,h){var i,j,k;for(j=0,k=f.length;k>j;j+=1)i=f[j],"string"==typeof i&&(i=c.cache(i)),i.checked=!1,a(i.html).removeClass(e.checkedCss||"stree-node-checked").find("input[type='checkbox']").removeAttr("checked");!g||tbc.isFunction(d)&&d.call(c,b)===!1||c.triggerEvent("uncheck",b),4===h&&tbc.lock(c.ui)},function(){tbc.unlock(c.ui)})):tbc.log("Error at tbc.Tree().uncheckNode(list): arguments[0]:list must be an array;")},chooseNode:function(a,b){a="string"==typeof a?this.cache(a):a;var c,d,f=this,g=e,h=this.getWillBeSelect(a,e.cascadeCheck);if(g.singleCheck){var c=function(){a.checked?f.uncheckNode(h):f.checkNode(h)};!b&&g.singleCheck&&(d=this.getWillBeDeselect(a,e.cascadeCheck),d.length>0?this.uncheckNode(d,c):c())}else a.checked?this.uncheckNode(h):this.checkNode(h);a=h=g=null},getWillBeCheck:function(a){a="string"==typeof a?this.cache(a):a;var b=[a];e.cascadeCheck&&(b=b.concat(this.getChildNodes(a,!0)));try{return b}finally{b=a=null}},getWillBeUncheck:function(a){a="string"==typeof a?this.cache(a):a;var b,c,d,f=this.cache(),g=this.cache("index"),h=[];for(c=0,d=g.length;d>c;c+=1)b=g[c],!e.cascadeCheck&&a&&a.property.id!==b&&f[b].checked?h.push(f[b]):a&&a.property.id!==b&&f[b].checked&&-1===tbc.array.indexOf(a.property.id,f[b].parents)&&h.push(f[b]);try{return h}finally{h=f=g=b=null}},getWillBeSelect:function(a,b){a="string"==typeof a?this.cache(a):a;var c=[a];b&&(c=c.concat(this.getChildNodes(a,!0)));try{return c}finally{c=a=null}},getWillBeDeselect:function(a,b){a="string"==typeof a?this.cache(a):a;var c,d,e,f=this.cache(),g=this.cache("index"),h=[];for(d=0,e=g.length;e>d;d+=1)c=g[d],b||a&&a.property.id===c||!f[c].checked?(!a||a.property.id!==c&&-1===tbc.array.indexOf(a.property.id,f[c].parents))&&f[c].checked&&h.push(f[c]):h.push(f[c]);try{return h}finally{h=f=g=c=null}},hasChildren:function(a){var b="string"==typeof a?this.cache(a):a;try{return b&&b.property.sn&&b.property.sn.length>0}finally{b=null}},isFirst:function(a){var b="string"==typeof a?this.cache(a):a,c=b.parents[b.parents.length-1],d=c?this.cache(c).property.sn:null,e=d&&d[0].id===a?!0:!1;try{return e}finally{b=c=d=null}},isLast:function(a){var b="string"==typeof a?this.cache(a):a,c=b.parents[b.parents.length-1],d=c?this.cache(c).property.sn:null,e=d&&d[d.length-1].id===a;try{return e}finally{b=c=d=null}},setCurrent:function(b,c){b="string"==typeof b?this.cache(b):b||this.getCurrent();var d,f=e.currentCss||"stree-node-selected",g=b.property,h=b.html,i=g&&g.sn&&g.sn.length>0;return g&&(g.tp=g.tp||"ORGANIZATION"),a(b.html).hasClass(f)?(this.triggerEvent("select",g,a(h),i),void(f=g=h=i=null)):(d=this.container.find("dt."+f).removeClass(f).attr("data-id"),this.cache(d,"current",!1),a(b.html).addClass(f),b.current=!0,c!==!1&&this.triggerEvent("select",g,a(h),i),void(f=g=h=i=null))},___selectNode:function(b,c,d){var f="string"==typeof b?this.cache(b):b||this.getCurrent(),g=e.currentCss||"stree-node-selected",h=f.property,i=f.html,j=h&&h.sn&&h.sn.length>0;h&&(h.tp=h.tp||"ORGANIZATION"),f.current===!0?c!==!0?this.deselectNode(this.getSelectedList()):(a(f.html).removeClass(g),f.current=!1):(a(f.html).addClass(g),f.current=!0,this.triggerEvent("select",h,a(i),j,d),c!==!0&&this.deselectNode(this.getSelectedList([f.property.id]))),g=h=i=j=null},selectNode:function(b,c,d){var f="string"==typeof b?this.cache(b):b||this.getCurrent(),g=e.currentCss||"stree-node-selected",h=f.property,i=f.html,j=h&&h.sn&&h.sn.length>0;h&&(h.tp=h.tp||"ORGANIZATION"),f.current!==!0||d?("filter"!==this.mode||f.matched)&&((c!==!0||e.multipleSelect!==!0)&&this.deselectNode(this.getSelectedList([f.property.id])),a(f.html).addClass(g),f.current=!0,this.triggerEvent("select",h,a(i),j,d)):c!==!0?this.deselectNode(this.getSelectedList()):(a(f.html).removeClass(g),f.current=!1),g=h=i=j=null},deselectNode:function(b){var c,d,f=e.currentCss||"stree-node-selected";for(c=0,d=b.length;d>c;c+=1)a(b[c].html).removeClass(f),b[c].current=!1;this.triggerEvent("deselect",b)},getCurrent:function(){var a,b,c,d;for(c=0,d=this._cacheIndex.length;d>c;c+=1)if(b=this._cacheIndex[c],a=this.cache(b),a.current===!0)try{return a}finally{b=a=null}try{return this.getFirstNode()}finally{b=a=null}},getSelectedList:function(b){b=a.isArray(b)?b:[b];var c,d,e,f,g,h,i=[];for(d=0,e=this._cacheIndex.length;e>d;d+=1)if(c=this._cacheIndex[d],this.cache(c).current){for(f=!1,g=0,h=b.length;h>g;g+=1)if(b[g]===c){f=!0;break}f||i.push(this.cache(c))}try{return i}finally{c=i=null}},getFirstNode:function(){var a=this.container.children(".tbc-tree").children(".tbc-tree-container").children("ul:first").children("li:first").children(".stree-node").attr("data-id");try{return this.cache(a)}finally{a=null}},getCommonParent:function(a,b){var c,d,e,f=a.parents,g=b.parents;for(c=f.length-1;c>=0;c--)for(e=f[c],d=g.length-1;d>=0;d--)if(e===g[d])return e},getSequence:function(a,b,c){if(c=c||this.getCommonParent(a,b),!c)return null;var d,e,f,g=this._cacheData[c],h=g.property,i=h.children||h.sn,j=a.parents,k=b.parents,l=[];for(d=0,e=i.length;e>d&&(a||b);d++)f=i[d].id,a&&-1!==tbc.array.indexOf(f,j)&&(l.push(a),a=null),b&&-1!==tbc.array.indexOf(f,k)&&(l.push(b),b=null);return l[2]=c,l},getNextSiblings:function(a,b){var c,d=this.getSiblings(a,"next"),e=d.length,f=[];if(b)for(c=0;e>c;c++)f=f.concat(this.getChildNodes(d[c]));return f},getPrevSiblings:function(a){return this.getSiblings(a,"prev")},getShiftSelect:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=this.getSequence(a,b),r=[];if(null===q)return r;if(d=a.parents,e=b.parents,f=tbc.array.indexOf(q[2],d)+1,g=tbc.array.indexOf(q[2],e)+1,h=q[0]===a?"next":"prev",i=q[0]===b?"next":"prev",r=[],d=f>-1?d.slice(f):[],e=g>-1?e.slice(g):[],m=d.length,o=e.length,c)return 0===m&&0===o?this.getSiblings(b,a,!0):this.getSiblings(b,i,!0);for(l=m-1;l>=0;l--)j=d[l],p=this.getSiblings(j,h,!0),r=r.concat(p),"next"!==h&&r.push(this.cache(j));for(n=o-1;n>=0;n--)k=e[n],p=this.getSiblings(k,i,!0),r=r.concat(p),"next"!==i&&r.push(this.cache(k));return r.push(a),r.push(b),r=r.concat(this.getSiblings(a,h,!0)),r=r.concat(this.getSiblings(b,i,!0))},shiftSelect:function(b,c){function d(b,c){var d,f,g=b.length,h=e.currentCss||"stree-node-selected";for(d=0;g>d;d++)f=b[d],("filter"!==j.mode||f.matched)&&(f.current=!0,a(f.html).addClass(h),k.push(f));c&&tbc.unlock(j.ui)}var f="string"==typeof b?this.cache(b):b||this.getCurrent(),g=this.lastClickNode,h=this.getSelectedList(),i=this.getShiftSelect(f,g,c),j=this,k=[];this.deselectNode(h),tbc.lock(this.ui),tbc.batch(i,1e3,0,10,d)}}),c.addEvent({resize:function(a){var b=0;e.filterVisible&&this.filterBar&&(b=this.filterBar.height()),this.treeContainer.height(a-b)}}),c.ui.css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}).delegate(".stree-handle","click",function(a){a.stopPropagation();var b=c,d=this.parentNode,e=d.getAttribute("data-id");b.toggleNode(d),b.renderNode(e),b=d=e=null}).delegate(".stree-node","click",function(a){var b=this.getAttribute("data-id");a.shiftKey||(c.lastClickNode=c._cacheData[b]),a.shiftKey?c.shiftSelect(b,!0):c.selectNode(b,a.ctrlKey&&e.multipleSelect,!1,a.shiftKey)}).delegate(".stree-node","dblclick",function(a){var b=this.getAttribute("data-id"),d=!0;a.shiftKey||(c.lastClickNode=c._cacheData[b]),c.selectNode(b,a.ctrlKey&&e.multipleSelect,d,a.shiftKey)}),e.checkbox&&c.ui.delegate("input[type='checkbox']","click",function(a){c.chooseNode(this.value,a.ctrlKey||!e.singleCheck),a.stopPropagation()})}}(jQuery),tbc.namespace("tbc.tree"),tbc.tree.Online=function(a){var b,c,d={},e=$.extend({},d,a);c=tbc.self(this,arguments).extend([tbc.Tree,a],{packageName:"tbc.tree.Online",renderOnlineNumber:function(){this.batch(this._cacheIndex,1e3,0,10,function(a,c){for(var d,e=0,f=a.length;f>e;e++)d=a[e],this.render2Html(d,this.cache(d,"amount"));if(a=d=null,c){var g=this;b=setTimeout(function(){g.request(),g=null},this.interval||18e4)}})},singleRender:function(a){var b,c,d;for(a=$.isArray(a)?a:[a],b=0,c=a.length;c>b;b++)d=a[b],this.render2Html(d,this.cache(d,"amount"))},render2Html:function(a,b){b=!b||isNaN(b)?0:b;var c=$(this.cache(a,"html")),d=c.find(".stree-count");c.size()&&(d.size()?d.html("&nbsp;["+b+"]"):c.append('<i class="stree-count">&nbsp;['+b+"]</i>"))},countOnlineNumber:function(a,b){b=b||[];for(var c,d,e,f,g,h=0,i=a.length;i>h;h++)f=a[h],c=f.id,d=f.n,e=f.sn||f.c,this.cache(c,"amount",d),e&&e.length>0&&this.countOnlineNumber(e,b.concat([c])),this.updateParents(b,d);c=d=e=f=g=null},updateParents:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=this.cache(a[c],"amount");this.cache(a[c],"amount",b+e)}},request:function(){var a=c;$.ajax({url:e.onlineUrl,type:"get",dataType:"json",success:function(b){a.countOnlineNumber(b),a.renderOnlineNumber(),a=null}})},start:function(){this.request()},stop:function(){clearTimeout(b)}}),c.addEvent({itemRender:function(a){try{for(var b=0,c=a.length,d=[];c>b;b++)d.push(a[b].id);this.singleRender(d)}catch(e){alert(e.line)}}})},function(a,b){"use strict";var c=function(){var a=function(){};a()};c.prototype={getDesktopHeight:function(){return window.desktop?window.desktop.container.height():document.documentElement.clientHeight},getDesktopWidth:function(){return window.desktop?window.desktop.container.width():document.documentElement.clientWidth},getShortcutById:function(a){return this.getTaskByElement("[_shortcutid='"+a+"']")},getOpenType:function(a){var b,c="string"==typeof a?this.getAppOptions(a):a,d=null;if("NEW_PAGE"===c.openType)d="LINK";else switch(b=c.itemType.toUpperCase()){case"FOLDER":d="FOLDER";break;case"APPLICATION":d="APP";break;case"WIDGET":d="WIDGET";break;case"shortcut":d="LINK";break;case"ICON":d="NEW_WINDOW"===c.openType?"APP":"LINK";break;default:d=b}return d},getAppOptions:function(a){return window.applicationMap[a]},getTaskByElement:function(c,d){var e=b(c).attr("tbc");return e=e?e:d!==!1?b(c).parents("[tbc]:first").attr("tbc"):"",a.TASKS(e)},logout:function(c){if(c){{var d=new a.Pop({width:320,height:150}).appendTo("body").locate(".tbc-startmenu-handle").show(),e=new a.Button({text:i18n("v4.js.logout"),icon:"icon-breadcrumb_separator_arrow_2_dots",click:function(){a.system.logout(!1)}}),f=new a.Button({text:i18n("v4.js.cancel"),icon:"icon-close",click:function(){setTimeout(function(){d.close()},1)}});b("<div/>").html(i18n("v4.js.logoutTips")).css({padding:"0 0 2em 0"}).appendTo(d.container)}e.depend(d),e.appendTo(d),e.ui.css("float","left").addClass("tbc-button-blue"),f.depend(d),f.appendTo(d),f.ui.css({marginRight:12,"float":"right"}),d.container.css("padding","2em")}else window.onbeforeunload=null,document.location.href="/login/login.logout.do"},open:function(c,d,e){var f,g,h,i,j="string"==typeof c?this.getAppOptions(c):c,k=this.getOpenType(j),l=null,m=j.appId||j.applicationId,n=a.webdesk.data.apps[m];switch(j=b.extend({},n,j),k){case"FOLDER":l=a.TaskManager.get("folder",j.userDeskItemId),l?(f=l.ui.parent(),g=f.hasClass("current"),h=a.system.getTaskByElement(f),g||h.group.show(h.index),f=g=h=null,l.focused?l.flash():l.show()):(l=new a.Folder(j).addEvent({afterClose:function(){a.TaskManager.exit("folder",j.userDeskItemId)}}).show(),a.TaskManager.set("folder",j.userDeskItemId,l));break;case"APP":case"APPLICATION":l=a.TaskManager.get("app",j.applicationId),l?(f=l.ui.parent(),g=f.hasClass("current"),h=a.system.getTaskByElement(f),g||h.group.show(h.index),f=g=h=null,l.show(),e&&l.load(j.homePageUrl,d?"post":"get",d)):("undefined"!=typeof d&&(j.data=d),i=window.applicationMap[j.applicationId],j=b.extend(i,j),l=new a.App(j,j).addEvent({afterClose:function(){a.TaskManager.exit("app",j.applicationId)}}).show(),a.TaskManager.set("app",j.applicationId,l));break;case"LINK":window.open(j.homePageUrl,j.applicationId);break;case"SHORTCUT":j.autologin===!1?this.startAutoLogin(j)===!1&&window.open(j.homePageUrl,j.applicationId):window.open(j.homePageUrl,j.applicationId)}try{return l}finally{l=null}},startAutoLogin:function(b){var c,d=b.userDeskItemId,e=window.URLS.autoLoginSetting,f=this;return"string"==typeof e?(e=e.replace(/\{\{shortcutId\}\}/,d),this.autoLoginWins=this.autoLoginWins||{},c=this.autoLoginWins[b.userDeskItemId],c?c.show():(c=new a.Window({width:500,height:340,name:b.userDeskItemName+" - "+i18n("v4.js.autoLoginSetting"),homepage:e,loadType:"ajax"}).show(),c.addEvent({close:function(){delete f.autoLoginWins[b.userDeskItemId]}}),this.autoLoginWins[b.userDeskItemId]=c)):c=!1,c},isImg:function(a){return!("string"!=typeof a||!a.match(/\.(jpg|jpeg|gif|png|img|bmp|ico|WebP)$/)&&-1===a.indexOf("sf-server/file/getFile/"))}},a.system=new c}(window.tbc,window.jQuery);