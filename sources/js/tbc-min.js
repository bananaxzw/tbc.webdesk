/** 
 * -------------------------------------------------------------
 * Copyright (c) 2013 时代光华, All rights reserved. 
 * http://www.21tb.com/ 
 *  
 * @version: 0.0.1 
 * @author: Colin <mail@luozhihua.com> 
 * @description: TBC Javascript Project 
 * ------------------------------------------------------------- 
 */ 

!function(a,b){"use strict";function c(a,b){var c;if("string"==typeof a){for(c=0;c<b.length;c+=1)if(a===b[c])return!1;return!0}}function d(a){a=a.toLowerCase();var b=i.exec(a)||j.exec(a)||k.exec(a)||a.indexOf("compatible")<0&&l.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}}var e,f,g,h=a.navigator.userAgent,i=/(webkit)[ \/]([\w.]+)/,j=/(opera)(?:.*version)?[ \/]([\w.]+)/,k=/(msie) ([\w.]+)/,l=/(mozilla)(?:.*? rv:([\w.]+))?/;!function(){return}(),a.console=a.console||{log:function(){}},a.tbc=e=a.tbc||{nspath:"tbc"},e.namespace=e.ns=function(a,b){a=a.split(/[.\/\\>]/);var c,d,f=b||e,g=f.nspath||"window";for(c=0,d=a.length;d>c;c+=1)(0!==c||"tbc"!==a[c])&&(g+="."+a[c],f[a[c]]=f[a[c]]||{superClass:f},f[a[c]].nspath=f[a[c]].nspath||g,f=f[a[c]]);try{return f}finally{f=g=null}},e.version="1.0",e.self=function(a,b){var c,d,f,g,h=b||[],i=h[h.length-1],j=i&&"object"==typeof i&&i.subclass?i.subclass:a;j&&(j.extend=function(){var a=[this];for(this.parentClass=this.parentClass||[],c=0;c<arguments.length;c+=1){for(g=null,d=0,f=this.parentClass.length;f>d;d+=1)if(this.parentClass[d]===arguments[c]){g=!0;break}g||(this.parentClass.push(arguments[c]),a.push(arguments[c]))}return e.extend.apply(this,a),a=null,this},j.extend(e.ClassManager,e.Event));try{return j}finally{h=i=j=null}},e.extend=function(){var a,b,d,e=arguments,f=e.length,g="nspath,superClass,extend,iid,guid,packageName";if(g=g.split(","),f>1)for(b=1;f>b;b+=1){switch(typeof e[b]){case"object":a=e[b]&&e[b].constructor===Array&&"function"==typeof e[b][0]?new e[b][0](e[b][1],{subclass:e[0]}):e[b];break;case"function":a=new e[b]({subclass:e[0]});break;default:a={}}for(d in a)a.hasOwnProperty(d)&&c(d,g)!==!1&&"undefined"!=typeof a[d]&&(e[0][d]=a[d])}try{return e[0]}finally{e=a=null}},g=d(h),g.browser&&(e[g.browser]=!0,e.browserVersion=g.version),e.touchable="ontouchstart"in document.documentElement,f={getCoordinate:function(a,c){a=b("string"==typeof a?document.getElementById(a):a);var d=a.size()?a.offset():{left:0,top:0},e={left:d.left,top:d.top,bottom:0,right:0,width:a.outerWidth(),height:a.outerHeight()};e.right=e.left+e.width,e.bottom=e.top+e.height;try{return e}finally{e=a=c=d=null}},getScroll:function(a,b){var c={top:0,left:0},d=a.parentNode;if(d||d&&"body"===d.nodeName)return c;for(;d&&d!==(b||document.body);)c.left+=d.scrollLeft||0,c.top+=d.scrollTop||0,d=d.parentNode;try{return c}finally{a=d=b=c=null}},lock:function(a,c){a=b(a||document.body);var d="number"==typeof c?{zIndex:c}:c,e=a.css("position"),f=b.isNumeric(c)?c:this.getMaxZIndex(a),g=a.innerWidth(),h=a.innerHeight(),i=b('<div class="elem_mask"></div>').appendTo(a);d=b.extend({position:"absolute",top:0,left:0,width:g,cursor:"wait",height:h,backgroundColor:"#000",opacity:.2,zIndex:f+1},d),i.css(d),e&&"static"!==e&&""!==e||a.css({position:"relative"});try{return i}finally{a=e=i=f=d=null}},unlock:function(a){a=b(a||document.body),a.children(".elem_mask").fadeOut(200,function(){b(this).remove(),a=null})},percentToInt:function(b,c){return"string"==typeof b&&b.match(/%$/)?a.parseInt(b)/100*c:b},percentToFloat:function(b,c){return"string"==typeof b&&b.match(/%$/)?a.parseFloat(b)/100*c:b},substr:function(a,b){if(!a||!b)return a||"";var c=0,d=0,e="";for(d=0;d<a.length;d+=1){if(c+=a.charCodeAt(d)>255?2:1,c>b)return e;e+=a.charAt(d)}return a},formatString:function(a){if(0===arguments.length)return null;var b,c;for(b=1;b<arguments.length;b+=1)c=new RegExp("\\{"+(b-1)+"\\}","gm"),a=a.replace(c,arguments[b]);return a},stringTemplate:function(a,b,c){if(b&&"object"!=typeof b)return a;c=c||{};var d,e;for(d in b)b.hasOwnProperty(d)&&(e=new RegExp("\\{"+d+"\\}","gm"),a=a.replace(e,c[b[d]]||b[d]||""));return a=a.replace(/\{\w+\}/g,"")},getMaxZIndex:function(a){var c,d=0;a=b(a||"body"),c=a.children(),c.each(function(){var a=b(this).css("zIndex");a=a&&!isNaN(a)?a:0,d=Math.max(d,a)});try{return d}finally{c=a=null}},getElementByMaxZIndex:function(a,c){a=b(a),c=b(c);for(var d,e,f,g,h=a[0],i=c[0];h&&h!==document.body;){for(d=h.offsetParent;d&&i&&i!==document.body;){if(e=i.offsetParent,e&&d===e){f=b(h).css("zIndex"),g=b(i).css("zIndex"),f="auto"===f?0:f,g="auto"===g?0:g;var j=-1===b(d).nextAll().index(e);return h=i=d=e=null,f>g?a:f===g&&j?a:c}i=e}i=c[0],h=d}},getCursorPosition:function(a){var b={text:"",start:0,end:0};if(a.focus(),a.setSelectionRange)b.start=a.selectionStart,b.end=a.selectionEnd,b.text=b.start!==b.end?a.value.substring(b.start,b.end):"";else if(document.selection){var c,d=document.selection.createRange(),e=document.body.createTextRange();for(e.moveToElementText(a),b.text=d.text,b.bookmark=d.getBookmark(),c=0;e.compareEndPoints("StartToStart",d)<0&&0!==d.moveStart("character",-1);c++)"\n"===a.value.charAt(c)&&c++;b.start=c,b.end=b.text.length+b.start}return b},setCursorPosition:function(a,b){if(b||alert("You must get cursor position first."),a.setSelectionRange)a.focus(),a.setSelectionRange(b.start,b.end);else if(a.createTextRange){var c=a.createTextRange();a.value.length===b.start?(c.collapse(!1),c.select()):(c.moveToBookmark(b.bookmark),c.select())}},setCursors:function(a,b,c){a.setSelectionRange?(a.focus(),a.setSelectionRange(b,c)):a.createTextRange&&(range=a.createTextRange(),range.collapse(!0),range.moveEnd("character",c),range.moveStart("character",b),range.select())},setCursor:function(a){var b=this.getCursorPosition(a);this.setCursorPosition(a,b)},batch:function(c,d,f,g,h,i){if(!b.isArray(c))return!1;f=f||0,d=d||1e3,g=g||20;var j=f*d,k=c.length,l=Math.min((f+1)*d,k),m=c.slice(j,l);b.isFunction(h)?h(m,l===k,f):a.console&&console.log("Error: tbc.batch(...). arguments[4] must be a function;"),setTimeout(function(){f+=1,k>d*f&&e.batch(c,d,f,g,h,i)},g),l===k&&b.isFunction(i)&&i.call(this)},seriesForm:function(a){var c,d=b("input,textarea,select",a),e=[],f={},g=[],h={};d.each(function(){var a=this.tagName.toLowerCase();if(this.disabled)return!0;switch(a){case"input":switch(this.type){case"checkbox":f[this.name]=f[this.name]||[],this.checked&&f[this.name].push(this.value);break;case"radio":h[this.name]=h[this.name]||[],this.checked&&h[this.name].push(this.value);break;case"button":case"reset":break;case"submit":if(!b(this).hasClass("trigger_aspnet_event"))break;default:e.push([this.name||this.id,encodeURIComponent(this.value)].join("="))}break;case"textarea":e.push([this.name||this.id,encodeURIComponent(this.value)].join("="));break;case"select":b("option",this).each(function(){this.selected&&g.push(encodeURIComponent(this.value))}),e.push([this.name||this.id,g.join(",")].join("="));break;case"button":e.push([this.name||this.id,encodeURIComponent(this.value)].join("="))}}),d=null;for(c in f)e.push([c,f[c].join(",")].join("="));for(c in h)e.push([c,h[c].join(",")].join("="));try{return e.join("&")}finally{e=h=f=g=null}},replaceUrlParam:function(a,c,d){var e=this.isObject(a)?a:function(){var b={};return b[a]=c,b}(),f=d||document.location.search;f=f.substring(f.indexOf("?")+1).split("&");var g={};return b.each(f,function(){var a=this.split("=");g[a[0]]=a[1]||""}),b.extend(g,e),g},mergerPath:function(a,b){var a=a||document.location.href;if(b.match(/^https?:\/\//)){return b}var c=a.split("?")[0].split("/");if(c.length--,!b.match(/^\/{1}/)){for(;0===b.indexOf("../");)b=b.slice(3),c.length--;b=unescape(c.join("/")+"/"+b)}return b},randomString:function(a){a=a?a-1:15;var b="0123456789abcdefghijklmnoprstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+|=-`";return function(a,b,c){return(c?arguments.callee(a,b,c-1):"")+b[a.floor(a.random()*b.length)]}(Math,b,a)},random:function(a,b){switch(arguments.length){case 1:return Math.floor(Math.random()*a+1);case 2:return Math.floor(Math.random()*(b-a+1)+a);default:return 0}},randColor:function(a){return function(a,b,c){return(c>0?arguments.callee(a,b,c-1):"#")+b[a.floor(16*a.random())]}(Math,a||["1","2","3","4","5","6","7","8","9","0","a","b","c","d","e","f"],5)},isSight:function(a){var c=b(a)[0]?b(a)[0].parentNode:a,d=this.getCoordinate(b(a)[0]),e=this.getCoordinate(b(a)[0]);if(d.top<e.top||d.top>e.bottom||d.left<e.left)return!1;try{return!0}finally{c=a=d=e=null}},inArea:function(a,b){var c=this.getCoordinate(a),d=this.getCoordinate(b);if(d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.left>c.left&&d.right<c.right&&d.top>c.top&&d.bottom<c.bottom)return!0;try{return!1}finally{a=b=c=d=null}},isIncline:function(a,b){var c=this.getCoordinate(a),d=this.getCoordinate(b);if(d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.centerX>c.left&&d.centerX<c.right&&d.centerY>c.top&&d.centerY<c.bottom)return!0;try{return!1}finally{a=b=c=d=null}},isOverlap:function(a,c){var d=b.isPlainObject(a)?a:this.getCoordinate(a),e=b.isPlainObject(c)?c:this.getCoordinate(c),f=Math.max(d.left,e.left),g=Math.max(d.top,e.top),h=Math.min(d.right,e.right),i=Math.min(d.bottom,e.bottom);try{return h>f&&i>g}finally{a=c=d=e=null}},center:function(a,c,d){a=b(a),c=b(c);var e,f,g,h,i=a.width(),j=a.height(),k=a.css("left"),l=a.css("top");c.size()?(e=c.innerWidth(),f=c.innerHeight(),g=c.scrollTop(),h=c.scrollLeft()):(e=document.documentElement.clientWidth||document.documentElement.offsetWidth,f=document.documentElement.clientHeight||document.documentElement.offsetHeight,g=Math.max(document.documentElement.scrollTop,document.body.scrollTop),h=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)),k=i>e?h:e/2+h-i/2,l=j>f?g:f/2+g-j/2,a.css({top:l,left:k,width:i,height:j}),d=d||c,b.isFunction(d)&&d.call(a)},array:{unique:function(a){var b,c,d,e,f=[];for(c=0,d=a.length;d>c;c+=1){for(b=!1,e=0;e<f.length;e+=1)a[c]===f[e]&&(b=!0);b!==!0&&f.push(a[c])}try{return f}finally{f=null}},merge:function(){var a,b=arguments,c=b.length,d=[];for(a=0;c>a;a+=1)"object"==typeof b[a]&&b[a].constructor===Array&&(d=d.concat(b[a]));try{return this.unique(d)}finally{b=d=null}},clear:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b+=1)"undefined"!=typeof a[b]&&d.push(a[b]);try{return d}finally{d=null}},remove:function(a){var c=[],d=arguments;return d=e.isArray(d[1])?[1].concat(d[1]):d,b.each(a,function(a,b){var e,f,g=!1;for(e=1,f=d.length;f>e;e+=1)if(!g&&d[e]===b){g=!0;break}g||c.push(b)}),c},indexOf:function(a,b){var c,d;for(b=b&&"object"==typeof b&&b.constructor===Array?b:[],c=0,d=b.length;d>c;c+=1)if(a===b[c])return c;return-1},sort:function(a,b){var c;c=b&&"desc"===b.toLowerCase()?a.sort(this.sortASC):a.sort(this.sortDESC);try{return c}finally{c=null}},sortASC:function(a,b){return a-b},sortDESC:function(a,b){return b-a}},isNumber:function(a){return"number"==typeof a},isString:function(a){return"string"==typeof a},isFunction:function(a){return"function"==typeof a},isNull:function(a){return null===a},isBool:function(a){return"boolean"==typeof a},isArray:function(a){return!!a&&a.constructor===Array},isObject:function(a){return!!a&&a.constructor===Object},debug:{printObj:function(a,b){var c,d=["{\n"];for(c in a)a.hasOwnProperty(c)&&d.push(b?"    "+c+":"+a[c]+",\n":"    "+c+"; ");return d.push("}"),d.join("")}},log:function(b){a.console&&a.console.log(b)},st:function(){return this.st.time=(new Date).getTime(),this.st.time},et:function(){var a=(new Date).getTime(),b="tbc.et: "+(a-this.st.time);return e.log(b),a-this.st.time}},e.extend(e,f)}(window,jQuery),function(){Function.prototype.bind=Function.prototype.bind||function(){var a=this,b=arguments[0],c=Array.prototype.slice.call(arguments,1);return function(){var d=Array.prototype.concat.apply(c,arguments);return a.apply(b,d)}}}(),function(a,b){"use strict";a.Event=function(){a.self(this,arguments).extend({init:function(){return this.packageName="tbc.Event",this},eventStorage:{},REMOVE:function(a,b){if("function"==typeof b){var c,d,e=this.eventStorage[a],f=[];if("object"==typeof e&&e.constructor===Array){for(c=0,d=e.length;d>c;c+=1)e[c].toString()!==b.toString()&&f.push(e[c]);this.eventStorage[a]=f}}else this.eventStorage[a]=[]},TRIGGER:function(a,b){var c,d,e,f=this.eventStorage[a];if("object"==typeof f&&f.constructor===Array)for(e=f.length-1;e>-1;e-=1)if("function"==typeof f[e])try{if(d=f[e].apply(this,b),c=d===!1?!1:c,d===!0)return!0}catch(g){}return c===!1?!1:c},addEvent:function(a,c){var d,e,f,g,h,i=this.eventStorage;if("object"==typeof a){for(d in a)a.hasOwnProperty(d)&&this.addEvent(d,a[d]);return this}if("function"==typeof c){for(e=b.isArray(i[a])?i[a]:i[a]=[],f=!1,g=0,h=e.length;h>g;g+=1)e[g].toString()===c.toString()&&(f=!0);f||i[a].push(c)}return this},removeEvent:function(a,b){var c,d=this.eventStorage,e=new RegExp("(^|\\.)"+a.substring(a.indexOf(".")+1,a.length)+"($|\\.)");for(c in d)d.hasOwnProperty(c)&&(c===a||c.match(e))&&this.REMOVE(c,b);return d=null,this},triggerEvent:function(a){var b,c,d,e,f,g=[],h=this.eventStorage,i=new RegExp("(^|\\.)"+a.substring(a.indexOf(".")+1,a.length)+"($|\\.)");for(d=1,e=arguments.length;e>d;d+=1)g.push(arguments[d]);for(f in h)if(h.hasOwnProperty(f)&&(f===a||f.match(i))&&(c=this.TRIGGER(f,g),b=c===!1?!1:b,c===!0))return!1;return h=null,b===!1?!1:this}})}}(tbc,jQuery),function(a,b){"use strict";a.TASK_DEPOT=a.TASK_DEPOT||{},a.TASK_DEPOT_COUNT=a.TASK_DEPOT_COUNT||0,a.guid=a.guid||0,a.TASKS=function(b,c){return b?!c||a.TASK_DEPOT[b]?a.TASK_DEPOT[b]||null:(a.TASK_DEPOT[b]=c,a.TASK_DEPOT_COUNT+=1,void 0):null},a.TASKS.set=function(a,b){this(a,b)},a.TASKS.get=function(a){return this(a)},a.TASKS.del=function(b){var c,d,e=a.TASK_DEPOT[b];if(b&&e){try{e.container&&a.TASK_DEPOT[b].container.empty().remove(),e.ui&&a.TASK_DEPOT[b].ui.empty().remove()}catch(f){}c=e.DEPENDS||[],a.TASKS.killAll(c);for(d in e)e.hasOwnProperty(d)&&delete a.TASK_DEPOT[b][d];e=null,delete a.TASK_DEPOT[b]}},a.TASKS.killAll=function(b){if("array"==typeof b&&b.length>0){var c,d,e;for(c in a.TASK_DEPOT)if(a.TASK_DEPOT.hasOwnProperty(c)&&a.TASK_DEPOT[c].DEPENDS)for(d=0,e=b.length;e>d;d++)b[d]===c&&a.TASK_DEPOT[c].DESTROY()}},a.getTaskByElement=function(c){var d=b(c).attr("tbc");return d=d||b(c).parents("[tbc]:first").attr("tbc"),a.TASKS(d)},a.ClassManager=function(){a.self(this,arguments).extend({DEPENDS:[],depend:function(b){return a.isArray(b.DEPENDS)&&b.DEPENDS.push(this.guid),this},dependSelf:function(a){var b="object"==typeof a?a.guid:a;return this.DEPENDS.push(b),this},undepend:function(b){return b&&a.isArray(b.DEPENDS)&&(b.DEPENDS=a.array.remove(b.DEPENDS,this.guid)),this},undependSelf:function(b){var c="object"==typeof b?b.guid:b;return this.DEPENDS=a.array.remove(this.DEPENDS,c),this},INIT:function(){var b=this.constructor;return this.packageName="tbc.ClassManager",b.maxid=b.maxid||0,b.maxid=b.maxid+1,this.iid=b.maxid,b.count=b.count&&!isNaN(b.count)?b.count+1:1,a.guid+=1,this.guid=a.guid,b.instance=b.instance||{},this.CREATE_TIME=(new Date).getTime(),this.INIT_INSTANCE(),this.INSTANCE(this.iid,this),a.TASKS(this.guid,this),this},DESTROY:function(){var b=this.guid,c=this.iid;this.INSTANCE(c,"del"),this.triggerEvent("destroy"),a.TASKS.del(b,!1),b=c=null},INSTANCE:function(a,b){if(!a)return null;if("del"===b&&this.constructor.instance[a])delete this.constructor.instance[a],this.constructor.count=this.constructor.count-1;else{if(!b||this.constructor.instance[a])return this.constructor.instance[a]||null;this.constructor.instance[a]=b}return this},INIT_INSTANCE:function(){this.INSTANCE.get=function(a){return this(a)},this.INSTANCE.set=function(a,b){this(a,b)},this.INSTANCE.del=function(a){this(a,"del")}}}).INIT()}}(tbc,jQuery);