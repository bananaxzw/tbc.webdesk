/** 
 * -------------------------------------------------------------
 * Copyright (c) 2013 时代光华, All rights reserved. 
 * http://www.21tb.com/ 
 *  
 * @version: 0.0.1 
 * @author: Colin <mail@luozhihua.com> 
 * @description: TBC Javascript Project 
 * ------------------------------------------------------------- 
 */ 

!function(a,b){"use strict";function c(a,b){var c;if("string"==typeof a){for(c=0;c<b.length;c+=1)if(a===b[c])return!1;return!0}}function d(a){a=a.toLowerCase();var b=i.exec(a)||j.exec(a)||k.exec(a)||a.indexOf("compatible")<0&&l.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}}var e,f,g,h=a.navigator.userAgent,i=/(webkit)[ \/]([\w.]+)/,j=/(opera)(?:.*version)?[ \/]([\w.]+)/,k=/(msie) ([\w.]+)/,l=/(mozilla)(?:.*? rv:([\w.]+))?/;!function(){return}(),a.console=a.console||{log:function(){}},a.tbc=e=a.tbc||{nspath:"tbc"},e.namespace=e.ns=function(a,b){a=a.split(/[.\/\\>]/);var c,d,f=b||e,g=f.nspath||"window";for(c=0,d=a.length;d>c;c+=1)(0!==c||"tbc"!==a[c])&&(g+="."+a[c],f[a[c]]=f[a[c]]||{superClass:f},f[a[c]].nspath=f[a[c]].nspath||g,f=f[a[c]]);try{return f}finally{f=g=null}},e.version="1.0",e.self=function(a,b){var c,d,f,g,h=b||[],i=h[h.length-1],j=i&&"object"==typeof i&&i.subclass?i.subclass:a;j&&(j.extend=function(){var a=[this];for(this.parentClass=this.parentClass||[],c=0;c<arguments.length;c+=1){for(g=null,d=0,f=this.parentClass.length;f>d;d+=1)if(this.parentClass[d]===arguments[c]){g=!0;break}g||(this.parentClass.push(arguments[c]),a.push(arguments[c]))}return e.extend.apply(this,a),a=null,this},j.extend(e.ClassManager,e.Event));try{return j}finally{h=i=j=null}},e.extend=function(){var a,b,d,e=arguments,f=e.length,g="nspath,superClass,extend,iid,guid,packageName";if(g=g.split(","),f>1)for(b=1;f>b;b+=1){switch(typeof e[b]){case"object":a=e[b]&&e[b].constructor===Array&&"function"==typeof e[b][0]?new e[b][0](e[b][1],{subclass:e[0]}):e[b];break;case"function":a=new e[b]({subclass:e[0]});break;default:a={}}for(d in a)a.hasOwnProperty(d)&&c(d,g)!==!1&&"undefined"!=typeof a[d]&&(e[0][d]=a[d])}try{return e[0]}finally{e=a=null}},g=d(h),g.browser&&(e[g.browser]=!0,e.browserVersion=g.version),e.touchable="ontouchstart"in document.documentElement,f={getCoordinate:function(a,c){a=b("string"==typeof a?document.getElementById(a):a);var d=a.size()?a.offset():{left:0,top:0},e={left:d.left,top:d.top,bottom:0,right:0,width:a.outerWidth(),height:a.outerHeight()};e.right=e.left+e.width,e.bottom=e.top+e.height;try{return e}finally{e=a=c=d=null}},getScroll:function(a,b){var c={top:0,left:0},d=a.parentNode;if(d||d&&"body"===d.nodeName)return c;for(;d&&d!==(b||document.body);)c.left+=d.scrollLeft||0,c.top+=d.scrollTop||0,d=d.parentNode;try{return c}finally{a=d=b=c=null}},lock:function(a,c){a=b(a||document.body);var d="number"==typeof c?{zIndex:c}:c,e=a.css("position"),f=b.isNumeric(c)?c:this.getMaxZIndex(a),g=a.innerWidth(),h=a.innerHeight(),i=b('<div class="elem_mask"></div>').appendTo(a);d=b.extend({position:"absolute",top:0,left:0,width:g,cursor:"wait",height:h,backgroundColor:"#000",opacity:.2,zIndex:f+1},d),i.css(d),e&&"static"!==e&&""!==e||a.css({position:"relative"});try{return i}finally{a=e=i=f=d=null}},unlock:function(a){a=b(a||document.body),a.children(".elem_mask").fadeOut(200,function(){b(this).remove(),a=null})},percentToInt:function(b,c){return"string"==typeof b&&b.match(/%$/)?a.parseInt(b)/100*c:b},percentToFloat:function(b,c){return"string"==typeof b&&b.match(/%$/)?a.parseFloat(b)/100*c:b},substr:function(a,b){if(!a||!b)return a||"";var c=0,d=0,e="";for(d=0;d<a.length;d+=1){if(c+=a.charCodeAt(d)>255?2:1,c>b)return e;e+=a.charAt(d)}return a},formatString:function(a){if(0===arguments.length)return null;var b,c;for(b=1;b<arguments.length;b+=1)c=new RegExp("\\{"+(b-1)+"\\}","gm"),a=a.replace(c,arguments[b]);return a},stringTemplate:function(a,b,c){if(b&&"object"!=typeof b)return a;c=c||{};var d,e;for(d in b)b.hasOwnProperty(d)&&(e=new RegExp("\\{"+d+"\\}","gm"),a=a.replace(e,c[b[d]]||b[d]||""));return a=a.replace(/\{\w+\}/g,"")},getMaxZIndex:function(a){var c,d=0;a=b(a||"body"),c=a.children(),c.each(function(){var a=b(this).css("zIndex");a=a&&!isNaN(a)?a:0,d=Math.max(d,a)});try{return d}finally{c=a=null}},getElementByMaxZIndex:function(a,c){a=b(a),c=b(c);for(var d,e,f,g,h=a[0],i=c[0];h&&h!==document.body;){for(d=h.offsetParent;d&&i&&i!==document.body;){if(e=i.offsetParent,e&&d===e){f=b(h).css("zIndex"),g=b(i).css("zIndex"),f="auto"===f?0:f,g="auto"===g?0:g;var j=-1===b(d).nextAll().index(e);return h=i=d=e=null,f>g?a:f===g&&j?a:c}i=e}i=c[0],h=d}},getCursorPosition:function(a){var b={text:"",start:0,end:0};if(a.focus(),a.setSelectionRange)b.start=a.selectionStart,b.end=a.selectionEnd,b.text=b.start!==b.end?a.value.substring(b.start,b.end):"";else if(document.selection){var c,d=document.selection.createRange(),e=document.body.createTextRange();for(e.moveToElementText(a),b.text=d.text,b.bookmark=d.getBookmark(),c=0;e.compareEndPoints("StartToStart",d)<0&&0!==d.moveStart("character",-1);c++)"\n"===a.value.charAt(c)&&c++;b.start=c,b.end=b.text.length+b.start}return b},setCursorPosition:function(a,b){if(b||alert("You must get cursor position first."),a.setSelectionRange)a.focus(),a.setSelectionRange(b.start,b.end);else if(a.createTextRange){var c=a.createTextRange();a.value.length===b.start?(c.collapse(!1),c.select()):(c.moveToBookmark(b.bookmark),c.select())}},setCursors:function(a,b,c){a.setSelectionRange?(a.focus(),a.setSelectionRange(b,c)):a.createTextRange&&(range=a.createTextRange(),range.collapse(!0),range.moveEnd("character",c),range.moveStart("character",b),range.select())},setCursor:function(a){var b=this.getCursorPosition(a);this.setCursorPosition(a,b)},batch:function(c,d,f,g,h,i){if(!b.isArray(c))return!1;f=f||0,d=d||1e3,g=g||20;var j=f*d,k=c.length,l=Math.min((f+1)*d,k),m=c.slice(j,l);b.isFunction(h)?h(m,l===k,f):a.console&&console.log("Error: tbc.batch(...). arguments[4] must be a function;"),setTimeout(function(){f+=1,k>d*f&&e.batch(c,d,f,g,h,i)},g),l===k&&b.isFunction(i)&&i.call(this)},seriesForm:function(a){var c,d=b("input,textarea,select",a),e=[],f={},g=[],h={};d.each(function(){var a=this.tagName.toLowerCase();if(this.disabled)return!0;switch(a){case"input":switch(this.type){case"checkbox":f[this.name]=f[this.name]||[],this.checked&&f[this.name].push(this.value);break;case"radio":h[this.name]=h[this.name]||[],this.checked&&h[this.name].push(this.value);break;case"button":case"reset":break;case"submit":if(!b(this).hasClass("trigger_aspnet_event"))break;default:e.push([this.name||this.id,encodeURIComponent(this.value)].join("="))}break;case"textarea":e.push([this.name||this.id,encodeURIComponent(this.value)].join("="));break;case"select":b("option",this).each(function(){this.selected&&g.push(encodeURIComponent(this.value))}),e.push([this.name||this.id,g.join(",")].join("="));break;case"button":e.push([this.name||this.id,encodeURIComponent(this.value)].join("="))}}),d=null;for(c in f)e.push([c,f[c].join(",")].join("="));for(c in h)e.push([c,h[c].join(",")].join("="));try{return e.join("&")}finally{e=h=f=g=null}},replaceUrlParam:function(a,c,d){var e=this.isObject(a)?a:function(){var b={};return b[a]=c,b}(),f=d||document.location.search;f=f.substring(f.indexOf("?")+1).split("&");var g={};return b.each(f,function(){var a=this.split("=");g[a[0]]=a[1]||""}),b.extend(g,e),g},mergerPath:function(a,b){var a=a||document.location.href;if(b.match(/^https?:\/\//)){return b}var c=a.split("?")[0].split("/");if(c.length--,!b.match(/^\/{1}/)){for(;0===b.indexOf("../");)b=b.slice(3),c.length--;b=unescape(c.join("/")+"/"+b)}return b},randomString:function(a){a=a?a-1:15;var b="0123456789abcdefghijklmnoprstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+|=-`";return function(a,b,c){return(c?arguments.callee(a,b,c-1):"")+b[a.floor(a.random()*b.length)]}(Math,b,a)},random:function(a,b){switch(arguments.length){case 1:return Math.floor(Math.random()*a+1);case 2:return Math.floor(Math.random()*(b-a+1)+a);default:return 0}},randColor:function(a){return function(a,b,c){return(c>0?arguments.callee(a,b,c-1):"#")+b[a.floor(16*a.random())]}(Math,a||["1","2","3","4","5","6","7","8","9","0","a","b","c","d","e","f"],5)},isSight:function(a){var c=b(a)[0]?b(a)[0].parentNode:a,d=this.getCoordinate(b(a)[0]),e=this.getCoordinate(b(a)[0]);if(d.top<e.top||d.top>e.bottom||d.left<e.left)return!1;try{return!0}finally{c=a=d=e=null}},inArea:function(a,b){var c=this.getCoordinate(a),d=this.getCoordinate(b);if(d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.left>c.left&&d.right<c.right&&d.top>c.top&&d.bottom<c.bottom)return!0;try{return!1}finally{a=b=c=d=null}},isIncline:function(a,b){var c=this.getCoordinate(a),d=this.getCoordinate(b);if(d.centerX=d.left+d.width/2,d.centerY=d.top+d.height/2,d.centerX>c.left&&d.centerX<c.right&&d.centerY>c.top&&d.centerY<c.bottom)return!0;try{return!1}finally{a=b=c=d=null}},isOverlap:function(a,c){var d=b.isPlainObject(a)?a:this.getCoordinate(a),e=b.isPlainObject(c)?c:this.getCoordinate(c),f=Math.max(d.left,e.left),g=Math.max(d.top,e.top),h=Math.min(d.right,e.right),i=Math.min(d.bottom,e.bottom);try{return h>f&&i>g}finally{a=c=d=e=null}},center:function(a,c,d){a=b(a),c=b(c);var e,f,g,h,i=a.width(),j=a.height(),k=a.css("left"),l=a.css("top");c.size()?(e=c.innerWidth(),f=c.innerHeight(),g=c.scrollTop(),h=c.scrollLeft()):(e=document.documentElement.clientWidth||document.documentElement.offsetWidth,f=document.documentElement.clientHeight||document.documentElement.offsetHeight,g=Math.max(document.documentElement.scrollTop,document.body.scrollTop),h=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)),k=i>e?h:e/2+h-i/2,l=j>f?g:f/2+g-j/2,a.css({top:l,left:k,width:i,height:j}),d=d||c,b.isFunction(d)&&d.call(a)},array:{unique:function(a){var b,c,d,e,f=[];for(c=0,d=a.length;d>c;c+=1){for(b=!1,e=0;e<f.length;e+=1)a[c]===f[e]&&(b=!0);b!==!0&&f.push(a[c])}try{return f}finally{f=null}},merge:function(){var a,b=arguments,c=b.length,d=[];for(a=0;c>a;a+=1)"object"==typeof b[a]&&b[a].constructor===Array&&(d=d.concat(b[a]));try{return this.unique(d)}finally{b=d=null}},clear:function(a){var b,c,d=[];for(b=0,c=a.length;c>b;b+=1)"undefined"!=typeof a[b]&&d.push(a[b]);try{return d}finally{d=null}},remove:function(a){var c=[],d=arguments;return d=e.isArray(d[1])?[1].concat(d[1]):d,b.each(a,function(a,b){var e,f,g=!1;for(e=1,f=d.length;f>e;e+=1)if(!g&&d[e]===b){g=!0;break}g||c.push(b)}),c},indexOf:function(a,b){var c,d;for(b=b&&"object"==typeof b&&b.constructor===Array?b:[],c=0,d=b.length;d>c;c+=1)if(a===b[c])return c;return-1},sort:function(a,b){var c;c=b&&"desc"===b.toLowerCase()?a.sort(this.sortASC):a.sort(this.sortDESC);try{return c}finally{c=null}},sortASC:function(a,b){return a-b},sortDESC:function(a,b){return b-a}},isNumber:function(a){return"number"==typeof a},isString:function(a){return"string"==typeof a},isFunction:function(a){return"function"==typeof a},isNull:function(a){return null===a},isBool:function(a){return"boolean"==typeof a},isArray:function(a){return!!a&&a.constructor===Array},isObject:function(a){return!!a&&a.constructor===Object},debug:{printObj:function(a,b){var c,d=["{\n"];for(c in a)a.hasOwnProperty(c)&&d.push(b?"    "+c+":"+a[c]+",\n":"    "+c+"; ");return d.push("}"),d.join("")}},log:function(b){a.console&&a.console.log(b)},st:function(){return this.st.time=(new Date).getTime(),this.st.time},et:function(){var a=(new Date).getTime(),b="tbc.et: "+(a-this.st.time);return e.log(b),a-this.st.time}},e.extend(e,f)}(window,jQuery),function(){Function.prototype.bind=Function.prototype.bind||function(){var a=this,b=arguments[0],c=Array.prototype.slice.call(arguments,1);return function(){var d=Array.prototype.concat.apply(c,arguments);return a.apply(b,d)}}}(),function(a,b){"use strict";a.Event=function(){a.self(this,arguments).extend({init:function(){return this.packageName="tbc.Event",this},eventStorage:{},REMOVE:function(a,b){if("function"==typeof b){var c,d,e=this.eventStorage[a],f=[];if("object"==typeof e&&e.constructor===Array){for(c=0,d=e.length;d>c;c+=1)e[c].toString()!==b.toString()&&f.push(e[c]);this.eventStorage[a]=f}}else this.eventStorage[a]=[]},TRIGGER:function(a,b){var c,d,e,f=this.eventStorage[a];if("object"==typeof f&&f.constructor===Array)for(e=f.length-1;e>-1;e-=1)if("function"==typeof f[e])try{if(d=f[e].apply(this,b),c=d===!1?!1:c,d===!0)return!0}catch(g){}return c===!1?!1:c},addEvent:function(a,c){var d,e,f,g,h,i=this.eventStorage;if("object"==typeof a){for(d in a)a.hasOwnProperty(d)&&this.addEvent(d,a[d]);return this}if("function"==typeof c){for(e=b.isArray(i[a])?i[a]:i[a]=[],f=!1,g=0,h=e.length;h>g;g+=1)e[g].toString()===c.toString()&&(f=!0);f||i[a].push(c)}return this},removeEvent:function(a,b){var c,d=this.eventStorage,e=new RegExp("(^|\\.)"+a.substring(a.indexOf(".")+1,a.length)+"($|\\.)");for(c in d)d.hasOwnProperty(c)&&(c===a||c.match(e))&&this.REMOVE(c,b);return d=null,this},triggerEvent:function(a){var b,c,d,e,f,g=[],h=this.eventStorage,i=new RegExp("(^|\\.)"+a.substring(a.indexOf(".")+1,a.length)+"($|\\.)");for(d=1,e=arguments.length;e>d;d+=1)g.push(arguments[d]);for(f in h)if(h.hasOwnProperty(f)&&(f===a||f.match(i))&&(c=this.TRIGGER(f,g),b=c===!1?!1:b,c===!0))return!1;return h=null,b===!1?!1:this}})}}(tbc,jQuery),function(a,b){"use strict";a.TASK_DEPOT=a.TASK_DEPOT||{},a.TASK_DEPOT_COUNT=a.TASK_DEPOT_COUNT||0,a.guid=a.guid||0,a.TASKS=function(b,c){return b?!c||a.TASK_DEPOT[b]?a.TASK_DEPOT[b]||null:(a.TASK_DEPOT[b]=c,a.TASK_DEPOT_COUNT+=1,void 0):null},a.TASKS.set=function(a,b){this(a,b)},a.TASKS.get=function(a){return this(a)},a.TASKS.del=function(b){var c,d,e=a.TASK_DEPOT[b];if(b&&e){try{e.container&&a.TASK_DEPOT[b].container.empty().remove(),e.ui&&a.TASK_DEPOT[b].ui.empty().remove()}catch(f){}c=e.DEPENDS||[],a.TASKS.killAll(c);for(d in e)e.hasOwnProperty(d)&&delete a.TASK_DEPOT[b][d];e=null,delete a.TASK_DEPOT[b]}},a.TASKS.killAll=function(b){if("array"==typeof b&&b.length>0){var c,d,e;for(c in a.TASK_DEPOT)if(a.TASK_DEPOT.hasOwnProperty(c)&&a.TASK_DEPOT[c].DEPENDS)for(d=0,e=b.length;e>d;d++)b[d]===c&&a.TASK_DEPOT[c].DESTROY()}},a.getTaskByElement=function(c){var d=b(c).attr("tbc");return d=d||b(c).parents("[tbc]:first").attr("tbc"),a.TASKS(d)},a.ClassManager=function(){a.self(this,arguments).extend({DEPENDS:[],depend:function(b){return a.isArray(b.DEPENDS)&&b.DEPENDS.push(this.guid),this},dependSelf:function(a){var b="object"==typeof a?a.guid:a;return this.DEPENDS.push(b),this},undepend:function(b){return b&&a.isArray(b.DEPENDS)&&(b.DEPENDS=a.array.remove(b.DEPENDS,this.guid)),this},undependSelf:function(b){var c="object"==typeof b?b.guid:b;return this.DEPENDS=a.array.remove(this.DEPENDS,c),this},INIT:function(){var b=this.constructor;return this.packageName="tbc.ClassManager",b.maxid=b.maxid||0,b.maxid=b.maxid+1,this.iid=b.maxid,b.count=b.count&&!isNaN(b.count)?b.count+1:1,a.guid+=1,this.guid=a.guid,b.instance=b.instance||{},this.CREATE_TIME=(new Date).getTime(),this.INIT_INSTANCE(),this.INSTANCE(this.iid,this),a.TASKS(this.guid,this),this},DESTROY:function(){var b=this.guid,c=this.iid;this.INSTANCE(c,"del"),this.triggerEvent("destroy"),a.TASKS.del(b,!1),b=c=null},INSTANCE:function(a,b){if(!a)return null;if("del"===b&&this.constructor.instance[a])delete this.constructor.instance[a],this.constructor.count=this.constructor.count-1;else{if(!b||this.constructor.instance[a])return this.constructor.instance[a]||null;this.constructor.instance[a]=b}return this},INIT_INSTANCE:function(){this.INSTANCE.get=function(a){return this(a)},this.INSTANCE.set=function(a,b){this(a,b)},this.INSTANCE.del=function(a){this(a,"del")}}}).INIT()}}(tbc,jQuery),function(a,b){"use strict";a.Accordion=function(c){var d={height:320,header:".tbc-accordion-header",container:null,itemHeader:".tbc-accordion-itemHeader",itemContainer:".tbc-accordion-itemContainer",currentCss:"current",active:0,event:{titleClick:function(){},active:function(){},retire:function(){}}},e=a.extend({},d,c);e.height=e.height&&"auto"!==e.height?e.height:356,a.self(this,arguments).extend({init:function(){var a=this;this.addEvent(e.event),this.packageName="tbc.Accordion",e.container?(this.ui=b(e.container),this.container=this.ui):(this.ui=b('<div class="tbc-accordion"></div>'),this.container=this.ui),this.ui.height(e.height),this.crimpleAll(),setTimeout(function(){a.setCurrent(e.active,!0)},100),this.ui.delegate(e.itemHeader,"click touchend dblclick",function(){var c=b(this).prevAll(e.itemHeader).size();a.setCurrent(c)})},getSize:function(){return this.container.children(e.header).size()},appendTo:function(a){var c=b(a);return c.size()&&c.append(this.ui),this},append:function(a){return a.header&&a.container?this.appendItem.apply(this,arguments):this.container.append(a),this},appendItem:function(a){return a.header&&a.container&&(a.container.hide(),this.container.append(a.header.addClass("tbc-accordion-itemHeader")).append(a.container.addClass("tbc-accordion-itemContainer"))),this},prepend:function(a){return a.header&&a.container?this.prependItem.apply(this,arguments):this.container.prepend(a),this},prependItem:function(a){return a.header&&a.container&&(a.container.hide(),this.container.prepend(a.container.addClass("tbc-accordion-itemContainer")).prepend(a.header.addClass("tbc-accordion-itemHeader"))),this},removeItem:function(a){var c,d;return a&&!isNaN(a)?(c=this.container.children(e.itemHeader).eq(a),d=c.next(e.itemContainer),c.remove(),d.remove()):"string"==typeof a&&(this.container.children(e.itemHeader).each(function(){return-1!==this.innerHTML.indexOf(a)?(c=b(this),!1):void 0}),d=c.next(e.itemContainer),c.remove(),d.remove()),c=d=null,this},getAll:function(){var a,c,d=[],f=this.container.children(e.itemHeader);for(a=0,c=f.length;c>a;a+=1)d.push({header:b(f[a]),container:b(f[a]).next(e.itemContainer)});try{return d}finally{d=f=null}},crimpleAll:function(){var a=this.container,b=a.children(e.itemHeader),c=a.children(e.itemContainer);return b.removeClass(e.currentCss),c.slideUp(),this},getCurrent:function(){var a=this.container.children(e.itemHeader).filter("."+e.currentCss),b=a.next(e.itemContainer);try{return a.size()?{header:a,container:b}:null}finally{a=b=null}},setCurrent:function(a,b){if(a=0!==a&&a?a:0,b||!this.isCurrent(a)){var c=this,d=this.getCurrent(),f=this.findItem(a);d&&f&&(d.header.removeClass(e.currentCss),d.container.stop().animate({height:0},300,function(){d.container.hide(),c.triggerEvent("retire",d),d=null})),f&&(f.header.addClass(e.currentCss),f.container.show().stop().animate({height:this.getAvailableHeight()},300,function(){f.container.css({overflow:"auto",position:""}),c.triggerEvent("active",f),f=null}))}return this},isCurrent:function(a){var b=this.findItem(a);return b&&b.header.hasClass(e.currentCss)},findItem:function(a){var b,c,d,e=this.getAll();if(0===a||a&&!isNaN(a))b=e[a];else for(c=0,d=e.length;d>c;c+=1)if(-1!==e[c].header.innerHTML.indexOf(a)){b=e[c];break}try{return b}finally{e=b=null}},getHeight:function(){return this.container.innerHeight()},setHeight:function(a){var b=this.getHeadersHeight();return this.getCurrent().container.css({height:a-b}),this.ui.css({height:a}),this.trigerEvent("resize",a),this},getAvailableHeight:function(){var a=this.getHeight(),b=this.getHeadersHeight();return a-b},setAvailableHeight:function(a){var b=this.getHeadersHeight();return this.ui.css({height:a+b}),this.getCurrent().container.css({height:a}),this.trigerEvent("resize",a+b),this},getHeadersHeight:function(){var a,c,d=0,f=this.container.children(e.itemHeader);for(a=0,c=f.length;c>a;a+=1)d+=b(f[a]).outerHeight();try{return d}finally{d=f=a=c=null}}}).init()}}(tbc,jQuery),function(a,b){"use strict";a.accordionSelector=function(c){var d,e,f=a.self(this,arguments),g={autoSelect:!0,container:null,includeChild:!1,multiple:!0,height:356,treeOptions:{},accordionOptions:{},items:[{title:"部门",type:"ajax",nodeType:"ORGANIZATION",content:"",active:!0,options:{}},{title:"岗位",type:"ajax",nodeType:"POSITION_CATEGORY",content:"",options:{}},{title:"群组",type:"ajax",nodeType:"GROUP_CATEGORY",content:"",options:{}}],event:{}},h=a.extend({},g,c),i=0;f.packageName="tbc.orgSelector",f.addEvent(h.event),h.container?(f.container=b(h.container),f.ui=h.ui?b(h.ui):f.container):(f.container=b('<div class="tbc-orgSelector"></div>'),f.ui=h.ui?b(h.ui):f.container),e=f.container.css("position"),"position"!==e&&"fixed"!==e&&f.container.css("position","relative"),h.accordionOptions=b.extend({height:h.height},h.accordionOptions),d=new a.Accordion(h.accordionOptions),f.accordion=d,d.depend(f),d.appendTo(f.container),d.addEvent({active:function(c){var d,e,g,i,j;try{f.includeChild=c.header.find("[name^='includeChild']")[0].checked}catch(k){}if(c&&c.container)if(c.container.data("rendered")||c.container.data("rendering")){if(h.autoSelect!==!1){if(d=c.container.data("treeId"),e=a.TASKS(d),!e)return;e.setCurrent()}}else i=c.container.data("options"),"ajax"===i.type&&"string"==typeof i.content?(j=b("<div/>").html("loading...").css({margin:"1em",textAlign:"center"}).appendTo(c.container),g=b.extend({},i.treeOptions,{nodeType:i.nodeType,url:i.content,container:c.container,lazyLevel:3,param:{nodeType:i.nodeType}}),e=new a.Tree(g),e.depend(f),e.addEvent({afterRender:function(){var b=this;h.autoSelect!==!1&&setTimeout(function(){b.setCurrent()},100),j.remove(),a.unlock(c.container),c.container.data("rendering",!1),f.triggerEvent("afterLoad",c),j=c=null},select:function(a,b,c,d){f._selected=a,f.triggerEvent("select",a,a.tp||a.nodeType,d),f.triggerEvent("selected",a,a.tp||a.nodeType,d)},deselect:function(a){return f.triggerEvent("deselect",a)},beforeLoad:function(){a.lock(c.container,10)},afterLoad:function(){a.unlock(c.container,10)}}),c.container.data("treeId",e.guid),setTimeout(function(){e.load(),e=null},1)):"object"==typeof i.content&&c.container.append(i.content),c.container.data("rendered",!0);f.triggerEvent("active",c)}}),f.extend({appendTo:function(a){b(a).size()&&this.ui.appendTo(a)},prependTo:function(a){b(a).size()&&this.ui.prependTo(a)},getCurrent:function(){return this.accordion.getCurrent()},getSelected:function(){return this._selected}}),b.each(h.items,function(a){var c,e,g,j=b('<h3 class="tbc-accordion-itemHeader"/>').html(this.title).appendTo(f.container),k=b('<div class="tbc-accordion-itemContainer"/>').appendTo(f.container).hide(),l=this.icon?this.icon.match(/(jpg|jpeg|png|gif|bmp)/)?'<i class="tbc-icon"><img src="'+this.icon+'"/></i>':'<i class="tbc-icon '+this.icon+'"></i>':null;l&&j.prepend(l),e=this.includeChild||h.includeChild&&"ORGANIZATION"===this.nodeType||c,g=b('<div class="tbc-accordion-includeChild"></div>').html('<input type="checkbox" name="includeChild_'+a+'" '+(e?' checked="checked" ':"")+' /><label for="includeChild_'+a+'">包含子类</label>'),"undefined"!=typeof e?g.hide().css({display:"block"}):g.show().css({display:"none"}),g.find("[name='includeChild_"+a+"']").click(function(){f.includeChild=this.checked,f.triggerEvent("includechild",this.checked)}),j.append(g),k.data("options",this),d.appendItem({header:j,container:k}),j=k=l=null,this.active&&(i=a)}),d.setCurrent(i)}}(tbc,jQuery),function(a,b){"use strict";a.dialog=function(c,d){if(c&&c instanceof Object&&!c.size&&(d=c,c=d.html),!(this instanceof a.dialog))return new a.dialog(c,d);var e=a.extend({name:"提示",width:320,height:190,scrolling:!1,target:"body",modal:!0},d);return a.self(this,arguments).extend([a.Panel,e],{initDialog:function(){var a,d,f=this,g=b('<div style="overflow:auto;"></div>'),h=[];if(g.append(c||e.html),this.append(g),e.buttons instanceof Object){for(d in e.buttons)e.buttons.hasOwnProperty(d)&&h.push('<button class="tbc-button" data-type="'+d+'">'+d+"</button>");h.length>0&&(a=b('<div style="text-align:right; padding:10px; background-color:#f6f6f6;"></div>'),a.html(h.join(""))),a.on("click","button",function(){var a=this.getAttribute("data-type"),c=e.buttons[a];b.isFunction(c)&&c.call(f)}),this.container.css({overflow:"hidden"}),this.append(a)}return this.container=g,this.show(),this.initModal(),this.addEvent({close:function(){var a=this.mask;a&&b.isFunction(a.fadeOut)&&a.fadeOut(function(){a.remove()})},resize:function(c){var d,e=this.part.header.height(),f=this.part.footer.height();d=a&&b.isFunction(a.height)?c.height-e-f-a.outerHeight():"100%",g.height(d)}}),this},initModal:function(){var a=this;e.modal&&(this.mask=b('<div class="tbc-mask"/>').css({position:"absolute",zIndex:(this.ui.css("zIndex")||1)-1,backgroundColor:"#000",opacity:.2,left:0,top:0,width:"100%",height:"100%"}).insertBefore(this.ui).bind("click",function(){a.flash()}))}}).initDialog().triggerEvent("resize",e),this},a.confirm=function(c,d,e){var f={};return e=e instanceof Object?e:{},f[e.verifyText||"确认"]=function(){b.isFunction(d)&&d.call(this),this.close()},f[e.cancelText||"取消"]=function(){this.close()},e.buttons=f,e.name=e.name||e.title||"请您确认",c=b('<div style="padding:24px;"></div>').empty().append(c),a.dialog(c,e)},a.alert=function(c,d,e){var f={};return e=e instanceof Object?e:{},f[e.verifyText||"确认"]=function(){b.isFunction(d)&&d.call(this),this.close()},e.buttons=f,e.name=e.name||e.title||"提示",c=b('<div style="padding:24px;"></div>').append(c),a.dialog(c,e)}}(window.tbc,window.jQuery,window.URLS),tbc.Button=function(a){var b=tbc.self(this,arguments);b.extend(tbc.Event),b.extend(tbc.ClassManager),b.packageName="tbc.Button";var c={border:!0,icon:null,text:"按钮",click:null,target:null},d=tbc.extend({},c,a);b.ui=$('<button class="">        <span class="tbc-icon icon-application_windows_add"><img src="" onerror="this.style.display=\'none\'" style="width:16px; height:16px;"/></span>        <span class="tbc-button-text"></span>    </button>').addClass(d.border?"tbc-button":"tbc-button-link");var e=b.ui.find("img"),f=b.ui.find(".tbc-button-text");b.icon=function(a){return a&&"string"==typeof a?(a.match(/\.(jpg|jpeg|gif|png|img|bmp|ico)$/)||-1!==a.indexOf("sf-server/file/getFile/")?e.show().attr("src",a).parent().removeAttr("class").addClass("tbc-icon"):e.hide().parent().removeAttr("class").addClass("tbc-icon").addClass(a),b):d.icon},b.text=function(a){return a&&"string"==typeof a?(f.html(a),d.text=a,b):d.text},b.disable=function(){return b.disabled=!0,b.ui.addClass("tbc-button-disabled"),b.triggerEvent("disable"),b},b.enable=function(){return b.disabled=!1,b.ui.removeClass("tbc-button-disabled"),b.triggerEvent("enable"),b},b.click=function(){return b.disabled||($.isFunction(d.click)&&d.click.call(b),b.triggerEvent("click")),b},b.appendTo=function(a){return a=a&&a.container?a.container:a,b.ui.appendTo(a),b.triggerEvent("append",a),b},b.remove=function(){b.ui.remove(),b.triggerEvent("remove")},b.icon(d.icon),b.text(d.text),b.appendTo(d.target),b.ui.click(function(){b.click()})},function(a,b){"use strict";b("html,body").css({overflow:"hidden",background:"transparent"}),a.blendSelector=function(c){function d(a,b){var c=h.ui.find(".searchKeywords");b&&0!==b.length&&b!==c[0].title?"0"===a?(h._ajaxDataAvailable.keyword=b,h._ajaxDataSelected.keyword=""):"1"===a&&g.itemSelectorOptions.autoSave!==!1&&g.itemSelectorOptions.lazy!==!0&&(h._ajaxDataAvailable.keyword="",h._ajaxDataSelected.keyword=b):(h._ajaxDataAvailable.keyword="",h._ajaxDataSelected.keyword=""),h.pageSelected(1),h.pageAvailable(1)}var e=a.self(this,arguments),f={max:0,title:"选择人员",verifyButton:!0,cancelButton:!0,verifyText:"确定",cancelText:"取消"},g=a.extend({},f,c);e.addEvent(g.event),e.packageName="tbc.blendSelector",e.ui=b('<div class="tbc-blendSelector"></div>').html('<div role="header" class="tbc-blendSelector-header"><h3>请选择人员</h3><span role="tips"><i class="tbc-icon icon-info"></i>友情提醒:转入”已选人员“的名单即时生效,系统自动保存</span> </div><div role="org" class="tbc-blendSelector-organize"></div><div role="items" class="tbc-blendSelector-items"></div><div style="clear:both;"></div><div role="footer" class="tbc-blendSelector-footer">    <a role="verify" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(g.verifyText||"确定")+"</span></a>"+'    <a role="cancel" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(g.cancelText||"取消")+"</span></a>"+"</div>"),e.container=e.ui,e.part={},e.ui.find("[role]").each(function(){var a=this.getAttribute("role");e.part[a]=b(this)}),g.itemSelectorOptions=b.extend({},g.itemSelectorOptions,{vauleSetFormater:function(a){var b,c={};for(b in a)if(a.hasOwnProperty(b))switch(b){case"nm":case"text":c.nm=a.nm||a.text,c.text=a.nm||a.text;break;case"selected":c[b]=a[b]||this._cache.selected.names[a.id]?" checked":"";break;case"rnm":c[b]=a[b]?" ("+a[b]+")":"";break;case"icn":c[b]=a[b]?" ("+a[b]+")":"";break;default:c[b]=a[b]}c.selected=a.selected||this._cache.selected.names[a.id]?" checked":"";try{return c}finally{c=null}}}),g.orgSelectorOptions=b.extend(g.orgSelectorOptions||{},{height:365});var h=new a.itemSelector(g.itemSelectorOptions),i=new a.accordionSelector(g.orgSelectorOptions);h.prepend('<div class="tbc-itemSelector-header">    <div class="padding">        <select name="accountStatus">            <option value="ALL" selected="selected">全部人员</option>            <option value="ENABLE">激活人员</option>            <option value="FORBIDDEN">冻结人员</option>        </select>        <div class="abs_right">            <input type="text" value="工号/姓名/用户名" title="工号/姓名/用户名" class="tbc-inputer searchKeywords">            <select name="which">                <option value="0">待选人员</option>                <option value="1">已选人员</option>            </select>            <a class="tbc-button searchButton" type="button">筛选</a>        </div>     </div></div>'),(g.itemSelectorOptions.autoSave===!1||g.itemSelectorOptions.lazy===!0)&&e.part.tips.hide(),h.addEvent({beforeSave:function(){return a.lock(e.ui),!1},afterSave:function(){return a.unlock(e.ui),!1}}),h.ui.find("select[name='accountStatus']").val(g.accountStatus).change(function(){h._ajaxDataAvailable.accountStatus=this.value,h._ajaxDataSelected.accountStatus=this.value,h.pageAvailable()}),g.accountStatus&&(h._ajaxDataAvailable.accountStatus=g.accountStatus,h._ajaxDataSelected.accountStatus=g.accountStatus),(g.accountStatus||g.accountStatus&&"all"!==g.accountStatus.toLowerCase())&&h.ui.find("select[name='accountStatus']").hide(),h.ui.find(".searchKeywords").keyup(function(a){var c=b.trim(this.value);c!==this.title&&(h._ajaxDataAvailable.keyword=c,h._ajaxDataSelected.keyword=c),13===a.keyCode&&h.ui.find(".searchButton").trigger("click")}).focus(function(){var a=b.trim(this.value);a===this.title&&(this.value="")}).blur(function(){var a=b.trim(this.value);""===a&&(this.value=this.title)}),h.ui.find("select[name='which']").change(function(){var a=this.value,b=h.ui.find(".searchKeywords").val();d(a,b)}),h.ui.find(".searchButton").click(function(a){a.preventDefault();var b=h.ui.find("select[name='which']").val(),c=h.ui.find(".searchKeywords").val();d(b,c)}),g.itemSelectorOptions.deletable===!1&&(b(h.part.removeAll).hide(),b(h.part.operaRemoveSelected).attr("disabled","disabled").addClass("tbc-button-disabled"),b(h.part.operaRemoveCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled")),h.depend(e),i.depend(e),h.appendTo(e.part.items),i.appendTo(e.part.org),i.addEvent({select:function(a,b){h._ajaxDataAvailable.nodeType=b,h._ajaxDataAvailable.nodeId=a.id,h.pageAvailable(1)},includechild:function(a){h._ajaxDataAvailable.includeChild=a}}),e.extend({append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},close:function(){e.triggerEvent("close"),this.DESTROY()},getSelected:function(){var a,b=h._cache.selected.names,c=[];for(a in b)b.hasOwnProperty(a)&&c.push(b[a]);return c}}),g.verifyButton||e.part.verify.hide(),g.cancelButton||e.part.cancel.hide(),e.part.verify.click(function(){var c=e.getSelected(),d=g.itemSelectorOptions.autoSave,f=g.itemSelectorOptions.lazy,h=[];if("undefined"!=typeof d&&d!==!0||f!==!0||!g.lazyUrl)e.triggerEvent("verify",c)!==!1&&(e.ui.remove(),e.close());else{b.each(c,function(){h.push(this.userId)});var i=g.itemSelectorOptions.post||{};i[g.itemSelectorOptions.postKey||"userIds"]=h.join(","),b.ajax({url:g.lazyUrl,data:i,type:"post",dataType:"json",beforeSend:function(){a.lock(e.ui)},complete:function(){a.unlock(e.ui)},success:function(){e.triggerEvent("verify",c)!==!1&&(e.ui.remove(),e.close())}}),i=null}}),e.part.cancel.click(function(){var a=e.getSelected();e.triggerEvent("cancel",a)!==!1&&(e.ui.remove(),e.close())
})}}(tbc,jQuery),function(a,b){"use strict";a("html,body").css({overflow:"hidden",background:"transparent"}),b.CourseSelector=function(c){var d,e,f,g={selectButtons:function(){}},h=b.extend({},g,c),i=b.self(this,arguments);i.addEvent(h.event),i.packageName="tbc.CourseSelector",i.ui=a('<div class="tbc-blendSelector tbc-courseSelector"></div>').html('<div role="header" class="tbc-blendSelector-header"><h3>请选择资源</h3><span role="tips"><i class="tbc-icon icon-info"></i>友情提醒:转入”已选“栏的选项即时生效,系统自动保存</span> </div><div role="org" class="tbc-blendSelector-organize"></div><div role="items" class="tbc-blendSelector-items"></div><div style="clear:both;"></div><div role="footer" class="tbc-blendSelector-footer">    <a role="verify" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(h.verifyText||"确定")+"</span></a>"+'    <a role="cancel" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(h.cancelText||"取消")+"</span></a>"+"</div>"),i.container=i.ui,i.part={},i.ui.find("[role]").each(function(){var b=this.getAttribute("role");i.part[b]=a(this)}),(h.itemSelectorOptions.autoSave===!1||h.itemSelectorOptions.lazy===!0)&&i.part.tips.hide(),h.itemSelectorOptions=a.extend({},h.itemSelectorOptions,{isOrganize:!0,textTransform:{COURSE:"[课] ",SUBJECT:"[专题] "},post:h.post,itemTemplate:'<li data-id="{id}" title="{title}" class="{selected} {checked}"><i>{title}</i></li>',dataTemplate:{id:"id",text:"title",title:"title"},itemTemplateSelected:'<li data-id="{id}" title="{title}"><i>{type}{title}</i></li>',vauleSetFormater:function(a){var b,c=(e.getCurrent().container.data("options").nodeType,{});for(b in a)if(a.hasOwnProperty(b))switch(b){case"type":c.type=a.type||"COURSE";break;case"nm":case"text":case"title":c.nm=a.nm||a.text||a.title,c.text=a.nm||a.text||a.title,c.title=a.nm||a.text||a.title;break;case"selected":c[b]=a[b]||this._cache.selected.names[a.id]?" checked":"";break;default:c[b]=a[b]}try{return c}finally{c=null}},postFormater:function(a){var b,c,d,e=[];for(c=0,d=a.length;d>c;c+=1)b=a[c].tp||"COURSE",e.push([b,a[c].id].join(":"));return e.join(",")},itemDataFormater:function(a){var b,c,d=e.getCurrent().container.data("options").nodeType;for(e.getSelected()||{},b=0,c=a.length;c>b;b+=1)switch(a[b].tp||d){case"SUBJECT":a[b].tp=a[b].type||"SUBJECT",a[b].nm=a[b].title,delete a[b].rid,delete a[b].rnm;break;default:a[b].tp=a[b].type||"COURSE",a[b].nm=a[b].title}return a}}),h.orgSelectorOptions=a.extend({},h.orgSelectorOptions,{autoSelect:!1}),f=h.itemSelectorOptions.dataTemplate,h.orgSelectorOptions=a.extend(h.orgSelectorOptions||{},{height:365}),d=new b.itemSelector(h.itemSelectorOptions),e=new b.accordionSelector(h.orgSelectorOptions),d.prepend('<div class="tbc-itemSelector-header"><div class="padding">   <div class="abs_right">        <input type="text" value="输入课程编号或名称" title="输入课程编号或名称" class="tbc-inputer searchKeywords">        <select name="device" style="display:'+(h.itemSelectorOptions.device!==!1?"":"none")+';">'+'            <option value="">全部终端</option>'+'            <option value="COMPUTER">PC</option>'+'            <option value="IPHONE">iPhone</option>'+'            <option value="IPAD">iPad</option>'+'            <option value="ANDROIDPHONE">Android</option>'+'            <option value="ANDROIDPAD">Android Pad</option>'+"        </select>"+'        <a class="tbc-button searchButton" type="button">筛选</a>'+"    </div>"+"</div>"+"</div>"),d.addEvent({beforeSave:function(){return b.lock(i.ui),!1},afterSave:function(){return b.unlock(i.ui),!1}}),d.ui.on("click",".searchButton",function(){var b=d.ui.find("input.searchKeywords"),c=b.val(),e=d.ui.find("select[name='device']").val();a.trim(c)!==b.attr("title")?d._ajaxDataAvailable.keyword=c:delete d._ajaxDataAvailable.keyword,h.itemSelectorOptions.device!==!1?d._ajaxDataAvailable.device=e:delete d._ajaxDataAvailable.device,d.pageAvailable(1)}),d.ui.find("input.searchKeywords").bind({focus:function(){a.trim(this.value)===this.title&&(this.value="")},blur:function(){""===a.trim(this.value)&&(this.value=this.title)}}),i.extend({appendTo:function(){}}),d.depend(i),e.depend(i),a(d.part.addAll).hide(),h.itemSelectorOptions.deletable===!1&&(a(d.part.removeAll).hide(),a(d.part.operaRemoveSelected).attr("disabled","disabled").addClass("tbc-button-disabled"),a(d.part.operaRemoveCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled")),d.appendTo(i.part.items),d.loadAvailableByPage(1),e.appendTo(i.part.org),e.addEvent({afterLoad:function(a){var c=(a.container.data("options"),a.container.data("treeId")),d=b.TASKS(c);d&&"function"==typeof d.setCurrent&&d.setCurrent()},active:function(a){var c=(a.container.data("options"),a.container.data("treeId")),d=b.TASKS(c);d&&"function"==typeof d.setCurrent&&d.setCurrent()},check:function(a){var b,c,f,g,h;for(this.getCurrent().container.data("options").nodeType,b=0,c=a.length;c>b;b+=1)f=e.includeChild?"含子类":"",g=a[b].property,h=[{id:g.id,tp:g.tp,nm:g.nm||g.text,ic:e.includeChild,icn:f,rnm:""}],g.id&&!d._cache.available.names[g.id]&&d.addAvailableItem(h)},deselect:function(a){var b,c;for(b=0,c=a.length;c>b;b+=1)d.removeAvailableItem(a[b].property.id)},select:function(a,b){d._ajaxDataAvailable.nodeType=b,d._ajaxDataAvailable.nodeId=a.id,d.loadAvailableByPage(1)},includechild:function(a){d._ajaxDataAvailable.includeChild=a}}),d.addEvent({select:function(){var a=e.getCurrent();a.container.data("options")},beforeAvailableLoad:function(){var a=e.getCurrent();a.container.data("options")}}),i.extend({append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},close:function(){i.triggerEvent("close"),this.DESTROY()},getSelected:function(){var a,b=d._cache.selected.names,c=[];for(a in b)b.hasOwnProperty(a)&&b[a]&&c.push(b[a]);return c}}),h.verifyButton||i.part.verify.hide(),h.cancelButton||i.part.cancel.hide(),i.part.verify.click(function(){var c,d=i.getSelected(),e=h.itemSelectorOptions.autoSave,f=h.itemSelectorOptions.lazy;e!==!1&&f===!0&&h.lazyUrl?(c=h.itemSelectorOptions.post||{},c[h.itemSelectorOptions.postKey||"courseIds"]=h.itemSelectorOptions.postFormater(d),a.ajax({url:h.lazyUrl,data:c,type:"post",dataType:"json",beforeSend:function(){b.lock(i.ui)},complete:function(){b.unlock(i.ui)},success:function(){i.triggerEvent("verify",d)!==!1&&(i.ui.remove(),i.close())}}),c=null):i.triggerEvent("verify",d)!==!1&&(i.ui.remove(),i.close())}),i.part.cancel.click(function(){var a=i.getSelected();i.triggerEvent("cancel",a)!==!1&&(i.ui.remove(),i.close())})}}(jQuery,tbc),$("html,body").css({overflow:"hidden",background:"transparent"}),tbc.organizationSelector=function(a){var b=tbc.self(this,arguments),c={},d=tbc.extend({},c,a);b.addEvent(d.event),b.packageName="tbc.organizationSelector",b.ui=$('<div class="tbc-blendSelector tbc-organizationSelector"></div>').html('<div role="header" class="tbc-blendSelector-header"><h3>请选择组织</h3><span role="tips"><i class="tbc-icon icon-info"></i>友情提醒:转入”已选“栏的选项即时生效,系统自动保存</span> </div>		<div role="org" class="tbc-blendSelector-organize"></div>		<div role="items" class="tbc-blendSelector-items"></div>		<div style="clear:both;"></div>		<div role="footer" class="tbc-blendSelector-footer">			<a role="verify" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(d.verifyText||"确定")+'</span></a>			<a role="cancel" class="tbc-button tbc-button-blue" type="button"><span class="tbc-text">'+(d.cancelText||"取消")+"</span></a>		</div>	"),b.container=b.ui,b.part={},b.ui.find("[role]").each(function(){var a=this.getAttribute("role");b.part[a]=$(this)}),(d.itemSelectorOptions.autoSave===!1||d.itemSelectorOptions.lazy===!0)&&b.part.tips.hide(),d.itemSelectorOptions=$.extend({},d.itemSelectorOptions,{isOrganize:!0,textTransform:{ORGANIZATION:"[部] ",POSITION:"[岗] ",POSITION_CATEGORY:" ",GROUP:"[群] ",GROUP_CATEGORY:" "},post:d.post,itemTemplate:'<li data-id="{id}" title="{np}"><i>{nm}</i></li>',itemTemplateSelected:'<li data-id="{id}" title="{np}"><i>{tp}{nm}{parentheses1}{rnm}{icn}{parentheses2}</i></li>',dataTemplate:{id:"id",text:"nm",title:"np"},vauleSetFormater:function(a){var b=(g.getCurrent().container.data("options").nodeType,{});for(var c in a)switch(c){case"nm":case"text":b.nm=a.nm||a.text,b.text=a.nm||a.text;break;case"selected":b[c]=a[c]||this._cache.selected.names[a.id]?" checked":"";break;case"rnm":b[c]=a[c]?a[c]:"";break;case"icn":b[c]=a[c]?a[c]:"";break;default:b[c]=a[c]}try{return b}finally{b=null}},postFormater:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push([a[c].ic,a[c][e.id],a[c].tp||"ORGANIZATION",a[c].rid].join(":"));return b.join(",")},itemDataFormater:function(a){for(var b=g.getCurrent().container.data("options").nodeType,c=g.getSelected()||{},d=0,e=a.length;e>d;d++)switch(a[d].tp||b){case"POSITION":a[d].rnm=a[d].rnm||c.nm||c.text,a[d].rid=a[d].rid||c.id,a[d].tp=a[d].tp||"POSITION",a[d].rnm&&(a[d].parentheses1=" (",a[d].parentheses2=")"),a[d].ic=g.includeChild,a[d].ic&&(a[d].parentheses1=" (",a[d].parentheses2=")");break;case"ORGANIZATION":a[d].tp=a[d].tp||"ORGANIZATION",delete a[d].rid,delete a[d].rnm,a[d].ic&&(a[d].parentheses1=" (",a[d].parentheses2=")");break;case"GROUP":}return a}}),d.orgSelectorOptions=$.extend({},d.orgSelectorOptions,{autoSelect:!1,height:365});var e=d.itemSelectorOptions.dataTemplate,f=new tbc.itemSelector(d.itemSelectorOptions),g=new tbc.accordionSelector(d.orgSelectorOptions);f.addEvent({beforeSave:function(){return tbc.lock(b.ui),!1},afterSave:function(){return tbc.unlock(b.ui),!1}}),b.extend({appendTo:function(){}}),f.depend(b),g.depend(b),$(f.part.operaAddCurrPage).hide(),$(f.part.operaRemoveCurrPage).hide(),$(f.part.operaRemoveCurrPage).hide(),$(f.part.addAll).hide(),$(f.part.availContainer).parent().hide(),$(f.part.selectedContainer).parent().css({width:410}),d.itemSelectorOptions.deletable===!1&&($(f.part.removeAll).hide(),$(f.part.operaRemoveSelected).attr("disabled","disabled").addClass("tbc-button-disabled"),$(f.part.operaRemoveCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled")),f.appendTo(b.part.items),f.loadAvailableByPage(1),g.appendTo(b.part.org),g.addEvent({afterLoad:function(a){var b=a.container.data("options");if("POSITION"===b.nodeType){var c=a.container.data("treeId"),d=tbc.TASKS(c);d&&d.setCurrent()}},active:function(a){var b=a.container.data("options");if("POSITION"===b.nodeType){var c=$(f.part.selectedContainer).parent();c.outerWidth(),$(f.part.selectedContainer).parent().css({width:203}),c.css({width:203}).show(),$(f.part.availContainer).parent().show()}else{var d=$(f.part.availContainer).parent();d.hide(),d.find("li.selected").removeClass("selected"),$(f.part.selectedContainer).parent().css({width:418})}if("POSITION"===b.nodeType){var e=a.container.data("treeId"),g=tbc.TASKS(e);g&&g.setCurrent()}f.clearAvailable()},check:function(a){this.getCurrent().container.data("options").nodeType;for(var b=0,c=a.length;c>b;b++){var d=g.includeChild?"含子类":"",e=a[b].property,h=[{id:e.id,tp:e.tp,nm:e.nm||e.text,ic:g.includeChild,icn:d,rnm:""}];e.id&&!f._cache.available.names[e.id]&&f.addAvailableItem(h)}},deselect:function(a){for(var b=0,c=a.length;c>b;b++)f.removeAvailableItem(a[b].property.id)},select:function(a,b){f._ajaxDataAvailable.nodeType=b,f._ajaxDataAvailable.nodeId=a.id;var c=this.getCurrent().container.data("options").nodeType;if(a.tp===c||!a.tp&&"POSITION"!==c||"ORGANIZATION"===c||"GROUP"===c&&"GROUP"===a.tp)if("POSITION"===a.tp);else{var d,e;a.tp&&"ORGANIZATION"!==a.tp?e=[{id:a.id,tp:a.tp,nm:a.nm||a.text,ic:g.includeChild,rnm:""}]:(d=g.includeChild?"含子类":"",e=[{id:a.id,tp:a.tp,nm:a.nm||a.text,ic:g.includeChild,icn:d,rnm:""}]),f.addAvailableItem(e)}else"POSITION"===c&&f.loadAvailableByPage(1)},includechild:function(a){f._ajaxDataAvailable.includeChild=a}}),f.addEvent({select:function(){var a=g.getCurrent(),b=a.container.data("options");"POSITION"!==b.nodeType&&this.clearAvailable()},beforeAvailableLoad:function(){var a=g.getCurrent(),b=a.container.data("options");return"POSITION"!==b.nodeType?!1:void 0}}),b.extend({append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},close:function(){b.triggerEvent("close"),this.DESTROY()},getSelected:function(){var a=f._cache.selected.names,b=[];for(var c in a)c&&a[c]&&b.push(a[c]);return b}}),d.verifyButton||b.part.verify.hide(),d.cancelButton||b.part.cancel.hide(),b.part.verify.click(function(){var a=b.getSelected(),c=d.itemSelectorOptions.autoSave,e=d.itemSelectorOptions.lazy;if(c!==!1&&e===!0&&d.lazyUrl){var f=d.itemSelectorOptions.post||{};f[d.itemSelectorOptions.postKey||"orgIds"]=d.itemSelectorOptions.postFormater(a),$.ajax({url:d.lazyUrl,data:f,dataType:"json",type:"post",beforeSend:function(){tbc.lock(b.ui)},complete:function(){tbc.unlock(b.ui)},success:function(){b.triggerEvent("verify",a)!==!1&&(b.ui.remove(),b.close())}}),f=null}else b.triggerEvent("verify",a)!==!1&&(b.ui.remove(),b.close())}),b.part.cancel.click(function(){var a=b.getSelected();b.triggerEvent("cancel",a)!==!1&&(b.ui.remove(),b.close())})},function(a,b){"use strict";a.Drag=function(c){var d=a.self(this,arguments),e={nodes:null,selected:null,window:window,document:document,handle:null,cursor:"move",circles:null,circlesRound:{},targets:null,rangeMode:"y",disableInsertTargets:null,timeout:0,pauseTimeout:40},f=a.extend({},e,c),g=!!document.documentElement.ontouchstart,h=(b(f.handle,f.node),{left:0,top:0}),i={left:0,top:0},j=f.targets||b(f.node).parent(),k=[],l=null,m=null;d.packageName="tbc.Drag",d.pointer=b("<div></div>").css({position:"absolute",zIndex:100,background:"#fff",height:"1px",border:"1px solid #888",borderRadius:"10px",overflow:"hidden",lineHeight:"0",opacity:.5}),b(f.disableInsertTargets).data("tbc_drag_"+d.guid,!0),d.node=null,d.replica=[],d.a=function(){alert(f.targets.size())},d.addContainer=function(c){b(c).each(function(){k.push(this)}),f.targets=b(k),b(c).delegate(f.handle,"mousedown",{},function(c){return a.msie&&a.browserVersion<9&&1!==c.button||(a.msie&&a.browserVersion>8||!a.msie)&&0!==c.button?!1:(b("body").disableSelect(),d.node=b(this).parent(),h.left=c.pageX,h.top=c.pageY,d.init(c),c.disableSelectArea=!0,!1)})},d.addContainer(j),d.removeContainer=function(a){var c=[];f.targets.each(function(d,e){b(a).each(function(){e!==this&&c.push(e)})}),f.targets=b(c)},d.init=function(a){return b(document).bind({"mouseup.tbc_drag":function(a){d.stop(a,d.getPositionByEvent(a))}}),f.timeout?l=setTimeout(function(){d.start(a)},f.timeout):d.start(a),d},d.getPositionByEvent=function(a){return{left:a.pageX-i.left,top:a.pageY-i.top}},d.start=function(a){var c=d.node.offset();document.documentElement.scrollTop||document.body.scrollTop,document.documentElement.scrollLeft||document.body.scrollLeft,d.triggerEvent("start",a),d.createReplica(),"y"===f.rangeMode?d.pointer.css({width:d.node.width(),height:2}).appendTo("body"):d.pointer.css({width:2,height:d.node.height()}).appendTo("body"),i={left:a.pageX-c.left,top:a.pageY-c.top},b(document).bind("mousemove.tbc_drag",function(a){d.move(a)}),d.starting=!0},d.move=function(a){clearTimeout(m),m=setTimeout(function(){d.pause(a)},f.pauseTimeout);var b=d.getPositionByEvent(a);return b.right=b.left+1,b.bottom=b.top+1,d.replica&&d.moveReplica(b),d.triggerEvent("move",b),d},d.pause=function(c,e){if(f.targets&&b(f.targets).size()>0&&(!a.msie||a.msie&&a.browserVersion>7)&&d.starting===!0){var g=d.locateInsertPosition(c),h=g.offset;g.marks.size()?d.pointer.show().css({width:"y"===f.rangeMode?h.width:2,height:"y"===f.rangeMode?2:h.height,left:h.left,top:g.replica.top<h.halfY?h.top:h.bottom}):d.pointer.hide()}return d.triggerEvent("pause",c,e),d},d.stop=function(a){if(clearTimeout(l),clearTimeout(m),b(document).unbind(".tbc_drag"),b("body").enableSelect(),d.starting!==!0)return d;var c=d.locateInsertPosition(a);return d.insertTo(c),d.starting=!1,d.triggerEvent("stop",a),d},d.createReplica=function(){var c,e=d.node.offset(),g=[],h={node:d.node,clone:d.node.clone().appendTo("body").css({position:"absolute",zIndex:"100",left:e.left,top:e.top,opacity:.5})};return g.push(h),f.selected&&(c=d.node.siblings(f.selected),c.each(function(c,d){var e=b(this),f=e.offset(),i="rotate("+a.random(-15,15)+"deg)",j={node:e,clone:e.clone().appendTo("body").css({position:"absolute",zIndex:"99",left:f.left,top:f.top,opacity:.5,MozTransform:i,WebkitTransform:i,OTransform:i,msTransform:i,transform:i})};g.push(j),j.clone.animate(h.clone.offset(),800),d=null})),d.replica=g,e=g=h=null,d.replica},d.moveReplica=function(a){return b.each(d.replica,function(b,c){c.clone.stop().css({left:a.left,top:a.top})}),d},d.deleteReplica=function(){return b.each(d.replica,function(a,c){var d=c.transfer?b(c.transfer).offset():b(c.node).offset(),e=d.left,f=d.top;c.clone.animate({top:f,left:e,opacity:0},400,function(){c.clone.remove(),delete c.clone})}),delete d.replica,d},d.isOpenFor=function(a){var c=!0;return b(f.disableInsertTargets).each(function(){return b(a)[0]===this?(c=!1,!1):void 0}),c},d.insertTo=function(a){if(!a)return d;var c,e,g,h=d.node,i=h.siblings(f.selected),j={node:h,selected:i,marks:a.marks,from:h.parent(),to:a.transfer||a.dropBox,offset:a.offset},k=j.to,l=window.desktop;b(a.dropBox).removeClass("tbc-dragin").parent().removeClass("tbc-dragin-parent"),d.isOpenFor(k)&&(a.marks.size()?(c=a.marks,e=a.offset,g=d.triggerEvent("beforeInsert",j),g===!1?(b.each(d.replica,function(a){d.replica[a].transfer=j.transfer}),a.marks[0]!==h[0]&&(d.triggerEvent("afterInsert",j),l.current().layout())):a.marks[0]!==h[0]&&(a.replica.top<e.halfY?h.insertBefore(c):h.insertAfter(c),i.insertAfter(h),l.current().layout(),d.triggerEvent("afterInsert",j)),c=e=null):k.size()&&d.triggerEvent("beforeInsert",j)!==!1&&(h.appendTo(k),i.insertAfter(h),l.current().layout(),d.triggerEvent("afterInsert",j))),d.pointer.remove(),d.deleteReplica(),h=i=j=null},d.locateTarget=function(c,d){var e,g,h,i,j,k,l=[],m={},n=b(f.targets);for(k=0;k<n.size();k+=1)j=n[k],i=b(j).offset().left,e=b(j).offset().top,g=i+j.offsetWidth,h=e+j.offsetHeight,b(j).filter(":visible").size()>0&&a.isOverlap({left:i,top:e,bottom:h,right:g},d)&&l.push(j);return b.each(l,function(c,d){m.self=m.self||d,m.self=-1!==b(m.self).find("*").index(d)?d:a.getElementByMaxZIndex(m.self,d)[0]}),n.not(m.self).removeClass("tbc-dragin").trigger("dragout").parent().removeClass("tbc-dragin-parent"),m.self&&b(m.self).addClass("tbc-dragin").trigger("dragin",m).parent().addClass("tbc-dragin-parent"),m},d.locateInsertPosition=function(c){var e={left:c.pageX,top:c.pageY,right:c.pageX+1,bottom:c.pageY+1},g=d.locateTarget(c,e),h=null,i={};return b(g.self).children(f.node).each(function(c,d){var f=b(d).offset().left,g=b(d).offset().top,j=d.offsetWidth,k=d.offsetHeight,l=f+j,m=g+k,n=f+j/2,o=g+k/2,p={left:f,top:g,right:l,bottom:m+10,width:j,height:k,halfX:n,halfY:o};return a.isOverlap(p,e)?(h=d,i=p,!1):void 0}),{dropBox:b(g.self),transfer:g.transfer,offset:i,marks:b(h),replica:e}},d.disable=function(){b(f.node).unbind(".tbc_drag"),d.triggerEvent("disable")},d.enable=function(){var a=b(f.node);return a.each(function(a,c){var e=f.handle?b(f.handle,c):b(this);g?e.bind("touchstart.tbc_drag",function(a){d.start(a,c)}):e.bind("mousedown.tbc_drag",function(a){d.start(a,c)})}),d},d.maskDoc=function(){var a=b(f.document.body).children(".tbc-drag-mask");a=0!==a.size()?a:b('<div class="tbc-drag-mask" />').appendTo(f.document.body),a.show()},d.unmaskDoc=function(){var a=b(f.document.body).children(".tbc-drag-mask");a.hide()},d.addEvent({start:function(){this.maskDoc()},stop:function(){this.unmaskDoc()}})}}(window.tbc,jQuery),function(a,b){a.itemSelector=function(c){var d=a.self(this,arguments),e={availableUrl:null,selectedUrl:null,selectUrl:null,deselectUrl:null,selectAllUrl:null,deselectAllUrl:null,itemTemplate:null,itemTemplateSelected:null,dataTemplate:{id:"userId",text:"employeeCode",depict:"userName",title:""},htmlFormater:null,resultFormater:null,max:0,lazy:!1,postKey:"userIds",autoSave:!0,multiple:!0,dataType:"html",cleanable:!0,resettable:!0,event:{selected:function(){},unselected:function(){},complete:function(){}}},f=a.extend({},e,c);f.autoSave="undefined"==typeof f.autoSave?!0:f.autoSave,d.packageName="tbc.itemSelector";var g=b('<div class="tbc-itemSelector '+(f.multiple?"":"tbc-itemSelector-single")+'"></div>').html('<div class="tbc-itemSelector-panel availableBox">        <div class="tbc-itemSelector-title">            <span role="availTitle">待选</span> [<i class="" role="availNum">0</i>]            <a role="addAll" class="tbc-button tbc-itemSelector-btnAddAll" type="button">添加全部</a>        </div>        <div role="availContainer" class="tbc-itemSelector-list"></div>        <div class="tbc-itemSelector-pagination">            <div class="border">                <select role="availPageSize" id="fromPageSize" name="fromPageSize" class="inputxt">                    <option value="10">10</option>                    <option value="20">20</option>                    <option value="50">50</option>                    <option value="100">100</option>                    <option value="500">500</option>                </select>                <div class="abs_right">                    <a  role="availPrevPage" href="javascript:void(0);" id="fromPrev" class="tbc-buttons prev"><i class="tbc-icon icon-arrow-left"></i></a>                    <input role="availPageTyper" type="text" value="1" id="fromPageNO" name="fromPageNo" class="inputxt tbc-inputer" norender="true">                    <i>/</i>                    <span role="availPageTotal">1</span>                    <a role="availNextPage" href="javascript:void(0);" class="tbc-buttons next"><i class="tbc-icon icon-arrow-right"></i></a>                </div>            </div>        </div>    </div>    <div role="operaList" class="tbc-itemSelector-panel tbc-itemSelector-operation">        <button role="operaAddSelected" class="tbc-button normalBtn addSelected" type="button"><i class="tbc-icon icon-arrow-right"></i></button>        <button role="operaRemoveSelected" class="tbc-button normalBtn removeSelected" type="button"><i class="tbc-icon icon-arrow-left"></i></button>        <button role="operaAddCurrPage" class="tbc-button bigBtn addCurrPage" type="button"><i class="tbc-icon icon-arrow-dblright"></i></button>        <button role="operaRemoveCurrPage" class="tbc-button bigBtn removeCurrPage" type="button"><i class="tbc-icon icon-arrow-dblleft"></i></button>    </div>    <div class="tbc-itemSelector-panel selectedBox">        <div class="tbc-itemSelector-title">            <span role="selectedTitle">已选</span> <span> [ <i class="" role="selectedNum">0</i><b role="maxSelected"></b> ]</span>            <a role="removeAll" class="tbc-button tbc-itemSelector-btnRemoveAll">移除全部</a>        </div>        <div role="selectedContainer" class="tbc-itemSelector-list"><ul></ul></div>        <div class="tbc-itemSelector-pagination">            <div class="border">                <select role="selectedPageSize" name="toPageSize" class="inputxt">                    <option value="10">10</option>                    <option value="20">20</option>                    <option value="50">50</option>                    <option value="100">100</option>                    <option value="500">500</option>                </select>                <div class="abs_right">                    <a role="selectedPrevPage" href="javascript:void(0);" class="tbc-buttons prev"><i class="tbc-icon icon-arrow-left"></i></a>                    <input role="selectedPageTyper" type="text" value="1" name="toPageNo" class="inputxt tbc-inputer" norender="true">                    <i>/</i>                    <span role="selectedPageTotal">1</span>                    <a role="selectedNextPage" href="javascript:void(0);" class="tbc-buttons next"><i class="tbc-icon icon-arrow-right"></i></a>                </div>            </div>        </div>    </div></div>').css({position:"relative",zIndex:1});if(d.part={},g.find("[role]").each(function(){var a=this.getAttribute("role");d.part[a]=this,a=null}),d._cache={selected:{total:0,list:[],names:{},page:{"page.pageSize":10,"page.pageNo":1,totalPages:1,total:0},selected:{}},available:{total:0,list:[],names:{},page:{"page.pageSize":10,"page.pageNo":1,totalPages:1,total:0}}},d._ajaxDataAvailable=a.extend({},this._cache.selected.page,{includeChild:!0,keyword:""}),d._ajaxDataSelected=a.extend({},this._cache.available.page,{keyword:""}),f.max&&(1===f.max&&b(d.part.operaAddCurrPage).attr("disabled","disabled").addClass("tbc-button-disabled"),b(d.part.maxSelected).append('/<b title="最多只能选择'+f.max+'项" style="font-weight:bold; color:red; cursor:default; text-decoration:underline;">'+f.max+"</b>")),d.extend({ui:g,container:g,append:function(a){this.container.append(a)},prepend:function(a){this.container.prepend(a)},appendTo:function(a){this.ui.appendTo(a)},prependTo:function(a){this.ui.prependTo(a)},formatPage:function(a){var c={};b("input[type='hidden']",a).each(function(){switch(this.name){case"totalPages":c.totalPages=this.value||0;break;case"totalRecords":c.totalRecords=this.value||0;break;case"pageNo":c["page.pageNo"]=this.value||0;break;case"pageSize":c["page.pageSize"]=this.value||0}}),c.prev=Math.max(c["page.pageNo"]-=1,1),c.next=Math.min(c["page.pageNo"]+=1,c.totalPages);try{return c}finally{c=null}},getPages:function(a){var b={},c=this.part,d=this._cache.available.page||{},e=this._cache.selected||{};switch(a){case"available":b["page.pageSize"]=d["page.pageSize"]||c.availPageSize.value||10,b["page.pageNo"]=d["page.pageNo"]||c.availPageTyper.value||1,b.totalPages=d.totalPages||c.availPageTotal.value||1,b.total=d.total||c.availNum.value||0;break;case"selected":b["page.pageSize"]=e["page.pageSize"]||c.selectedPageSize.value||10,b["page.pageNo"]=e["page.pageNo"]||c.selectedPageTyper.value||1,b.totalPages=e.totalPages||c.selectedPageTotal.value||1,b.total=e.total||c.selectedNum.value||0}try{return b}finally{b=null}},formatList:function(a){var c=[];a&&"object"==typeof a&&b.isFunction(a.size)?b("li",a).each(function(){var a={},d=f.dataTemplate;b("input",this).val()||this.getAttribute("data-id"),a[d.id]=b("input",this).val()||this.getAttribute("data-id"),a[d.text]=b("i",this).text()||b("span:first",this).text(),a[d.depict]=b("span:last",this).text(),a[d.title]=this.getAttribute("title"),c.push(a),a=null}):a&&(c=a);try{return c}finally{c=null}},setPagination:function(c,d){var e=d.total?d.total:"0";switch(c){case"available":this.part.availPageTyper.value=d["page.pageNo"],this.part.availPageTotal.innerHTML=d.totalPages,b(this.part.availPageSize).val(d["page.pageSize"]),b(this.part.availNum).html(e),a.extend(this._cache.available.page,d);break;case"selected":this.part.selectedPageTyper.value=d["page.pageNo"],this.part.selectedPageTotal.innerHTML=d.totalPages,b(this.part.selectedPageSize).val(d["page.pageSize"]),b(this.part.selectedNum).html(e),a.extend(this._cache.selected.page,d)}},loadAvailableByPage:function(a){var c=this;if(f.availableUrl&&this.triggerEvent("beforeAvailableLoad")!==!1){var e=(f.autoSave!==!1&&f.lazy===!0?!0:!1)+"";a=a||this.getPages("available")["page.PageNo"]||1,this._ajaxDataAvailable,this._cache.available.page,a=Math.max(0,Math.min(this._cache.available.page.totalPages,a)),b.ajax({url:f.availableUrl,dataType:f.dataType,data:b.extend({},f.post,this._ajaxDataAvailable,this._cache.available.page,{"page.pageNo":a,lazy:e}),type:"post",beforeSend:function(){c.triggerEvent("beforeAvailableLoad")},complete:function(){},error:function(){},success:function(e){e&&e.rows&&(f.itemDataFormater&&(e.rows=f.itemDataFormater(e.rows)),b.each(e.rows,function(){!this.id&&(this.id=this.userId),!this.text&&(this.text=this.userName||this.nm),!this.nm&&(this.nm=this.text),d._cache.available.names[this[f.dataTemplate.id]]=this}));var g=c.formatResult(e,f.itemTemplate);c.updateAvailablePage(g),c.triggerEvent("afterAvailableLoad"),c=g=a=null}})}},loadSelectedByPage:function(a){var c=this;if(f.selectedUrl&&f.autoSave&&this.triggerEvent("beforeSelectedLoad")!==!1){var e=(f.autoSave!==!1&&f.lazy===!0?!0:!1)+"";a=a||this.getPages("selected")["page.PageNo"]||1,b.ajax({url:f.selectedUrl,dataType:f.dataType,type:"post",data:b.extend({},f.post,d._ajaxDataSelected,this._cache.selected.page,{"page.pageNo":a,lazy:e}),beforeSend:function(){},complete:function(){},error:function(){var a=b(c.part.selectedContainer);0===a.find("ul").size()&&a.html("<ul></ul>")},success:function(a){if(a&&a.rows){f.itemDataFormater&&(a.rows=f.itemDataFormater(a.rows));for(var e in d._cache.selected.names)delete d._cache.selected.names[e];b.each(a.rows,function(){!this.id&&(this.id=this.userId),!this.text&&(this.text=this.userName),!this.nm&&(this.nm=this.text),d._cache.selected.names[this[f.dataTemplate.id]]=this})}var g=c.formatResult(a,f.itemTemplateSelected);c.updateSelectedPage(g),c._cache.selected.list=g.list,g.list=null,c=g=null}})}else{var g=b(c.part.selectedContainer);0===g.find("ul").size()&&g.html("<ul></ul>")}},updateAvailablePage:function(a){var c=this;b(c.part.availContainer).empty().append(a.html),c.setPagination("available",a.page),c._cache.available.page=a.page,c._cache.available.list=[].concat(a.list),a.page["page.pageNo"]<=1?b(c.part.availPrevPage).addClass("tbc-button-disabled"):b(c.part.availPrevPage).removeClass("tbc-button-disabled"),a.page["page.pageNo"]>=a.page.totalPages?b(c.part.availNextPage).addClass("tbc-button-disabled"):b(c.part.availNextPage).removeClass("tbc-button-disabled")},updateSelectedPage:function(a){var c=this;b(c.part.selectedContainer).empty().append(a.html),c.setPagination("selected",a.page),c._cache.selected.page=a.page,f.autoSave!==!1,a.page["page.pageNo"]<=1?b(c.part.selectedPrevPage).addClass("tbc-button-disabled"):b(c.part.selectedPrevPage).removeClass("tbc-button-disabled"),a.page["page.pageNo"]>=a.page.totalPages?b(c.part.selectedNextPage).addClass("tbc-button-disabled"):b(c.part.selectedNextPage).removeClass("tbc-button-disabled")},pageAvailable:function(){this.loadAvailableByPage.apply(this,arguments)},pageSelected:function(a){var a=a||d._cache.selected.page["page.pageNo"],b=d._cache.selected.page.totalPages;a=Math.max(1,Math.min(b,a)),f.autoSave===!1||f.lazy===!0?this.sliceSelectedByPage.apply(this,arguments):this.loadSelectedByPage(a)},sliceSelectedByPage:function(a){var b=a||this._cache.selected.page["page.pageNo"],c=this._cache.selected.page.totalPages,d=this._cache.selected.page["page.pageSize"],e=this.sliceListByPage(this._cache.selected.list,Math.max(1,Math.min(c,b)),d||10),g=this.formatResult(e,f.itemTemplateSelected);this.updateSelectedPage(g)},sliceListByPage:function(a,b,c){c=c||10;var d=a.length,e=Math.floor(d/c)+(d%c>0?1:0),f=Math.max(0,(b-1)*c),g=Math.min(d,b*c),h=a.slice(f,g);return{totalRecords:d,totalPages:e,total:a.length,rows:h,pageSize:c,pageNo:b}},formatResult:function(a,c){var d={html:"<ul></ul>",page:{"page.pageSize":10,"page.pageNo":1,totalPages:0,total:0},list:[]};if(a){f.dataType="string"==typeof f.dataType?f.dataType.toLowerCase():f.dataType;var e="html"!==f.dataType&&"text"!==f.dataType||"string"!=typeof a&&!a.jQuery?"json"===f.dataType||"object"==typeof a?"json":"xml"===f.dataType?"xml":f.dataType:"html";switch(e){case"html":var g=b("<div/>").html(a);d.html=b(a),d.page=this.formatPage(g),d.list=this.formatList(g),g.remove(),g=null;break;case"json":var h=a.rows?a.rows.length>a.pageSize?this.sliceListByPage(a.rows,a.pageNo,a.pageSize).rows:a.rows:null;d.html=h?this.createHtmlByJSON(h,c):"",d.page={"page.pageSize":a.pageSize,"page.pageNo":a.pageNo,totalPages:a.totalPages,total:a.total},d.list=a.rows||this.formatList(d.html)}}try{return d}finally{d=null}},createHtmlByJSON:function(c,d){if(!c)return"";for(var e,g=b("<ul/>"),h=a.isArray(c)?c:c.list||[],i=h.length,j=d||f.itemTemplate||'<li data-id="{userId}" class="{selected} {checked}"><i>{employeeCode}</i><span>{userName}</span></li>',k=[],l=0;i>l;l++)e=f.vauleSetFormater?f.vauleSetFormater.call(this,h[l]):h[l],k.push(a.stringTemplate(j,e,f.textTransform));
g.html(k.join(""));try{return g}finally{g=h=i=j=k=null}},createHtmlByXML:function(){},getAvailablePage:function(){return this._cahce.available.page},selectItems:function(a){b(a),a=b(a).filter(function(){var a=this.getAttribute("data-id"),c=b(d.part.selectedContainer).find("li[data-id='"+a+"']").size()>0;return!c}).addClass("checked"),d.setNextSelected(a),a.clone().prependTo(b("ul",d.part.selectedContainer))},saveSelected:function(c,e){if(f.autoSave!==!1&&f.lazy!==!0&&c.length>0){var g,h=f.post||{};if(f.postFormater)g=f.postFormater(c),h[f.postKey]=g;else{for(var i=[],j=0,k=c.length;k>j;j++)i.push(c[j][f.dataTemplate.id]);h[f.postKey]=i.join(",")}b.ajax({url:f.addUrl,type:"post",data:h,dataType:"json",beforeSend:function(){d.triggerEvent("beforeSave")!==!1&&a.lock(d.ui)},complete:function(){a.unlock(d.ui),b.isFunction(e)&&e.call(d),d.triggerEvent("afterSave")},success:function(a){a.success!==!0&&a.message&&alert(a.message)}}),h=null}else d.pageAvailable(),d.pageSelected()},deselectItems:function(a){a=b(a),d.setNextSelected(a),a.remove()},saveDeselected:function(c,e){if(f.autoSave&&!f.lazy&&c.length>0){var g,h=f.post||{};if(f.postFormater)g=f.postFormater(c),h[f.postKey]=g;else{for(var i=[],j=0,k=c.length;k>j;j++)i.push(c[j][f.dataTemplate.id]);h[f.postKey]=i.join(",")}b.ajax({url:f.removeUrl,type:"post",data:h,dataType:"json",beforeSend:function(){d.triggerEvent("beforeSave")!==!1&&a.lock(d.ui)},complete:function(){a.unlock(d.ui),b.isFunction(e)&&e.call(d),d.triggerEvent("afterSave")},success:function(a){a.success!==!0&&a.message&&alert(a.message)}}),h=null}else d.pageSelected(),d.pageAvailable()},setNextSelected:function(a){if(1===a.size()){var b=a.next();b.size()?b.addClass("selected"):a.prev().addClass("selected"),b=null}},checkSelect:function(a,b){if(0===a.length)return!1;if(f.max&&!isNaN(f.max)){if(this._cache.selected.page.total>=f.max)return alert("您最多只能选择"+f.max+"条."),!1;var c=a.length,d=0;this._cache.selected.page.total+c>f.max&&(d=f.max-this._cache.selected.page.total,a=a.slice(0,d),alert("数量已经超过限制, 仅前面的"+d+"个被添加到了已选栏."))}var e=this.getAvailableItems(a),g=this;f.itemDataFormater&&(e=f.itemDataFormater(e));var h=this._cache.available.page["page.pageNo"];h+=b?1:0,this.selectItems(a),this.selectToCache(e),this.saveSelected(e,function(){this.pageAvailable(h),this.pageSelected(h)}),e.length=0,e=a=g=null},checkDeselect:function(a){if(0===a.length)return!1;var b=this.getSelectedItems(a),c=this;this.deselectToCache(b),this.deselectItems(a),this.saveDeselected(b,function(){this.pageAvailable(),this.pageSelected()}),b.length=0,b=a=c=null},selectAll:function(){f.autoSave!==!1&&f.lazy!==!0?b.ajax({url:f.selectAllUrl,type:"post",dataType:"json",data:b.extend({},f.post,this._ajaxDataAvailable,this._cache.available.page),beforeSend:function(){d.triggerEvent("beforeSave")!==!1&&a.lock(d.ui)},complete:function(){a.unlock(d.ui),d.pageSelected(),d.pageAvailable(),d.triggerEvent("afterSave")},success:function(a){a.success!==!0&&a.message&&alert(a.message)}}):(this.pageSelected(),this.pageAvailable())},removeAll:function(){this._cache.selected.list.length=0,this._cache.selected.names={},f.autoSave!==!1&&f.lazy!==!0?b.ajax({url:f.deselectAllUrl,type:"post",dataType:"json",data:b.extend({},f.post,this._ajaxDataAvailable,this._cache.available.page),beforeSend:function(){d.triggerEvent("beforeSave")!==!1&&a.lock(d.ui)},complete:function(){a.unlock(d.ui),d.pageSelected(1),d.pageAvailable(1),d.triggerEvent("afterSave")},success:function(a){a.success!==!0&&a.message&&alert(a.message)}}):(this.pageSelected(1),this.pageAvailable(1))},selectCurrentPage:function(){var a=b("li",this.part.availContainer).not(".checked");this.checkSelect(a,"goNextPage"),a=null},deselectCurrentPage:function(a){var c=b("li",this.part.selectedContainer);this.checkDeselect(c,a),c=null},getSelectedItems:function(a){var c=[];b(a).each(function(){var a=this.getAttribute("data-id"),b=d._cache.selected.names[a];b&&c.push(b)});try{return c}finally{c=null}},getAvailableItems:function(a){var c=[];b(a).each(function(){var a=this.getAttribute("data-id"),b=d._cache.available.names[a];b&&c.push(b)});try{return c}finally{c=null}},selectChecked:function(){var a=b("li.selected",this.part.availContainer).not(".checked");this.checkSelect(a),a=null},addAvailableItem:function(a,c){var d=this.createHtmlByJSON(a).find("li").addClass("selected"),e=b(this.part.availContainer).children("ul");c&&e.empty(),e=0!==e.size()?e:b("<ul/>").appendTo(this.part.availContainer),e.append(d),this.deselectToCache(a)},removeAvailableItem:function(a){b(this.part.availContainer).find("li[data-id='"+a+"']").remove(),delete this._cache.available.names[a]},clearAvailable:function(){b(this.part.availContainer).children("ul").empty();var a=this._cache.selected.names[id];for(var c in a)delete a[c];a=null,this._cache.selected.list.length=0},deselectChecked:function(){var a=b("li.selected",this.part.selectedContainer);this.checkDeselect(a),a=null},selectToCache:function(a){var c=this,d=[];b.each(a,function(a,b){if(b){var e=this[f.dataTemplate.id];c._cache.selected.names[e]||(c._cache.selected.names[e]=this,c._cache.selected.list.push(this),d.push(this)),delete c._cache.available.names[e]}}),this.triggerEvent("select",d),d=c=null},deselectToCache:function(c){var e,g=this;b.each(c,function(){var a=this[f.dataTemplate.id];g._cache.available.names[a]||(g._cache.available.names[a]=this,g._cache.available.list.push(this)),delete g._cache.selected.names[a],b(g.part.availContainer).find("li[data-id='"+a+"']").removeClass("checked")}),g._cache.selected.list.length=0;for(var h in g._cache.selected.names)e++,g._cache.selected.list.push(g._cache.selected.names[h]),e>5e3&&a.lock(d.ui);a.unlock(d.ui),this.triggerEvent("deselect",c),g=null},getPropertiesById:function(a){var c=this,d=f.post||{};d[f.postKey]=a.join(","),b.ajax({url:f.propertiesUrl,type:"post",dataType:"json",data:d,success:function(a){a&&c.setSelected(a)}})},setSelected:function(c){var d=this;c&&b.isArray(c)&&c.length>0&&(a.lock(d.ui),d._cache.selected.list=d._cache.selected.list||[],a.batch(c,1e4,0,0,function(a){for(var b,c,e=0,g=a.length;g>e;e++)b=a[e][f.dataTemplate.id],c=d._cache.selected.names[b],c||(d._cache.selected.names[b]=a[e],d._cache.selected.list.push(a[e])),d._cache.selected.names[b].selected=!0},function(){a.unlock(d.ui);var c=d.sliceListByPage(d._cache.selected.list,1,10),e=d.formatResult(c,f.itemTemplateSelected);b(d.part.selectedContainer).empty().append(e.html),d.setPagination("selected",e.page)}))}}),f.autoSave||"string"!=typeof f.selectedData)!f.autoSave&&b.isArray(f.selectedData)?setTimeout(function(){d.setSelected(f.selectedData)},100):d.loadSelectedByPage(1);else{var h=f.selectedData.split(",");h.length>0&&d.getPropertiesById(h)}(f.autoSave===!1||f.lazy===!0)&&b(d.part.addAll).hide(),b(d.part.availContainer).add(d.part.selectedContainer).delegate("li","click",function(a){var c=b(this);if(a.shiftKey){var d;c.siblings().add(c).each(function(){d?b(this).addClass("selected"):b(this).removeClass("selected"),(this===c[0]||b(this).hasClass("lastClicked"))&&(d=!d,b(this).addClass("selected"))})}else c.addClass("lastClicked").siblings().removeClass("lastClicked"),a.ctrlKey&&f.multiple&&1!==f.max?c.hasClass("selected")?c.removeClass("selected"):c.addClass("selected"):c.addClass("selected").siblings().removeClass("selected")}),b(d.part.availContainer).add(d.part.selectedContainer).delegate("li","dblclick",function(){}),b(d.part.operaAddCurrPage).click(function(){d.selectCurrentPage()}),b(d.part.operaRemoveCurrPage).click(function(){d.deselectCurrentPage()}),b(d.part.operaAddSelected).click(function(){d.selectChecked()}),b(d.part.operaRemoveSelected).click(function(){d.deselectChecked()}),b(d.part.availPageTyper).keyup(function(a){if(!this.value.match(/^\d+$/),13===a.keyCode){var b=parseInt(this.value);d.pageAvailable(b)}}),b(d.part.selectedPageTyper).keyup(function(a){if(!this.value.match(/^\d+$/),13===a.keyCode){var b=parseInt(this.value);d.pageSelected(b)}}),b(d.part.availPageSize).change(function(){d._cache.available.page["page.pageSize"]=this.value,d.pageAvailable()}),b(d.part.selectedPageSize).change(function(){d._cache.selected.page["page.pageSize"]=this.value,d.pageSelected()}),b(d.part.availPrevPage).click(function(){var a=d._cache.available.page["page.pageNo"]-1;d.pageAvailable(a)}),b(d.part.availNextPage).click(function(){var a=d._cache.available.page["page.pageNo"]+1;d.pageAvailable(a)}),b(d.part.selectedPrevPage).click(function(){var a=d._cache.selected.page["page.pageNo"]-1;return d.pageSelected(a)}),b(d.part.selectedNextPage).click(function(){var a=d._cache.selected.page["page.pageNo"]+1;return d.pageSelected(a)}),b(d.part.addAll).click(function(){d.selectAll()}),b(d.part.removeAll).click(function(){d.removeAll()})}}(tbc,jQuery),tbc.jdc=new function(){var a=tbc.self(this);a.extend(tbc.Event),a.extend(tbc.ClassManager),a.packageName="tbc",a.db={store:{},key:function(a){return isNaN(parseInt(a))?null:this.store[a]},getItem:function(a){return this.store[a]},setItem:function(a,b){return b&&(this.store[a]=b),b.KEY=a,b},removeItem:function(a){this.store[a]=null,delete this.store[a]}};var b={};a.db.setItem("tables",b),a.getTable=function(a){return b[a]},a.createTable=function(a){return a&&!b[a]?(b[a]=new tbc.jdc.Table(a),b[a]):void 0},a.dropTable=function(a){b[a]&&(b[a].del("all"),b[a].DESTROY(),delete b[a])},a.select=function(a,c){var d="string"==typeof a?b[a]:a;if(d){var e=d.get(c);return d=null,e||null}return null},a.set=function(c,d,e){var f=b[c];if(f||(f=a.createTable(c)),f)if("object"==typeof d)for(var g in d)f.set(g,d[g]);else f.set(d,e);f=null},a.del=function(a,c){var d=b[a];d&&d.del(c),d=null}},tbc.jdc.Table=function(){var a=tbc.self(this);a.extend(tbc.Event),a.extend(tbc.ClassManager),a.packageName="tbc.jdc.Table",a.count=0,a.store={},a.get=function(b){var c=[];if("all"===b.toLowerCase()||"*"===b){for(var d in a.store)c.push(a.store[d]);return c}return a.store[b]||null},a.set=function(b,c){a.store[b]&&a.count++,a.store[b]=c},a.del=function(b){if("string"==typeof b&&"all"===b.toLowerCase())for(var c in a.store)delete a.store[c];else b&&delete a.store[b]}},function(a,b){"use strict";a.Panel=function(c){var d={window:window,opener:null,title:null,name:null,icon:"",html:"",area:"body",width:400,height:300,top:"auto",left:"auto",target:null,modal:!0,enable3D:!0,sizeType:"restore",minWidth:180,autoShow:!0,minHeight:100,autoClose:!1,draggable:!0,resizable:!0,minimizable:!1,maximizable:!1,defaultSate:"restore",autoCloseTimeout:5,event:{}},e=b.extend({},d,c);e.window=e.window||window,a.self(this,arguments).extend({packageName:"tbc.Panel",part:{},ui:null,container:null,lastSize:{width:0,height:0,left:0,top:0,right:"auto",bottom:"auto"},initUi:function(){var c=a.getMaxZIndex(b(".tbc-slide-scene.current")[0]),d=a.msie&&a.browserVersion<9?"div":"dialog";return this.ui=b("<"+d+' class="tbc-panel closeable shadow" style="filter:alpha(opacity=0); opacity:0; z-index:'+(c+1)+';"></'+d+">").attr("tbc",this.guid).html('<div role="header" class="tbc-panel-header" unselectable="on" onselectstart="return false;">    <div class="tbc-panel-top-left resize-handle" role="north-west"></div>    <div class="tbc-panel-top-right resize-handle" role="north-east"></div>    <div role="controls" class="tbc-panel-controls">        <div class="tbc-switch-role" role="roleBox">            <span class="tbc-switch-role-roleName" role="roleName"></span>            <span class="tbc-switch-role-handle tbc-icon icon-arrow_state_blue_expanded" role="roleHandle"></span>            <ul class="tbc-switch-role-list" role="roleList"><li>1111</li><li>2222</li></ul>        </div>        <span class="tbc-panel-controls-box">            <a role="close" class="tbc-panel-btn-close" href="javascript:void(null);" hidefocus="true" title="关闭">×</a>            <a role="restore" class="tbc-panel-btn-max" href="javascript:void(null);" hidefocus="true" title="最大化/还原">■</a>            <a role="min" class="tbc-panel-btn-min" href="javascript:void(null);" hidefocus="true" title="最小化">▁</a>            <!--a role="refresh" class="tbc-panel-btn-refresh" href="javascript:void(null);" hidefocus="true" title="刷新">&hArr;</a-->            <a role="reset" class="tbc-panel-btn-reset" href="javascript:void(null);" hidefocus="true" title="重新打开">&otimes;</a>            <a role="help" class="tbc-panel-btn-help" href="javascript:void(null);" hidefocus="true" title="">?</a>        </span>    </div>    <div class="tbc-panel-top-center">        <div class="tbc-panel-top-center-handle resize-handle" role="north"></div>        <span class="tbc-panel-icon"><img role="icon" height="16" onerror="this.style.display=\'none\';" /></span>        <div role="title" class="tbc-panel-title">            <!--标题区域-->窗体基类        </div>    </div></div><div class="tbc-panel-body">    <div class="tbc-panel-middle-left resize-handle" role="west"></div>    <div class="tbc-panel-middle-right resize-handle" role="east"></div>    <div class="tbc-panel-middle-center tbc-panel-main">        <div role="container" class="tbc-panel-container">            <!--内容区域-->        </div>        <div role="mask" class="tbc-panel-locked-layer" style="display:none;">            <div role="maskTips" class="tbc-panel-locked-layertips"></div>        </div>    </div></div><div role="footer" class="tbc-panel-footer">    <div class="tbc-panel-footer-left resize-handle" role="south-west"></div>    <div class="tbc-panel-footer-right resize-handle" role="south-east"></div>    <div class="tbc-panel-footer-center resize-handle" role="south"></div></div>'),this.ui.bind("click",function(c){var d=c.target,e=d.tagName.toLowerCase(),f=a.getTaskByElement(this);f&&b.isFunction(f.focus)&&f.focus(),("input"===e||"textarea"===e||"button"===e||"a"===e||d.contenteditable)&&setTimeout(function(){d.focus(),d=null},0),f=null}),a.Panel.cacheid++,this.cacheid=a.Panel.cacheid,this.ui.attr("iid",this.iid),this.ui.attr("cacheid",this.cacheid),a.Panel.cache[this.cacheid]=this,a.Panel.cache_length+=1,e.minimizable&&this.ui.addClass("minimizable"),e.maximizable&&this.ui.addClass("maximizable"),e.refreshable&&this.ui.addClass("refreshable"),e.resettable&&this.ui.addClass("resettable"),e.helpable&&this.ui.addClass("helpable"),this},initPart:function(){var c=this;if(this.ui.find("[role]").each(function(a,c){var d=c.getAttribute("role");this.part[d]=b(c)}.bind(this)),this.container=this.part.container,this.part.form&&this.part.form.submit(function(a){a.preventDefault(),this.triggerEvent("submit")}.bind(this)),this.part.controls.bind("mousedown",function(a){a.disableSelectArea=!0,a.stopPropagation()}).delegate("a","click",null,function(a){a.preventDefault();var b=a.currentTarget,c=b.getAttribute("role");switch(c){case"close":a.stopPropagation(),this.close();break;case"min":e.minimizable&&this.min();break;case"max":e.maximizable&&this.max();break;case"restore":e.maximizable&&("max"===this.sizeType?this.restore():this.max());break;case"refresh":e.refreshable&&this.refresh&&this.refresh();break;case"reset":e.resettable&&this.reset&&this.reset();break;case"help":e.helpable&&this.help()}}.bind(this)),this.part.title.dblclick(function(){"max"!==c.sizeType&&e.maximizable?c.max():c.restore()}),a.msie&&a.browserVersion<8){var d=24*c.part.controls.children(".tbc-panel-controls-box").children().size()+2;c.part.controls.width(d)}return this},init:function(){return this.packageName="tbc.Panel",this.initUi(),this.initPart(),this.initDrag(),this.initResize(),this.initContextmenu(),this},initForOpen:function(){var b,c,d,f,g,h;return"FULL"===e.windowInitialType||"MAX"===e.windowInitialType?(b="100%",c="100%",d=f=g=h=0):(b=a.system?Math.min(a.system.getDesktopWidth(),e.width||e.minWidth):e.width||e.minWidth,c=a.system?Math.min(a.system.getDesktopHeight()-24-taskbar.ui.height(),e.height||e.minHeight):e.height||e.minHeight,d=e.left,f=e.right,h=e.bottom,g=e.top),this.appendTo(e.target||a.Panel.parent||"body").name(e.name||"窗口").icon(e.icon||a.Panel.defaultIcon||(window.DEFAULT_ICONS?DEFAULT_ICONS.window_icon:null)||"").resize(b,c,g,f,h,d,!1),"FULL"===e.windowInitialType||"MAX"===e.windowInitialType?this.resize("max").rememberSize(e.width,e.height,e.top,e.left):this.rememberSize(),this.opened=!0,this.triggerEvent("open"),this},initDrag:function(){var c=this;try{if(e.draggable)c.addEvent("drop",function(){c.rememberSize()}),b.fn.drag&&c.ui.addClass("draggable").drag({document:document,area:"body",areaMargin:{top:-6,left:"-80%",bottom:"80%",right:"80%"},handle:c.part.title,enabled:function(){return c.ui.hasClass("draggable")},timeout:1,event:{dragStart:function(){var d=c.ui.css("zIndex")||2;a.lock("body",{zIndex:9999999,opacity:.001,cursor:"move"}),c.dragSaveOnIframe=b("<div />").insertAfter(c.ui).css({position:"absolute",z:d-1,background:"#fff",opacity:.01,width:"100%",height:"100%",left:0,top:0}),c.triggerEvent("dragStart")},drag:function(){c.triggerEvent("drag")},drop:function(){c.dragSaveOnIframe&&c.dragSaveOnIframe.remove(),a.unlock("body"),c.triggerEvent("drop")}}}),c.part.title.mousedown(function(){c.focus()});else if(e.draggable&&!b.fn.drag)throw"jQuery plugins 'jQuery.fn.drag' was not found! jQuery.fn.dialog Dependent on the plugin."}catch(d){a.log(d)}return this},initResize:function(){var c=this;try{if(e.resizable&&b.fn.resizableForTbc)c.ui.addClass("resizable").resizableForTbc({handle:".resize-handle",vector:"normal",document:document,margin:{top:7,left:7,right:9,bottom:9},minWidth:e.minWidth,minHeight:e.minHeight,enabled:function(){return c.ui.hasClass("resizable")},onResizeStart:function(){c.focus().lock()},onResize:function(){},onResizeEnd:function(a){c.resize(a),c.unlock()}});else if(e.resizable&&!b.fn.resizableForTbc)throw"jQuery plugins 'jQuery.fn.resizableForTbc' was not found! jQuery.fn.dialog Dependent on the plugin."}catch(d){a.log(d)}return this},initContextmenu:function(){var a=this;return b.isFunction(b.fn.contextmenu)&&this.ui.contextmenu({items:[{text:"最小化",icon:"",click:function(){a.min()},disabled:!e.minimizable,inheritable:!0},{text:function(){return"max"===a.sizeType?"还原":"最大化"},icon:"",click:function(){"max"===a.sizeType?a.restore():a.max()},disabled:!e.maximizable,inheritable:!0},{text:"关闭",icon:"",click:function(){a.close()},inheritable:!0}]}),this},panelLayout:function(){var a=this;try{var c=a.ui,d=c.innerHeight()-a.part.header.height()-a.part.footer.height(),e=c.width()-b(".tbc-panel-middle-left",c).width()-b(".tbc-panel-middle-right",c).width();b(".tbc-panel-body",c).height(d),a.part.container.height(d).width(e)}catch(f){}return a=null,this},show:function(){var a=this;return this.opened||this.initForOpen(),this.minimize=!1,this.ui.css({opacity:0,display:"block"}).animate({opacity:1},200),this.facade(),setTimeout(function(){a.focus(),a=null},0),this.triggerEvent("show"),this},hide:function(){var b=this;return a.msie&&a.browserVersion<8?this.ui.css({opacity:0,display:"none"}):this.ui.animate({opacity:0,display:"none"},200,function(){b.ui.hide(),b=null}),this.evert(),this.triggerEvent("hide"),this},html:function(a){return this.triggerEvent("beforeChange"),a?(this.container.html(a),this.triggerEvent("afterChange"),this):this.container.html()},append:function(a){return this.triggerEvent("beforeChange"),this.container.append(a),this.triggerEvent("afterChange"),this},appendTo:function(a){return this.ui.appendTo(a),this},prepend:function(a){return this.triggerEvent("beforeChange"),a.ui?this.container.prepend(a.ui):this.container.prepend(a),this.triggerEvent("afterChange"),this},prependTo:function(a){return a.container?this.ui.prependTo(a.container):this.ui.prependTo(a),this},titleModel:"{0}<span style='filter:alpha(opacity=70); opacity:0.7; font-weight:lighter;' title='{0} {1}'>{1}</span>",title:function(b){if(b){e.title=b;var c,d=e.name,f=e.title,g=f&&f!==d?a.formatString(this.titleModel||"",f?d+" > ":d,f):e.name;return c=f?d+" > "+f:d||"",this.part.title.html(g).attr("title",c),this.triggerEvent("changeTitle",b,d),this}return e.title},name:function(b){if(b){e.name=b;var c,d=b,f=e.title,g=f&&f!==d?a.formatString(SELF.titleModel,f?d+" > ":d,f):e.name;return c=f?d+" > "+f:d||"",this.part.title.html(g).attr("title",c),this.triggerEvent("changeTitle",f,b),this}return e.name},icon:function(b){var c=a.system.isImg(b);return c||!b||"null"===b?(b=c?b:DEFAULT_ICONS.window_icon,this.part.icon.attr("src",b).show().parent().css({backgroundPosition:"center center"}),this.triggerEvent("changeIcon",b),this):(this.part.icon.parent().addClass("tbc-icon "+b).css({backgroundImage:""}),this.part.icon.hide(),this)},close:function(b){function c(){if(f){var a;f.ui.empty().remove();for(a in f.part)f.part.hasOwnProperty(a)&&delete f.part[a];f.triggerEvent("afterClose",f.returnValue),f.DESTROY()}e=d=f=null}var f=this;if(this.modalWindow)try{if(!b)return this.modalWindow.show().focus().flash(),this;this.modalWindow.close(b)}catch(g){}return this.triggerEvent("beforeClose")===!1?this:(this.triggerEvent("close",this.returnValue),a.Panel.cache_length-=1,delete a.Panel.cache[this.cacheid],a.Panel.removeSequence(this.cacheid),this.opener&&this.opener.modalWindow&&delete this.opener.modalWindow,b||setTimeout(function(){var b,c,d,e,f=window.desktop.current().container[0];for(d=a.Panel.sequence,e=d.length;e>=0;e-=1)if(c=a.Panel.cache[d[e]],c&&(b=a.Panel.cache[d[e]].ui.parent()[0],f===b||b===document.body)){a.Panel.cache[d[e]].focus();break}f=b=c=null},0),a.msie&&a.browserVersion<8?c():(this.evert(),this.ui.animate({opacity:0,marginTop:"-=20px"},300,c)),void 0)},closeOther:function(){},min:function(){return this.blur(),this.ui.hide(),this.minimize=!0,this.maximize=!1,this.triggerEvent("min"),this},max:function(){return this.minimize&&this.show(),this.disableResize().disableDrag(),this.resize("100%","100%",null,null,null,null,!1),this.sizeType="max",this.maximize=!0,this.minimize=!1,this.ui.addClass("maximize"),this.triggerEvent("max"),this},restore:function(){this.minimize&&this.show();var a=this.lastSize||{},b=a.left||0,c=a.top||0,d=a.width||this.ui.width(),e=a.height||this.ui.height();return this.enableResize().enableDrag(),this.resize(d,e,c,null,null,b,!1),this.sizeType="restore",this.minimize=!1,this.maximize=!1,this.ui.removeClass("maximize"),this.triggerEvent("restore"),this},sizeType:e.sizeType||"restore",rememberSize:function(a,b,c,d){return this.lastSize={top:c||this.ui.css("top"),left:d||this.ui.css("left"),width:a||this.ui.width(),height:b||this.ui.height()},this},openModalDialog:function(b,c){var d=this,e=c||d.constructor||a.Panel;return this.modalWindow=new e(b),this.modalWindow.opener=this,this.modalWindow.addEvent({afterClose:function(){d.modalWindow=null,d.show().focus()}}),e=null,this.modalWindow},focused:!1,focus:function(){var b,c,d,e,f,g,h,i=this.ui.parent();if(i.hasClass("current")||(c=a.system?a.system.getTaskByElement(i):null,c&&(d=c.index,desktop.show(d)),i=c=null),this.modalWindow)return b=a.getMaxZIndex(this.ui.parent()[0]),this.ui.css({zIndex:b}),this.modalWindow.focused?this.modalWindow.focus().flash():this.modalWindow.focus(),this;if(this.focused===!0)return this;this.focused=!0,a.Panel.removeSequence(this.cacheid),a.Panel.sequence.push(this.cacheid),this.unlock("blur"),e=a.getMaxZIndex(this.ui.parent()[0]),f=Math.max(window.parseInt(this.ui.css("top")),-6),this.ui.addClass("shadow").css({zIndex:e+1,top:f}),this.triggerEvent("focus"),g=a.Panel.cache;for(h in g)g.hasOwnProperty(h)&&g[h]!==this&&g[h].blur&&g[h].focused&&g[h].blur(!0);return g=null,this},blur:function(b){var c,d,e;if(b!==!0){for(d=a.Panel.sequence,c=d.length-2;c>-1;c--)if(e=a.Panel.cache[d[c]],this.ui&&e.ui&&this.ui.parent()[0]===e.ui.parent()[0]&&e&&!e.minimize&&!e.focused){e.focus();break}e=d=null}return this.focused=!1,this.ui.removeClass("shadow"),this.lock("blur","",.1),this.triggerEvent("blur"),this},resize:function(a){var c,d;switch(a){case"min":this.min();break;case"max":this.max();break;case"restore":this.restore();break;default:if(a){var f=b(e.area).size()?b(e.area):this.ui.parent(),g=!0;"object"!=typeof a?(d=arguments,c={width:d[0],height:d[1],top:d[2],right:d[3],bottom:d[4],left:d[5]}):(c=a,d=[c.width,c.height,c.top,c.right,c.bottom,c.left]),g=arguments[arguments.length-1]===!1?!1:g,c.width="auto"===c.width?f.innerWidth()-((isNaN(c.left)?20:c.left)+(isNaN(c.right)?20:c.right)):"100%"===c.width?f.innerWidth()+12:c.width,c.height="auto"===c.height?f.innerHeight()-((isNaN(c.top)?20:c.top)+(isNaN(c.bottom)?20:c.bottom)):"100%"===c.height?f.innerHeight()+12:c.height;var h=Math.max(c.width,e.minWidth),i=Math.max(c.height,e.minHeight),j="100%"===d[0]?-6:"auto"===c.left?Math.max(0,(f.width()-h)/2):c.left,k="auto"===c.right?Math.max(0,(f.width()-h)/2):c.right,l="100%"===d[1]?-6:"auto"===c.top?Math.max(0,(f.height()-i)/2):c.top,m="auto"===c.bottom?Math.max(0,(f.height()-i)/2):c.bottom;g!==!1&&b.extend(this.lastSize,{left:parseInt(this.ui.css("left")),top:parseInt(this.ui.css("top")),width:this.ui.width(),height:this.ui.height()}),this.ui.css({width:h,height:i,left:j,right:k,top:l,bottom:m}),this.panelLayout(),this.triggerEvent("resize",{width:h,height:i})}}return this},resizeWidth:function(a,b){return a=isNaN(a)?{width:a,left:b,right:b}:a,this.resize(a),this},resizeHeight:function(a,b){return a=isNaN(a)?{height:a,top:b,bottom:b}:a,this.resize(a),this},disableResize:function(){return this.ui.removeClass("resizable"),this},enableResize:function(){return this.ui.addClass("resizable"),this},disableDrag:function(){return this.ui.removeClass("draggable"),this},enableDrag:function(){return this.ui.addClass("draggable"),this},center:function(a,c,d){var f=c&&!isNaN(c)?c:this.ui.width(),g=d&&!isNaN(d)?d:this.ui.height(),h=e.left,i=e.top,j=document.documentElement.clientWidth||document.documentElement.offsetWidth,k=document.documentElement.clientHeight||document.documentElement.offsetHeight;return h=f>j?Math.max(document.documentElement.scrollLeft,document.body.scrollLeft):j/2+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)-f/2,i=g>k?Math.max(document.documentElement.scrollTop,document.body.scrollTop):k/2+Math.max(document.documentElement.scrollTop,document.body.scrollTop)-g/2,this.ui.css({top:i,left:h,width:f,height:g}),b.isFunction(a)&&a.call(this),this.triggerEvent("center"),this},lock:function(a,c,d){var e=b(".tbc-panel-locked-layer",this.ui);return e.css({display:"block"}),d&&e.css({opacity:d}),a&&e.addClass(a),this.part.maskTips.html(c),this.triggerEvent("lock"),this},unlock:function(a){var c=b(".tbc-panel-locked-layer",this.ui);return a&&c.removeClass(a),"tbc-panel-locked-layer"===b.trim(c.attr("class"))&&(c.css({display:"none"}),c.css({opacity:""})),this.part.maskTips.html(""),this.triggerEvent("unlock"),this},fling:function(){return this.shake()},shake:function(a){var c=this,d=this.ui;return d.animate({left:"-=5px"},40),d.animate({left:"+=10px"},40),d.animate({left:"-=5px"},40),d.animate({left:"+=4px"},40),d.animate({left:"-=4px"},40),d.animate({left:"+=2px"},40),d.animate({left:"-=2px"},40,function(){b.isFunction(a)&&a.call(c)}),d=null,this.triggerEvent("shake"),this.triggerEvent("fling"),this},scaleTo:function(a,c){var d=this,e=d.ui,f=e.width(),g=e.height(),h=e.css("left"),i=e.css("top"),j=b.isPlainObject(a)?a:b.extend({},b(a).offset(),{width:b(a).width(),height:b(a).height(),opacity:0});return e.animate(j,1200,"easeOutBounce",function(){d.ui.css({display:"none",width:f,height:g,left:h,top:i,opacity:1}),b.isFunction(c)&&c.call(d),d=null}),e=null,this},evert:function(){return(!a.msie||a.browserVersion>9)&&this.ui.css({"-moz-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)","-webkit-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)","-o-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)","-ms-transform":"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)",transform:"translateZ(-1000px) rotateY(180deg) rotateX(0deg) translateX(1000px)"}),this.triggerEvent("evert"),this},facade:function(){return(!a.msie||a.browserVersion>9)&&this.ui.css({"-moz-transform":"none","-webkit-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none"}),this.triggerEvent("facade"),this},enable3D:function(){return this.ui.parent().css({"-moz-transform-style":"preserve-3d","-webkit-transform-styles":"preserve-3d","-ms-transform-style":"preserve-3d","-o-transform-style":"preserve-3d","transform-style":"preserve-3d","-webkit-transform-style":"perspective"}),this.triggerEvent("enable3D"),this},disable3D:function(){return this.ui.parent().css({"-moz-transform-style":"none","-webkit-transform-style":"none","-ms-transform-style":"none","-o-transform-style":"none","transform-style":"none"}),this.triggerEvent("disable3D"),this},enableAnimate:function(a,b,c){var d=a||".4s",e=c||"ease",f=b||"0s",g=[d,e,f].join(" ");return this.ui.css({"-moz-transition":"-moz-transform "+g,"-webkit-transition":"-web-transform "+g,"-o-transition":"-o-transform "+g,"-ms-transition":"-ms-transform "+g,transition:"transform "+g}),this.triggerEvent("enableAnimate"),this},disableAnimate:function(){return this.ui.css({"-moz-transition":"","-webkit-transition":"","-o-transition":"","-ms-transition":"",transition:""}),this.triggerEvent("disableAnimate"),this},active:function(a){return a?this.ui.addClass("active"):this.ui.removeClass("active"),this.triggerEvent("active"),this},flash:function(a){var c=this.ui,d=function(){c.dequeue("flash")},e=40;return this.ui.queue("flash",[function(){c.css({opacity:.5}).removeClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:1}).addClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:.5}).removeClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:1}).addClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:.5}).removeClass("shadow"),setTimeout(d,e)},function(){c.css({opacity:1}).addClass("shadow"),setTimeout(function(){d(),c.verifyButton?c.verifyButton.focus():c.cancelButton&&c.cancelButton.focus(),b.isFunction(a)&&a.call(c)},e)}]).dequeue("flash"),this.triggerEvent("flash"),this},offset:function(){var a=this.ui,c=a.offset(),d=this.part.container;return b.extend(c,{offsetWidth:a.outerWidth(),offsetHeight:a.outerHeight(),containerWidth:d.innerWidth(),containerHeight:d.innerHeight(),width:a.width(),height:a.height(),scrollWidth:d[0].scrollWidth,scrollHeight:d[0].scrollHeight}),c}}).addEvent({afterClose:function(){var c,d,e=!1;for(d in a.Panel.cache)a.Panel.cache.hasOwnProperty(d)&&(c=a.Panel.cache[d],e=e||c.maximize);e||(taskbar&&taskbar.show(),desktop.setDockZindex(),b(".tbc-desktop-nav").css({zIndex:5})),c=null},max:function(){taskbar&&taskbar.hide(),b(".tbc-desktop-dock").css({zIndex:3}),b(".tbc-desktop-nav").css({zIndex:3})},min:function(){var c,d;for(d in a.Panel.cache)if(a.Panel.cache.hasOwnProperty(d)&&(c=a.Panel.cache[d],"max"===c.sizeType&&!c.minimize))return;c=null,taskbar&&taskbar.show(),desktop.setDockZindex(),b(".tbc-desktop-nav").css({zIndex:5})},restore:function(){var c,d;for(d in a.Panel.cache)if(c=a.Panel.cache[d],"max"===c.sizeType&&!c.minimize)return;c=null,taskbar&&taskbar.show(),desktop.setDockZindex(),b(".tbc-desktop-nav").css({zIndex:5})},destroy:function(){try{e=c=null}catch(a){}}}).init()},a.Panel.cache=a.Panel.cache||{},a.Panel.cacheid=isNaN(a.Panel.cacheid)||!a.Panel.cacheid?0:a.Panel.cacheid,a.Panel.cache_length=isNaN(a.Panel.cache_length)?0:a.Panel.cache_length,a.Panel.sequence=a.Panel.sequence||[],a.Panel.parent=".tbc-slide-scene.current",a.Panel.removeSequence=a.Panel.removeSequence||function(b){a.Panel.sequence=a.array.remove(a.Panel.sequence,b)}}(tbc,jQuery),tbc.Pop=function(a){var b=tbc.self(this,arguments);b.extend(tbc.Event,tbc.ClassManager),b.packageName="tbc.Pop";var c={width:320,height:180,icon:null,autoClose:!1,timeout:3,locate:null,parent:null,counter:".tbc-pop-close i"},d=tbc.extend({},c,a),e=null,f=d.timeout||5,g=tbc.getMaxZIndex()+1,h='<div class="tbc-pop" style="opacity:0.001; filter:alpha(opacity=0.01); z-index:'+g+';">'+'    <div class="tbc-pop-arrow">&diams;</div>'+'    <div class="tbc-pop-close"><i></i><a href="#">&times;</a></div>'+'    <div class="tbc-pop-inner">'+'        <div class="tbc-pop-icon"></div>'+'        <div class="tbc-pop-container"></div>'+"    </div>"+"</div>";
b.ui=$(h).css({width:d.width,height:d.height}).attr("tbc",b.guid).appendTo(d.parent||"body").bind(function(){b.focus()}),b.container=b.ui.find(".tbc-pop-container"),b.arrow=b.ui.find(".tbc-pop-arrow"),b.counter=$(d.counter,b.ui),b.extend({html:function(a){return b.container.html(a),b},focus:function(){var a=tbc.getMaxZIndex();return b.ui.css({zIndex:a+1}),b},show:function(){return b.ui.show(),b},hide:function(){return b.hide(),b},addCounter:function(a){return b.counter.add(a),b},countDown:function(a){return b.triggerEvent("beforeCountdown"),b.ui.find(".tbc-pop-close i").html(a),b.triggerEvent("countdown"),b},stop:function(){return b.triggerEvent("beforeStop"),clearInterval(e),f=0,b.triggerEvent("stop"),b},start:function(){return e=setInterval(function(){return 0>=f?(b.close(),void 0):(f--,b.countDown(f),void 0)},1e3),b.triggerEvent("start"),b},pause:function(){return clearInterval(e),b},resume:function(){return this.start(),b},close:function(){return b.triggerEvent("beforeClose")!==!1&&(clearInterval(e),b.ui.empty().remove(),b.triggerEvent("close"),b.DESTROY(),b=null),b},append:function(a){return b.triggerEvent("beforeAppend")!==!1&&(b.container.append(a.ui||a),b.triggerEvent("append")),b},prepend:function(a){return b.triggerEvent("beforeAppend")!==!1&&(b.container.prepend(a.ui||a),b.triggerEvent("append")),b},appendTo:function(a){return b.ui.appendTo(a.container||a),b},prependTo:function(a){return b.ui.prependTo(a.container||a),b},setArrowX:function(a,c){var d=b.ui.offset(),e=c||$(a).offset(),f=a.width()/2-14,g=e.left+f-d.left;return 0>g&&b.ui.css({left:"-="+Math.abs(g)+"px"}),b.arrow.css({top:"",left:Math.max(1,g)+"px"}),b},setArrowY:function(a,c){var d=b.ui.offset(),e=c||$(a).offset(),f=a.height()/2-14,g=e.top+f-d.top;return 0>g&&b.ui.css({top:"-="+Math.abs(g)+"px"}),b.arrow.css({left:"",top:Math.max(g,1)+"px"}),b},locate:function(a,c){if(a=a||d.locate?$(a||d.locate):b.lastLocate,b.lastLocate=a,!(a.size<0)){var e=b.getPosition(a,c),f=b.ui.data("lastClass")||"tbc-pop-left",g="",h="y";return"auto"===e.left?e.parent.height<e.locate.bottom?(g="tbc-pop-bottom",e.right-=e.locate.width,e.bottom+=e.parent.height+e.parent.scrollTop-e.locate.bottom+e.locate.height+20,h="x"):e.locate.top<0?(g="tbc-pop-top",e.right-=e.locate.width,e.top+=e.locate.height+4,h="x"):(g="tbc-pop-right",e.right+=4):e.parent.height<e.locate.bottom?(g="tbc-pop-bottom",e.left-=e.locate.width,e.bottom+=e.parent.height+e.parent.scrollTop-e.locate.bottom+e.locate.height+20,h="x"):e.locate.top<0?(g="tbc-pop-top",e.left-=e.locate.width,e.top+=e.locate.height+4,h="x"):(g="tbc-pop-left",e.left+=4),e.left="auto"===e.left?e.left:e.left+"px",e.bottom="auto"===e.bottom?e.bottom:e.bottom+"px",e.top="auto"===e.top?e.top:e.top+"px",e.right="auto"===e.right?e.right:e.right+"px",b.arrow.removeClass(f).addClass(g).data("lastClass",g),b.ui.css({left:e.left,right:e.right,top:e.top,bottom:e.bottom,opacity:1}),"x"===h?b.setArrowX(a,c):b.setArrowY(a,c),b}},getPosition:function(a,c){var e,f,g=$(a||d.locate),h=c?c.left:0,i=c?c.top:0,j=g.offset(),k=g.width(),l=g.height(),m=h||j.left,n=i||j.top,o=m+k,p=n+l,q=b.ui.width(),r=b.ui.height(),s=b.ui.offsetParent()[0].offsetHeight,t=b.ui.offsetParent()[0].offsetWidth,u="0",v="auto";return o+q>t&&m>q?(e=t-j.left,f="auto"):(e="auto",f=o),n+r>s?(u="auto",v=0):(u=n,v="auto"),{top:u,bottom:v,left:f,right:e,width:q,height:r,locate:{left:m,top:n,right:o,bottom:p,width:k,height:l},parent:{height:s,width:t,scrollTop:b.ui.offsetParent()[0].scrollTop,scrollLeft:b.ui.offsetParent()[0].scrollLeft}}}}),b.ui.find(".tbc-pop-close a").bind({click:function(){b.close()}}),d.autoClose===!0&&b.start(),b.addEvent({destroy:function(){b=c=d=e=f=g=h=null}})},function(a,b){"use strict";a.Tabpage=function(c){var d={title:null,icon:null,closable:!1,closeNode:null,handleNode:"",titleNode:null,iconNode:null,container:null,content:null,duration:300,easing:null,autoShow:!0},e=a.extend({},d,c),f=b(e.handleNode),g=b(e.iconNode,f),h=b(e.titleNode,f),i=b(e.container);a.self(this,arguments).extend({init:function(){this.packageName="tbc.Tabpage",e.group&&(this.group=e.group,this.appendTo(this.group)),e.autoShow&&this.show()},handle:f,container:i,ui:i,title:function(a){var c;a?(h.html(a),c=this):c=b.trim(h.html());try{return c}finally{c=null}},icon:function(a){var b;a?(g.attr("src",a),b=this):b=g.attr("src");try{return b}finally{b=null}},outToBottom:function(a){this.triggerEvent("beforeHide");var c=this,d=i.parent(),f=d.height();i.animate({top:f},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},outToTop:function(a){this.triggerEvent("beforeHide");var c=this,d=i.height();i.animate({top:-d},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},outToRight:function(a){this.triggerEvent("beforeHide");var c=this,d=i.parent(),f=d.width();i.animate({left:f},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},outToLeft:function(a){this.triggerEvent("beforeHide");var c=this,d=i.width();i.animate({left:-d},e.duration,"swing",function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},inFromTop:function(a){this.triggerEvent("beforeShow");var c=this,d=i.height();i.css({top:-d}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},inFromBottom:function(a){this.triggerEvent("beforeShow");var c=this,d=i.parent(),f=d.height();i.css({top:f}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},inFromLeft:function(a){var c=this,d=i.width();this.triggerEvent("beforeShow"),i.css({left:-d}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},inFromRight:function(a){var c=this,d=i.parent(),f=d.width();this.triggerEvent("beforeShow"),i.css({left:f}).show().animate({top:0,left:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},fadeOut:function(a){var c=this;this.triggerEvent("beforeHide"),i.css({top:0,left:0}).animate({opacity:0},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("hide")})},fadeIn:function(a){var c=this;this.triggerEvent("beforeShow"),i.css({top:0,left:0}).show().animate({opacity:1},e.duration,e.easing,function(){b.isFunction(a)&&a(),c.triggerEvent("show")})},show:function(a){this.triggerEvent("beforeShow"),i.css({top:0,left:0,opacity:1}).show(),b.isFunction(a)&&a(),this.triggerEvent("show")},hide:function(a){this.triggerEvent("beforeHide"),i.css({top:0,left:0}).hide(),b.isFunction(a)&&a(),this.triggerEvent("hide")},close:function(){e.closable&&this.triggerEvent("beforeClose")!==!1&&(b(e.handleNode).empty().remove(),i.empty().remove(),this.triggerEvent("close"),delete this.group,this.DESTROY(),d=e=f=g=h=i=null)},appendTo:function(a){return this.group&&this.group.remove(this.index),a.append(this),this.group=a,this},prependTo:function(a){return this.group&&this.group.remove(this.index),a.prepend(this),this.group=a,this}}).addEvent({beforeShow:function(){this.handle.addClass(e.currentClass||"current"),this.container.addClass(e.currentClass||"current")},beforeHide:function(){this.handle.removeClass(e.currentClass||"current"),this.container.removeClass(e.currentClass||"current")},hide:function(){i.hide()},destroy:function(){d=e=c=f=g=h=i=null}}).init()}}(tbc,jQuery),function(a,b){"use strict";a.Tabset=function(c){var d={container:".tbc-tabset",header:".tbc-desktop-nav",prevHandle:".tbc-tabset-prev",nextHandle:".tbc-tabset-next",effects:"slide-x",easing:"swing",loop:!0,auto:!0,timeout:5e3,speed:800},e=b.extend({},d,c);a.self(this,arguments).extend({init:function(){var c=this;if(this.packageName="tbc.Tabset",this.header=b(e.header),this.container=b(e.container),this.tabs=[],this.currIndex=0,a.touchable){var d,f=0,g=0;this.container[0].addEventListener("touchstart",function(a){f=a.touches[0].pageX,g=a.touches[0].pageY,d=(new Date).getTime()}),this.container[0].addEventListener("touchmove",function(a){var b=a.touches[0].pageX,d=a.touches[0].pageY;c.current().ui.css({left:b-f}),b=d=null}),this.container[0].addEventListener("touchend",function(a){var b=a.changedTouches[0].pageX,e=a.changedTouches[0].pageY,g=(new Date).getTime(),h=Math.abs(b-f),i=c.container.width();h>i/2||h>i/2/(1e3/(g-d))?f>b&&!c.isLast()?c.next():b>f&&!c.isFirst()?c.prev():c.current().ui.animate({left:0}):c.current().ui.animate({left:0}),b=e=i=null})}},isFirst:function(){return 0===this.currIndex},isLast:function(){return this.currIndex===this.tabs.length-1},current:function(){return this.tabs[this.currIndex]},next:function(a){var b=this.tabs[this.currIndex],c=isNaN(a)?this.currIndex+1>=this.tabs.length?0:this.currIndex+1:a;switch(this.effect()){case"slide-x":b&&b.outToLeft(),this.tabs[c].inFromRight();break;case"slide-y":b&&b.outToTop(),this.tabs[c].inFromBottom();break;case"fade":b&&b.fadeOut(),this.tabs[c].fadeIn();break;default:b&&b.hide(),this.tabs[c].show()}return this.currIndex=c,this},prev:function(a){var b,c,d=this.tabs[this.currIndex],e=isNaN(a)?this.currIndex-1<0?this.tabs.length-1:this.currIndex-1:a,f=this.tabs[e];switch(this.effect()){case"slide-x":b="inFromLeft",c="outToRight";break;case"slide-y":b="inFromTop",c="outToBottom";break;case"fade":b="fadeIn",c="fadeOut";break;default:b="show",c="hide"}return d&&"function"==typeof d[c]&&d[c](),f&&"function"==typeof f[b]&&f[b](),this.currIndex=e,this},show:function(a){var b,c=this.currIndex;return a=a||0,c>a?this.prev(a):a>c?this.next(a):(b=this.tabs[this.currIndex],b&&b.fadeIn()),this},append:function(a){var c=this;return this.header.append(a.handle),this.container.append(a.container),this.tabs.push(a),a.handle.bind("click",function(){c.show(a.index)}),a.autoShow&&this.show(this.tabs.length-1),a.index=this.tabs.length-1,a.group=this,a.addEvent({close:function(){c.remove(a.index)},beforeShow:function(){var a=this.index;b.each(c.tabs,function(b,d){b!==c.currIndex&&b!==a&&d.hide()})}}),this},prepend:function(a){var b=this;return this.header.prepend(a.title),this.container.prepend(a.content),this.tabs=[a].concat(this.tabs),a.autoShow&&this.show(0),a.index=0,a.group=this,a.addEvent({close:function(){b.remove(a.index)}}),this},effect:function(a){return"string"!=typeof a?e.effects:(e.effects=a,this)},easing:function(a){return"string"!=typeof a?e.easing:(e.easing=a,this)},remove:function(a){return a===this.currIndex?a<this.tabs.length-1?(this.excludeTab(a),this.next()):a>0&&(this.excludeTab(a),this.prev()):a<this.currIndex?(this.excludeTab(a),this.currIndex-=1,this.show(this.currIndex)):this.excludeTab(a),this},excludeTab:function(a){var b,c,d,e=[];for(c=0,d=this.tabs.length;d>c;c++)b=this.tabs[c],b&&b.index!==a&&(b.index=e.length,e.push(b));return b=null,this.tabs=e,this}}).addEvent({destroy:function(){d=e=c=null}}).init()}}(tbc,jQuery),tbc.namespace("tbc.tree"),tbc.tree.Editor=tbc.tree.Editor||function(a){var b=tbc.self(this,arguments),c={editUrl:"",addible:!0,editable:!0,deletable:!0},d=$.extend({},c,a);b.extend([tbc.Tree,a],{packageName:"tbc.tree.Editor",isDeletable:function(a){return this.hasChildren(a)},hoverTools:function(a){var b=[],c="string"==typeof a?this.cache(a):a;!d.level||c.level<d.level?b.push('<a href="javascript:void(0);" class="stree-add">新增</a>'):b.push('<span style="color:#888; text-decoration:line-through;">新增</span>');var e=this.isRoot(a);e||(b.push('<a href="javascript:void(0);" class="stree-edit">编辑</a>'),this.isFirst(a)?b.push('<span style="color:#888; text-decoration:line-through;">上移</span>'):b.push('<a href="javascript:void(0);" class="stree-moveup">上移</a>'),this.isLast(a)?b.push('<span style="color:#888; text-decoration:line-through;">下移</span>'):b.push('<a href="javascript:void(0);" class="stree-movedown">下移</a>'),this.isDeletable(a)?b.push('<span style="color:#888; text-decoration:line-through;">删除</span>'):b.push('<a href="javascript:void(0);" class="stree-delete">删除</a>'));try{return b.join("&nbsp;&nbsp;|&nbsp;&nbsp;")}finally{c=b=""}},nodeAddHandle:function(a){var c="string"==typeof a?this.cache(a):a;c&&this.triggerEvent("beforeAdd",c)!==!1&&(this.addbox?(this.addbox.show(),this.addbox.locate($(".stree-text",c.html)),this.addbox.container.find("._cont").empty().load(d.addUrl)):(this.addbox=new tbc.Pop({name:"新增",width:400,height:340}),this.addbox.appendTo("body"),this.addbox.show(),this.addbox.locate($(".stree-text",c.html)),this.addbox.addEvent({close:function(){b.addbox=null}}),this.addbox.append('<div class="tbc-titleBar"><b>新增</b> &nbsp;<i style="color:#aaa;">(双击标题关闭)</i></div><div class="_cont"><div style="text-align:center;">Loading...</div></div>'),this.addbox.container.delegate(".tbc-titleBar","dblclick",function(){b.addbox.close()}).find("._cont").load(d.addUrl,{id:c.property.id})),this.addbox.__nodeid=c.property.id)},nodeEditHandle:function(a){var c="string"==typeof a?this.cache(a):a;c&&this.triggerEvent("beforeEdit",c)!==!1&&(this.editbox?(this.editbox.show(),this.editbox.locate($(".stree-text",c.html)),this.editbox.container.find("._cont").empty().load(d.editUrl)):(this.editbox=new tbc.Pop({width:400,height:340}),this.editbox.appendTo("body"),this.editbox.show(),this.editbox.locate($(".stree-text",c.html)),this.editbox.addEvent({close:function(){b.editbox=null}}),this.editbox.append('<div class="tbc-titleBar"><b>编辑:</b><i>'+(c.property.nm||c.property.text||"")+'</i> &nbsp;<i style="color:#aaa;">(双击标题关闭)</i></div><div class="_cont"></div>'),this.editbox.container.delegate(".tbc-titleBar","dblclick",function(){b.editbox.close()}).find("._cont").load(d.editUrl,{id:c.property.id})),this.editbox.__nodeid=c.property.id)},nodeDeleteCheck:function(){},nodeDelete:function(a){a="string"==typeof a?this.cache(a):a;var c=$(a.html).css({background:"yellow"});if(c.hasClass("disabled"))return c=null,!1;c.addClass("disabled");var d=b,e=c.find(".stree-delete"),f=e.offset(),g=$('<div class="tbc-tips">确定删除吗?&nbsp;&nbsp;<a class="_dle" href="javascript:void(0);">删除</a>&nbsp;<a class="_cancel" href="javascript:void(0);">取消</a></div>').css({left:f.left,top:f.top-12,opacity:0,background:"#fff",border:"1px solid #ccc",padding:"6px",position:"absolute",zIndex:"10000"}).appendTo("body").animate({left:"+=24px",opacity:1},200),h=function(){g&&g.stop().animate({left:"-=64px",opacity:0},200,function(){c&&c.css({background:""}).removeClass("disabled"),g&&g.remove(),a=d=c=e=f=g=h=null})};g.delegate("a._dle","click",function(){d.nodeDeleteAjax(a),h()}),g.delegate("a._cancel","click",function(){h()}),g.animate({opacity:0},1e4,h)},removeNode:function(a){for(var b,c="string"==typeof a?this.cache(a):a,d=c.parents[c.parents.length-1],e=this.cache(d).property.sn,f=c.html,g=0,h=e.length;h>g;g++)if(e[g].id===a){b=g;break}this.cache(d).property.sn=e.slice(0,b).concat(e.slice(b+1,h)),f.parentNode.removeChild(f),c=d=e=b=f=h=null},nodeDeleteAjax:function(a){a="string"==typeof a?a:a.property?a.property.id:null;var c=b;d.deleteUrl&&a&&$.ajax({url:d.deleteUrl,type:"post",dataType:"json",data:{id:a,action:"delete"},beforeSend:function(){},complete:function(){},error:function(){},success:function(b){b.success?(c.deleteNode(a),c.triggerEvent("delete",a),c=null):alert(b.message||"删除失败")}})},nodeMoveup:function(a){if(a&&!this.isFirst(a)){for(var b,c=this.cache(a),d=c.parents[c.parents.length-1],e=this.cache(d).property.sn,f=0,g=e.length;g>f;f++)if(e[f].id===a){b=e[f-1],e[f-1]=e[f],e[f]=b;break}var h=$(c.html).parent();h.insertBefore(h.prev()),this.nodeMoveAjax(a,"up"),c=h=paren=e=next=null}},nodeMovedown:function(a){if(a&&!this.isLast(a)){for(var b,c=this.cache(a),d=c.parents[c.parents.length-1],e=this.cache(d).property.sn,f=0,g=e.length;g>f;f++)if(e[f].id===a){b=e[f+1],e[f+1]=e[f],e[f]=b;break}var h=$(c.html).parent();h.insertAfter(h.next()),this.nodeMoveAjax(a,"down"),c=h=paren=e=b=null}},nodeMoveAjax:function(a,c){a="string"==typeof a?a:a.property?a.property.id:null;var e=b;d.moveUrl&&a&&c&&$.ajax({url:d.moveUrl,type:"post",data:{id:a,type:c},dataType:"html",beforeSend:function(){},complete:function(){},error:function(){},success:function(){e.triggerEvent("move",a,c),e=null}})}}),b.ui.delegate(".stree-node","mouseenter",function(){var a=this.getAttribute("data-id"),c=b.hoverTools(a);$(this).addClass("stree-node-hover").find(".stree-node-tools").css({display:"inline"}).html(c)}),b.ui.delegate(".stree-node","mouseleave",function(){$(this).removeClass("stree-node-hover").find(".stree-node-tools").hide().html("")}),b.ui.delegate(".stree-add","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeAddHandle(c)}),b.ui.delegate(".stree-moveup","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeMoveup(c)}),b.ui.delegate(".stree-movedown","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeMovedown(c)}),b.ui.delegate(".stree-edit","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeEditHandle(c)}),b.ui.delegate(".stree-delete","click",function(a){a.stopPropagation();var c=this.parentNode.parentNode.getAttribute("data-id");b.nodeDelete(c)})},function(a,b){window.tbc=a||{},a.Tree=function(c){"use strict";var d=a.self(this,arguments),e={width:"auto",height:"auto",url:null,level:1,lazyLevel:4,deleteNode:!0,upNode:!0,downNode:!0,cascadeCheck:!0,singleCheck:!1,multiple:!1,editable:!0,addUrl:null,deleteUrl:null,editUrl:null,moveUrl:null,data:null,addNode:!0,extool:[],confirmmsg:"确定要删除{name}吗?",exconfirmmsg:"删除后将无法恢复,确定要删除吗?",errormsg:"无法删除",formatExtool:function(){},isRetracted:!0,renderTo:""},f=b.extend({},e,c);f.container=f.ui?b(f.ui).find(f.container):b(f.container),f.ui=f.ui?b(f.ui):f.container,d.addEvent(f.event),d.addEvent({afterRender:function(){b.isFunction(f.onLoad)&&f.onLoad.apply(this,arguments)},select:function(){b.isFunction(f.onSelect)&&f.onSelect.apply(this,arguments)},deleteNode:function(){b.isFunction(f.onDelete)&&f.onDelete.apply(this,arguments)},check:function(){b.isFunction(f.onCheck)&&f.onCheck.apply(this,arguments)},move:function(){b.isFunction(f.onMove)&&f.onMove.apply(this,arguments)},addNode:function(){b.isFunction(f.onAdd)&&f.onAdd.apply(this,arguments)}}),d.packageName="tbc.Tree",d.extend({ui:f.ui,container:f.container,appendTo:function(a){b(a).size()&&this.container.appendTo(a)},data:null,init:function(){switch(f.dataType){case"json":this.render(f.data);break;case"ajax":this.load();break;default:this.load()}},load:function(){var a=b.ajax({url:f.url,type:f.param?"post":"get",data:b.extend({},f.param,{noDepPath:f.noDepPath}),dataType:"json",beforeSend:function(){d.triggerEvent("beforeLoad")},complete:function(){d.triggerEvent("afterLoad")},error:function(){d.triggerEvent("error","loading failed!")},success:function(a){d.render(a)}});this.addEvent({destroy:function(){a.abort&&a.abort(),a=null}})},render:function(a){this.triggerEvent("beforeRender"),(new Date).getTime(),this.container.html(this.createChild(a)),this.addHtmlCache(),this.triggerEvent("afterRender")},addHtmlCache:function(a){a=a?b(a):this.container.find("dt.stree-node");var c=d;b(a).each(function(){var a=this.getAttribute("data-id");c.cache(a,"html",this)}),c=a=null},cache:function(a,b,c){if("index"===a)return this._cacheIndex;if(!a)return this._cacheData;var d=this._cacheData[a];if(d||(d=this._cacheData[a]={}),b)void 0!==c&&(d[b]=c);else try{return d}finally{d=null}try{return d[b]}finally{d=null}},_cacheData:{},_cacheIndex:[],createChild:function(a,b,c,d){b=b||0,c=c||[];var e,f,g,h,i,j=a.length;for(i=0;j>i;i+=1)if(h=a[i],g=h.id,h.children&&!h.sn&&(h.sn=h.children),this.cache(g,"property",h),this.cache(g,"level",b),this.cache(g,"parents",c),this._cacheIndex.push(g),d===!0){if(!this._delayCreateNode)break;this._delayCreateNode(h,b,c.concat([g]),f,d)}else 0===i&&(f="first"),i===j-1&&(f="last"),e||(e=["<ul>"]),e.push(this.createNode(h,b,c.concat([g]),f,d)),"last"===f&&e.push("</ul>");try{return e?e.join(""):""}finally{e=null}},_delayCreateNode:function(a,b,c,d,e){var f=this;setTimeout(function(){f.createNode&&f.createNode(a,b,c,d,e),f=null},0)},createNode:function(b,c,d,e,g){var h,i,j,k,l,m,n,o,p,q=b.id,r=b.sn||b.children;if(g===!0&&r&&r.length>0)return this.createChild(r,c+1,d,g),r=null,"";h=f.lazyLevel||2,i=this.cache(q),j=b.nm||b.text,k="",l="first"===e?" tbc-tree stree-node-first":"last"===e?" stree-node-last":"",m="stree-node stree-level-{3}"+l+(r&&0!==r.length?"":" stree-leaf"),n='<div class="stree-node-tools" style="display:none; float:none;"></div>',o=f.checkbox?'<span class="tbc-checkbox stree-checkbox" data-id="{0}" data-text="{1}">    <input type="checkbox" name="'+f.checkboxName+'" value="{0}" title="{1}" '+(i&&i.checked?' checked="checked" ':"")+"/>"+"</span>":"",p='<li>    <dt data-id="{0}" data-text="{1}" title="{1}" class="{2}">        <span class="stree-space" style="width:'+16*c+'px;"></span>'+'        <span class="stree-handle" level="{3}"></span>'+o+'        <span class="stree-icon stree-icon-{3}"></span>'+'        <span class="stree-text">{1}</span>'+"       {4}"+"    </dt>"+"    {5}"+"</li>",r&&r.length>0&&(h>c?(k=this.createChild(r,c+1,d),this.cache(q,"rendered",!0)):r&&(this.createChild(r,c+1,d,!0),m+=" stree-node-retracted")),p=a.formatString(p,q,j,m,c,n,k);try{return p}finally{m=r=p=q=j=null}},addNode:function(a,c,d,e){var f,g="string"==typeof a?{id:a,pr:d,nm:c,sg:e}:a,h=this.cache(d),i=b(h.html).removeClass("stree-leaf");switch(e){case"prepend":this.prependNode.apply(this,arguments);break;case"append":this.appendNode.apply(this,arguments);break;default:this.insertNode.apply(this,arguments)}g=h=i=f=null},appendNode:function(a,c,d){var e,f,g="string"==typeof a?{id:a,pr:d,nm:c}:a,h=this.cache(d),i=b(h.html).removeClass("stree-leaf");g&&(f=h.parents.concat([g.pr]),e=b(this.createChild([g],h.level+1,f)),i.next("ul").size()?i.next("ul").append(e.html()):i.after(e),this.addHtmlCache(i.next("ul").find(".stree-node")),h.rendered=!0),h.property.sn=h.property.sn||[],h.property.sn.push(g),this.triggerEvent("addNode",g),g=h=i=e=f=null},prependNode:function(a,c,d){var e,f,g="string"==typeof a?{id:a,pr:d,nm:c}:a,h=this.cache(d),i=b(h.html).removeClass("stree-leaf");g&&(f=h.parents.concat([g.pr]),e=b(this.createChild([g],h.level+1,f)),i.next("ul").size()?i.next("ul").prepend(e.html()):i.after(e),this.addHtmlCache(i.next("ul").find(".stree-node")),h.rendered=!0),h.property.sn=[g].concat(h.property.sn||[]),this.triggerEvent("addNode",g),g=h=i=e=f=null},adjustNode:function(){},insertNode:function(a,c,d,e){var f,g,h,i,j="string"==typeof a?{id:a,pr:d,nm:c,sg:e}:a,k=this.cache(d),l=b(k.html).removeClass("stree-leaf"),m=k.property.sn||[];if(e="string"==typeof e?this.cache(e):e){for(g=k.parents.concat([j.pr]),f=b(this.createChild([j],k.level+1,g)),h=0,i=m.length;i>h;h+=1)if(m[h].id===e.property.id){k.property.sn=m.slice(0,h).concat([j]).concat(m.slice(h,i)),l.next("ul").size()?b(this.cache(m[h].id,"html")).after(f.html()):l.after(f);break}this.addHtmlCache(l.next("ul").find(".stree-node[data-id='"+j.id+"']")),k.rendered=!0}else this.appendNode(a,c,d);this.triggerEvent("addNode",j),j=k=l=m=f=g=null},renameNode:function(a,c){if(a="string"==typeof a?this.cache(a):a,a&&c){var d=b(a.html).find(".stree-text"),e=d.text();a.property&&(a.property.nm=c),d.html(c),this.triggerEvent("rename",a,c,e),d=e=null}},deleteNode:function(a){if(a="string"==typeof a?this.cache(a):a,!this.hasChildren(a)){var c,d,e,f,g,h=a.parents;if(h&&h.length>0){for(c=this.cache(h[h.length-1]),d=c.property.sn||[],e=[],f=0,g=d.length;g>f;f+=1)d[f].id!==a.property.id&&e.push(d[f]);c.property.sn=e}b(a.html).remove(),this.triggerEvent("deleteNode",a,h),d=e=null}},toggleNode:function(a){var c="string"==typeof a?this.container.find("div[data-id='"+a+"']"):b(a);0!==c.size()&&(c.hasClass("stree-node-retracted")?this.unfoldNode(c):this.foldNode(c))},unfoldNode:function(a){var c="string"==typeof a?this.container.find("div[data-id='"+a+"']"):b(a);0!==c.size()&&(c.removeClass("stree-node-retracted"),c.next("ul").removeClass("hide")),this.triggerEvent("unfold",c)},foldNode:function(a){var c="string"==typeof a?this.container.find("div[data-id='"+a+"']"):b(a);0!==c.size()&&(c.addClass("stree-node-retracted"),c.next("ul").addClass("hide")),this.triggerEvent("fold",c)},getChecked:function(){var a,b,c,d=[],e=this._cacheIndex;for(b=0,c=e.length;c>b;b+=1)a=this.cache(e[b]),a.checked&&d.push(a);try{return d}finally{d=a=e=null}},getChildNodes:function(a,b){var c,d,e,f,g="string"==typeof a?this.cache(a):a,h=g&&g.property?g.property.sn||g.property.children||[]:[],i=[];for(e=0,f=h.length;f>e;e+=1)c=h[e],d=this.cache(c.id),d&&i.push(d),b&&(c.sn||c.children)&&(i=i.concat(this.getChildNodes(c.id,b)));try{return i}finally{g=h=i=c=d=a=null}},isRoot:function(a){var b="string"==typeof a?this.cache(a):a;try{return b&&0===b.level}finally{b=null}},getSiblings:function(a){var b,c,d,e,f="string"==typeof a?this.cache(a):a,g=f.parents?f.parents[f.parents.length-1]:null,h=g&&g.property?g.property.sn||g.property.children||[]:[],i=[];for(g&&(g=this.cache(g)),d=0,e=h.length;e>d;d+=1)b=h[d],c=this.cache(b.id),c&&b.id!==a&&i.push(c);try{return i}finally{f=g=h=i=b=c=a=null}},checkNode:function(c,e){return a.isArray(c)?(!1!==this.triggerEvent("beforeCheck",c)&&c.length>0&&a.batch(c,1e3,0,10,function(g,h,i){var j,k,l;for(k=0,l=g.length;l>k;k+=1)j=g[k],"string"==typeof j&&(j=d.cache(j)),j.checked=!0,b(j.html).addClass(f.checkedCss||"stree-node-checked").find("input[type='checkbox']").attr("checked",!0);!h||a.isFunction(e)&&e.call(d,c)===!1||d.triggerEvent("check",c),4===i&&a.lock(d.ui)},function(){a.unlock(d.ui)}),void 0):a.log("Error at tbc.Tree().checkNode(list): arguments[0]:list must be an array;")},uncheckNode:function(c,e){return a.isArray(c)?(!1!==this.triggerEvent("beforeUncheck",c)&&c.length>0&&a.batch(c,1e3,0,10,function(g,h,i){var j,k,l;for(k=0,l=g.length;l>k;k+=1)j=g[k],"string"==typeof j&&(j=d.cache(j)),j.checked=!1,b(j.html).removeClass(f.checkedCss||"stree-node-checked").find("input[type='checkbox']").removeAttr("checked");!h||a.isFunction(e)&&e.call(d,c)===!1||d.triggerEvent("uncheck",c),4===i&&a.lock(d.ui)},function(){a.unlock(d.ui)}),void 0):a.log("Error at tbc.Tree().uncheckNode(list): arguments[0]:list must be an array;")},chooseNode:function(a,b){a="string"==typeof a?this.cache(a):a;var c=f,d=this.getWillBeChecked(a);c.singleCheck?(!b&&c.singleCheck&&this.uncheckNode(this.getWillBeUnchecked(a)),a.checked?this.uncheckNode(d):this.checkNode(d)):a.checked?this.uncheckNode(d):this.checkNode(d),a=d=c=null},getWillBeChecked:function(a){a="string"==typeof a?this.cache(a):a;var b=[a];f.cascadeCheck&&(b=b.concat(this.getChildNodes(a,!0)));try{return b}finally{b=a=null}},getWillBeUnchecked:function(b){b="string"==typeof b?this.cache(b):b;var c,d,e,g=this.cache(),h=this.cache("index"),i=[];for(d=0,e=h.length;e>d;d+=1)c=h[d],!f.cascadeCheck&&b&&b.property.id!==c&&g[c].checked?i.push(g[c]):b&&b.property.id!==c&&g[c].checked&&-1===a.array.indexOf(b.property.id,g[c].parents)&&i.push(g[c]);try{return i}finally{i=g=h=c=null}},hasChildren:function(a){var b="string"==typeof a?this.cache(a):a;try{return b&&b.property.sn&&b.property.sn.length>0}finally{b=null}},isFirst:function(a){var b="string"==typeof a?this.cache(a):a,c=b.parents[b.parents.length-1],d=c?this.cache(c).property.sn:null,e=d&&d[0].id===a?!0:!1;try{return e}finally{b=c=d=null}},isLast:function(a){var b="string"==typeof a?this.cache(a):a,c=b.parents[b.parents.length-1],d=c?this.cache(c).property.sn:null,e=d&&d[d.length-1].id===a;try{return e}finally{b=c=d=null}},setCurrent:function(a){a="string"==typeof a?this.cache(a):a||this.getCurrent();var c,d=f.currentCss||"stree-node-selected",e=a.property,g=a.html,h=e&&e.sn&&e.sn.length>0;return e&&(e.tp=e.tp||"ORGANIZATION"),b(a.html).hasClass(d)?(this.triggerEvent("select",e,b(g),h),d=e=g=h=null,void 0):(c=this.container.find("dt."+d).removeClass(d).attr("data-id"),this.cache(c,"current",!1),b(a.html).addClass(d),a.current=!0,this.triggerEvent("select",e,b(g),h),d=e=g=h=null,void 0)},selectNode:function(a,c,d){var e="string"==typeof a?this.cache(a):a||this.getCurrent(),g=f.currentCss||"stree-node-selected",h=e.property,i=e.html,j=h&&h.sn&&h.sn.length>0;h&&(h.tp=h.tp||"ORGANIZATION"),e.current===!0?c!==!0?this.deselectNode(this.getSelectedList()):(b(e.html).removeClass(g),e.current=!1):(b(e.html).addClass(g),e.current=!0,this.triggerEvent("select",h,b(i),j,d),c!==!0&&this.deselectNode(this.getSelectedList([e.property.id]))),g=h=i=j=null},deselectNode:function(a){var c,d,e=f.currentCss||"stree-node-selected";for(c=0,d=a.length;d>c;c+=1)b(a[c].html).removeClass(e),a[c].current=!1;this.triggerEvent("deselect",a)},getCurrent:function(){var a,b,c,d;for(c=0,d=this._cacheIndex.length;d>c;c+=1)if(b=this._cacheIndex[c],a=this.cache(b),a.current===!0)try{return a}finally{b=a=null}b=this.container.children("ul:first").children("li:first").children(".stree-node").attr("data-id");try{return this.cache(b)}finally{b=a=null}},getSelectedList:function(a){a=b.isArray(a)?a:[a];var c,d,e,f,g,h,i=[];for(d=0,e=this._cacheIndex.length;e>d;d+=1)if(c=this._cacheIndex[d],this.cache(c).current){for(f=!1,g=0,h=a.length;h>g;g+=1)if(a[g]===c){f=!0;break}f||i.push(this.cache(c))}try{return i}finally{c=i=null}},getFirstNode:function(){var a=this.container.children("ul:first").children("li:first").children(".stree-node").attr("data-id");try{return this.cache(a)}finally{a=null}}}),d.ui.delegate(".stree-handle","click",function(a){a.stopPropagation();var c,e,f,g,h=d,i=this.parentNode,j=i.getAttribute("data-id"),k=h.cache(j),l=k.property,m=l.sn||l.children;h.toggleNode(i),l&&m&&!k.rendered&&(c=window.parseInt(k.level)+1,e=h.createChild(m,c,k.parents.concat([j])),k.rendered=!0,h.cache(j,"rendered",!0),f=b(this.parentNode.parentNode).append(e),g=f.find("dt.stree-node"),h.addHtmlCache(g),h.triggerEvent("itemRender",m),m=c=e=null),h=i=j=k=null}),d.ui.delegate(".stree-node","click",function(a){var b=this.getAttribute("data-id");d.selectNode(b,a.ctrlKey&&f.multiple)}),d.ui.delegate(".stree-node","dblclick",function(a){var b=this.getAttribute("data-id"),c=!0;d.selectNode(b,a.ctrlKey&&f.multiple,c)}),f.checkbox&&d.ui.delegate("input[type='checkbox']","click",function(a){d.chooseNode(this.value,a.ctrlKey||!f.singleCheck),a.stopPropagation()})}}(tbc,jQuery),tbc.namespace("tbc.tree"),tbc.tree.Online=function(a){var b,c=tbc.self(this,arguments),d={},e=$.extend({},d,a);c.extend([tbc.Tree,a],{packageName:"tbc.tree.Online",renderOnlineNumber:function(){this.batch(this._cacheIndex,1e3,0,10,function(a,c){for(var d,e=0,f=a.length;f>e;e++)d=a[e],this.render2Html(d,this.cache(d,"amount"));if(a=d=null,c){var g=this;b=setTimeout(function(){g.request(),g=null},this.interval||18e4)}})},singleRender:function(a){var b,c,d;for(a=$.isArray(a)?a:[a],b=0,c=a.length;c>b;b++)d=a[b],this.render2Html(d,this.cache(d,"amount"))},render2Html:function(a,b){b=!b||isNaN(b)?0:b;var c=$(this.cache(a,"html")),d=c.find(".stree-count");c.size()&&(d.size()?d.html("&nbsp;["+b+"]"):c.append('<i class="stree-count">&nbsp;['+b+"]</i>"))},countOnlineNumber:function(a,b){b=b||[];for(var c,d,e,f,g,h=0,i=a.length;i>h;h++)f=a[h],c=f.id,d=f.n,e=f.sn||f.c,this.cache(c,"amount",d),e&&e.length>0&&this.countOnlineNumber(e,b.concat([c])),this.updateParents(b,d);c=d=e=f=g=null},updateParents:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=this.cache(a[c],"amount");this.cache(a[c],"amount",b+e)}},request:function(){var a=c;$.ajax({url:e.onlineUrl,type:"get",dataType:"json",success:function(b){a.countOnlineNumber(b),a.renderOnlineNumber(),a=null}})},start:function(){this.request()},stop:function(){clearTimeout(b)}}),c.addEvent({itemRender:function(a){try{for(var b=0,c=a.length,d=[];c>b;b++)d.push(a[b].id);this.singleRender(d)}catch(e){alert(e.line)}}})};